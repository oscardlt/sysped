      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/EPOMS13 MODULE(*LIBL/EPOMS13
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10261 * 01 YBC PTF10 VEKT/KUBIKK I TURER ER ENDRET TIL 9.0 OG 7.3
10XXX * 02 YBC PTF10 TEST FRA/TIL STEDSKODE PÅ LINJE-NIVÅ
10XXX * 03 jov PTF10 MAXSND økt 500->2000,Quick/dirty -det viser seg at det IKKE mottas parameter
xxxxxx*xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
11XXX * 04 YBC PTF11 KUNDE 12497 (EUROPRIS) IKKE PLUKK PÅ HEADER-NIVÅ
11XXX * 05 YBC PTF11 ARBEID MED KOLLI
11XXX * 06 YBC PTF11 VISE KUN REST VEKT OG KUBIKK
11XXX * 07 YBC PTF11 VISE "DIRECT" FOR DIREKT SENDING
********************************************************************
      *
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     UF   E           K DISK    USROPN
     FHEADF     UF   E           K DISK    USROPN
     FTURER14   UF   E           K DISK    USROPN
     FEPOH      UF   E           K DISK    USROPN
     FEPOH01    IF   E           K DISK    USROPN
     F                                     RENAME(EPOHR:EPOHR01)
N05  FEPOH06    IF   E           K DISK    USROPN
N05  F                                     RENAME(EPOHR:EPOHR06)
     FEPOL      UF   E           K DISK    USROPN
     FEPOTT     O  A E             DISK    USROPN
N07  FEPOTT01   IF   E           K DISK    USROPN
N07  F                                     RENAME(EPOTTR:EPOTTR01)
N07  F                                     PREFIX(T01_)
     FEPOPOS    IF A E           K DISK    USROPN
N05  FBRPARF    IF   E           K DISK    USROPN
N05  FCUNDL01   IF   E           K DISK    USROPN
N05  FVADR3     IF   E           K DISK    USROPN
N05  FKALENDER  IF   E           K DISK    USROPN
      *********************************************************************
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      * Indicators for GetHtmlIfsMult subprocedure
     D IfsMultIndicators...
     d                 ds
     D  NoErrors                       n
     D  NameTooLong                    n
     D  NotAccessible                  n
     D  NoFilesUsable                  n
     D  DupSections                    n
     D  FileIsEmpty                    n

      *
     D OddEven         s             10
     0* Client input variables
     D user            s             10
     D UsrSpcName      s             10
N05  D WSALL           s              1
     D WSKN            S              8
     D BSKN            S              8  0
     D XXKN            S              8  0
     D WSTUR           s              8
     D WBTUR           s              8  0
     D WSAVD           s              4
     D WBAVD           s              4  0
     D WSOPD           s              7
     D WBOPD           s              7  0
     D WSPICKUP        s              1
     D XFEILPLK        s              1
     D XFEILPLKT       s            100
     D WSDELETE        s              1
     D WSBES           s             10
N05  D WSBESMAX        s             10
N05  D WSBESLT         s             10
N05  D WSBESLTMAX      s             10
N05  D ETDCOLOR        s             20
     D XIKKEPL         s              1
     D KUNSUP          s             15    VARYING
     D KUNFRA          s              8
     D KUNTIL          s              8
     D VisAChecked     s             10
     D VisAlle         s              1
     D DATO            s              8  0
     D ZZVKT           s             10  2
     D From            s              8
     D To              s              8
     D STATUS          S            100
     D REASON          S            100
     D Title           S            100
N05  D Frames          s              1
     D PGM             C                   CONST('SYSPED/CHECKUSR')
      *
xx   D BigNum          s             19  9
     D ANTSND          s              5  0
     D MaxSN           s              5
     D MaxSND          s              5  0
     D ANTRCD          s              5  0
     D MaxRC           s              5
     D MaxRCD          s              5  0
     D Spaces          s             12a   inz('&nbsp;&nbsp;')
     D ItemCount       s             10i 0
     D i               s             10i 0
     D UPC             C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LO              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
     D                 DS
     D  FraDs                  1      8
     D   EHFLK                 1      2
     D   StrFra                3      3    inz('-')
     D   EHFSTE                4      8
     D                 DS
     D  TilDs                  1      8
     D   EHTLK                 1      2
     D   StrTil                3      3    inz('-')
     D   EHTSTE                4      8
     D                 DS
     D  TstFrTi                1      8
     D   TstStr                3      3
N02  D                 DS
N02  D  LFraDs                 1      8
N02  D   ELFLK                 1      2
N02  D   LStrFra               3      3    inz('-')
N02  D   EFFSTE                4      8
N02  D                 DS
N02  D  LTilDs                 1      8
N02  D   ELTLK                 1      2
N02  D   LStrTil               3      3    inz('-')
N02  D   ELTSTE                4      8
      *
      /copy syspeds/qrpgsrcpy,prolog3
      *
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input / cvt to numeric
     C                   exsr      Parse
      * File open / keys
     C                   EXSR      INIT
      *
     C                   CALLB     PGM
     C                   PARM                    BIBRID
     C                   PARM                    UsrSpcName
     C                   PARM                    UINN              1
     C                   IF        UINN = 'N'
     C                   GOTO      SLUTT
     C                   END
      * dato/tid siste vellykkede operasjon.
     C     USER          CHAIN     BRIDF                              50
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           BIDTF
     C                   MOVE      WTM           BITIDF
     C                   UPDATE    BRIDFR
N05  C                   MOVE      WDT           XIDAG             8 0
      * Pickup
     C                   IF        WSPICKUP = 'Y'
     C                   EXSR      SRPICKUP
     C                   END
      * Delete
     C                   IF        WSDELETE = 'Y'
     C                   EXSR      SRDELETE
     C                   END
      * ER DET BEDT OM statusendring på en/fler poster.(submit med checked i xx poster)
     C                   eval      ItemCount = ZhbGetVarCnt('OKSTAT')
     C     ItemCount     IFGT      *ZEROS
     C                   EXSR      SetStat
     C                   END
      * Read output skeleton html member into memory
     C                   exsr      LoadHtml
      * Set section variables
     C                   exsr      Settop
N05   * Frames = Y = init / første runde
N05  C     FRAMES        IFeq      'Y'
N05   * BRUKER-NIVÅ
N05  C                   EVAL      PABRID = BIBRID
N05  C                   EVAL      PAKUNR = *ZEROS
N05  C                   EVAL      PAID   = 'POMCL'
N05  C     BrParKey      SETLL     BRPARF
N05  C     BrParKey      READE     BRPARF                                 33
N05   * FIRMA-NIVÅ
N05  C   33              EVAL      PABRID = '*KUNDFT*' + BIFIRM
N05  C   33BrParKey      SETLL     BRPARF
N05  C   33BrParKey      READE     BRPARF                                 33
N05   *
N05  C                   IF        *IN33 = *OFF
N05  C                   EVAL      BSKN = PAVRDN                                Velg første
N05  C                   END
N05  C                   callp     updHtmlVar('WSKN':
N05  C                             %trim(%editc(BSKN:'Z')))
N05  C                   callp     wrtsection('all')
N05  c                   goto      slutt
N05  C                   END
     C                   callp     wrtsection('Stdtop')
     C                   callp     wrtsection('top')                            Programmets html
N05   *
N05  C                   IF        XJOBBKL = 'J'
N05  C                   EXSR      DSPKN
N05  C                   callp     wrtsection('dspcltop01')
N05  C                   END
N05  C                   callp     wrtsection('top2')                           Programmets html
N05  C                   IF        XJOBBKL = 'J'
N05  C                   callp     wrtsection('topcl12')
N05  C                   ELSE
N05  C                   callp     wrtsection('topcl11')
N05  C                   END
N05  C                   IF        XJOBBKLL <> *BLANKS
N05  C                   callp     wrtsection('topcl13A')
N05  C                   ELSE
N05  C                   callp     wrtsection('topcl13B')
N05  C                   END
N05  C                   callp     wrtsection('topcl13C')
N05  C                   IF        XJOBBKLL <> *blanks
N05  C                   callp     wrtsection('topcl22')
N05  C                   ELSE
N05  C                   callp     wrtsection('topcl21')
N05  C                   END
N05  C                   callp     wrtsection('topcl23')
N05  C                   IF        XJOBBKL = 'J'
N05  C                   callp     wrtsection('topcl32')
N05  C                   ELSE
N05  C                   callp     wrtsection('topcl31')
N05  C                   END
N05  C                   callp     wrtsection('topcl33')
      *
      * HOVEDRUTINE
      *
      * Vis liste over registrete saker
      *
     C     MaxSnd        IFEQ      *ZEROS
s03  C*                  Z-add     500           MaxSnd
N04  C                   IF        XJOBBKL = 'J'
N04  C                   Z-add     5000          MaxSnd
N04  C                   ELSE
n03  C                   Z-add     2000          MaxSnd
N04  C                   END
     C                   END
     C     MaxRcd        IFEQ      *ZEROS
s03  C*                  Z-add     2000          MaxRcd
N03  C                   Z-add     5000          MaxRcd
     C                   END
      *
     C                   Move      *zeros        AntSnd
     C                   Move      *zeros        AntRcd
      *
     C*                  MOVE      WBAVD         EHAVD
     C*                  MOVE      WBOPD         EHOPD
     C     HEADFK        CHAIN(N)  HEADF                              33
      *
N05  C                   SELECT
N05  C                   WHEN      WSALL = 'J'
N05  c     EPOH06K       SETLL     EPOH06
N05  c     XXKN          READE     EPOH06                                 35
N05  c  N35EHBES         COMP      WSBESMAX                           35
N05  C                   WHEN      XJOBBKL = 'J' AND USER = 'LTPOMS'
N05  C                   IF        USER = 'LTPOMS' AND WSBESLT = *BLANKS
N05  C                   EVAL      *IN35 = *ON
N05  C                   ELSE
N05  C     KeyLT         setll     EPOH01
N05  C     XXKN          Reade     EPOH01                                 35
N05  C  N35EHBES         COMP      WSBESLTMAX                         35
N05  C                   END
N05  C                   OTHER
     c     Key           setll     EPOH01
     c     Key           Reade     EPOH01                                 35
N05  c                   ENDSL
      *
     c     *IN35         doweq     '0'
N05  C                   IF        XJOBBKL = 'J'
N05  C     EPOLK         SETLL     EPOL
N05  C     EPOLK         READE(N)  EPOL                                   33
N05  C                   IF        *IN33 = *OFF
N05  C                   DOW       *IN33 = *OFF
N05  C                   SELECT
N05  C                   WHEN      ELAVD = 0 AND WSALL <> 'J'
N05  C                   LEAVE
N05  C                   WHEN      ELAVD > 0 AND WSALL = 'J'
N05  C                   LEAVE
N05  C                   WHEN      ELAVD = -9998 AND WSALL = 'J'
N05  C                   LEAVE
N05  C                   END
N05  C     EPOLK         READE(N)  EPOL                                   33
N05  C                   ENDDO
N05  C     *IN33         CABEQ     *ON           NEXTREC
N05  C                   END
N05  C                   END
N05  C                   IF        XJOBBKLL <> *BLANKS
N05  C                   SELECT
N05  C                   WHEN      XJOBBKLL = EHLEVN
N05  C                   WHEN      XJOBBKLL2 = *BLANKS
N05  C                   GOTO      NEXTREC
N05  C                   OTHER
N05  C     EHLEVN        CABNE     XJOBBKLL2     NEXTREC
N05  C                   ENDSL
N05  C                   END
     C                   Add       1             AntRcd
     C     AntRcd        CabGe     MaxRcd        Utles
      * div filter
     c*    XINTERN       Ifne      'J'
     C*    BIKUNR        CabNe     MSGKNR        NextRec
     c*                  end
     c     KUNSUP        ifne      *BLANKS
     C     LO:UPC        XLATE     EHLNAV        TSTLNAV          30
     C     KUNSUP        SCAN      TSTLNAV                                33
     c     *IN33         CaBEQ     *OFF          NextRec
     C                   end
N02  c                   MOVE      KUNFRA        XSTEDF1           8
N02  c                   MOVE      KUNTIL        XSTEDT1           8
N02  c                   MOVE      ' '           TSTSTRF           1
N02  c                   MOVE      ' '           TSTSTRT           1
     c     Kunfra        ifne      *blanks
     c                   eval      TstFrTi=Kunfra
     c     TstStr        ifeq      '-'
S02  c*    Kunfra        cabne     FraDS         NextRec                        LK-Sted
N02  c                   MOVE      FRADS         XSTEDF2           8
N02  c                   EVAL      TSTSTRF = '-'
     c                   else
S02  c*    Kunfra        cabne     EHFSTE        NextRec                        Kun sted
N02  c                   EVAL      XSTEDF2 = EHFSTE
     c                   endif
     c                   endif
     c     Kuntil        ifne      *blanks
     c                   eval      TstFrTi=Kuntil
     c     TstStr        ifeq      '-'
S02  c*    Kuntil        cabne     TilDS         NextRec                        LK-Sted
N02  c                   MOVE      TILDS         XSTEDT2           8
N02  c                   EVAL      TSTSTRT = '-'
     c                   else
S02  c*    Kuntil        cabne     EHTSTE        NextRec                        Kun sted
N02  c                   EVAL      XSTEDT2 = EHTSTE
     c                   endif
     c                   endif
N02  c                   EXSR      TESTSTD
N02  c     XVISOK        CABNE     'J'           NEXTREC
N06   * TREKK VEKT/KUBIKK FRA LINJE SOM ER PLUKKET TIL ANDRE TUR
N06  C     EPOLK         SETLL     EPOL
N06  C     EPOLK         READE(N)  EPOL                                   33
N06  C                   DOW       *IN33 = *OFF
N06  C                   IF        ELAVD <> 0
N06  C                   EVAL      EHVKT = EHVKT - ELVKTL
N06  C                   EVAL      EHM3  = EHM3  - ELM3L
N06  C                   END
N06  C     EPOLK         READE(N)  EPOL                                   33
N06  C                   ENDDO
      * Ok - skriv
     C                   exsr      Setrow
     C                   callp     wrtsection('row')
      *
S02  C*                  IF        BSKN = 21647
S02   * VOICE KAN IKKE PLIKKE HELE PO
S02  C*                  EVAL      XIKKEPL = 'J'
S02  C*                  ELSE
S02  C*                  EVAL      XIKKEPL = 'N'
S02  C*    EPOLK         SETLL     EPOL
S02  C*    EPOLK         READE(N)  EPOL                                   33
S02  C*                  DOW       *IN33 = *OFF
S02  C*                  IF        ELAVD > 0 OR
S02  C*                            (ELAVD = 0 AND ELETD <> EHETD)
S02  C*                  EVAL      XIKKEPL = 'J'
S02  C*                  LEAVE
S02  C*                  END
S02  C*    EPOLK         READE(N)  EPOL                                   33
S02  C*                  ENDDO
S02  C*                  END
      *
     C                   SELECT
     C                   WHEN      WBAVD = 0 OR XIKKEPL = 'J'
     C                   callp     wrtsection('row2')
S02  C*                  WHEN      HESDF <> EHFSTE OR HESDT <> EHTSTE
S02  C*                  callp     wrtsection('row2')
     C                   OTHER
     C                   callp     wrtsection('row1')
     C                   ENDSL
     C                   SELECT
     C                   WHEN      XIKKEPL = 'J'
     C                   callp     wrtsection('row4')
     C                   OTHER
N05  C*                  IF        XJOBBKLL <> *BLANKS
N05  C                   IF        XJOBBKLL <> *BLANKS OR EHSTA = '5'
N05  C                   callp     wrtsection('row3A')
N05  C                   ELSE
     C                   callp     wrtsection('row3')
N05  C                   END
     C                   ENDSL
      * siste staus ikke sendt, indiker i liste ??
     c                   move      *blanks       HSTA2style      100
     C                   if        EHSTA2='S'
     c                   eval      HSTA2style = 'bgcolor="#E65F5F"'
     c                   endif
     C                   callp     updHTMLvar('HSTA2style':HSTA2style)
     C                   callp     wrtsection('row5')
N05  C                   IF        XJOBBKL = 'J'
N05  C                   callp     wrtsection('rowcl2')
N05  C                   ELSE
N05  C                   callp     wrtsection('rowcl1')
N05  C                   END
N05  C                   callp     wrtsection('rowcl3')
     C                   Add       1             AntSnd
     C     AntSnd        CabGe     MaxSnd        Utles
      *
     c     NextRec       Tag
N05  C                   SELECT
N05  C                   WHEN      WSALL = 'J'
N05  c     XXKN          READE     EPOH06                                 35
N05  c  N35EHBES         COMP      WSBESMAX                           35
N05  C                   WHEN      XJOBBKL = 'J'
N05  C     XXKN          Reade     EPOH01                                 35
N05  C  N35EHBES         COMP      WSBESLTMAX                         35
N05  C                   OTHER
     c     Key           Reade     EPOH01                                 35
N05  C                   END
     c                   enddo
      *
      *
     C     UTLES         TAG
     C                   callp     updHTMLvar('ANTSND':
     C                             %trim(%editc(ANTSND:'3')))
     C                   callp     updHTMLvar('MaxSnd':
     C                             %trim(%editc(MaxSnd:'3')))
     C                   callp     updHTMLvar('ANTRCD':
     C                             %trim(%editc(ANTRCD:'3')))
     C                   callp     updHTMLvar('MaxRcd':
     C                             %trim(%editc(MaxRcd:'3')))
      * Quit
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   callp     wrtsection('bot')                            programmets Html
      *
     C     SLUTT         TAG
     C                   exsr      Exit
      *
     C                   eval      *inlr = *on
     C                   return
      *
N02   *=====================================================================
N02   * TEST STED FRA OG TIL
N02   *=====================================================================
N02  C     TESTSTD       begsr
N02   *
N02  C                   MOVE      'N'           XVISOK            1
S04  C*                  IF        BSKN = 21647
N04  C                   IF        BSKN = 21647 OR BSKN = 12497
N04   * EUROPRIS KAN IKKE PLIKKE HELE PO
N02   * VOICE KAN IKKE PLIKKE HELE PO
N02  C                   EVAL      XIKKEPL = 'J'
N02  C                   ELSE
N02  C                   EVAL      XIKKEPL = 'N'
N02  C                   END
N02   * TEST PÅ HODE-NIVÅ
N02  C                   IF        (XSTEDF1 = *BLANKS AND XSTEDT1 = *BLANKS) OR
N02  C                             (XSTEDF1 = *BLANKS AND XSTEDT1 = XSTEDT2) OR
N02  C                             (XSTEDF1 = XSTEDF2 AND XSTEDT1 = *BLANKS) OR
N02  C                             (XSTEDF1 = XSTEDF2 AND XSTEDT1 = XSTEDT2)
N02  C                   MOVE      'J'           XVISOK
N02  C                   END
N02  C                   IF        (HESDF <> *BLANKS AND HESDF <> EHFSTE) OR
N02  C                             (HESDT <> *BLANKS AND HESDT <> EHTSTE)
N02  C                   MOVE      'J'           XIKKEPL
N02  C                   END
N02   *
N02   * TEST PÅ LINJE-NIVÅ
N02  C     EPOLK         SETLL     EPOL
N02  C     EPOLK         READE(N)  EPOL                                   33
N02  C                   DOW       *IN33 = *OFF
N02  C                   IF        ELFSTE <> *BLANKS OR ELTSTE <> *BLANKS
N02  C                   MOVE      'J'           XIKKEPL
N02  C                   END
N02   *
N02  C                   SELECT
N02   *
N02  C                   WHEN      XSTEDF1 = *BLANKS AND XSTEDT1 = *BLANKS
N02   *
N02  C                   WHEN      XSTEDF1 = *BLANKS AND XSTEDT1 <> *BLANKS
N02  C                   IF        TstStrT = '-'
N02  C                   IF        XSTEDT1 = LTilDS
N02  C                   MOVE      'J'           XVISOK
N02  C                   END
N02  C                   ELSE
N02  C                   IF        XSTEDT1 = ELTSTE
N02  C                   MOVE      'J'           XVISOK
N02  C                   END
N02  C                   END
N02   *
N02  C                   WHEN      XSTEDF1 <> *BLANKS AND XSTEDT1 = *BLANKS
N02  C                   IF        TstStrF = '-'
N02  C                   IF        XSTEDF1 = LFraDS
N02  C                   MOVE      'J'           XVISOK
N02  C                   END
N02  C                   ELSE
N02  C                   IF        XSTEDF1 = ELFSTE
N02  C                   MOVE      'J'           XVISOK
N02  C                   END
N02  C                   END
N02   *
N02  C                   WHEN      XSTEDF1 <> *BLANKS AND XSTEDT1 <> *BLANKS
N02  C                   SELECT
N02  C                   WHEN      TstStrF = '-' AND TstStrT = '-'
N02  C                   IF        XSTEDF1 = LFraDS OR XSTEDT1 = LTilDS
N02  C                   MOVE      'J'           XVISOK
N02  C                   END
N02  C                   WHEN      TstStrF = '-' AND TstStrT <> '-'
N02  C                   IF        XSTEDF1 = LFraDS OR XSTEDT1 = ELTSTE
N02  C                   MOVE      'J'           XVISOK
N02  C                   END
N02  C                   WHEN      TstStrF <> '-' AND TstStrT <> '-'
N02  C                   IF        XSTEDF1 = ELFSTE OR XSTEDT1 = ELTSTE
N02  C                   MOVE      'J'           XVISOK
N02  C                   END
N02  C                   WHEN      TstStrF <> '-' AND TstStrT = '-'
N02  C                   IF        XSTEDF1 = ELFSTE OR XSTEDT1 = LTilDS
N02  C                   MOVE      'J'           XVISOK
N02  C                   END
N02  C                   ENDSL
N02   *
N02  C                   ENDSL
N02   *
N02  C                   IF        XVISOK = 'J' AND XIKKEPL = 'J'
N02  C                   LEAVE
N02  C                   END
N02   *
N02  C     EPOLK         READE(N)  EPOL                                   33
N02  C                   ENDDO
N02   *
N02  C                   endsr
      *
      *=====================================================================
      * Parse input / cvt to numeric
      *=====================================================================
     C     Parse         begsr
      * Parse variables from QUERY_STRING environment variable
     C                   eval      MAXSN    = zhbgetvar('MaxSn')
     C                   eval      MaxSnd   = c2n2(MAXSN)
     C                   eval      MAXRC    = zhbgetvar('MaxRc')
     C                   eval      MaxRcd   = c2n2(MAXRC)
      * Userid.....
     C                   eval      user = zhbgetvar('user')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
N05  C                   eval      WSALL   = zhbgetvar('WSALL')
     C                   eval      WSKN    = zhbgetvar('WSKN')
     C                   eval      BSKN    = c2n2(WSKN)
     C                   eval      WSTUR    = zhbgetvar('WSTUR')
     C                   EVAL      WBTUR    = c2n2(WSTUR)
     C                   eval      WSAVD    = zhbgetvar('WSAVD')
     C                   EVAL      WBAVD    = c2n2(WSAVD)
     C                   eval      WSOPD    = zhbgetvar('WSOPD')
     C                   EVAL      WBOPD    = c2n2(WSOPD)
     C                   eval      WSPICKUP = zhbgetvar('WSPICKUP')
     C                   eval      WSDELETE = zhbgetvar('WSDELETE')
     C                   eval      WSBES    = zhbgetvar('WSBES')
N05  C     LO:UPC        XLATE     WSBES         WSBES
N05  C                   IF        WSALL   = 'J'
N05  C                   EVAL      WSBESMAX = %TRIM(WSBES) + '9999999999'
N05  C                   END
N05  C                   eval      WSBESLT  = zhbgetvar('WSBESLT')
N05  C     LO:UPC        XLATE     WSBESLT       WSBESLT
N05  C                   EVAL      WSBESLTMAX = %TRIM(WSBESLT) + '9999999999'
     C                   eval      KUNSUP  = zhbgetvar('KUNSUP')
     C     LO:UPC        XLATE     KUNSUP        KUNSUP
     C                   eval      KUNFRA   = zhbgetvar('KUNFRA')
     C     LO:UPC        XLATE     KUNFRA        KUNFRA
     C                   eval      KUNTIL   = zhbgetvar('KUNTIL')
     C     LO:UPC        XLATE     KUNTIL        KUNTIL
      * Checkboks for Vis alle
      *    ved KLIKK på checkboks kommer verdi Y/blank,
      *    ellers kommer verdi fra siste valg via "VisAlle" som checked / blank(N)
     C     VisAchecked   Ifeq      'checked'
     C                   eval      VisAlle  = 'Y'
     C                   else
     C                   eval      VisAlle  = zhbgetvar('VisAlle')
     C                   end
N05  C                   eval      FRAMES   = zhbgetvar('FRAMES')
     C                   endsr
      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   CLOSE     BRIDF
     C                   CLOSE     HEADF
     C                   CLOSE     TURER14
     C                   CLOSE     EPOH
     C                   CLOSE     EPOH01
N05  C                   CLOSE     EPOH06
     C                   CLOSE     EPOL
     C                   CLOSE     EPOTT
N07  C                   CLOSE     EPOTT01
     C                   CLOSE     EPOPOS
N05  C                   CLOSE     BRPARF
N05  C                   CLOSE     CUNDL01
N05  C                   CLOSE     VADR3
N05  C                   CLOSE     KALENDER
     C                   endsr
      *=====================================================================
      * Read output skeleton html member into memory
      *=====================================================================
     C     LoadHtml      begsr
N05  C                   IF        XJOBBKL = 'J' AND FRAMES = 'Y'
N05  C                   eval      IfsMultIndicators = gethtmlifsmult(
N05  C                             '/syspeddev/html/Header/eSpedTop.html -
N05  C                             /syspeddev/html/EPOMS31F.html -
N05  C                             /syspeddev/html/Footer/eSpedBot.html':
N05  C                             '/CGITAG/')
N05  C                   ELSE
cccccC                   eval      IfsMultIndicators = gethtmlifsmult(
cccccC                             '/syspeddev/html/Header/eSpedTop.html -
cccccC                             /syspeddev/html/EPOMS13.html -
cccccC                             /syspeddev/html/Footer/eSpedBot.html':
cccccC                             '/CGITAG/')
N05  C                   END
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$top
      *=====================================================================
     C     SetTop        begsr
      *
     c                   eval      Title='POMS Purchase Order Management System'
     C                   callp     updhtmlvar('TITLE':Title)
     c
N05  C                   callp     updHTMLvar('FRAMES':FRAMES)
     C                   callp     updHTMLvar('ROWHEAD':RowHead)
     C                   callp     updHTMLvar('LogoImg':LogoImg)
     C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHTMLvar('USER':USER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('BESK':BIBESK)
     C                   callp     updHtmlVar('KUNDE':
     C                             %trim(%editc(BIKUNR:'Z')))
     C                   callp     updHTMLvar('KNAVN':BIBESK)
N05  C                   callp     updHTMLvar('WSALL':WSALL)
N05  C                   callp     updHTMLvar('WSBESLT':WSBESLT)
     C                   callp     updHtmlVar('WSKN':
     C                             %trim(%editc(BSKN:'Z')))
     C                   callp     updHTMLvar('WSTUR':WSTUR)
     C                   callp     updHTMLvar('WSAVD':WSAVD)
     C                   callp     updHTMLvar('WSOPD':WSOPD)
     C                   callp     updHTMLvar('WSPLUKKET':WSPICKUP)
     C                   callp     updHTMLvar('XFEILPLK':XFEILPLK)
     C                   callp     updHTMLvar('XFEILPLKT':XFEILPLKT)
     C                   callp     updHtmlVar('EHKUND':
     C                             %trim(%editc(EHKUND:'Z')))
     C                   callp     updHTMLvar('EHBES':EHBES)
     C                   callp     updHTMLvar('KUNSUP':KUNSUP)
     C                   callp     updHTMLvar('KUNFRA':KUNFRA)
     C                   callp     updHTMLvar('KUNTIL':KUNTIL)
      * Søkeparam
     C                   callp     updHTMLvar('VISAlle':VISAlle)
     C     VisAlle       Ifeq      'Y'
     C                   eval      VisAChecked = 'checked'
     C                   end
     C                   callp     updHTMLvar('VisAChecked':VisAChecked)
      *
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$row
      *=====================================================================
     C     Setrow        begsr
      *
     C                   callp     updHTMLvar('EHBES':EHBES)
      * flytte inn ulike datore avh av valg ???
     c                   z-add     EHDATO        DATO
     C                   callp     updHTMLvar('DATO':
     C                             %trim(%editc(DATO:'Z')))
     C                   callp     updHTMLvar('ETD':
     C                             %trim(%editc(EHETD:'Z')))
N05  C                   EVAL      ETDCOLOR = *BLANKS
N05  C                   IF        XJOBBKLL <> *BLANKS
N05  C                   IF        EHSTA < '1'
N05  C     EHDATO        CHAIN     KALENDER                           33
N05  C                   READ      KALENDER                               33
N05  C                   READ      KALENDER                               33
N05  C                   READ      KALENDER                               33
N05  C                   IF        XJOBBKLL = '9999990017796'
N05  C                   READ      KALENDER                               33
N05  C                   READ      KALENDER                               33
N05  C                   END
N05  C                   IF        EHDATO < XIDAG
N05  C                   EVAL      ETDCOLOR = 'BGCOLOR=YELLOW'
N05  C                   END
N05  C                   END
N05   *
N05  C                   EVAL      VAKURE = EHINV
N05  C     VADR3K        CHAIN     VADR3                              33
N05  C  N33              callp     updHTMLvar('EHLNAV':VADRNA)
N05  C   33              callp     updHTMLvar('EHLNAV':EHLNAV)
N05  C                   ELSE
     C                   callp     updHTMLvar('EHLNAV':EHLNAV)
N05  C                   END
N05  C                   callp     updHTMLvar('ETDCOLOR':ETDCOLOR)
     c*                  eval      From = EHFLK +'-'+EHFSTE
     C                   eval      From = EHFSTE
     C                   callp     updHTMLvar('FROM':FROM)
     c*                  eval      To   = EHTLK +'-'+EHTSTE
     C                   eval      To   = EHTSTE
     C                   callp     updHTMLvar('EHTRKO':EHTRKO)
     C                   callp     updHTMLvar('TO':TO)
     c                   Z-ADD(H)  EHVKT         ZZVKT
     C                   callp     updHTMLvar('EHVKT':
     C                             %trim(%editc(ZZVKT:'3')))
     c*                  z-add     EHM3          ZZM3
     C                   callp     updHTMLvar('EHM3':
     C                             %trim(%editc(EHM3:'3')))
     c                   select
     c     EHSTA         wheneq    ' '
     c     EHSTA         oreq      '0'
     c                   eval      STATUS = 'Pending'
     c     EHSTA         wheneq    '1'
N05  c                   IF        XJOBBKL = 'J'
N05  c                   eval      STATUS = 'Confirmed'
N05  c                   ELSE
     c                   eval      STATUS = 'Contacted'
N05  c                   END
     c     EHSTA         wheneq    '15'
     c                   eval      STATUS = 'Ready for stuffing'
     c     EHSTA         wheneq    '2'
N05  c                   IF        XJOBBKL = 'J'
N05  c                   eval      STATUS = 'Printed'
N05  c                   ELSE
     c                   eval      STATUS = 'Booked'
N05  c                   END
     c     EHSTA         wheneq    '3'
N05  c                   IF        XJOBBKL = 'J'
N05  c                   eval      STATUS = 'Colleted'
N05  c                   ELSE
     c                   eval      STATUS = 'Confirmed'
N05  c                   END
     c     EHSTA         wheneq    '4'
N05  c                   IF        XJOBBKL = 'J'
N05  c                   eval      STATUS = 'Received'
N05  c                   ELSE
     c                   eval      STATUS = 'Shipped'
N05  c                   END
     c     EHSTA         wheneq    '5'
N05  c                   IF        XJOBBKL = 'J'
N05  C     HEADFK        CHAIN(N)  HEADF                              33
N05  C                   IF        *IN33
N05  C     EPOLK         CHAIN(N)  EPOL                               33
N05  C     HEADFK2       CHAIN(N)  HEADF                              33
N05  C                   END
N05  c                   IF        HEHAWB = 'DIREKT'
N05  c                   eval      STATUS = 'Direct shipment'
N05  c                   ELSE
N07  C     EPOTT01K      CHAIN     EPOTT01                            33
N07  C                   DOW       *IN33 = *OFF
N07  C                   IF        %SUBST(T01_ETTEXT:1:14) = 'Direct sending'
N07  C                   LEAVE
N07  C                   END
N07  C     EPOTT01K      READE     EPOTT01                                33
N07  C                   ENDDO
N07  C                   IF        *IN33
N05  c                   eval      STATUS = 'Out terminal'
N07  C                   ELSE
N07  c                   eval      STATUS = 'Direct shipment'
N07  C                   END
N05  c                   END
N05  c                   ELSE
     c                   eval      STATUS = 'Arrived'
N05  c                   END
     c     EHSTA         wheneq    '6'
     c                   eval      STATUS = '6*Undefined*'
     c                   endsl
     C                   callp     updHTMLvar('STATUS':STATUS)
      *
     c                   select
     c     EHREAS        wheneq    ' '
     c                   eval      REASON = *blanks
     c     EHREAS        wheneq    'xxx'
     c                   eval      REASON = EHREAS + ' xxxxxxxxxxxxx'
     c     EHREAS        wheneq    'AAAA'
     c                   eval      REASON = EHREAS + ' YYYYYYYYYYYYY'
     c     EHREAS        wheneq    'XYX..'
     c                   eval      REASON = EHREAS + ' ZZZZZZZZZZZZZ'
     c                   other
     c                   eval      REASON = EHREAS
     c                   endsl
     C                   callp     updHTMLvar('REASON':REASON)
      *
     C                   endsr
      *
      *
      *=====================================================================******
      *  SRPICKUP
      *=====================================================================******
     C     SRPICKUP      begsr
      *
     C                   CALL      'EPOMS15A'
     C                   PARM                    WBAVD             4 0
     C                   PARM                    WBOPD             7 0
     C                   PARM                    BIBRID
     C                   PARM                    XXKN
     C                   PARM                    WSBES
     C                   PARM                    ULIN              7 0
     C                   PARM                    UULIN             5 0
     C                   PARM                    USTA3             5
     C                   PARM                    XFEILPLK
     C                   PARM                    XFEILPLKT
     C                   GOTO      SLPICKUP
      *
     C     EPOHK         CHAIN     EPOH                               33
     C                   IF        *IN33 = *OFF
     C                   IF        EHAVD = 0
     C                   MOVE      WBAVD         EHAVD
     C                   MOVE      WBOPD         EHOPD
     C     WBTUR         CHAIN(N)  TURER14                            33
     C                   EVAL      EHSTA = '2'                                  Booked
     c                   IF        TUTST4= 'X'
     C                   EVAL      EHSTA = '3'                                  Confirmed
     c                   endif
     C                   EVAL      EHSTA2= 'S'                                  SEND
     C                   UPDATE    EPOHR
      * Update på linjenivå,
     C     EPOLK         SETLL     EPOL
     C     EPOLK         READE     EPOL                                   33
     C                   DOW       *IN33 = *OFF
     C                   EVAL      ELSTA = EHSTA
     C                   EVAL      ELSTA2= 'S'                                  SEND
     C                   UPDATE    EPOLR
     C     EPOLK         READE     EPOL                                   33
     C                   ENDDO
      * T&T
     C                   EVAL      ETKUND = EHKUND
     C                   EVAL      ETBES  = EHBES
     C                   EVAL      ETACTI = 'PIC'
     C                   EVAL      ETTEXT = 'PO is picked up to order '
     C                             + %TRIM(%EDITC(EHAVD:'Z')) + '/'
     C                             + %TRIM(%EDITC(EHOPD:'Z'))
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           ETDATE
     C                   MOVE      WTM           ETTIME
     C                   MOVE      BIBRID        ETUSER
     C                   WRITE     EPOTTR
      * Skriv x-ref ubetinget - sats 100% på at det fjernes ved evt remove fra oppdrag
      * finn høyeste eksisterende POSnr - add 10
     c                   move      *zeros        EPPOS
     c     PosMax        setgt     EPOPOS
     c     HEADFK        readpe    EPOPOS
     C                   eval      EPAVD = EHAVD
     C                   eval      EPOPD = EHOPD
     c                   eval      EPPOS = EPPOS + 10
     C                   eval      EPKUND= EHKUND
     C                   eval      EPBES = EHBES
     C                   eval      EPLIN = *ZEROS
     C                   eval      EPULIN= *ZEROS
     c                   write     EPOPOSR
      *
     C     HEADFK        CHAIN     HEADF                              33
     C                   IF        *IN33 = *OFF
     C                   ADD(H)    EHANTK        HENT
     C                   ADD(H)    EHVKT         HEVKT
     C*                  ADD(H)    EHM3          HEM3
     c     HEM3          ADD(H)    EHM3          BigNum
     c     BigNum        ifgt      9999.999
     c                   z-add     9999.999      HEM3
     c                   else
     c                   z-add     BigNum        HEM3
     c                   endif
     C                   UPDATE    HEADFR
     C     WBTUR         CHAIN     TURER14                            33
     C                   IF        *IN33 = *OFF
     C                   ADD(H)    EHANTK        TUTS
     C                   ADD(H)    EHVKT         TUTVKT
     C*                  ADD(H)    EHM3          TUTM3
     c     TUTM3         ADD(H)    EHM3          BigNum
S01  c*    BigNum        ifgt      999.99
S01  c*                  z-add     999.99        TUTM3
N01  c     BigNum        ifgt      9999.999
N01  c                   z-add     9999.999      TUTM3
     c                   else
     c                   z-add     BigNum        TUTM3
     c                   endif
     C                   UPDATE    TURERR
     C                   END
     C                   END
     C                   ELSE
     C                   EVAL      XFEILPLK = 'Y'
     C                   EVAL      XFEILPLKT = 'PO (' + %TRIM(WSBES)
     C                   IF        EHAVD > 0
     C                   EVAL      XFEILPLKT = %TRIM(XFEILPLKT)
     C                             + ') is already picked up by another user.'
     C                   ELSE
     C                   EVAL      XFEILPLKT = %TRIM(XFEILPLKT)
     C                             + ') is already deleted by another user.'
     C                   END
     C                   END
     C                   END
      *
     C     SLPICKUP      TAG
     C                   ENDSR
      *
      *=====================================================================******
      *  SRDELETE
      *=====================================================================******
     C     SRDELETE      begsr
      *
     C     EPOHK         CHAIN     EPOH                               33
     C                   IF        *IN33 = *OFF
      * Test om ingen linje er med på tur.
     C     EPOLK         SETLL     EPOL
     C     EPOLK         READE(N)  EPOL                                   33
     C                   DOW       *IN33 = *OFF
     C                   IF        ELAVD > 0
     C                   UPDATE    EPOHR
     C                   GOTO      SLDELETE
     C                   END
     C     EPOLK         READE(N)  EPOL                                   33
     C                   ENDDO
      *
     c                   move      ' '           EHSTA2                         blank evt SENDstatus
     C                   Z-SUB     9999          EHAVD
     C                   Z-SUB     9999999       EHOPD
     C                   UPDATE    EPOHR
      * Update på linjenivå,
     C     EPOLK         SETLL     EPOL
     C     EPOLK         READE     EPOL                                   33
     C                   DOW       *IN33 = *OFF
     C                   EVAL      ELSTA2= ' '                                  ikke SEND
     C                   UPDATE    EPOLR
     C     EPOLK         READE     EPOL                                   33
     C                   ENDDO
      * T&T
     C                   EVAL      ETKUND = EHKUND
     C                   EVAL      ETBES  = EHBES
     C                   EVAL      ETACTI = 'DLT'
     C                   EVAL      ETTEXT = 'PO is deletet.'
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      WDT           ETDATE
     C                   MOVE      WTM           ETTIME
     C                   MOVE      BIBRID        ETUSER
     C                   WRITE     EPOTTR
     C                   END
      *
     C     SLDELETE      TAG
     C                   endsr
      *
      *=====================================================================******
      *  SetStat
      *=====================================================================******
     C     SETSTAT       begsr
      * Endre status fra blank/0 -> 1
      * (låner inp-variabel WSBES, men i fall denne er benyttet i SRPICKUP, så er den ferdig nå)
     C                   eval      i = 1
     C     i             DOUGT     ItemCount
     C                   eval      WSBES  = ZhbGetVar('OKSTAT':i)
     C     EPOHK         CHAIN     EPOH                               33
     C                   IF        *IN33 = *OFF
     C                   IF        EHSTA <= '1'
      *
     C                   IF        EHSTA < '1'
     C                   EVAL      ETTEXT = 'Status is changed from 0 to 1'
     C                   EVAL      ETKUND = EHKUND
     C                   EVAL      ETBES  = EHBES
     C                   EVAL      ETLIN  = 0
     C                   EVAL      ETULIN = 0
     C                   EVAL      ETACTI = 'CHG'
     C                   MOVE      WDT           ETDATE
     C                   MOVE      WTM           ETTIME
     C                   MOVE      BIBRID        ETUSER
     C                   WRITE     EPOTTR
     C                   END
      *
     C                   EVAL      EHSTA = '1'
     C                   EVAL      EHSTA2= 'S'                                  SEND
     C                   UPDATE    EPOHR
      * linjenivå
      * Update på linjenivå, men bare de med samme ETD
     C     EPOLK         SETLL     EPOL
     C     EPOLK         READE     EPOL                                   33
     C                   DOW       *IN33 = *OFF
     C                   IF        ELETD = EHETD AND ELSTA <> EHSTA
      * T&T
     C                   IF        ELSTA = *BLANKS
     C                   EVAL      ELSTA = '0'
     C                   END
     C                   EVAL      ETTEXT = 'Status is changed from '
     C                             + %TRIM(ELSTA) + ' to ' + %TRIM(EHSTA)
     C                   EVAL      ETKUND = ELKUND
     C                   EVAL      ETBES  = ELBES
     C                   EVAL      ETLIN  = ELLIN
     C                   EVAL      ETULIN = ELULIN
     C                   EVAL      ETACTI = 'CHG'
     C                   MOVE      WDT           ETDATE
     C                   MOVE      WTM           ETTIME
     C                   MOVE      BIBRID        ETUSER
     C                   WRITE     EPOTTR
      *
     C                   EVAL      ELSTA = EHSTA
     C                   EVAL      ELSTA2= 'S'                                  SEND
     c                   endif
      *
     C                   UPDATE    EPOLR
     C     EPOLK         READE     EPOL                                   33
     C                   ENDDO
     c                   endif
     c                   endif
      *
     C                   eval      i = i +1
     C                   ENDDO
      *
     C                   endsr
      *
N05   *=====================================================================******
N05   *  Display Customer Number to select from
N05   *=====================================================================******
N05  C     DSPKN         begsr
N05   *
N05  C                   IF        XJOBBKL = 'J' AND XJOBBKLL = *BLANKS
N05  C                   callp     wrtsection('DspClTop1')
N05  C                   END
N05  C                   callp     wrtsection('DspClTop3')
N05   * BRUKER-NIVÅ
N05  C                   EVAL      PABRID = BIBRID
N05  C                   EVAL      PAKUNR = *ZEROS
N05  C                   EVAL      PAID   = 'POMCL'
N05  C     BrParKey      SETLL     BRPARF
N05  C     BrParKey      READE     BRPARF                                 33
N05   * FIRMA-NIVÅ
N05  C   33              EVAL      PABRID = '*KUNDFT*' + BIFIRM
N05  C   33BrParKey      SETLL     BRPARF
N05  C   33BrParKey      READE     BRPARF                                 33
N05   *
N05  C                   DOW       *IN33 = *OFF
N05  C                   IF        BSKN = 0                                     Ennå ikke valgt
N05  C                   EVAL      BSKN = PAVRDN                                Velg første
N05  C                   END
N05  C                   IF        BSKN = PAVRDN
N05  C                   callp     updhtmlvar('KNSEL':'SELECTED')
N05  C                   ELSE
N05  C                   callp     updhtmlvar('KNSEL':'')
N05  C                   END
N05  C                   Z-ADD     PAVRDN        KUNDNR
N05  C                   callp     updHTMLvar('SLTKN1':
N05  C                             %trim(%editc(KUNDNR:'Z')))
N05  C                   IF        PAVRDA = *BLANKS
N05  C     CUNDL01K      CHAIN     CUNDL01                            33
N05  C                   callp     updhtmlvar('SLTKN2':KNAVN)
N05  C                   ELSE
N05  C                   callp     updhtmlvar('SLTKN2':PAVRDA)
N05  C                   END
N05  C                   callp     wrtsection('DspClRow')
N05  C     BrParKey      READE     BRPARF                                 33
N05  C                   ENDDO
N05  C                   callp     updHtmlVar('WSKN':
N05  C                             %trim(%editc(BSKN:'Z')))
N05   *
N05  C                   callp     wrtsection('DspClBot')
N05   *
N05  C                   endsr
N05   *
      *
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     USER          CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
     C                   OPEN      HEADF
     C                   OPEN      TURER14
     C                   OPEN      EPOH
     C                   OPEN      EPOH01
N05  C                   OPEN      EPOH06
     C                   OPEN      EPOL
     C                   OPEN      EPOTT
N07  C                   OPEN      EPOTT01
     C                   OPEN      EPOPOS
N05  C                   OPEN      BRPARF
N05  C                   OPEN      CUNDL01
N05  C                   OPEN      VADR3
N05  C                   OPEN      KALENDER
      *
      * hent Parametre som går igjen i mange prog:
      *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
     c                   call      'ESGETPAR'
     c                   parm                    BIBRID
     c                   parm                    BIFIRM
     c                   parm                    BIKUNR
     c                   parm                    BIKNG
     c                   parm                    RowHead          10
     c                   parm                    Odd              10
     c                   parm                    Even             10
     c                   parm                    LogoImg          50
     c                   parm                    XSPRÅK            2
     c                   parm                    XINTERN           1
     c                   parm                    ParmDS1        1024
     c                   parm                    ParmDS2        1024
     c                   parm                    ParmDS3        1024
      *
     C     HEADFK        klist
     C                   kfld                    EHAVD
     C                   kfld                    EHOPD
N09  C     HEADFK2       klist
N09  C                   kfld                    ELAVD
N09  C                   kfld                    ELOPD
     C     PosMax        klist
     C                   kfld                    EHAVD
     C                   kfld                    EHOPD
     c                   kfld                    MAX5
     c                   move      99999         MAX5              5 0
     c     Key           klist
     C*                  kfld                    BSKN
     C                   kfld                    XXKN
N05  c     KeyLT         klist
N05  C                   kfld                    XXKN
N05  C                   kfld                    WSBESLT
     c     EPOHK         klist
     C*                  kfld                    BSKN
     C                   kfld                    XXKN
     c                   kfld                    WSBES
N05  c     EPOH06K       klist
N05  C                   kfld                    XXKN
N05  C                   kfld                    WSBES
     c     EPOLK         klist
     C                   kfld                    XXKN
     c                   kfld                    EHBES
N07  c     EPOTT01K      klist
N07  C                   kfld                    XXKN
N07  C                   kfld                    EHBES
N07  C*                  kfld                    T01_ETLIN
N07  C*                  kfld                    T01_ETULIN
N07  C*                  kfld                    T01_ETACTI
N07  C*                  EVAL      T01_ETACTI = 'UTLAG'
N05  C     BrParKey      klist
N05  C                   kfld                    PABRID
N05  C                   kfld                    PAKUNR
N05  C                   kfld                    PAID
N05  C     CUNDL01K      klist
N05  C                   kfld                    BIFIRM
N05  C                   kfld                    KUNDNR
N05  C     VADR3K        klist
N05  C                   kfld                    BIFIRM
N05  C                   kfld                    EHKUND
N05  C                   kfld                    VAKURE
      *
     C                   MOVE      WBAVD         EHAVD
     C                   MOVE      WBOPD         EHOPD
     C     HEADFK        CHAIN(N)  HEADF                              33
     C                   IF        *IN33
     C                   EVAL      XXKN   = BSKN
     C                   ELSE
     C                   EVAL      XXKN   = TRKNFA
     C                   END
     C                   EVAL      EHKUND = XXKN
N05   *
N05  C                   MOVE      BIBRID        PABRID
N05  C                   MOVE      *zeros        PAKUNR
N05  C                   MOVE      'POMKL'       PAID
N05  C                   MOVE      'N'           XJOBBKL           1
N05  C                   MOVE      *BLANKS       XJOBBKLL         17
N05  C                   MOVE      *BLANKS       XJOBBKLL2        17
N05  C     BrParKey      chain     BRPARF                             33
N05  C  N33              IF        %SUBST(PAVRDA:1:1) = 'J' OR
N05  C                             %SUBST(PAVRDA:1:1) = 'j'
N05  C                   EVAL      XJOBBKL = 'J'
N05  C                   EVAL      XJOBBKLL = %SUBST(PAVRDA:3:17)
N05  C                   EVAL      XJOBBKLL2 = %SUBST(PAVRDA:21:17)
N05  C                   END
      *
     C                   endsr
      *
