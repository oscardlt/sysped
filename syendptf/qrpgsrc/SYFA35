      *
      *    OPPDATER IBM REGNSKAPSSYSTEM
      *
      *  LØSNING 1 VRU2  POST1/2 --> POSTB1/B2
      *  INNFØRT KODIL01/KODJL01 OG SUBRUTINE STEBAR SOM LEGGER
      *  KOSTNADSSTED OG BÆRERS GRUPPERINGSKODE I IBMNY1 (H I POSTB0)
      *  NULLSTILLER IKKE AVD VED DEBITORPOST
      *
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 JOV PTF10 Behold peri fra farkt-utskr også ved TRmodul single (=fra tur eller overstyrt).
10XXX * 02 SH  PTF10 alvorlig feil i samlefakturering
10XXX * 03 SH  PTF10 tar vare på betbet fra fakturafil
10XXX * 04 SH  PTF10 rettelse til
10XXX * 05 SH  PTF10 rettelse til
10XXX * 06 SH  PTF10 VALUTA HOVEDBOK
10XXX * 07 SH  PTF10 Tar høyde for FACKNR faktoringselskap L1
10172 * 08 SH  PTF10 norsk text til Track and trace
10172 * 09 SH  PTF10 forhøying forkorting ved mva
10172 * 10 SH  PTF10 signaturkode i bilagstekst også på kreditnota
10172 * 11 SH  PTF10 LEGGER UT DETTE NUMMER
10172 * 12 SH  PTF10 EU-KONTERINGER
10172 * 13 SH  PTF10 kunne ha med avdeling på utleggspost
      *-------------------------------------------------------
10172 * 14 SH  PTF11 feil ved factoring og samlefaktura
      *-------------------------------------------------------
12XXX * 15 JOV PTF12 DARSOM AVVIKENDE MOMS OG 0 I SATSS SÅ ER DENNE FRI
12XXX * 16 SH  PTF12 visma-endringer
12XXX * 17 sH  PTF12 flere visma-endringer
12XXX * 18 JOV PTF12 Update direkte på FAK3 i VALI leseloop (ikke chain via fakt i fall dupl. lnr)
12XXX * 19 sh  PTF12 kun referanse ved helkreditering
********************************************************************
     H DATEDIT(*DMY)
     FTRACKF    O  A E           K DISK
N12  FKODTS2    IF   E           K DISK
N12  FKODTG3    IF   E           K DISK
N12  FSTED2     IF   E           K DISK
     FKODIL01   IF   E           K DISK
     FKODJL01   IF   E           K DISK
     FKONTL01   IF   E           K DISK
S18  F*FAKT      UF   E           K DISK
S18  F*FAK3      IF   E           K DISK
     FFAK3      UF   E           K DISK
S18  F***                                  RENAME(FAKTR:FAKTR3)
     FFAK2      IF   E           K DISK
     F                                     RENAME(FAKTR:FAKTR2)
     FPOSTB2    UF A E           K DISK
     F                                     RENAME(POSBR:POSBR2)
     FPOSTB1    UF A E           K DISK
     FPOSTA1    UF A E           K DISK
     FPOSTA2    IF   E           K DISK
     F                                     RENAME(POSAR:POSAR2)
     FKODTÅ     IF   E           K DISK
     FKODTV     IF   E           K DISK
     FKODTA     IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FKODTG2    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FFIRMTEL   UF A E           K DISK
     FDISP      IF   E           K DISK
     FNUMML01   UF   E           K DISK                                         X010
     FSYSRL01   UF   E           K DISK
     FTURER     IF   E           K DISK
     FHEADF     UF   E           K DISK
     FHEAD1     IF   E           K DISK
     F                                     RENAME(HEADFR:HEADFR1)
     FKHEDL01   IF   E           K DISK
     FKUNDL01   UF   E           K DISK
     FCUNDL01   IF   E           K DISK
     F                                     RENAME(KUNDR:CUNDR)
     FEKUNL01   UF A E           K DISK
     FKODWL01   IF   E           K DISK
     FSYFA35P   O    F  132        PRINTER OFLIND(*INOF)
      *___________________
      * DS for System Data
      *"""""""""""""""""""
     D                SDS
     D  UUSR                 254    263
      *
     D                 DS
     D  DG                     1      2  0
     D  MN                     3      4  0
     D  AR                     5      6  0
     D  IBMDAT                 1      6  0
     D                 DS
     D  IBMFAR                 1      4  0
     D  IBMFMN                 5      6  0
     D  IBMFDG                 7      8  0
     D  IBMFFD                 1      8  0
     D                 DS
     D  HEDTOP                 1      8  0
     D  HEDTÅ                  1      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D                 DS
     D  FADATO                 1      8  0
     D  FADTÅÅ                 1      4  0
     D  FADTMM                 5      6  0
     D  FADTDD                 7      8  0
     D                 DS
     D  FADAFF                 1      8  0
     D  FADAFÅ                 1      4  0
     D  FADAFM                 5      6  0
     D  FADAFD                 7      8  0
     D                 DS
     D  XFDT                   1      6  0
     D  XFDTÅÅ                 1      2  0
     D  XFDTMM                 3      4  0
     D  XFDTDD                 5      6  0
     D                 DS
     D  BILDAT                 1      8  0
     D  BILAAR                 1      4  0
     D  BILMND                 5      6  0
     D  BILDAG                 7      8  0
     D*--------------------------------------------------------------
     D* DEFINERER DATASTRUKTURER
     D*--------------------------------------------------------------
     D                 DS
     D  MINPER                 1      6  0
     D  KOÅCC                  1      2  0
     D  KOÅÅR                  3      4  0
     D  KOÅMND                 5      6  0
     D                 DS
     D  KNAVN                  1     30
     D  KNAV18                 1     18
     D                 DS
     D  KGEKON                 1      5  0
     D  FKONTO                 1      5  0
     D  SKONTO                 1      5  0
     D                 DS
     D  SEKSPN                 1     11  0
     D  HEAVD                  1      4  0
     D  HEOPD                  5     11  0
V10  D* UTLREF                 4      9  0
     D*** KG2XX I KODETGE ER TATT I BRUK        23/11-89
     D*** 4 FØRSTE POSISJON PÅ KG2LEV I KODETGE ER TATT I BRUK
     D*** SOM PROSENT SATS MEN KG2LEV ER IKKE I BRUK NÅ
     D                 DS
     D  KG2LEV                 1      8  0
     D  KG2PRO                 1      4  4
     D  KG2BÆR                 5      8  0
     D                 DS
     D  BILTX2                 1     15
     D  FAVK                   1      3
     D  SEKSP2                 4     14  0
     D* HESG                  13     15
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XULÅÅ                 11     14  0
     D                 DS
     D  ULÅÅ                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     D                UDS
     D  UFIRMA                 1      2
      *
     ICUNDR
     I              BANKG                       SYBAGI
     I              POSTG                       SYPOGI
      *
     C     *ENTRY        PLIST
     C                   PARM                    AUT               1
N17  C                   PARM                    L1KJOR            1
     C     AUT           COMP      'O'                                    75
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL POSTA1
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    PERAAR        YYÅR
     C     *LIKE         DEFINE    PERNR         YYMND
     C     KEYBI         KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    YYÅR
     C                   KFLD                    YYMND
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL POSTA2
     C*--------------------------------------------------------------
     C     KEYBI2        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    BILNR
     C                   KFLD                    YYÅR
     C                   KFLD                    YYMND
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL SYSRL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    REGNAV        XREGNA
     C     SYSRKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    XREGNA
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL EKUNL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    KUNDNR        YKUNDN
     C     *LIKE         DEFINE    PERAAR        YPERAA
     C     *LIKE         DEFINE    BILNR         YBILNR
     C     EKUNKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    YKUNDN
     C                   KFLD                    YPERAA
     C                   KFLD                    YBILNR
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KUNDL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    KUNDNR        ZKUNDN
     C     KUNKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    ZKUNDN
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODTÅ   ÅPNE PERIODER
     C*--------------------------------------------------------------
     C     KODÅKE        KLIST
     C                   KFLD                    KOÅUNI
     C                   KFLD                    KOÅCC
     C                   KFLD                    KOÅÅR
     C                   KFLD                    KOÅMND
     C                   MOVE      'Å'           KOÅUNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL TYPE V
     C*--------------------------------------------------------------
     C     KODVKE        KLIST
     C                   KFLD                    KOVUNI
     C                   KFLD                    KOVAVD
     C                   MOVE      'V'           KOVUNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL TYPE A
     C*--------------------------------------------------------------
     C     KODAKE        KLIST
     C                   KFLD                    KOAUNI
     C                   KFLD                    KOAAVD
     C                   MOVE      'A'           KOAUNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL TYPE GE (GEBYRKODER)
     C*--------------------------------------------------------------
     C     GEBKEY        KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    KGEKOD
     C     GEBKE3        KLIST
     C                   KFLD                    KGEUNI
     C                   KFLD                    TUBILK
     C                   MOVE      'GE'          KGEUNI
N12  C     GEBKEYE       KLIST
N12  C                   KFLD                    EUKODE
N12  C                   KFLD                    KGEKOD
N12  C     GEBKEY3E      KLIST
N12  C                   KFLD                    EUKODE
N12  C                   KFLD                    TUBILK
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL TYPE G2 (GEBYRKODER)
     C*--------------------------------------------------------------
     C     GEBKE2        KLIST
     C                   KFLD                    KG2UNI
     C                   KFLD                    KG2KOD
     C     GEBKE4        KLIST
     C                   KFLD                    KG2UNI
     C                   KFLD                    TUBILK
     C                   MOVEL     'G2'          KG2UNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KONTL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    KONTO         WKONTO
     C     KONTKE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WKONTO
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KHEDL01
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    RECTYP        KHEKE2
     C     *LIKE         DEFINE    KHENV         KHEKE3
     C     KHEKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KHEKE2
     C                   KFLD                    KHEKE3
     C                   MOVE      'D'           KHEKE2
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL FAKTURAREGISTER: FAKT
     C*--------------------------------------------------------------
     C     KEYFAK        KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C                   KFLD                    FALI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL HEADINGREGISTER  HEAD
     C*--------------------------------------------------------------
     C     HEAKEY        KLIST
     C                   KFLD                    FAAVD
     C                   KFLD                    FAOPD
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL POSTERINGSREGISTER POSTB1
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    KBARER        SBÆR
     C     *LIKE         DEFINE    PERNR         SMNPC
     C     *LIKE         DEFINE    MOMSK         SMVA
     C     *LIKE         DEFINE    PROSNR        NULPRO
     C     SKEY          KLIST
     C                   KFLD                    SMNPC
     C                   KFLD                    SÅR
     C                   KFLD                    SKONTO
     C                   KFLD                    FAVD
     C                   KFLD                    SBÆR
     C                   KFLD                    SMVA
     C                   KFLD                    NULPRO
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL POSTERINGREGISTER POSTB2
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    KRNR          IBMFA2
     C     *LIKE         DEFINE    FIRMA         POST01
     C     POSTKE        KLIST
     C                   KFLD                    POST01
     C                   KFLD                    KUNDEN
     C                   KFLD                    IBMFA2
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL FAKTURAREGISTER: FAK3
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    FAOPKO        XXOPKO
     C     *LIKE         DEFINE    FAFAKT        XXFAKT
     C     *LIKE         DEFINE    FAKUNR        XXKUNR
     C     *LIKE         DEFINE    FAAVD         XXAVD
     C     *LIKE         DEFINE    FAOPD         XXOPD
     C     KEYFA3        KLIST
     C                   KFLD                    XXOPKO
     C                   KFLD                    XXFAKT
     C                   KFLD                    XXKUNR
     C                   KFLD                    XXAVD
     C                   KFLD                    XXOPD
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL SAML1 SAMLEFAKTURA
     C*--------------------------------------------------------------
     C     SAM1KE        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL TURER
     C*--------------------------------------------------------------
     C     TURKEY        KLIST
     C                   KFLD                    DITUAV
     C                   KFLD                    DITUR
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL SYSRL01 ("SURRUGATNR")
     C*--------------------------------------------------------------
     C     SURKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    REGNA
     C                   MOVE      'SYS   '      REGNA             6
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL NUMML01
     C*--------------------------------------------------------------
     C     NUMMKY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    SÅR
     C                   KFLD                    NOK1
     C                   KFLD                    NOK2
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODWL01
     C*--------------------------------------------------------------
     C     KODWKY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    FAKDM
     C                   MOVE      *BLANKS       WMVAKD            2
      *
     C     FIFIRM        SETLL     FIRM
     C                   READ      FIRM                                   33
     C                   MOVE      FIFIRM        UFIRMA            2
      * *IN70 ON = HVIS KOSTNAD, SWITCH MOMSKODE.
     C     FILE41        COMP      'J'                                    70
     C* HENTER TELLEVERK JOURNALNR
     C     FIFIRM        SETLL     FIRMTEL
     C                   READ      FIRMTEL                                33
     C                   ADD       1             FIJOUR
     C  N33              UPDATE    FIRMTR
     C   33              WRITE     FIRMTR
      *
      * HENTER MINSTE ÅPNE PERIODE
     C                   MOVE      *ZEROS        KOÅMND
     C                   MOVE      *ZEROS        KOÅÅR
     C                   MOVE      *ZEROS        KOÅCC
     C     'Å'           SETLL     KODTÅ
     C     'Å'           READE     KODTÅ                                  33
     C     *IN33         IFEQ      '1'
     C     UYEAR         IFGT      50
     C     UYEAR         ADD       1900          MINPE2            6 0
     C                   ELSE
     C     UYEAR         ADD       2000          MINPE2
     C                   END
     C                   MULT      100           MINPE2
     C                   MOVE      UMONTH        MINPE2
     C                   ELSE
     C                   MOVE      MINPER        MINPE2
     C                   END
     C*
     C                   MOVE      *ZEROS        NULPRO
     C                   MOVE      *ZEROS        IBMPNR            5 0
     C*
     C*PRINTER HEADING
     C*
     C                   EXCEPT    PHEAD
     C                   MOVE      'G'           XXOPKO
     C                   MOVE      *ZEROS        XXFAKT
     C                   MOVE      *ZEROS        XXKUNR
     C                   MOVE      *ZEROS        XXAVD
     C                   MOVE      *ZEROS        XXOPD
     C     KEYFA3        SETLL     FAK3                               33
S18  C*    XXOPKO        READE     FAK3                                   33
N18  C     XXOPKO        READE(N)  FAK3                                   33
     C   33              GOTO      SLUTT
     C                   MOVE      FAFAKT        XXFAKT
     C                   MOVE      FAKUNR        XXKUNR
     C                   MOVE      FAAVD         XXAVD
     C                   MOVE      FAOPD         XXOPD
     C*
     C     STAFIR        TAG
     C     KEYFA3        SETLL     FAK3                               33
      *
      * LESER FAKTURTE FAKTURALINJER
S18  C*    XXOPKO        READE     FAK3                                   33
N18  C     XXOPKO        READE(N)  FAK3                                   33
     C   33              GOTO      SLUTT
     C                   MOVE      FAFAKT        XXFAKT
     C                   MOVE      FAKUNR        XXKUNR
     C                   MOVE      FAAVD         XXAVD
     C                   MOVE      FAOPD         XXOPD
     C*
     C* HENTER AVDOPPLYSNINGER HVIS IKKE LIK FORRIGE
     C     FAAVD         IFNE      FORIGE
     C                   EXSR      AVDSR
     C                   END
     C*
     C     HEAKEY        CHAIN     HEADF                              33
N12  C  N33              EXSR      EUSR
     C  N33HEUR          IFEQ      'H'
     C* TRANSP OPD HVOR TURNR. MANGLER-HOPP OVER..(*IN33 VAR FØR *IN34)
     C     HEAKEY        CHAIN     DISP                               33
     C  N33TURKEY        CHAIN     TURER                              33
     C* Transportoppdrag- Det er RUNDTURnr som går til evt prosj.regnsk
     C  N33              MOVE      TURUND        HEPRO
     C* Hvis det ikke er krav om prosj på avd.nivå OK uten prosj.nr
     C* (simuler landsped. oppdrag for å få OK periode/kontering..)
     C     *IN33         IFEQ      '1'
     C                   MOVE      HEAVD         KOVAVD
     C     KODVKE        CHAIN     KODTV                              33
     C     *IN33         IFEQ      '0'
     C     KOVPRO        IFNE      'J'
     C                   MOVE      *OFF          *IN33
     C                   MOVE      'A'           HEUR
     C                   ELSE
     C                   MOVE      *ON           *IN33
     C                   END
     C                   END
     C                   END
     C                   END
     C   33              ADD       1             XXOPD
     C   33              GOTO      STAFIR
     C*
     C* KALLER OPPDATERINGSRUTINEN
     C*
     C                   EXSR      HOVED
     C* HEDTMP/ÅP ER PERI. FOR "HOVEDFAKTURA" (FØRSTE)
     C     HEDTMP        IFEQ      *ZEROS
     C                   MOVE      SMND          HEDTMP
     C                   MOVE      SÅR           HEDTÅP
     C                   MOVEL     SÅR           HEDTCP
     C                   END
     C     HEST          IFEQ      'G'
     C                   MOVE      'T'           HEST
     C                   END
     C*
     C                   EXCEPT    HOVUPD
     C     FIURBL        IFEQ      'J'
     C                   EXSR      TTSR
     C                   END
     C*
     C* ØKER KEY MED 1
     C                   ADD       1             XXOPD
     C                   GOTO      STAFIR
     C**
     C     SLUTT         TAG
     C                   EXCEPT    TOTGRA
     C*
     C* GETS TOTALS FOR THIS FIRM
     C                   EXSR      TOTSR
     C* LESER ALLE OPPDRAG MED STATUS = 'G'
     C* BØR VÆRE RENE "NULL-FAKTURAER"-HEST MERKES DA MED T FOR STATI
     C* ØVRIGE FEILLISTES - DISSE SKAL DA SELVSAGT IKKE I STATISTIKK
     C                   EXSR      STATG
     C*
     C                   SETON                                        LR
     C                   RETURN
     C*
     C******************************************
     C     HENTBI        BEGSR
     C******************************************
     C* HENTER BILAGSNR KUN VED SAMMENSLÅING
     C     FISADK        IFNE      'N'
     C                   MOVE      'BILS'        NOK1              4
     C                   MOVE      '    '        NOK2              4
     C     NUMMKY        CHAIN     NUMML01                            61
     C     *IN61         IFEQ      '1'
     C                   EXSR      GMLNUM
     C                   END
     C  N61              DO
     C                   ADD       1             SBNRNU
     C                   MOVE      SBNRNU        BILNR
     C                   MOVE      SBNRNU        BILNRS            7 0
     C                   UPDATE    NUMMR
     C                   END
     C*
     C                   MOVE      'A'           AKTKOD
     C                   MOVE      FIFIRM        FIRMA
     C                   MOVE      SÅR           PERAAR
     C                   MOVE      SMND          PERNR
     C                   MOVE      *BLANKS       VALKOD
     C                   WRITE     POSAR
     C                   END
     C*
     C                   ENDSR
     C*
     C******************************************
     C     GMLNUM        BEGSR
     C******************************************
     C     *LIKE         DEFINE    SÅR           TMPÅR
     C                   MOVE      SÅR           TMPÅR
      *
     C     SÅR           DOWGT     2002
     C                   SUB       1             SÅR
     C     NUMMKY        CHAIN     NUMML01                            61
     C  N61              LEAVE
     C                   END
      *
     C                   MOVE      TMPÅR         SÅR
     C                   ENDSR
     C*
     C******************************************
     C     AVDSR         BEGSR
     C******************************************
     C*
     C* HENTER AVDELINGSOPPLYSNINGER
     C                   MOVE      FAAVD         FORIGE            4 0
     C                   MOVE      FORIGE        KOVAVD
     C     KODVKE        CHAIN     KODTV                              33
     C*
     C*  HENTER AVDELINGSOPPLYSNINGER OM KONTERING
     C                   MOVE      KOVAVD        KOAAVD
     C     KODAKE        CHAIN     KODTA                              33
     C*
     C                   MOVE      *ZEROS        SBÆR
     C                   MOVE      FIFIRM        POST01
     C*
     C                   ENDSR
     C*
     C******************************************
     C     HOVED         BEGSR
     C******************************************
     C*
     C* FIKSER PERIODEBEGREP TRANSPORTDISPONERING
     C* IKKE VED SAMLEFAKTURERING
     C*
     C     HEUR          IFEQ      'H'
     C     FAKDA         ANDNE     'S'
N01  C     FAMND         ANDEQ     *ZEROS
     C                   MOVE      TURACC        FACC
     C                   MOVE      TURAAR        FAÅR
     C                   MOVE      TURMND        FAMND
     C                   END
     C*
     C     FAMND         IFNE      *ZEROS
     C                   MOVE      FAMND         KOÅMND
     C                   MOVE      FAÅR          KOÅÅR
     C                   MOVE      FACC          KOÅCC
     C                   ELSE
     C                   MOVEL     HEDTÅ         KOÅCC
     C                   MOVE      HEDTÅ         KOÅÅR
     C                   MOVE      HEDTM         KOÅMND
     C                   END
     C*
     C* SKJEKKER OM PERIODE VARELINJE ER ÅPEN
     C* I REGNSKAPET
     C*
     C     KODÅKE        CHAIN     KODTÅ                              33
     C  N33              MOVEL     KOÅCC         SÅR               4 0
     C  N33              MOVE      KOÅÅR         SÅR
     C  N33              MOVE      KOÅMND        SMND              2 0
     C   33              MOVEL     MINPE2        SÅR
     C   33              MOVE      MINPE2        SMND
     C                   MOVE      SÅR           SÅR2              2 0
     C*
     C                   MOVE      FADTDD        DG
     C                   MOVE      FADTMM        MN
     C                   MOVE      FADTÅÅ        AR
     C                   MOVE      FAKUNR        KUNDEN            8 0
     C                   MOVE      FAKUNR        ZKUNDN
     C                   Z-ADD     FAFAKT        IBMFAK            7 0
     C                   MOVE      FADAFF        IBMFFD
     C*
     C* HUSK PROSJNR (KAN NULLES BASERT PÅ KONTOPLAN V.VISSE KONTOER)
     C                   MOVE      HEPRO         HEPROH            8 0
     C*-----------------------------------------
     C* KJØPER
     C*-----------------------------------------
     C*
     C     FASK          IFEQ      'K'
N19  C                   MOVE      *zeros        REFERA            7 0
N19  c     fakda         ifeq      'C'
     C                   MOVE      HEFNGK        REFERA            7 0
N19  c                   end
     C                   MOVEL     HENAK         DIV11            11
     C                   MOVE      HEVALK        RESVAL            3
     C     FACURI        IFNE      *BLANKS
     C                   MOVE      FACURI        RESVAL
     C                   END
     C                   EXSR      VALI
     C                   END
     C*
     C*-----------------------------------------
     C* SELGER
     C*-----------------------------------------
     C*
     C     FASK          IFEQ      'S'
N19  C                   MOVE      *zeros        REFERA            7 0
N19  c     fakda         ifeq      'C'
     C                   MOVE      HEFNGS        REFERA
N19  c                   end
     C                   MOVEL     HENAS         DIV11            11
     C                   MOVE      HEVALS        RESVAL
     C     FACURI        IFNE      *BLANKS
     C                   MOVE      FACURI        RESVAL
     C                   END
     C                   EXSR      VALI
     C                   END                                                     * END 'S'
     C*
     C*-----------------------------------------
     C* FRI PART 'X'
     C*-----------------------------------------
     C*
     C     FASK          IFEQ      'X'
     C                   MOVE      *ZEROS        REFERA
     C                   MOVE      *BLANKS       DIV11            11
     C                   MOVE      FICURR        RESVAL
     C     FACURI        IFNE      *BLANKS
     C                   MOVE      FACURI        RESVAL
     C                   END
     C                   EXSR      VALI
     C                   END                                                     * END 'S'
     C*
     C     SLUHOV        ENDSR
     C*
     C******************************************
     C     VALI          BEGSR
     C******************************************
     C                   Z-ADD     SMND          PMN               2 0
     C*
     C* SKJEKK OM DENNE MÅNED HAR BILAGSNR
     C*
     C                   MOVE      SÅR           YYÅR
     C                   Z-ADD     SMND          YYMND
     C     UYEAR         IFGT      50
     C     UYEAR         ADD       1900          BILAAR
     C                   ELSE
     C     UYEAR         ADD       2000          BILAAR
     C                   END
     C                   MOVE      UMONTH        BILMND
     C                   MOVE      UDAY          BILDAG
     C     FISADK        IFNE      'N'
     C     KEYBI         CHAIN     POSTA1                             44
     C   44              EXSR      HENTBI
     C  N44              MOVE      BILNR         BILNRS
     C                   ELSE
     C                   Z-ADD     FAFAKT        BILNR
     C                   MOVE      FADATO        BILDAT
     C                   MOVE      BILNR         BILNRS
     C                   MOVE      'A'           AKTKOD
     C                   MOVE      FIFIRM        FIRMA
     C                   MOVE      SÅR           PERAAR
     C                   MOVE      SMND          PERNR
     C                   MOVE      *BLANKS       VALKOD
     C     KEYBI2        CHAIN     POSTA2                             44
     C   44              WRITE     POSAR
     C                   END
     C* VARIABLE VAT
     C*
     C                   MOVE      *ZEROS        RESVAB
     C                   MOVE      *ZEROS        MVAVAL
     C*
     C*
     C     KEYFA3        SETLL     FAK3                               33
     C*
     C* GÅR I LØKKE OG LESER VARELINJER
     C*
     C     STVALI        TAG
     C     KEYFA3        READE     FAK3                                   33
     C  N33              DO
     C                   MOVE      HEPROH        HEPRO
     C*
     C* TEST IF INVOICE IS DELETED
     C*
     C     FAKDA         IFEQ      'D'
     C                   EXSR      KDTFM2
     C                   EXCEPT    DETSLE
S18  C*    KEYFAK        CHAIN     FAKT                               33
     C  N33              MOVE      FIJOUR        FAJOUR
     C  N33              MOVE      'D'           FAOPKO
     C  N33              UPDATE    FAKTR
     C                   GOTO      STVALI
     C                   END
     C*
     C* END DELETION
     C*
S18  C*    KEYFAK        CHAIN     FAKT                               33
S18  C*                  EXCEPT    DUMFAK
     C                   MOVE      FAVK          KGEKOD
     C                   MOVE      FAVK          KG2KOD
     C*
     C     GEBKEY        CHAIN     KODTGE                             11
     C  N11GEBKE2        CHAIN     KODTG2                             11
N12  C  N11EUKODE        IFNE      *BLANKS
N12  C     GEBKEYE       CHAIN     KODTG3                             11
N12  C                   SETOFF                                       11
N12  C                   END
     C*
     C* VED AVREGNINGSKODE T HENT BILKODENS KONTERING
     C*
     C                   MOVE      'N'           TRAJUS            1
     C  N11HEUR          IFEQ      'H'
     C     KGEAVR        ANDEQ     'T'
     C     GEBKE3        CHAIN     KODTGE                             11
     C  N11GEBKE4        CHAIN     KODTG2                             11
N12  C  N11EUKODE        IFNE      *BLANKS
N12  C     GEBKEY3E      CHAIN     KODTG3                             11
N12  C                   SETOFF                                       11
N12  C                   END
      *
      * PÅ TUR SOM ER AVREGNET... LEGG UT JUSTERING I KOSBU
     C     TUPRO         IFNE      *ZEROS
     C     TUAVRE        ANDEQ     'X'
     C     TUTAKO        ANDNE     'A'
     C     FACD21        ANDEQ     '  '
     C                   MOVE      'J'           TRAJUS            1
     C                   CALL      'SYTR12J'
     C                   PARM                    FAAVD
     C                   PARM                    FAOPD
     C                   PARM                    FALI
     C                   END
     C                   END
     C*
     C*HVIS GEBYRERT ER BORTE BENYTTES KONTO 99999
     C*
     C   11              DO
     C                   MOVE      99999         FKONTO
     C                   MOVE      99999         SKONTO
     C                   MOVE      99999         KG2KON
     C                   MOVE      'N'           KGEUTL
     C                   MOVE      'N'           KGEFRA
     C                   MOVE      'J'           KGEPR
     C                   MOVE      *ZEROS        KGEUTK
     C                   MOVE      *ZEROS        KG2AVD
     C                   MOVE      *ZEROS        KG2BÆR
     C                   END
     C*
     C* SPLITT AV POSTERING
     C*
     C     FAKDUK        IFEQ      'S'
     C     FABELN        SUB       FABELU        INNTEK           13 2
     C                   Z-ADD     FABELU        FABELN
     C                   EXSR      IBM
     C                   Z-ADD     INNTEK        FABELN
     C                   Z-ADD     KG2UTG        FKONTO
     C                   Z-ADD     KG2UTG        SKONTO
     C                   Z-ADD     KG2MOT        KG2KON
     C                   MOVE      *ZEROS        KGEUTK
     C                   EXSR      IBM
     C     FABELU        ADD       INNTEK        FABELN
     C*
     C* INGEN SPLITT
     C*
     C                   ELSE
     C                   EXSR      IBM
     C*
     C* SKAL HOVEDBOKSUTGIFT OPPDATERES
     C*
     C     FAKDUK        IFEQ      'H'
     C     FAKDUK        OREQ      'L'
     C                   EXSR      UTGIFT
     C                   END
     C                   END
     C                   SETOFF                                       11
     C*
     C* OPPDATERER FAKTURAREGISTER
     C*
S18  C*    KEYFAK        CHAIN     FAKT                               33
     C     AUT           IFNE      'O'
     C                   MOVE      'T'           FAOPKO                         *TIL STATIST
     C                   ELSE
     C                   MOVE      'O'           FAOPKO                         *OMKJ/KRED.NOTA
     C                   END
     C                   MOVE      FIJOUR        FAJOUR
     C                   MOVEL     SÅR           FACC
     C                   MOVE      SÅR           FAÅR
     C                   MOVE      SMND          FAMND
     C                   MOVE      FAVD          FAAVDR
     C                   MOVE      SBÆR          FABÆR
     C                   MOVE      FKONTO        FAACCN
     C     TRAJUS        IFEQ      'J'
     C                   MOVEL     'Y'           FACD21
     C                   END
     C                   EXCEPT    OPDATF
     C*
     C                   END                                                    LEST VARELINJE
     C*
     C*
     C  N33              ADD       FABELV        RESVAB           11 2
     C  N33              GOTO      STVALI
     C*
     C* PLUSSER MVA  PÅ UTENSLANDSK BELØP
     C*
     C     RESVAL        IFNE      FICURR
     C* OBS! FAKTOR FITAXN = 1,...(I NORGE 1,20)KUN NETTO LEGGES TIL
     C                   MOVE      MVAVAL        MVAGRL           13 2
     C                   MULT(H)   FITAXN        MVAVAL
     C                   SUB       MVAGRL        MVAVAL
     C                   ADD       MVAVAL        RESVAB
     C                   END
     C*
     C     KUNNOK        IFNE      *ZEROS
     C                   EXSR      IBMTOT
     C                   ELSE
     C     IBMFAK        IFNE      *ZEROS
     C                   EXCEPT    DETNUL
     C                   END
     C                   END
     C*
     C                   ENDSR
     C*
     C******************************************
     C     IBM           BEGSR
     C******************************************
      * *IN34=MOMS
     C     FAKDM         IFEQ      ' '
     C     FAKDM         OREQ      'N'
     C                   MOVE      *OFF          *IN34
     C                   ELSE
     C                   MOVE      *ON           *IN34
     C                   EXSR      MVA
N15   * FITAXN=1,000 MÅ BETY DET ER BENYTTET AVVIKENDE KODE MED 0 I SATS = FRI
N15  C                   IF        FITAXN = 1
N15  C                   MOVE      *OFF          *IN34                          FRI
N15  C                   ENDIF
     C                   ENDIF
     C*
     C* LEGGER OVER DEN AVDELING SOM KONTERES I
     C* DEN INTERNE SPEDISJONSAVDELING
     C*
     C                   MOVE      *ZEROS        IBMNOK
     C                   MOVE      KOAKON        FAVD              4 0
     C                   MOVE      *ZEROS        PRIPRO            8 0
     C                   MOVE      KOABÆR        SBÆR
     C                   MOVE      'H'           IBMTYP            1
     C* HVIS GEBYRET FAST FØRES EN AVDELING
     C* TAST DETTE HENSYN TIL HER
     C*
     C     KG2AVD        IFNE      *ZEROS
     C                   MOVE      KG2AVD        FAVD
     C                   END
     C*
     C* HVIS FØRING MOT BÆRER ER OVERSTYRTPÅ OPPDRAGSNIVÅ TA HENSYN HER
     C* SPESIELL BEHANDLING AV 9999 OG *BLANK KUN NØDVENDIG I EN OVER-
     C* GANG. SENERE VIL OPPDRAGET ALLTID INNEHOLDE BÆRER - ENTEN GITT
     C* FRA AVDELINGEN ELLER OVERSTYRT I OPPDRAGET.
     C     HESTD         IFEQ      9999
     C                   MOVE      *ZEROS        SBÆR
     C                   ELSE
     C     HESTD         IFGT      *ZEROS
     C                   Z-ADD     HESTD         SBÆR
     C                   END
     C                   END
     C* HVIS GEBYRET FAST FØRES EN BÆRER
     C* TAS  DETTE HENSYN TIL HER
     C     KG2BÆR        IFNE      *ZEROS
     C                   MOVE      KG2BÆR        SBÆR
     C                   END
     C*
     C* EGEN KONTO UTEN MOMS
     C*
     C     KG2KON        IFNE      *ZEROS
     C     *IN34         ANDEQ     *OFF
     C                   MOVE      KG2KON        FKONTO
     C                   MOVE      KG2KON        SKONTO
     C                   END
     C*
     C* FLYTTER 0 I KOSTNADSSTED HVIS IKKE KSTED
     C* KAN BENYTTES PÅ AKTUELL KONTO
     C*
     C                   MOVE      FKONTO        WKONTO
     C     KONTKE        CHAIN     KONTL01                            66
     C  N66STEDK         IFEQ      'N'
     C                   MOVE      *ZEROS        FAVD
     C                   END
     C*
     C* FLYTTER 0 I BÆRER HVIS IKKE LOV
     C*
     C  N66BARERK        IFEQ      'N'
     C                   MOVE      *ZEROS        SBÆR
     C                   END
     C*
     C* FLYTTER 0 I PROSJ HVIS IKKE LOV
     C*
     C  N66PROSJK        IFEQ      'N'
     C                   MOVE      *ZEROS        HEPRO
     C                   END
     C*
     C* SNUR BELØPET PÅ POSTERINGEN
     C*
     C                   Z-SUB     FABELN        IBMNOK           11 2
N06  C                   Z-SUB     FABELV        IBMVAL           11 2
N17  c     l1kjor        ifeq      'V'
N16  C                   Z-SUB     FABELN        IBMNOKN          11 2
N16  C                   Z-SUB     FABELV        IBMVALN          11 2
N17  c                   end
     C*
     C* ØKER POST MED MOMS
     C*
     C     *IN34         IFEQ      *ON
s09  C*                  MULT      FITAXN        IBMNOK
s09  C*                  MULT      FITAXN        IBMVAL
n09  C                   MULT(H)   FITAXN        IBMNOK
n09  C                   MULT(H)   FITAXN        IBMVAL
     C                   ADD       FABELV        MVAVAL           13 2
     C                   MOVE      '3'           IBMMVA            1
      * *IN70 ON = HVIS KOSTNAD, SWITCH MOMSKODE.
     C   70KONTY         IFEQ      'U'
     C                   MOVE      '1'           IBMMVA
     C                   END
     C                   ELSE
     C                   MOVE      '4'           IBMMVA
     C* VED FRI!! PÅ AKTIVA/PASSIVA/UTGIFT SKAL MOMS-KODE VÆRE 0
     C     KONTY         IFEQ      'A'
     C     KONTY         OREQ      'P'
     C                   MOVE      '0'           IBMMVA
     C                   END
      * *IN70 ON = HVIS KOSTNAD, SWITCH MOMSKODE.
     C   70KONTY         IFEQ      'U'
     C                   MOVE      '0'           IBMMVA
     C                   END
     C*
     C                   END
     C     FAKDM         IFNE      'J'
     C     FAKDM         ANDNE     'N'
     C                   MOVE      FAKDM         IBMMVA
     C                   END                                                    <FAKDM
     C*
     C                   MOVE      IBMMVA        SMVA
     C*
     C* OPPDATERER REGNSKAP HVIS IKKE BELØP = 0
     C*
     C     IBMNOK        IFNE      *ZEROS
     C                   ADD       IBMNOK        KUNNOK           11 2
     C*
     C* LEGGER UT POST VED UTLEGGSKONTROLL
     C* LEGGER HER UT NY POST UANSETT
     C*
     C     FIKDUL        IFEQ      'J'
     C     KGEUTK        ANDNE     *ZEROS
     C                   ADD       1             IBMPNR
     C                   EXSR      GETSUR
     C                   MOVE      'A'           AKTKOD
     C                   MOVE      POST01        FIRMA
     C                   MOVE      BILNRS        BILNR
     C                   Z-ADD     IBMPNR        POSNR
     C     AR            IFGT      50
     C     AR            ADD       1900          KRDAAR
     C                   ELSE
     C     AR            ADD       2000          KRDAAR
     C                   END
     C                   MOVE      MN            KRDMND
     C                   MOVE      DG            KRDDAG
     C                   MOVE      SÅR           PERAAR
     C                   MOVE      SMND          PERNR
     C                   MOVE      'D'           TYPE
     C                   MOVE      SEKSPN        SEKSP2
     C                   MOVE      BILTX2        BILTXT
     C                   Z-ADD     KGEUTK        RESNR
     C                   MOVE      FKONTO        KONTO
N13  C                   MOVE      FAVD          KSTED
N13  C                   MOVE      FKONTO        WKONTO
N13  C     KONTKE        CHAIN     KONTL01                            66
N13  C  N66STEDK         IFEQ      'N'
N13  C                   MOVE      *ZEROS        FAVD
N13  C                   END
     C                   MOVE      IBMMVA        MOMSK
     C                   Z-ADD     IBMNOK        BBELOP
     C                   Z-ADD     IBMVAL        BELOPV
N17  c     l1kjor        ifeq      'V'
N16  C                   Z-ADD     IBMNOKN       NBELPO
N16  C     RESVAL        IFNE      '   '
N16  C     RESVAL        ANDNE     FICURR
N16  C                   Z-ADD     IBMVALN       NBELPO
N16  C                   END
N17  c                   end
N06  C     RESVAL        IFEQ      '   '
N06  C     RESVAL        OREQ      FICURR
N06  C                   MOVE      *BLANKS       VALKOX
N06  C                   MOVE      *ZEROS        BELOPV
N06  C                   ELSE
N06  C                   MOVE      RESVAL        VALKOX
N06  C                   END
V10  C*                  Z-ADD     UTLREF        REFNR
V10  C                   Z-ADD     HEOPD         REFNR
     C                   MOVE      *BLANKS       KRNR
V10  C*                  MOVE      UTLREF        KRNR
V10  C                   MOVE      SEKSPN        KRNR
     C     AR            IFGT      50
     C     AR            ADD       1900          FFDAAR
     C                   ELSE
     C     AR            ADD       2000          FFDAAR
     C                   END
     C                   MOVE      MN            FFDMND
     C                   MOVE      DG            FFDDAG
     C                   MOVE      'J'           OPDKOD
     C                   EXCEPT    IBMNYU
     C                   GOTO      UTUTL
     C                   END
     C*
     C* LEGGER UT VANLIG POST TIL INNTEKTER
     C*
     C* SKJEKKER OM PROSJEKTNUMMER SKAL LEGGES UT
     C*
     C     KOVPRO        IFEQ      'J'
     C     KGEPR         ANDNE     'N'
     C     HEPRO         ANDNE     *ZEROS
     C                   ADD       1             IBMPNR
     C                   EXSR      GETSUR
     C                   EXSR      SRPOST
     C                   MOVE      HEPRO         PRIPRO
     C                   MOVE      SEKSPN        SEKSP2
     C                   MOVE      BILTX2        BILTXT
     C                   Z-ADD     HEPRO         PROSNR
     C                   EXSR      STEBAR
     C                   EXCEPT    IBMNY1
     C                   GOTO      UTUTL
     C                   END
     C*
     C* ELLERS VANLIG SUMPOST TIL INNTEKTSKONTO
     C*
     C                   Z-ADD     SMND          SMNPC
     C     FISADK        IFNE      'N'
     C     SKEY          CHAIN     POSTB1                             44
     C                   ELSE
     C                   SETON                                        44
     C                   END
     C*
     C* HENTER REGLER FRA KONTOPLAN
     C*
     C   44              DO
     C                   MOVE      FKONTO        WKONTO
     C     KONTKE        CHAIN     KONTL01                            66
     C                   ADD       1             IBMPNR
     C                   EXSR      GETSUR
     C                   EXSR      SRPOST
     C     FISADK        IFNE      'N'
     C                   MOVEL     'SUMPOST '    BILTXT
     C                   MOVE      FIJOUR        BILTXT
     C                   ELSE
     C                   MOVE      *BLANKS       BILTXT
     C                   MOVEL     'FAK'         BILT07            7
     C                   MOVE      HESG          BILT07
     C                   MOVEL     BILT07        BILTXT
     C                   MOVE      FIJOUR        BILTXT
     C                   END
     C                   MOVE      *ZEROS        PROSNR
     C                   EXCEPT    IBMNY1
     C                   END
     C  N44              ADD       IBMNOK        BBELOP
N06  C  N44              ADD       IBMVAL        BELOPV
      *
N06  C  N44RESVAL        IFEQ      '   '
N06  C     RESVAL        OREQ      FICURR
N17  c     l1kjor        ifeq      'V'
N16  C  N44              ADD       IBMNOK        NBELPO
N17  c                   end
N06  C                   MOVE      *BLANKS       VALKOX
N06  C                   MOVE      *ZEROS        BELOPV
N06  C                   ELSE
N17  c     l1kjor        ifeq      'V'
N16  C  N44              ADD       IBMVAL        NBELPO
N17  c                   end
N06  C                   MOVE      RESVAL        VALKOX
N06  C                   END
     C  N44              UPDATE    POSBR
     C*
     C     UTUTL         TAG
     C*
     C* SKRIVER UT LISTE OVER POSTERING
     C*
     C     IBMNOK        COMP      *ZEROS                             66  66
     C   OF              EXCEPT    PHEAD
     C   OF              SETOFF                                       OF
     C   66              ADD       IBMNOK        TOTDEB           11 2
     C   66              ADD       IBMNOK        GRADEB           11 2
     C  N66              ADD       IBMNOK        TOTKRE           11 2
     C  N66              ADD       IBMNOK        GRAKRE           11 2
     C                   EXSR      KDTFMT
     C                   EXCEPT    DET
     C                   EXSR      KDTFMT
     C*
     C                   END
     C*
     C     UTIBM         ENDSR
     C*
     C******************************************
     C     UTGIFT        BEGSR
     C******************************************
     C*
     C* OPPDATERING AV UTGIFT
     C*
     C                   MOVE      KG2MOT        FKONTO
     C                   MOVE      KG2MOT        SKONTO
     C* EGEN KONTO UTEN MOMS
     C     KG2UTG        IFNE      *ZEROS
     C     KG2UTG        ANDNE     99999
     C     *IN34         ANDEQ     *OFF
     C                   MOVE      KG2UTG        FKONTO
     C                   MOVE      KG2UTG        SKONTO
     C                   END
     C*
     C* FLYTTER 0 I KOSTNADSSTED HVIS IKKE KSTED
     C* KAN BENYTTES PÅ AKTUELL KONTO
     C*
     C                   MOVE      FKONTO        WKONTO
     C     KONTKE        CHAIN     KONTL01                            66
     C  N66STEDK         IFEQ      'N'
     C                   MOVE      *ZEROS        FAVD
     C                   END
     C*
     C* FLYTTER 0 I BÆRER HVIS IKKE LOV
     C*
     C  N66BARERK        IFEQ      'N'
     C                   MOVE      *ZEROS        SBÆR
     C                   END
     C*
     C* FLYTTER 0 I PROSJ HVIS IKKE LOV
     C*
     C  N66PROSJK        IFEQ      'N'
     C                   MOVE      *ZEROS        HEPRO
     C                   END
     C*
     C* LEGGER UT POSTERINGSBELØP
     C*
     C                   Z-ADD     FABELU        IBMNOK           11 2
     C*
     C* ØKER POST MED MOMS
     C*
     C     *IN34         IFEQ      *ON
s09  C*                  MULT      FITAXN        IBMNOK
n09  C                   MULT(H)   FITAXN        IBMNOK
     C                   MOVE      '1'           IBMMVA
     C                   ELSE
     C                   MOVE      '0'           IBMMVA
     C                   END
     C*
     C                   MOVE      IBMMVA        SMVA
     C*
     C* OPPDATERER REGNSKAP HVIS IKKE BELØP = 0
     C*
     C     IBMNOK        IFNE      *ZEROS
     C*
     C* LEGGER UT VANLIG POST TIL UTGIFT
     C*
     C* SKJEKKER OM PROSJEKTNUMMER SKAL LEGGES UT
     C*
     C     KOVPRO        IFEQ      'J'
     C     KGEPR         ANDNE     'N'
     C     HEPRO         ANDNE     *ZEROS
     C                   ADD       1             IBMPNR
     C                   EXSR      GETSUR
     C                   EXSR      SRPOST
     C                   MOVE      HEPRO         PRIPRO
     C                   MOVE      SEKSPN        SEKSP2
     C                   MOVE      BILTX2        BILTXT
     C                   Z-ADD     HEPRO         PROSNR
     C                   EXSR      STEBAR
     C                   EXCEPT    IBMNY1
     C                   GOTO      UTUTL2
     C                   END
     C*
     C* ELLERS VANLIG SUMPOST TIL UTGIFTSKONTO
     C*
     C                   Z-ADD     SMND          SMNPC
     C     FISADK        IFNE      'N'
     C     SKEY          CHAIN     POSTB1                             44
     C                   ELSE
     C                   SETON                                        44
     C                   END
     C*
     C*
     C* HENTER REGLER FRA KONTOPLAN
     C*
     C   44              DO
     C                   MOVE      FKONTO        WKONTO
     C     KONTKE        CHAIN     KONTL01                            66
     C                   ADD       1             IBMPNR
     C                   EXSR      GETSUR
     C                   EXSR      SRPOST
     C     FISADK        IFNE      'N'
     C                   MOVEL     'SAMLEPOS'    BILTXT
     C                   MOVE      'T      '     BILTXT
     C                   ELSE
     C                   MOVEL     'FAKTURA '    BILTXT
     C                   MOVE      '       '     BILTXT
     C                   MOVE      HESG          BILTXT
     C                   END
     C                   MOVE      *ZEROS        PROSNR
     C                   EXSR      STEBAR
     C                   EXCEPT    IBMNY1
     C                   END
     C  N44              ADD       IBMNOK        BBELOP
N06  C  N44              ADD       IBMVAL        BELOPV
N06  C  N44RESVAL        IFEQ      '   '
N06  C     RESVAL        OREQ      FICURR
N06  C                   MOVE      *BLANKS       VALKOX
N06  C                   MOVE      *ZEROS        BELOPV
N06  C                   ELSE
N06  C                   MOVE      RESVAL        VALKOX
N06  C                   END
     C  N44              UPDATE    POSBR
     C*
     C     UTUTL2        TAG
     C*
     C* SKRIVER UT LISTE OVER POSTERING
     C*
     C     IBMNOK        COMP      *ZEROS                             66  66
     C   OF              EXCEPT    PHEAD
     C   OF              SETOFF                                       OF
     C   66              ADD       IBMNOK        TOTDEB           11 2
     C   66              ADD       IBMNOK        GRADEB           11 2
     C  N66              ADD       IBMNOK        TOTKRE           11 2
     C  N66              ADD       IBMNOK        GRAKRE           11 2
     C                   EXSR      KDTFMT
     C                   EXCEPT    DET
     C                   EXSR      KDTFMT
     C*
     C                   END
     C*
     C* OPPDATERER MOTPOST TIL UTGIFT
     C* VED KODE = L SKAL KREDITOR OPPDATERES
     C*
     C     IBMNOK        IFNE      *ZEROS
     C*
     C                   Z-SUB     IBMNOK        IBMNOK
     C                   MOVE      KG2HBO        FKONTO
     C                   MOVE      KG2HBO        SKONTO
N06  C                   Z-SUB     IBMVAL        BELOPV
N06  C     RESVAL        IFEQ      '   '
N06  C     RESVAL        OREQ      FICURR
N06  C                   MOVE      *BLANKS       VALKOX
N06  C                   MOVE      *ZEROS        BELOPV
N06  C                   ELSE
N06  C                   MOVE      RESVAL        VALKOX
N06  C                   END
     C*
     C     FAKDUK        IFEQ      'H'
     C                   Z-ADD     SMND          SMNPC
     C     FISADK        IFNE      'N'
     C     SKEY          CHAIN     POSTB1                             44
     C                   ELSE
     C                   SETON                                        44
     C                   END
     C*
     C* HENTER REGLER FRA KONTOPLAN
     C*
     C   44              DO
     C                   MOVE      FKONTO        WKONTO
     C     KONTKE        CHAIN     KONTL01                            66
     C                   ADD       1             IBMPNR
     C                   EXSR      GETSUR
     C                   EXSR      SRPOST
     C     FISADK        IFNE      'N'
     C                   MOVEL     'SAMLEPOS'    BILTXT
     C                   MOVE      'T      '     BILTXT
     C                   ELSE
     C                   MOVEL     'FAKTURA '    BILTXT
     C                   MOVE      '       '     BILTXT
     C                   MOVE      HESG          BILTXT
     C                   END
     C                   MOVE      *ZEROS        PROSNR
     C                   EXSR      STEBAR
     C                   EXCEPT    IBMNY1
     C                   END
     C  N44              ADD       IBMNOK        BBELOP
N06  C  N44              ADD       IBMVAL        BELOPV
N06  C  N44RESVAL        IFEQ      '   '
N06  C     RESVAL        OREQ      FICURR
N06  C                   MOVE      *BLANKS       VALKOX
N06  C                   MOVE      *ZEROS        BELOPV
N06  C                   ELSE
N06  C                   MOVE      RESVAL        VALKOX
N06  C                   END
     C  N44              UPDATE    POSBR
     C*
     C* START KODE L
     C                   ELSE
     C                   MOVE      'K'           IBMTYP
     C                   MOVE      ' '           NOKKEL
     C                   MOVE      FALEVN        RESNR
     C                   MOVE      *BLANKS       VALKOX
     C                   MOVE      *ZEROS        BELOPV
     C                   MOVE      REFERA        REFNR
N02  C                   MOVE      *BLANKS       KRNR
     C                   MOVE      IBMFAK        KRNR
     C                   MOVE      IBMFAR        FFDAAR
     C                   MOVE      IBMFMN        FFDMND
     C                   MOVE      IBMFDG        FFDDAG
     C                   MOVE      HESG          BILTXT
     C                   MOVE      FKONTO        WKONTO
     C                   ADD       1             IBMPNR
     C                   EXSR      GETSUR
     C                   EXSR      SRPOST
     C                   MOVE      '0'           MOMSK
     C                   MOVE      *BLANKS       BILTXT
     C* FIXER BILAGSTEKST
     C     IBMNOK        IFLT      *ZEROS
     C                   MOVEL     'Faktura '    BILTXT
     C   45              MOVEL     'Invoice '    BILTXT
     C   46              MOVEL     'Rechnung'    BILTXT
     C                   MOVE      ' '           KRNOKD
     C                   ELSE
     C                   MOVEL     'Kreditno'    BILTXT
     C                   MOVE      'ta     '     BILTXT
     C   45              MOVEL     'Creditno'    BILTXT
     C   45              MOVE      'te     '     BILTXT
     C   46              MOVEL     'Gutschri'    BILTXT
     C   46              MOVE      'ft     '     BILTXT
     C                   MOVE      'K'           KRNOKD
     C                   END
     C                   MOVE      *ZEROS        KSTED
     C                   MOVE      *ZEROS        KBARER
     C                   MOVE      *ZEROS        PROSNR
     C                   EXCEPT    IBMNY
     C                   MOVE      'H'           IBMTYP
     C                   END
     C*
     C* SKRIVER UT LISTE OVER POSTERING
     C*
     C     IBMNOK        COMP      *ZEROS                             66  66
     C   OF              EXCEPT    PHEAD
     C   OF              SETOFF                                       OF
     C   66              ADD       IBMNOK        TOTDEB           11 2
     C   66              ADD       IBMNOK        GRADEB           11 2
     C  N66              ADD       IBMNOK        TOTKRE           11 2
     C  N66              ADD       IBMNOK        GRAKRE           11 2
     C                   EXSR      KDTFMT
     C                   EXCEPT    DET
     C                   EXSR      KDTFMT
     C*
     C                   END
     C*
     C                   ENDSR
     C*
     C******************************************
     C     SRPOST        BEGSR
     C******************************************
     C                   MOVE      'A'           AKTKOD
     C                   MOVE      POST01        FIRMA
     C                   MOVE      BILNRS        BILNR
     C                   Z-ADD     IBMPNR        POSNR
     C     AR            IFGT      50
     C     AR            ADD       1900          KRDAAR
     C                   ELSE
     C     AR            ADD       2000          KRDAAR
     C                   END
     C                   MOVE      MN            KRDMND
     C                   MOVE      DG            KRDDAG
     C                   MOVE      SÅR           PERAAR
     C                   MOVE      SMND          PERNR
     C                   MOVE      IBMTYP        TYPE
     C                   MOVE      SEKSPN        SEKSP2
     C                   MOVE      BILTX2        BILTXT
     C                   MOVE      FKONTO        KONTO
     C                   MOVE      FAVD          KSTED
     C                   MOVE      SBÆR          KBARER
     C                   MOVE      IBMMVA        MOMSK
     C                   Z-ADD     IBMNOK        BBELOP
N06  C                   Z-ADD     IBMVAL        BELOPV
N06  C     RESVAL        IFEQ      '   '
N06  C     RESVAL        OREQ      FICURR
N17  c     l1kjor        ifeq      'V'
N16  C                   Z-ADD     IBMNOKN       NBELPO
N17  c                   end
N06  C                   MOVE      *BLANKS       VALKOX
N06  C                   MOVE      *ZEROS        BELOPV
N06  C                   ELSE
N17  c     l1kjor        ifeq      'V'
N16  C                   Z-ADD     IBMVALN       NBELPO
N17  c                   end
N06  C                   MOVE      RESVAL        VALKOX
N06  C                   END
     C                   Z-ADD     HEPRO         PROSNR
     C                   MOVE      'J'           OPDKOD
     C*
     C                   ENDSR
     C*
     C******************************************
     C     IBMTOT        BEGSR
     C******************************************
     C*
     C* OPPDATERER TOTALPOST I KUNDEREGISTER
     C*
     C     KUNKEY        CHAIN     CUNDL01                            33
     C     KUNKEY        CHAIN     KUNDL01                            33
N14  C     *IN33         IFEQ      '0'
N14  C     FACKNR        ANDNE     *ZEROS
N14  C                   MOVE      FACKNR        KUNDEN
N14  C                   END
S04  C* N33              move      facd22        betbet
     C  N33UYEAR         IFGT      50
     C     UYEAR         ADD       1900          SISAAR
     C                   ELSE
     C     UYEAR         ADD       2000          SISAAR
     C                   END
     C  N33              MOVE      UMONTH        SISMND
     C  N33              MOVE      UDAY          SISDAG
     C  N33              UPDATE    KUNDR
N05  C  N33facd22        ifne      *blanks
s05  C* N33              move      facd22        betbet
N05  C                   move      facd22        betbet
N05  C                   end
     C     DKUND         COMP      'D'                                    50
     C   50              EXSR      DIV
     C  N33              MOVE      KHENV         KHEKE3
     C  N33KHEKEY        CHAIN     KHEDL01                            33
     C   33              MOVE      99999         FKONTO
     C  N33              MOVE      KONTOH        FKONTO
     C                   Z-SUB     KUNNOK        IBMNOK
     C                   MOVE      *ZEROS        KUNNOK
     C                   MOVE      *ZEROS        IBMMVA
     C                   MOVE      'D'           IBMTYP
     C                   MOVE      ' '           NOKKEL
     C   33              SETOFF                                       4546
     C  N33SPRAAK        COMP      'E'                                    45
     C  N33SPRAAK        COMP      'T'                                    46
     C*
     C* OPPRETTER PROSJEKT HVIS IKKE LIK 0
     C*
     C* KONTERER IKKE NORSKE KRONER
     C*
     C     RESVAL        IFEQ      '   '
     C                   MOVE      *BLANKS       RESVAL
     C                   MOVE      *ZEROS        RESVAB
     C                   END
     C     RESVAL        IFEQ      FICURR
     C                   MOVE      *BLANKS       RESVAL
     C                   MOVE      *ZEROS        RESVAB
     C                   END
     C*
     C                   MOVE      HEPRO         FPROSJ            8 0
     C                   MOVE      *ZEROS        HEPRO
     C* HVIS N FOR K-STED PÅ DEBITORKONTO. ->0000
     C                   MOVE      KOAKON        FAVD
     C                   MOVE      FKONTO        WKONTO
     C     KONTKE        CHAIN     KONTL01                            33
     C   33              MOVE      *ZEROS        FAVD
     C  N33STEDK         IFNE      'J'
     C                   MOVE      *ZEROS        FAVD
     C                   END
     C                   MOVE      *ZEROS        SBÆR
N02  C                   MOVE      *BLANKS       IBMFA2
     C                   MOVE      IBMFAK        IBMFA2
     C     POSTKE        CHAIN     POSTB2                             33
     C     IBMNOK        COMP      *ZEROS                             66  66
     C                   MOVE      KNAV18        KGENOT
     C                   MOVEL     '**'          KGENOT
S11  C* N66REFERA        IFEQ      *ZEROS
S11  C*                  MOVE      IBMFAK        REFERA
S11  C*                  END
     C   33              DO
     C                   ADD       1             IBMPNR
     C                   EXSR      GETSUR
     C                   EXSR      SRPOST
     C                   MOVE      KUNDEN        RESNR
     C                   MOVE      RESVAL        VALKOX
     C                   Z-ADD     RESVAB        BELOPV
     C                   MOVE      REFERA        REFNR
N02  C                   MOVE      *BLANKS       KRNR
     C                   MOVE      IBMFAK        KRNR
     C                   MOVE      IBMFAR        FFDAAR
     C                   MOVE      IBMFMN        FFDMND
     C                   MOVE      IBMFDG        FFDDAG
     C                   MOVE      *BLANKS       BILTXT
     C   66
     CANN50              MOVEL     'Faktura '    BILTXT
     C   66
     CANN50
     CAN 45              MOVEL     'Invoice '    BILTXT
     C   66
     CANN50
     CAN 46              MOVEL     'Rechnung'    BILTXT
     C  N66
     CANN50              MOVEL     'Kreditno'    BILTXT
     C  N66
     CANN50              MOVE      'ta     '     BILTXT
     C  N66
     CANN50
     CAN 45              MOVEL     'Creditno'    BILTXT
     C  N66
     CANN50
     CAN 45              MOVE      'te     '     BILTXT
     C  N66
     CANN50
     CAN 46              MOVEL     'Gutschri'    BILTXT
     C  N66
     CANN50
     CAN 46              MOVE      'ft     '     BILTXT
     C   50              MOVEL     DIV11         BILTXT
s10  C*  66              MOVE      HESG          BILTXT
n10  C                   MOVE      HESG          BILTXT
     C   66              MOVE      ' '           KRNOKD
     C  N66              MOVE      'K'           KRNOKD
S14  C*    FACKNR        IFNE      *ZEROS
S14  C*                  MOVE      FACKNR        RESNR
S14  C*                  END
     C                   EXCEPT    IBMNY
     C                   END
     C*
     C  N33              DO
     C                   ADD       IBMNOK        BBELOP
     C                   ADD       RESVAB        BELOPV
     C                   MOVE      *BLANKS       BILTXT
     C     BBELOP        IFGE      *ZEROS
     C                   MOVEL     'Faktura '    BILTXT
     C   45              MOVEL     'Invoice '    BILTXT
     C   46              MOVEL     'Rechnung'    BILTXT
     C                   MOVE      '   '         BILTXT
     C                   MOVE      ' '           KRNOKD
     C                   ELSE
     C                   MOVEL     'Kreditno'    BILTXT
     C                   MOVE      'ta     '     BILTXT
     C   45              MOVEL     'Creditno'    BILTXT
     C   45              MOVE      'te     '     BILTXT
     C   46              MOVEL     'Gutschri'    BILTXT
     C   46              MOVE      'ft     '     BILTXT
     C                   MOVE      'K'           KRNOKD
     C                   END
n10  C                   MOVE      HESG          BILTXT
     C                   UPDATE    POSBR2
     C                   SETON                                        67
     C                   END
     C   OF              EXCEPT    PHEAD
     C   OF              SETOFF                                       OF
     C   66              ADD       IBMNOK        TOTDEB           11 2
     C   66              ADD       IBMNOK        GRADEB           11 2
     C  N66              ADD       IBMNOK        TOTKRE           11 2
     C  N66              ADD       IBMNOK        GRAKRE           11 2
     C                   ADD       IBMNOK        DEBITO           11 2
     C                   EXSR      KDTFMT
     C                   EXCEPT    DET
     C                   EXSR      KDTFMT
     C                   SETOFF                                       67
     C                   MOVE      FPROSJ        HEPRO
      *
     C                   ENDSR
      *
     C******************************************
     C     DIV           BEGSR
     C******************************************
     C* LEGGER DATA TIL ENGANGSKUNDEREGISTER
     C* VED BENYTTELSE AV DIVERSEKUNDE
     C     FASK          IFEQ      'S'
     C                   MOVEL     HENAS         KNAVN
     C                   MOVEL     HEADS1        ADR1
     C                   MOVEL     HEADS2        ADR2
     C                   MOVEL     HEADS3        ADR3
     C                   ELSE
     C                   MOVEL     HENAK         KNAVN
     C                   MOVEL     HEADK1        ADR1
     C                   MOVEL     HEADK2        ADR2
     C                   MOVEL     HEADK3        ADR3
     C                   END
     C                   Z-ADD     IBMFAK        BILNR
     C                   MOVE      'A'           AKTKOD
     C                   Z-ADD     99999         JOURNR
     C                   Z-ADD     SÅR           PERAAR
     C                   Z-ADD     KUNDEN        KUNDNR
     C                   MOVE      *ZEROS        POSTNR
     C                   MOVE      FIFIRM        FIRMA
     C* ORDNER NØKKEL
     C                   Z-ADD     SÅR           YPERAA
     C                   Z-ADD     KUNDEN        YKUNDN
     C                   Z-ADD     IBMFAK        YBILNR
     C     EKUNKE        CHAIN(N)  EKUNL01                            30
     C   30              WRITE     EKUNR
     C*
     C* OPPDATERER ANTALL BRUKTE POSTER FOR EKUN
     C*
     C                   MOVE      'EKUNF '      XREGNA
     C     SYSRKE        CHAIN     SYSRL01                            30
     C  N30              ADD       1             ANTBRU
     C  N30              UPDATE    SYSRR
     C*
     C                   ENDSR
     C*
     C******************************************
     C     GETSUR        BEGSR
     C******************************************
     C*
     C* HENT NYTT SURRUGATNR - FRA SYSRF LEGG I "POSLNR"
     C*
     C     SURKEY        CHAIN     SYSRL01                            30
     C  N30              ADD       1             SISSGT
     C  N30              UPDATE    SYSRR
     C                   Z-ADD     SISSGT        POSLNR
     C*
     C                   ENDSR
     C*
     C******************************************
     C     STATG         BEGSR
     C******************************************
     C* LESER ALLE OPPDRAG MED STATUS = G
     C* DISSE VIL VÆRE NULLFAKTURAER
     C*
     C                   MOVE      'J'           SKRIVH            1
     C*
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL KODE-TEKST-FIL
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    KOVUNI        WRKUNI
     C     *LIKE         DEFINE    KOVAVD        WRKAVD
     C     KODTKE        KLIST
     C                   KFLD                    WRKUNI
     C                   KFLD                    WRKAVD
     C                   MOVE      'V'           WRKUNI
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL HEAD1
     C*--------------------------------------------------------------
     C     *LIKE         DEFINE    HEST          WRST
     C     HEA1KE        KLIST
     C                   KFLD                    KOVAVD
     C                   KFLD                    WRST
     C*--------------------------------------------------------------
     C* DEFINERER NØKKEL TIL HEADINGREGISTER  HEAD
     C*--------------------------------------------------------------
     C     XEAKEY        KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C*
     C**** FINNER ALLE AVDELINGER PÅ ØNSKET FIRMA OG GÅR I LØKKE
     C*
     C                   MOVE      *ZEROS        WRKAVD
     C     KODTKE        SETLL     KODTV
     C*
     C     STAG          TAG
     C                   SETOFF                                       33
     C                   READ      KODTV                                  33
     C   33              GOTO      SLG
     C*
     C* AVDELING FUNNET LESER FØRST DE 1ED STATUS = 'G'
     C*
     C                   MOVE      'G'           WRST
     C     HEA1KE        SETLL     HEAD1
     C     HEA1KE        READE     HEAD1                                  31
     C     *IN31         DOWEQ     '0'
     C                   EXSR      STATG2
     C     OPSTAT        IFEQ      'OK  '
     C     SAMLEF        ANDNE     'J'
     C                   EXSR      STATG3
     C                   END
     C     HEA1KE        READE     HEAD1                                  31
     C                   END
     C*
     C* LESER NESTE AVDELING
     C*
     C                   GOTO      STAG
     C*
     C     SLG           ENDSR
     C*
     C******************************************
     C     STATG2        BEGSR
     C******************************************
     C* MYE GAMMEL LOGIKK SLETTET - ikke skriv heading hvis 0 feil.
     C* (hadde med gammel måte for statoppdatering å gjøre-nå i SYST35)
     C*
     C* DERSOM DET ER ET VANLIG "NULLOPPDRAG" MERKES HEST MED "T"
     C* FOR Å BLI MED I NESTE STATISTIKKOPPDATERING (KUN ANT./VEKTER)
     C* PÅ ET NULLOPPDRAG AKSEPTERES (MERKING GJENNOMFØRES SELV OM..)
     C* ... DET FINNES LINJER MED BELØP 0
     C* ... DET FINNES LINJER MED STATUS O,T,D
     C* DERSOM DET ER SNAKK OM SAMLEFAKTURA SKAL IKKE MERKING GJØRES
     C*
     C     FAK2K         KLIST
     C                   KFLD                    HEAVD
     C                   KFLD                    HEOPD
     C*
     C                   MOVE      'OK  '        OPSTAT
     C                   MOVE      'N'           SAMLEF            1
     C*
     C     FAK2K         SETLL     FAK2
     C*
     C     FAK2K         READE     FAK2                                   33
     C     *IN33         DOWEQ     '0'                                          1B
     C*Del av samlefaktura HOPP UT (oppdater stat først når fakturert)
     C     FAOPKO        IFEQ      'C'
     C     FASK          OREQ      'I'
     C     FASK          IFEQ      'I'
     C     FAOPKO        CABEQ     'O'           STG2T1
     C     FABELN        CABEQ     0             STG2T1
     C                   END
     C                   MOVE      'J'           SAMLEF            1
     C                   GOTO      SLKRE
     C                   END
     C* Hvis et G oppdrag inneholder en linje med beløp og status ikke
     C* er en av de "lovlige", skriv på feilliste - ikke merk for STAT:
     C     FABELN        IFNE      *ZEROS                                        2B
     C     FAOPKO        ANDNE     'O'
     C     FAOPKO        ANDNE     'T'
     C     FAOPKO        ANDNE     'D'
     C     FASK          ANDNE     'F'
     C     FASK          ANDNE     'A'
     C                   MOVE      'FEIL'        OPSTAT            4            *IKKE OPPDAT
     C     SKRIVH        IFEQ      'J'                                             4B
     C                   EXCEPT    FEILH
     C                   MOVE      'N'           SKRIVH
     C                   END                                                       4E
     C   OF              EXCEPT    FEILH
     C     HEUR          COMP      'H'                                    68    *TRANS.OPD.
     C   68HEPRO         COMP      *ZEROS                                 68    *MÅ HA TURNR
     C                   EXCEPT    FEIL
     C                   GOTO      SLKRE
     C                   END                                                     2E
     C     STG2T1        TAG
     C     FAK2K         READE     FAK2                                   33
     C                   END                                                    1E
      *
     C     SLKRE         ENDSR
      *
     C******************************************
     C     STATG3        BEGSR
     C******************************************
     C* OPPDATERER STATISTIKK NULLFAKTURA
     C* HENTER PERIODEBEGREP
     C*
     C                   MOVEL     HEDTÅ         KOÅCC
     C                   MOVE      HEDTÅ         KOÅÅR
     C                   MOVE      HEDTM         KOÅMND
     C     KODÅKE        CHAIN     KODTÅ                              33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     KOÅCC         PÅR
     C                   MOVE      KOÅÅR         PÅR
     C                   MOVE      KOÅMND        PMN
     C                   ELSE
     C                   MOVEL     MINPE2        PÅR               4 0
     C                   MOVE      MINPE2        PMN
     C                   END
     C* OPPDATERER HEADINGFILE
     C*
     C     XEAKEY        CHAIN     HEADF                              33
     C     *IN33         IFEQ      '0'
     C                   MOVE      'T'           HEST
     C     HEDTMP        IFEQ      *ZEROS
     C                   MOVEL     PÅR           HEDTCP
     C                   MOVE      PÅR           HEDTÅP
     C                   MOVE      PMN           HEDTMP
     C                   END
     C                   EXCEPT    HOVUPD
      * SETT KEY IGJEN...
     C                   MOVE      'G'           HEST
     C                   END
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
     C                   MOVE      DG            UDT1              2 0
     C                   MOVE      MN            UDT2              2 0
     C                   MOVE      AR            UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          DG
     C                   MOVE      UDT2          MN
     C                   MOVE      UDT3          AR
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     KDTFM2        BEGSR
     C***********************************************
     C                   MOVE      FADTDD        UDT1              2 0
     C                   MOVE      FADTMM        UDT2              2 0
     C                   MOVE      FADTÅÅ        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          XFDTDD
     C                   MOVE      UDT2          XFDTMM
     C                   MOVE      UDT3          XFDTÅÅ
     C*
     C                   ENDSR
     C*
     C***********************************************
     C     TOTSR         BEGSR
     C***********************************************
     C* Hvis pgm returnerer med '1' i param (AUT) er det ingen poster å
     C* overføre-CL vil avbryte- Minst en post->AUT blir ' '.
     C                   MOVE      '1'           AUT
     C                   MOVE      *BLANKS       POST01
     C     POSTKE        SETLL     POSTB2                             33
     C     TOTTAG        TAG
     C                   READ(N)   POSTB2                                 33
     C  N33              DO
     C                   MOVE      ' '           AUT
     C     BBELOP        IFGT      *ZEROS
     C                   ADD       BBELOP        DEBTOT           13 2
     C                   ELSE
     C                   ADD       BBELOP        KRETOT           13 2
     C                   END
     C                   GOTO      TOTTAG
     C                   END
     C                   EXCEPT    DEBKRE
     C     FISADK        IFNE      'N'
     C   OF              EXCEPT    PHEAD
     C                   EXCEPT    PNYBIH
     C     *LOVAL        SETLL     POSTA1
     C     LESA1         TAG
     C                   READ(N)   POSTA1                                 33
     C  N33
     CAN OF              EXCEPT    PHEAD
     C  N33              EXCEPT    PNYBI
     C  N33              GOTO      LESA1
     C                   END
     C                   ENDSR
     C*
     C***********************************************
     C     STEBAR        BEGSR
     C***********************************************
     C     KODIKE        KLIST
     C                   KFLD                    FIRMA
     C                   KFLD                    KBARER
     C     KODJKE        KLIST
     C                   KFLD                    FIRMA
     C                   KFLD                    KSTED
     C                   MOVE      *BLANKS       GRKOPO
     C                   MOVE      *BLANKS       GRKODE
     C     KBARER        IFNE      *ZEROS
     C     KODIKE        CHAIN     KODIL01                            22
     C  N22              MOVE      GRKOTI        GRKOPO
     C                   END
     C     KSTED         IFNE      *ZEROS
     C     KODJKE        CHAIN     KODJL01                            22
     C                   END
     C                   ENDSR
     C*
     C***********************************************
     C     TTSR          BEGSR
     C***********************************************
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XULÅÅ         ULÅÅ
     C                   MOVE      'FIN'         TTACTI
     C                   MOVE      ULDT          TTDATE
     C                   MOVE      XULTM         TTTIME
     C                   MOVE      TTDATE        TTDATL
     C                   MOVE      TTTIME        TTTIML
     C                   MOVE      UUSR          TTUSER
     C                   MOVEL     'Finance '    XXTEXT           16
     C                   MOVE      'updated '    XXTEXT
     C                   MOVEL     XXTEXT        TTTEXT
     C                   MOVEL     'Inv.nbr:'    XXTEXT
     C                   MOVE      '        '    XXTEXT
     C                   MOVE      IBMFAK        XXTEXT
     C                   MOVE      XXTEXT        TTTEXT
N08  C                   eval      tttexl='regnskap oppdatert'
N08  c     TTTEXL        cat       'faktura nr':1TTTEXL
n21  c                   move      *blanks       FIFNA             7
n21  c                   eval      FIFNA = %triml(%editc(IBMFAK:'Z'))
n08  c     TTTEXL        cat       fifna:1       TTTEXL
     C                   WRITE     TRACKFR
     C                   ENDSR
     C***********************************************
     C     MVA           BEGSR
     C***********************************************
     C* finn momskode her
     C                   Z-ADD     0             FITAXN            5 4
     C     *IN34         IFEQ      *ON
     C                   MOVE      FADATO        FADAMO            8 0
     C                   Z-ADD     FITAX         FITAXN
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
     C     FADAMO        ANDLT     FITAXD
     C     FADAMO        ANDNE     *ZEROS
     C                   Z-ADD     FITAX2        FITAXN
     C                   END
     C     KODWKY        CHAIN     KODWL01                            84
     C     *IN84         IFEQ      *OFF
     C     MVAAVI        DIV       100           FITAXN
     C                   ENDIF
     C                   ENDIF
     C                   ADD       1             FITAXN
     C*
     C                   ENDSR
N12  C***********************************************
N12  C     EUSR          BEGSR
N12  C***********************************************
N12  C                   MOVE      *BLANKS       EUKODE            1
N12   * SPESIALKONTERING EU
N12  C     KODTS2K       KLIST
N12  C                   KFLD                    KS2UNI
N12  C                   KFLD                    KS2LK
N12  C                   MOVEL     'S2'          KS2UNI
N12  C
N12   *
N12   * unntak for eu (KS2PRE=B)
N12   *
N12  C                   MOVE      FILAND        KS2LK
N12  C     KODTS2K       CHAIN     KODTS2                             33
N12   *
N12   * EGET LAND ER EU
N12   *
N12  C  N33KS2PRE        IFEQ      'B'
N12   *
N12   *   IMPORT
N12   *
N12  C     HEUR          IFEQ      'A'
N12  C     HEUR          OREQ      'C'
N12  C     HEUR          OREQ      'F'
N12  C                   MOVE      HELKA         FIRLKF
N12  C     KOAPOS        IFEQ      'J'
N12  C                   MOVE      FILAND        FIRLKT
N12  C                   ELSE
N12  C     HESDT         CHAIN     STED2                              33
N12  C                   MOVE      ST2LK         FIRLKT
N12  C                   END
N12  C                   END
N12   *
N12   *   EKSPORT
N12   *
N12  C     HEUR          IFEQ      'B'
N12  C     HEUR          OREQ      'D'
N12  C     HEUR          OREQ      'G'
N12  C                   MOVE      HELKA         FIRLKT
N12  C     KOAPOS        IFEQ      'J'
N12  C                   MOVE      FILAND        FIRLKF
N12  C                   ELSE
N12  C     HESDT         CHAIN     STED2                              33
N12  C                   MOVE      ST2LK         FIRLKF
N12  C                   END
N12  C                   END
N12   *
N12   * TRANSPORTDISPONERING
N12   *
N12  C     HEUR          IFEQ      'H'
N12  C                   MOVE      HELKA         FIRLKF            2
N12  C                   MOVE      HETRI         FIRLKT            2
N12  C                   END
N12   *
N12   * DOMESTIC
N12   *
N12  C     FILAND        IFEQ      FIRLKF
N12  C     FILAND        ANDEQ     FIRLKT
N12  C                   MOVE      'D'           EUKODE
N12  C                   END
N12   *
N12   *
N12   * TRANSIT  BEGGE LAND I EU
N12   *
N12  C     FIRLKF        IFNE      FIRLKT
N12  C                   MOVE      FIRLKF        KS2LK
N12  C     KODTS2K       CHAIN     KODTS2                             33
N12  C  N33KS2PRE        IFEQ      'B'
N12  C                   MOVE      FIRLKT        KS2LK
N12  C     KODTS2K       CHAIN     KODTS2                             33
N12  C  N33KS2PRE        IFEQ      'B'
N12  C                   MOVE      'T'           EUKODE
N12  C                   END
N12  C                   END
N12  C                   END
N12   *
N12  C                   END
N12  C                   SETOFF                                       33
N12  C                   ENDSR
     OHEADFR    E            HOVUPD
     O                       HEST
     O                       HEDTCP
     O                       HEDTÅP
     O                       HEDTMP
     O*********
     O* TIL IBM REGNSKAP    RESKONTO
     O***********'
     OPOSBR2    EADD         IBMNY
     O                       AKTKOD
     O                       FIRMA
     O                       BILNR
     O                       POSNR
     O                       BILAAR
     O                       BILMND
     O                       BILDAG
     O                       PERAAR
     O                       PERNR
     O                       TYPE
     O                       RESNR
     O                       BILTXT
     O                       KONTO
     O                       KSTED
     O                       KBARER
     O                       MOMSK
     O                       BBELOP
     O                       VALKOX
     O                       BELOPV
     O                       REFNR
     O                       KRNR
     O                       KRDAAR
     O                       KRDMND
     O                       KRDDAG
     O                       FFDAAR
     O                       FFDMND
     O                       FFDDAG
     O                       BETBET
     O                       OPDKOD
     O                       POSLNR
     O                       KRNOKD
     O*********
     O* TIL IBM REGNSKAP  UTLEGGSPOST
     O***********'
     OPOSBR2    EADD         IBMNYU
     O                       AKTKOD
     O                       FIRMA
     O                       BILNR
     O                       POSNR
     O                       BILAAR
     O                       BILMND
     O                       BILDAG
     O                       PERAAR
     O                       PERNR
     O                       TYPE
     O                       RESNR
     O                       BILTXT
     O                       KONTO
     O                       MOMSK
     O                       BBELOP
N06  O                       VALKOX
N06  O                       BELOPV
     O                       REFNR
     O                       KRNR
     O                       KRDAAR
     O                       KRDMND
     O                       KRDDAG
     O                       FFDAAR
     O                       FFDMND
     O                       FFDDAG
     O                       BETBET
     O                       OPDKOD
     O                       POSLNR
     O*********
     O* TIL IBM REGNSKAP  inntektspost
     O***********'
     OPOSBR     EADD         IBMNY1
     O                       AKTKOD
     O                       FIRMA
     O                       BILNR
     O                       POSNR
     O                       BILAAR
     O                       BILMND
     O                       BILDAG
     O                       PERAAR
     O                       PERNR
     O                       TYPE
     O                       BILTXT
     O                       KONTO
     O                       KSTED
     O                       KBARER
     O                       MOMSK
     O                       BBELOP
N16  O                       NBELPO
N06  O                       VALKOX
N06  O                       BELOPV
     O                       PROSNR
     O                       OPDKOD
     O                       NOKKEL
     O                       POSLNR
     O                       GRKODE
     O                       GRKOPO
N03  O                       BETBET
     O*
S18  O*FAKTR     E            DUMFAK
     OFAKTR     E            OPDATF
     O                       FAOPKO
     O                       FAJOUR
     O                       FACC
     O                       FAÅR
     O                       FAMND
     O                       FAAVDR
     O                       FABÆR
     O                       FAACCN
     O                       FACD21
     OSYFA35P   E            PHEAD            01
     O                       FIFIRM               2
     O                       FIFT                48
     O                                           90 'JOURNALNR:'
     O                       FIJOUR        Z     97
     O                                          105 'SIDE:'
     O                       PAGE          Z    111
     OSYFA35P   E            PHEAD            02
     O                                           24 'F A K T U R A J O U R N '
     O                                           38 'A L   D A T O:'
     O                       UDATE         Y     48
     O               75                         120 '** OMKJØRING **'
     OSYFA35P   E            PHEAD            03
     O                                           24 '------------------------'
     O                       *PLACE              48
     O                       *PLACE              72
     O                       *PLACE              96
     O                       *PLACE             120
     O                                          132 '------------'
     O          E            PHEAD            04
     O                                            6 'FAKTNR'
     O                                           15 'FAKTDATO'
     O                                           23 'OPD.NR.'
     O                                           31 'STE/BÆR'
     O                                           37 'KTO'
     O                                           39 'MK'
     O                                           52 'D  E  B  E  T'
     O                                           67 'K R E D I T'
     O                                           88 'G E B Y R T E K S T'
     O                                           93 'TYPE'
     O                                          102 'PROSJEKT'
     O                                          111 'KUNDENR'
     O                                          115 'REF'
     O                                          118 'SF'
     O                                          126 'KR AV'
     O                                          132 'PER'
     OSYFA35P   E            PHEAD          1 05
     O                                           24 '------------------------'
     O                       *PLACE              48
     O                       *PLACE              72
     O                       *PLACE              96
     O                       *PLACE             120
     O                                          132 '------------'
     OSYFA35P   E            PNYBIH      2  2
     O                                           24 '** BILAGSNUMMER BENYTTET'
     OSYFA35P   E            PNYBI       0  1
     O                       PERAAR              13
     O                                           11 '/'
     O                       PERNR               10
     O                                           15 '='
     O                       BILNR         Z     24
     OSYFA35P   E            DET            1
     O                       IBMFAK        Z      7
     O                       IBMDAT              15
     O                       HEOPD         Z     23
     O                       FAVD          Z     27
     O                       SBÆR          Z     31
     O                       FKONTO              37
     O                       IBMMVA              39
V10  O*              66      IBMNOK        J     52
V10  O               66      IBMNOK        L     52
     O              N66      IBMNOK        J     67
     O                       KGENOT              88
     O               11                          88 '*** SLETTET KODE  **'
     O                       HEOT                93
     O                       PRIPRO        Z    102
     O                       KUNDEN        Z    111
     O                       HESG               115
     O               67                         118 'J'
     O                       REFERA        Z    126
     O                       SMND               129
     O                                          130 '/'
     O                       SÅR2               132
     OSYFA35P   E            DETSLE         1
     O                       FAFAKT        Z      7
     O                       XFDT                15
     O                                           42 '** SLETTET FAKTURA **'
     O                       FAKUNR        Z    111
     O          E            DETNUL         1
     O                       IBMFAK        Z      7
     O                                           31 '   * NULL FAKTURA  *    '
     OSYFA35P   E            FEILH            03
     O                                           24 '* FEIL - LISTE         *'
     OSYFA35P   E            FEILH          2 04
     O                                           24 'FØLGENDE OPPDRAG ER MERK'
     O                                           48 'ET FOR OVERFØRING MEN HA'
     O                                           72 'R FAKTURALINJER MED FEIL'
     O                                           96 ' STATUS. SJEKK ÅRSAK ELL'
     O                                          120 'ER KONTAKT SYSTEMA......'
     OSYFA35P   E            FEIL           1
     O                                           10 '* Oppdrag '
     O                       HEAVD               15
     O                                           16 '/'
     O                       HEOPD               23
     O               68                          50 'Transp. oppdrag som IKKE'
     O               68                          74 ' er satt på TUR/BIL     '
     OSYFA35P   E            TOTGRA      2
     O                                           24 '** DEBET KREDIT KOLONNE-'
     O                                           34 'TOTAL   **'
     O                       GRADEB        JB    52
     O                       GRAKRE        JB    77
     OSYFA35P   E            TOTGRA      2  2
     O                                           24 '** TOTAL DEBITORER    **'
     O                       DEBITO        JB    52
     OSYFA35P   E            DEBKRE      2
     O                                           24 '** DEB/KRED POSTTOTAL (T'
     O                                           34 'IL ØKO) **'
     O                       DEBTOT        JB    52
     O                       KRETOT        JB    77
