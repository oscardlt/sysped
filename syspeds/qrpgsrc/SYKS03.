     H debug(*yes)
      ***********************************************************
      *** PROGRAM SKAL FORDELE KOSTNADER (VEDLIKEHOLD)        ***
      *** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
      *** LEDIGE INDIKATORER 01 02 16-18 21 22
      *** LEDIGE INDIKATORER 31 32 34-38 46-78 97
      ***********************************************************
      * for COMP: OVRDBF     FILE(KOSTBVIS) TOFILE(KOSTB)
      *   +       OVRDBF     FILE(KOSTBSLT) TOFILE(KOSTB)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 sh  PTF10 endring bilde overlay felt
10XXX * 02 sh  PTF10 feil rulling
10XXX * 03 sh  PTF10 V=vis linje
10XXX * 04 sh  PTF10 F20 1.gangsføring
10XXX * 05 sh  PTF10 test at leverandør har interrim
10XXX * 06 sh  PTF10 test at leverandør har interrim
      * V11 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 07 sh  PTF11 omregner til valuta til skjermbildet
      * 08 sh  PTF11 feilmelding ved  F10
      * 09 sh  PTF11 skjerm 132 i bredde budsjett etc inn
      * 10 sh  PTF11 vise differanse etc
      * 11 sh  PTF11 antall
      * 12 sh  PTF11 budsjett
      * 13 sh  PTF11 nullstill vekt 2
      * 14 sh  PTF11 reverse reklamasjon  ind 79
      * 15 sh  PTF11 nye linjer mot WEB
      * 16 JOV PTF11 Bedre tester mot oppdragset periode, Fxx=autosett peri(hvis tillatt per.splitt)
      * 17 sh  PTF11 utvidelser ved eu føringer
      * 18 sh  PTF11 sjekker at ordre er på tur hvis prosjektregnskap
      * 19 sh  PTF11 emne ferdigutfyllt grønnskjerm
      * 20 JOV PTF11 nye hidden fields i subfila (KBREFA / KBREFB / KBREFC )
      * 21 SH  PTF11 sØke gebyrkoder
      * 22 SH  PTF11 direkte L1
********************************************************************
      *
n21  FNAVLEV    IF   E           K DISK
n18  FKODTV     IF   E           K DISK
s14  F*RACKL08  IF   E           K DISK
n14  FTRACKL08  IF A E           K DISK
N09  FARKLOGH4  IF   E           K DISK
     FKODTÅ     IF   E           K DISK
     FFRISOL01  IF   E           K DISK
N19  FFRISOK    IF   E           K DISK
N19  F                                     RENAME(FRISOKR:FRISOKRX)
     FAVSLUTF   IF   E           K DISK
     FAVSLUTL2  IF   E           K DISK
     F                                     RENAME(AVSLUTFR:AVSLUT2)
     FKOSTA14   IF   E           K DISK
N05  FKOSTA     IF   E           K DISK
N05  F                                     RENAME(kostar:kostarx)
N05  FLEVEL01   IF   E           K DISK
     FKOSTT     UF   E           K DISK
     FKOSTBVIS  IF   E           K DISK    USROPN
     F                                     RENAME(KOSTBR:KOSBRV)
     F                                     INFDS(KOSVDS)
     FKOSTBSLT  UF   E           K DISK    USROPN
     F                                     RENAME(KOSTBR:KOSBRS)
     FKOSTB     UF A E             DISK
     F                                     INFDS(KOSBDS)
     FKOSBU     UF   E           K DISK
     FKOSBU5    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSBU5R)
     FKOSBU2    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSBU2R)
     FKOSBU9    IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSBU9R)
     FKOSBU15   IF   E           K DISK
     F                                     RENAME(KOSBUR:KOSBU15R)
     FHEADF     IF   E           K DISK
     FHEAD11    IF   E           K DISK
     F                                     RENAME(HEADFR:HEA11R)
     FHEAD17    IF   E           K DISK
     F                                     RENAME(HEADFR:HEA17R)
     FHEAD18    IF   E           K DISK
     F                                     RENAME(HEADFR:HEA18R)
     FCUNDL01   IF   E           K DISK
     FKODTGE    IF   E           K DISK
     FKODTG2    IF   E           K DISK
N17  FKODTG3    IF   E           K DISK
N17  FKODTS2    IF   E           K DISK
N17  FSTED2     IF   E           K DISK
     FKODTA     IF   E           K DISK    INFDS(KODADS)
     F                                     USROPN
     FFIRM      IF   E           K DISK
     FFIRMKOS   IF   E           K DISK
     FTURER     UF   E           K DISK    INFDS(TUREDS)
     F                                     USROPN
N16  FTURER14   iF   E           K DISK    RENAME(TURERR:TURER14R)
     FTRAVH1    UF   E           K DISK    INFDS(TRAVDS)
     F                                     USROPN
     FKODWL01   IF   E           K DISK
     FSYKS03FM  CF   E             WORKSTN USROPN
     F                                     SFILE(SUBFIL:ZRECNO)
     F                                     INFDS(FBAREA)
N14  D                SDS
N14  D  ZUSER                254    263
     D UCMD            DS          1024
     D                 DS
     D XCMD11          C                   CONST('OVRDBF -
     D                                     FILE(KOSTBVIS) -
     D                                     TOFILE(KOSTB)')
     D                 DS
     D XCMD12          C                   CONST('OVRDBF -
     D                                     FILE(KOSTBSLT) -
     D                                     TOFILE(KOSTB)')
     D                 DS
     D XCMD13          C                   CONST('OVRMSGF -
     D                                     MSGF(QUSERMSG) -
     D                                     TOMSGF(SYMSGF)')
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D TUREDS          DS
     D  TUREOP                 9      9
     D TRAVDS          DS
     D  TRAVOP                 9      9
     D KODADS          DS
     D  KODAOP                 9      9
N21  D                 DS
N21  D  KO                     1     40  0
N21  D                                     DIM(8)                               I/O. frankatur
N21  D  KON                    1     40  0
N21  D  NAVKO1                 1      5  0
N21  D  NAVKO2                 6     10  0
N21  D  NAVKO3                11     15  0
N21  D  NAVKO4                16     20  0
N21  D  NAVKO5                21     25  0
N21  D  NAVKO6                26     30  0
N21  D  NAVKO7                31     35  0
N21  D  NAVKO8                36     40  0
N21  D  NAVKO28                5     40  0
     D                 DS
     D  WXTXT                  1     15
     D  WXOPD                  1      7
     D  WXOT                   8      9
     D  WXFR                  10     12
     D  WXNØKK                15     15
     D                 DS
     D  HEDTOP                 1      8  0
     D  HEDTÅ                  1      4  0
S16  D* HEDTÅC                 1      4  0
S16  D* HEDTÅÅ                 1      4  0
N16  D  HEDTÅC                 1      2  0
N16  D  HEDTÅÅ                 3      4  0
     D  HEDTM                  5      6  0
     D  HEDTD                  7      8  0
     D                 DS
     D  KBPCC                  1      2  0
     D  KBPÅR                  3      4  0
     D  KBPCÅ                  1      4  0
     D  KBPMN                  5      6  0
     D  KBPER                  1      6  0
     D                 DS
     D  WSBDT                  1      6  0
     D  WSBDTD                 1      2  0
     D  WSBDTM                 3      4  0
     D  WSBDTÅ                 5      6  0
     D                 DS
     D  WSGN17                 1     17
     D* WSAREF                 1     15
     D  WSAREF                 1     35
     D  WSGN                   1     15
N10  D                 DS
N10  D  TTDEPO                 1     10
N10  D  TT                     1     10
N10  D                                     DIM(10)
N10  D                 DS
N10  D  VEKT02                 1      5  0
N10  D  T2                     1      5
N10  D                                     DIM(5)
      * PARAMETERSTRENG FOR KALL PÅ SYKS12
     D                 DS
     D  P1DS                   1    256
     D  P1FLAG                 1      1
     D  P1BNR                  2      8  0
     D  P1AVD                  9     12  0
     D  P1TUNR                13     20  0
     D  P1OAVD                21     24  0
     D  P1OPD                 25     31  0
     D  P1BL                  32     44  2
     D  P1GN                  45     63
     D  P1KDM                 64     64
      * PARAMETERSTRENG FOR SAMMENSATT PARAMETER UIO V/KALL PÅ SYKS04
     D                 DS
     D  UIODS20                1     20
     D  UIODS                  1     24
     D  WSFRIO                 1      1
     D  WSFR01                 2      4
     D  WSFR02                 5      7
     D  WSFR03                 8     10
     D  WSOTIO                11     11
     D  WSOT01                12     13
     D  WSOT02                14     15
     D  WSOT03                16     17
     D  WSSKIO                18     18
     D  WSSK01                19     19
     D  WSSK02                20     20
     D  WSPMN                 21     22  0
     D  WSPÅR                 23     24  0
     D KOSVDS          DS
     D  RECNOV               397    400B 0
     D KOSBDS          DS
     D  RECNOB               397    400B 0
     D  WITAXD                 1      8  0
     D  MVAATW                 1      4  0
     D  MVAMTW                 5      6  0
     D  MVADTW                 7      8  0
N14  D                 DS
N14  D  XULTID                 1     14  0
N14  D  XULTM                  1      6  0
N14  D  XULDD                  7      8  0
N14  D  XULMM                  9     10  0
N14  D  XULÅÅ                 11     14  0
N14  D                 DS
N14  D  ULÅÅ                   1      4  0
N14  D  ULMM                   5      6  0
N14  D  ULDD                   7      8  0
N14  D  ULDT                   1      8  0
N22  D                 DS
N22  D  kbrefc                 1     35
N22  D  fastko                 1      3
N22  D  kbrefcko               4      8
N22  D  fastav                 9     11
N22  D  kbrefcav              12     15
N22  D  fastba                16     18
N22  D  kbrefcba              19     22
N22  D  fastpr                23     25
N22  D  kbrefcpr              26     33
     D                 DS
     D  UPARM1                 1    512
     D  U1BL                   1     13  2
     D  U1VK                  14     16
     D  U1KDPF                17     17
     D  U1KDM                 18     18
     D  U1PROS                19     23  2
     D  U1KDMV                24     24
     D  U1AVD                 25     28  0
     D  U1OPD                 29     35  0
     D  U1PRO                 36     43  0
     D  U1GN17                44     60
     D  U1BILT                61     75
     D  U1FRIO                76     76
     D  U1FR01                77     79
     D  U1FR02                80     82
     D  U1FR03                83     85
     D  U1OTIO                86     86
     D  U1OT01                87     88
     D  U1OT02                89     90
     D  U1OT03                91     92
     D  U1SKIO                93     93
     D  U1SK01                94     94
     D  U1SK02                95     95
     D  U1F23                 96     96
     D  U12ENDRE             200    200
     D  U12RECNO             201    207  0
     D  U12AVD               208    211  0
     D  U12OPD               212    218  0
     D  U12KN                219    226  0
     D  U12VK                227    229
     D  U12KDPF              230    230
     D  U12BLHB              231    243  2
     D  U12KDM               244    244
     D  U12BLF               245    257  2
     D  U12KDMV              258    258
     D  U12BILT              259    273
     D  U12PMN               274    275  0
     D  U12PÅR               276    277  0
     D  U1PMN                278    279  0
     D  U1PÅR                280    281  0
     D  U13FM                300    300
     D  U1FEILMELDING        431    510
     D  U1FMELDNR            511    512
N05  ILEVER
N05  I              BANKG                       SYBAGI
N05  I              POSTG                       SYPOGI
      *///////
      * INZ //
      *///////
     C                   EXSR      INIT
     C                   OPEN      SYKS03FM
      */////////////////
      * Clear subfile //
      */////////////////
     C     START         TAG
      *
     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   MOVE      '0'           *IN27
     C                   MOVE      '0'           *IN30
     C                   Z-ADD     *ZEROS        ZRECNO
     C                   MOVE      *ZEROS        WXAVD
     C                   MOVE      *BLANKS       WXTXT
     C                   MOVE      *BLANKS       WXVK              3
     C                   MOVE      *ZEROS        WXKDM             1 0
      *////////////////
      * Fill subfile //
      *////////////////
     C                   MOVE      *ZEROS        WSBLF
     C     UBNR          SETLL     KOSTBVIS
     C     UBNR          READE     KOSTBVIS                               94
      *
     C     *IN94         DOWEQ     '0'                                          1<-B
     c     EDIMATCH      ifeq      'J'
     c     KBNØKK        cabne     9             NextRec
     c                   end
     C                   Z-ADD     RECNOV        RECNUM
      * 39 OFF= FIS FORDELT PR OPPD / ON = VIS PR KONT.BERGR (F.EKS VED TUR SAMMENSLÅTT)
     C     *IN39         IFEQ      '0'                                           2<-B
     C     KBNØKK        ORLT      2
     C     KBNØKK        ORGT      4
      * Vis Oppd.type/frankatur/partskode i subfila....
     C     HEADKK        CHAIN     HEADF                              33
     C                   ELSE                                                    2
     C                   MOVE      '1'           *IN33
     C                   END                                                     2<-E
     C     *IN33         IFEQ      '0'                                           2<-B
S16  C*    HEDTCP        IFNE      *ZEROS                                         3<-B
S16  C*                  MOVE      HEDTCP        HEDTÅC
S16  C*                  MOVE      HEDTÅP        HEDTÅÅ
S16  C*                  MOVE      HEDTMP        HEDTM
S16  C*                  END                                                      3<-E
      *tester om postens periode differerer fra bilagets  (= 28 On)
S16  C*                  EXSR      TESTPER
      *
     C                   MOVE      HEOT          WSOT
     C                   MOVE      HEFR          WSFR
     C     KBKN          IFEQ      *ZEROS                                         3<-B
     C                   MOVE      ' '           WSSK
     C                   ELSE                                                     3
     C     KBKN          IFEQ      HEKNSF                                          4<-B
     C                   MOVE      'S'           WSSK
     C                   ELSE                                                      4
     C     KBKN          IFEQ      HEKNKF                                           5<-B
     C                   MOVE      'K'           WSSK
     C                   ELSE                                                       5
     C                   MOVE      'X'           WSSK
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   END                                                      3<-E
     C                   ELSE                                                    2
     C                   MOVE      *BLANKS       WSOT
     C                   MOVE      *BLANKS       WSFR
     C                   MOVE      *BLANKS       WSSK
     C                   END                                                     2<-E
      *
     C                   MOVE      KBBLHB        WSBLHB
      * Bilag i fremmed valuta - modus for "Vis Valuta"/Vis NOK
     C   41              DIV(H)    UVKU          WSBLHB
     C   41              MOVE      UVAL          WSVAL
     C  N41              MOVE      *BLANKS       WSVAL
      * Bilag i NOK/inneholder Mva - modus for "Vis netto"
     C   44KBKDM         IFEQ      1                                             2<-B
     C     KBKDPF        IFEQ      'P'
     C                   MOVE      FITAXOri      FITAXN
     C                   DIV(H)    FITAXN        WSBLHB
     C                   ELSE
     C     KODWKB        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    KBKDPF
     C                   MOVE      *BLANKS       WMVAKD            2
     C     KODWKB        CHAIN     KODWL01                            81
     C     *IN81         IFEQ      *OFF
     C     MVAAVI        IFEQ      *ZERO
     C                   ELSE
     C     UBDT8         IFLT      WITAXD
     C     GMVATW        DIV       100           FITAXN
     C                   ELSE
     C     MVAAVI        DIV       100           FITAXN
     C                   ENDIF
     C                   ADD       1             FITAXN
     C                   DIV(H)    FITAXN        WSBLHB
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   END                                                     2<-E
      * 39 on/off = visningsmode,Off=fordelt på oppdrag vises, On=Konteringsbegreb vises
      * KBNØKK=..skapt 0=Manu, 1.=avd/odp, 2=Via tur, 3=ViaAwB (IFB mm vi felt 3->Nøkk=1)
      *                8=Edi men beløpsmiss 9=Edi / ingen match
     C     *IN39         IFEQ      '0'                                           2<-B
     C     KBNØKK        ORLT      2
     C     KBNØKK        ORGT      4
      * visning vkoteringsmode/sammenslå alle på en tur ol...
     C   39WXAVD         IFNE      *ZEROS                                         3<-B
     C     WXTXT         ORNE      *BLANKS
     C     WXVK          ORNE      *BLANKS
     C                   MOVE      KBKN          X1KN              8 0
     C                   MOVE      WSBLHB        X1BLHB           13 2
     C                   MOVE      KBBLF         X1BLF            13 2
     C                   MOVE      KBVK          X1VK              3
     C                   MOVE      KBKDM         X1KDM             1 0
     C                   MOVE      KBKDMV        X1KDMV            1
     C                   MOVE      KBNØKK        X1NØKK            1 0
     C                   MOVE      *IN28         X1IN28            1
     C                   MOVE      *ZEROS        KBKN
     C                   MOVE      WXBLHB        WSBLHB
     C                   MOVE      WXBLF         KBBLF
     C                   MOVE      WXVK          KBVK
     C                   MOVE      WXKDM         KBKDM
     C                   MOVE      WXKDMV        KBKDMV
     C                   MOVE      WXSK          KBNØKK
     C                   MOVE      '0'           *IN28
N16  C                   EXSR      TESTPER
     C     WXGEBY        COMP      1                                      43
     C                   ADD       1             ZRECNO
N10  c                   exsr      testbud
     C                   WRITE     SUBFIL
     C                   MOVE      X1KN          KBKN
     C                   MOVE      X1BLHB        WSBLHB
     C                   MOVE      X1BLF         KBBLF
     C                   MOVE      X1VK          KBVK
     C                   MOVE      X1KDM         KBKDM
     C                   MOVE      X1KDMV        KBKDMV
     C                   MOVE      X1NØKK        KBNØKK
     C                   MOVE      X1IN28        *IN28
     C                   END                                                      3<-E
      *
     C     KBGEBY        COMP      1                                      43
     C                   MOVE      KBAVD         WXAVD
     C                   MOVE      *BLANKS       WXTXT
     C                   MOVE      KBOPD         WXOPD
     C                   MOVE      WSOT          WXOT
     C                   MOVE      WSFR          WXFR
s16  C*                  MOVE      *BLANKS       WXNØKK
s16  C*                  MOVE      KBNØKK        WXSK
N16  C                   MOVE      KBNØKK        WXNØKK
N16  C                   MOVE      WSSK          WXSK
N16  C                   EXSR      TESTPER
     C                   ADD       1             ZRECNO
N10  c                   exsr      testbud
     C                   WRITE     SUBFIL
     C                   MOVE      *ZEROS        WXAVD
     C                   MOVE      *BLANKS       WXTXT
     C                   MOVE      *BLANKS       WXVK
     C                   MOVE      *ZEROS        WXKDM
      *
     C                   ELSE                                                    2
     C     KBKAVD        IFNE      WXAVD                                          3<-B
     C     KBKKEY        ORNE      WXTXT
     C     KBVK          ORNE      WXVK
     C     KBKDM         ORNE      WXKDM
     C     WXTXT         IFNE      *BLANKS                                         4<-B
     C                   MOVE      *ZEROS        KBKN
     C                   MOVE      WSBLHB        X1BLHB           13 2
     C                   MOVE      KBBLF         X1BLF            13 2
     C                   MOVE      KBVK          X1VK              3
     C                   MOVE      KBKDM         X1KDM             1 0
     C                   MOVE      KBKDMV        X1KDMV            1
     C                   MOVE      KBNØKK        X1NØKK            1 0
     C                   MOVE      WXBLHB        WSBLHB
     C                   MOVE      WXBLF         KBBLF
     C                   MOVE      WXVK          KBVK
     C                   MOVE      WXKDM         KBKDM
     C                   MOVE      WXKDMV        KBKDMV
     C                   MOVE      WXSK          KBNØKK
     C     WXGEBY        COMP      1                                      43
     C                   MOVE      '0'           *IN28
     C                   ADD       1             ZRECNO
N16  C                   EXSR      TESTPER
N10  c                   exsr      testbud
     C                   WRITE     SUBFIL
     C                   MOVE      X1BLHB        WSBLHB
     C                   MOVE      X1BLF         KBBLF
     C                   MOVE      X1VK          KBVK
     C                   MOVE      X1KDM         KBKDM
     C                   MOVE      X1KDMV        KBKDMV
     C                   MOVE      X1NØKK        KBNØKK
     C                   END                                                       4<-E
     C                   MOVE      *ZEROS        WXBLHB           13 2
     C                   MOVE      *ZEROS        WXBLF            13 2
     C                   END                                                      3<-E
     C                   ADD       WSBLHB        WXBLHB
     C                   ADD       KBBLF         WXBLF
     C                   MOVE      KBKAVD        WXAVD
     C                   MOVE      KBKKEY        WXTXT
     C                   MOVE      KBVK          WXVK
     C                   MOVE      KBKDM         WXKDM
     C                   MOVE      KBKDMV        WXKDMV            1
     C                   MOVE      KBNØKK        WXSK
     C                   MOVE      KBGEBY        WXGEBY            1 0
     C                   END                                                     2<-E
      *
     c     NEXTREC       tag
     C                   ADD       KBBLHB        WSBLF
     C     UBNR          READE     KOSTBVIS                               94
     C   39
     CAN 94WXAVD         IFNE      *ZEROS                                        2<-B
     C     WXTXT         ORNE      *BLANKS
     C     WXVK          ORNE      *BLANKS
     C                   MOVE      *ZEROS        KBKN
     C                   MOVE      WXBLHB        WSBLHB
     C                   MOVE      WXBLF         KBBLF
     C                   MOVE      WXVK          KBVK
     C                   MOVE      WXKDM         KBKDM
     C                   MOVE      WXKDMV        KBKDMV
     C     WXGEBY        COMP      1                                      43
     C                   MOVE      '0'           *IN28
     C                   ADD       1             ZRECNO
N10  c                   exsr      testbud
     C                   WRITE     SUBFIL
     C                   END                                                     2<-E
     C  N94              ENDDO                                                  1<-E
      *
     C     UBL           ADD       WSBLF         WSBLD
     C                   Z-ADD     ZRECNO        YRECNO            4 0
     C                   Z-ADD     1             ZRECNO
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
      */////////////////////
      * Work with subfile //
      */////////////////////
     C     START3        TAG
      *
     C                   MOVEA     '11'          *IN(91)
      *
     C     *IN04         IFEQ      '0'
     C     *IN07         ANDEQ     '0'
     C     *IN24         ANDEQ     '0'
     C     *IN30         ANDEQ     '0'
     C                   EXSR      MOVBFD
     C                   ENDIF
      *
     C                   EXSR      OMRBL1
      * IN30 - brukt kun som påminning (ikke FEIL) settes på først her
      *        for å sørge for at MOVBFD (over) gå sin gang
     C     *IN30         IFEQ      '0'
     C     *IN27         ANDNE     '0'
     c     *in50         ifeq      '1'                                          Ikke tillat perSplit
     C                   MOVE      'JOV0741'     MSGNR
     C                   else
     C* ved tillat periodesplitt - inviter til å sette avvikende automatisk via F21
     C                   MOVE      'JOV1645'     MSGNR
     C                   endif
     C                   MOVE      '1'           *IN30
     C                   END
      *
      * Hvis fremmedvaluta og i modus for det også totaler i den VAL
     C     *IN41         IFEQ      '1'
     C                   MOVE      UVAL          WBVAL
     C     UBL           DIV       UVKU          WBBL
     C     WSBLF         DIV       UVKU          WBBLF
     C     WSBLD         DIV       UVKU          WBBLD
     C                   ELSE
     C                   MOVE      FICURR        WBVAL
     C                   MOVE      UBL           WBBL
     C                   MOVE      WSBLF         WBBLF
     C                   MOVE      WSBLD         WBBLD
     C                   END
      *
      *
     C     YRECNO        IFEQ      0
      *
     C     *IN04         IFEQ      '0'
     C     *IN07         ANDEQ     '0'
     C     *IN24         ANDEQ     '0'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   ENDIF
      *
N22  c     l1dir         ifne      '*L1*'
     C                   EXFMT     NYWRK
N22  C                   else
N22  c                   EXFMT     NYWRKL1
N22  c                   move      '1'           *in23
N22  C                   END
      *
     C                   ELSE
      *
     C                   WRITE     SUBCTL
     C                   EXFMT     BUNN
      *
     C                   ENDIF
      *
     C                   MOVEA     '00000000'    *IN(83)
     C                   MOVEA     '00'          *IN(27)
     C                   MOVE      '0'           *IN30
      *
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
      *
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   ENDIF
      *
     C                   EXSR      OMRBL2
      *
     C                   MOVEA     '00'          *IN(98)
     C                   MOVE      'N'           XNYSTR            1
      *
     C     *IN25         IFEQ      '1'
s02  C*                  ADD       13            ZRECNO
n02  C                   ADD       12            ZRECNO
     C     ZRECNO        IFGT      YRECNO
     C                   MOVE      YRECNO        ZRECNO
     C                   END
     C                   MOVE      '0'           *IN25
     C                   GOTO      START3
     C                   END
     C     *IN26         IFEQ      '1'
S02  C*                  SUB       13            ZRECNO
n02  C                   SUB       12            ZRECNO
     C     ZRECNO        IFLE      0
     C     YRECNO        IFGT      0
     C                   Z-ADD     1             ZRECNO
     C                   ELSE
     C                   MOVE      *ZEROS        ZRECNO
     C                   END
     C                   END
     C                   MOVE      '0'           *IN26
     C                   GOTO      START3
     C                   END
      *_______________
      * OPTION TYPED ?
      *"""""""""""""""
     C     YRECNO        CASGT     0             GETLIN
     C                   ENDCS
      *
     C     XNYSTR        CABEQ     'J'           START
     C     *IN99         CABEQ     '1'           START3
      *___________
      * F5=Refresh
      *"""""""""""
     c   05              move      'N'           EDIMATCH          1
     C     *IN05         CABEQ     '1'           START
      *___________
      * F14= Endre modus....
      *"""""""""""
      * F14 Hvis fremmed VAL Endre til/fra valutamode / Refresh
     C     *IN14         IFEQ      '1'
     C     *IN42         ANDEQ     '1'                                          er i fremmed
     C     *IN41         IFEQ      '1'
     C                   MOVE      '0'           *IN41                          vis "Lokal"
     C                   ELSE
     C                   MOVE      '1'           *IN41                          vis fremmed
     C                   END
      * Hvis F-tast-rekka med F14 er framme - bytt tekst.
     C     XMSGN2        IFEQ      4
     C  N41              MOVE      'JOV0742'     MSGN2M                         F14 VIS VALUTA
     C   41              MOVE      'JOV0743'     MSGN2M                         F14 VIS I NOK
     C                   END
     C                   GOTO      START
     C                   END
      * F14 BILAG M/MVA I NOK - SWITCH VIS BRUTTO/NETTO  -> REFRESH
     C     *IN14         IFEQ      '1'
     C     *IN45         ANDEQ     '1'                                          NOK/MVA
     C     *IN44         IFEQ      '1'
     C                   MOVE      '0'           *IN44
     C                   ELSE
     C                   MOVE      '1'           *IN44
     C                   END
      * Hvis F-tast-rekka med F14 er framme - bytt tekst.
     C     XMSGN2        IFEQ      4
     C  N44              MOVE      'JOV0764'     MSGN2M                         F14 VIS netto
     C   44              MOVE      'JOV0765'     MSGN2M                         F14 VIS brutto
     C                   END
     C                   GOTO      START
     C                   END
      *___________
      * F12=Cancel
      *"""""""""""
     C     *IN12         IFEQ      '1'
     C                   Z-ADD     1             UFLAGG
     C                   GOTO      SLUTT
     C                   ENDIF
      *________________
      * F24=More F-keys
      *""""""""""""""""
     C     *IN24         IFEQ      '1'
     C                   EXSR      CMD24
     C                   GOTO      START3
     C                   ENDIF
      *__________
      * F4=Prompt
      *""""""""""
     C     *IN04         IFEQ      '1'
     C                   EXSR      SØKDTA
     C                   GOTO      START3
     C                   ENDIF
      *________________
      * F7=Query orders
      *""""""""""""""""
     C     *IN07         IFEQ      '1'
     C                   MOVE      'S'           UTYPES            1
     C                   CALL      'SYFM21'
     C                   PARM                    UTYPES
     C                   PARM                    UAVDS             4 0
     C                   PARM                    UOPDS             7 0
     C                   PARM                    USGS              3
     C                   GOTO      START3
     C                   ENDIF
     C     *IN08         IFEQ      '1'
     C                   MOVE      'K'           P1FLAG
     C                   Z-ADD     UBNR          P1BNR
     C                   MOVE      *ZEROS        P1AVD
     C                   MOVE      *ZEROS        P1TUNR
     C                   MOVE      *ZEROS        P1OAVD
     C                   MOVE      *ZEROS        P1OPD
     C                   MOVE      *ZEROS        P1BL
     C                   MOVE      *BLANKS       P1GN
     C                   MOVE      *BLANKS       P1KDM
     C                   MOVE      P1DS          PARM1           256
     C                   CALL      'SYKS12'
     C                   PARM                    PARM1
      * HENBUD UTFØRES ETTER START3
     C                   GOTO      START3
     C                   ENDIF
      *__________
      * F6=Create
      *""""""""""
     C     *IN06         IFEQ      '1'
     C                   EXSR      CMD06
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     2             POSNBR
     C                   GOTO      START3
     C                   ENDIF
      *____________________________________
      * F10=Ferdigmeld (kan ikke vÆre diff)
      *""""""""""""""""""""""""""""""""""""
     C     *IN10         IFEQ      '1'
      * INGEN HANDLING HVIS IKKE BILAGET "GÅR I NULL"
     C     WSBLD         IFEQ      0
      * TEST OM UFERDIG KONTERING(EDI) / OM MOMS ER FORDELT
     C                   MOVE      FITAXOri      FITAXN
     C                   CALL      'SYKS05'
     C                   PARM                    UBNR
     C                   PARM                    UBLM
     C                   PARM                    FITAXN
     C                   PARM                    UFLAGG
      *
     C     UFLAGG        IFEQ      1
     C                   GOTO      START3
     C                   ENDIF
     C     UFLAGG        IFEQ      2
     c                   move      'J'           EDIMATCH
     C                   GOTO      START
     C                   ENDIF
      * ENDELIG BILAGSNR MÅ VÆRE TILDELT VED F10
     C     UBNR2         IFEQ      *ZEROS
     C                   EXSR      CMD13
     C     *IN12         IFEQ      '1'
     C                   GOTO      START3
     C                   ENDIF
     C                   ENDIF
     C*FERDIGMELDING VELLYKKET - SETT FLAGG (TIL SYKS02)
     C                   Z-ADD     9             UFLAGG
     C                   GOTO      SLUTT
     C                   ELSE
n08  C                   MOVE      'SHU1459'     MSGNR
n08  C                   MOVE      '1'           *IN30
     C                   GOTO      START3
     C                   ENDIF
     C                   ENDIF
N04   *____________________________________
N04   * F20=Ferdigmeld 1.gangsreg
N04   *""""""""""""""""""""""""""""""""""""
N04  C     *IN20         IFEQ      '1'
N04  C     KHENIT        IFEQ      *blanks
n04  C                   MOVE      'SHU1426'     MSGNR
n04  C                   MOVE      '1'           *IN30
N04  C                   GOTO      START3
N04  C                   end
N04   *
N06  C     KABLST        IFEQ      '1'
n06  C                   MOVE      'SHU1435'     MSGNR
n06  C                   MOVE      '1'           *IN30
N06  C                   GOTO      START3
N06  C                   end
N04   *
N04   * ENDELIG BILAGSNR MÅ VÆRE TILDELT VED F10
N04  C     UBNR2         IFEQ      *ZEROS
N04  C                   EXSR      CMD13
N04  C     *IN12         IFEQ      '1'
N04  C                   GOTO      START3
N04  C                   ENDIF
N04  C                   ENDIF
N04  C*FERDIGMELDING VELLYKKET - SETT FLAGG (TIL SYKS02)
N04  C                   Z-ADD     8             UFLAGG
N04  C                   GOTO      SLUTT
N04  C                   ENDIF
      *___________________
      * F13=Endre endelig bilagsnr
      *"""""""""""""""""""
     C     *IN13         IFEQ      '1'
     C                   EXSR      CMD13
     C                   GOTO      START3
     C                   ENDIF
      *___________________
      * F15=Frie søkeveier
      *"""""""""""""""""""
     C     *IN15         IFEQ      '1'
     C                   MOVE      UBNR          ABNR              7
     C                   MOVE      WSBDT         ABDT              6
     C                   CALL      'SYKS64'
     C                   PARM                    ABNR
     C                   PARM                    ABDT
     C                   GOTO      START3
     C                   ENDIF
N16
N16   *___________________
N16   * F21=Autosett avvikende periode
N16   *"""""""""""""""""""
N16  C     *IN21         IFEQ      '1'
N16  C     *IN50         andeq     '0'                                          Tillatt
N16  C     UBNR          SETLL     KOSTBSLT
N16  C     UBNR          READE     KOSTBSLT                               33
N16  C     *IN33         DOWEQ     '0'
N16  C                   exsr      TESTPER
N16   * Dresom oppdragets avviker, test oppdragets mot åpen peri. endre kun hvis åpen..
N16  c     *in28         ifeq      '1'
N16  C                   move      20            W2PCC
N16  C                   move      HEDTÅ         W2PÅR
N16  C                   move      HEDTM         W2PMN
N16  C     KODTÅK        CHAIN     KODTÅ                              33
N16  C     *in33         ifeq      '1'
N16  c                   else
N16  c                   move      HEDTÅ         KBPCÅ
N16  c                   move      HEDTM         KBPMN
N16  c                   endif
N16  c                   endif
N16   *
N16  C                   UPDATE    KOSBRS
N16  C     UBNR          READE     KOSTBSLT                               33
N16  C  N33              ENDDO
N16  C                   GOTO      START
N16  C                   ENDIF
      *___________________
      * F19=ENDRE MODUS
      *"""""""""""""""""""
     C     *IN19         IFEQ      '1'
     C     *IN39         IFEQ      '0'
     C                   MOVE      '1'           *IN39
     C                   ELSE
     C                   MOVE      '0'           *IN39
     C                   ENDIF
     C                   GOTO      START
     C                   ENDIF
      *______________
      * ENTER ON BUNN.. DEFAULT FORD.NØKKEL ?
      *""""""""""""""
     C     *IN09         IFEQ      '0'                                          B1
     C     *IN11         ANDEQ     '0'
     C     *IN23         ANDEQ     '0'
     C     WSBLFD        IFNE      0                                             B2
      *
     C     UFLAGG        IFEQ      7                                              B3
     C     UFLAGG        OREQ      9
     C                   MOVE      *ZEROS        UFLAGG
     C                   ENDIF                                                    E3
      * SETT FORD.NØKKEL.... OPPDRAG 1.PRIORITET
      *
     C     WSOPD         IFNE      0                                              B3
     C                   MOVE      '1'           *IN09
     C                   GOTO      START4
     C                   ELSE                                                     X3
     C     WSPRO         IFNE      0                                               B4
     C     WSGN          ORNE      *BLANKS
     C                   MOVE      '1'           *IN11
     C                   GOTO      START4
     C                   ENDIF                                                     E4
     C                   ENDIF                                                    E3
     C                   ENDIF                                                   E2
      *
     C* ENTER TASTET - INGEN DATA SOM KAN GI FOR.NØKKEL...
N22  c     l1dir         ifne      '*L1*'
     C  N95wsopd         ifeq      0
     C     WSBLFD        IFEQ      0
     C                   Z-ADD     19            LINNBR
     C                   ELSE
     C                   Z-ADD     20            LINNBR
     C                   END
     C                   Z-ADD     18            POSNBR
     C                   MOVE      'JOV0361'     MSGNR
     C                   MOVE      '1'           *IN30
     c                   else
     C                   MOVE      '1'           *IN09
     c                   end
N22  c                   end
     C     START4        TAG
     C                   ENDIF                                                  E1
      *______________________
      * TEST FORDELINGSNØKKEL
      *""""""""""""""""""""""
      *
     C     *IN09         IFEQ      '1'
     C     *IN11         OREQ      '1'
     C     *IN23         OREQ      '1'
N22  c     l1dir         ifne      '*L1*'
     C                   EXSR      TESTB1
N22  c                   else
N22  c                   exsr      TESTB1L1
N22  c                   end
      * IKKE BASERT PÅ BUDSJETT .. SJEKK OM ÅPEN FORV. KOSTN. FINNES...
     C     *IN30         IFEQ      *OFF
     C     SISBUD        ANDEQ     'N'
      * MEN IKKE NÅR DET ER 2. RUNDE ETTER AT VARSEL ER GITT..
     C     UFLAGG        ANDNE     9
     C     UFLAGG        ANDNE     7
     C     UFLAGG        ANDNE     -9
     C     UFLAGG        ANDNE     -7
     C                   EXSR      TSTBUD
      * DERSOM EN HAR PLUKKET - GÅ TIL START3-HENT FRA BUDSJETT...
     C     P1FLAG        CABEQ     'P'           START3
     C                   ENDIF
      *
     C     *IN30         CABEQ     '1'           START3
     C                   EXSR      FORDEL
     C     *IN30         CABEQ     '1'           START3
     C                   GOTO      START
     C                   ENDIF
      *
     C     *IN29         CABEQ     '1'           START3
      *
      *
     C                   GOTO      START3
      *___________
      * End of PGM
      *"""""""""""
     C     SLUTT         TAG
     C                   CLOSE     SYKS03FM
     C                   CLOSE     KOSTBVIS
     C                   CLOSE     KOSTBSLT
     C                   MOVE      '1'           *INLR
      *___________
      * Subrutines
      *"""""""""""
      *//////////////////////////////////////////////////////////////////////
      * F13=CHAGE VOUCHER NO                                         CMD13 //
      *//////////////////////////////////////////////////////////////////////
     C     CMD13         BEGSR
     C     *IN10         IFEQ      *ON
N04  C     *IN20         OREQ      *ON
     C                   MOVE      'J'           FERDIG            1
     C                   MOVE      '1'           *IN30
     C                   MOVE      'JOV0385'     MSGNR
     C                   ELSE
     C                   MOVE      'N'           FERDIG
     C                   END
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     42            POSNBR
      *
      * Hvis fremmedvaluta og i modus for det også totaler i den VAL
      *
N04  C     *IN20         IFNE      *ON
     C     *IN41         IFEQ      '1'
     C                   MOVE      UVAL          WBVAL
     C     UBL           DIV       UVKU          WBBL
     C     WSBLF         DIV       UVKU          WBBLF
     C     WSBLD         DIV       UVKU          WBBLD
     C                   ELSE
     C                   MOVE      FICURR        WBVAL
     C                   MOVE      UBL           WBBL
     C                   MOVE      WSBLF         WBBLF
     C                   MOVE      WSBLD         WBBLD
     C                   END
N04  C                   END
     C     STBUN2        TAG
     C                   EXFMT     BUNN2
     C     *IN12         IFEQ      '1'
     C                   GOTO      ENDF13
     C                   ENDIF
      *
      * HENTER BILAGSNUMMER FRA TELLER
      *
     C     WSBSR         IFNE      ' '
     C     WSBNR2        ANDEQ     *ZEROS
     C     WSBSR         CHAIN     KOSTT                              33
     C   33              GOTO      STBUN2
     C                   MOVE      KTNR          WSBNR2
     C                   ADD       1             KTNR
     C                   UPDATE    KOSTTR
     C                   ENDIF
      *
      * TILLATER IKKE 0 I BILAGSNUMMER VED FERDIGMELDING
      *
     C     FERDIG        IFEQ      'J'
     C     WSBNR2        ANDEQ     *ZEROS
     C                   MOVE      '1'           *IN30
     C                   MOVE      'JOV0385'     MSGNR
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     42            POSNBR
     C                   GOTO      STBUN2
     C                   ENDIF
      *
      * BILASGSNUMMER MÅ IKKE FINNES FRA FØR
      *
     C     WSBNR2        IFNE      *ZEROS
     C     WSBNR2        CHAIN     KOSTA14                            33
     C     *IN33         IFEQ      *OFF
     C                   MOVE      'JOV0387'     MSGNR
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     42            POSNBR
     C                   GOTO      STBUN2
     C                   ENDIF
     C                   ENDIF
     C                   MOVE      WSBNR2        UBNR2
      *
     C     ENDF13        TAG
     C                   MOVE      '0'           *IN30
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      * F6=CREATE NEW                                                CMD06 //
      *//////////////////////////////////////////////////////////////////////
     C     CMD06         BEGSR
     C                   EXSR      MOVB2
     C                   Z-ADD     22            LINNBR
     C                   Z-ADD     10            POSNBR
      *
     C     CMD061        TAG
      *
N22  c     l1dir         ifne      '*L1*'
     C                   EXFMT     VARELI
N22  C                   else
N22  c                   EXFMT     VARELIL1
N22  C                   END
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00000000'    *IN(83)
     C                   MOVEA     '00'          *IN(27)
      *
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C                   Z-ADD     WSSUBN        XRECNO            4 0
     C     XRECNO        IFEQ      0
     C                   Z-ADD     ZRECNO        XRECNO            4 0
     C                   ENDIF
      * F4=Prompt
     C     *IN04         IFEQ      '1'
     C                   EXSR      SØKDT2
     C                   GOTO      CMD061
     C                   ENDIF
      * F12=Cancel
     C     *IN12         IFEQ      '1'
     C                   EXSR      MOVB2
     C                   ELSE
N22  c     l1dir         ifne      '*L1*'
     C                   EXSR      TESTB2
N22  C                   ELSE
N22  C                   EXSR      TESTB2L1
N22  C                   END
     C     *IN30         CABEQ     '1'           CMD061
     C                   ENDIF
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      * F24=MORE HELP                                                CMD24 //
      *//////////////////////////////////////////////////////////////////////
     C     CMD24         BEGSR
     C                   SELECT
      *
     C     XMSGN2        WHENLT    1
     C                   ADD       1             XMSGN2            1 0
     C                   MOVE      'DIV0020'     MSGN2K                         F3 AVSLUTT
     C                   MOVE      'DIV0032'     MSGN2L                         F4 SØK
     C                   MOVE      'DIV0021'     MSGN2M                         F5 FORNY
      *
     C     XMSGN2        WHENEQ    1
     C                   ADD       1             XMSGN2
     C                   MOVE      'DIV0022'     MSGN2K                         F6 LAG NY
     C                   MOVE      'JOV0330'     MSGN2L                         F7 SØK OPPD
     C                   MOVE      'JOV0331'     MSGN2M                         F8 PLUKK BUD
      *
     C     XMSGN2        WHENEQ    2
     C                   ADD       1             XMSGN2
     C                   MOVE      'JOV0332'     MSGN2K                         F9 ETTER INN
     C                   MOVE      'JOV0333'     MSGN2L                         F10 FERD.MLD
     C                   MOVE      'JOV0334'     MSGN2M                         F11 ET. VEKT
      *
     C     XMSGN2        WHENEQ    3
     C                   ADD       1             XMSGN2
     C                   MOVE      'DIV0024'     MSGN2K                         F12 FORRIGE
     C                   MOVE      'JOV0386'     MSGN2L                         F13 BILAGSNR
     C  N42
     CANN45              MOVE      'DIV0000'     MSGN2M                         F14 IKKE LOV
     C   42
     CANN41              MOVE      'JOV0742'     MSGN2M                         F14 VIS VALUTA
     C   42
     CAN 41              MOVE      'JOV0743'     MSGN2M                         F14 VIS I NOK
     C   45
     CANN44              MOVE      'JOV0764'     MSGN2M                         F14 VIS netto
     C   45
     CAN 44              MOVE      'JOV0765'     MSGN2M                         F14 VIS brutto
      *
s04  C*                  OTHER
s04  C*                  Z-ADD     0             XMSGN2
n04  C     XMSGN2        WHENEQ    4
n04  C                   ADD       1             XMSGN2
     C                   MOVE      'JOV0335'     MSGN2K                         F15 FRI SØKEV.
     C                   MOVE      'JOV0336'     MSGN2L                         F23 IKKE FORDEL
     C  N39              MOVE      'YBC0848'     MSGN2M
     C   39              MOVE      'YBC0849'     MSGN2M
N04  C                   OTHER
N04  C                   Z-ADD     0             XMSGN2
N04  C                   MOVE      'SHU1423'     MSGN2K                         Ferdigmeld
N04  C                   MOVE      'DIV0000'     MSGN2L                         F4 SØK
N04  C                   MOVE      'DIV0000'     MSGN2M                         F5 FORNY
     C                   ENDSL
      *
     C                   ENDSR
      *************************************************************************
     C     TESTB1        BEGSR
      *************************************************************************
      *
      * TESTER FRA BILDET MED NYREGISTRERING
      *
      *
      * BELØP KAN IKKE VÆRE 0
      *
     C     WSBLFD        IFEQ      0
     C                   MOVE      'SPB0007'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN90
     C                   GOTO      SLTB1
     C                   ENDIF
      *
      * FINNES GEBYRKODE/ER KOSTNADSKONTO REGISTRERT
      * VED SPLITT=J STÅR KOSTNADSKONTO PÅ "1." LINJE ELLERS I "2"
      *
     C                   MOVE      ' '           OKPLI             1
     C                   MOVE      ' '           OKFRI             1
     C                   MOVE      WSVK          YVK
     C     KODGEK        CHAIN     KODTGE                             89
     C     *IN89         IFEQ      '0'
     C     KODG2K        CHAIN     KODTG2                             89
     C                   ENDIF
      *
      * eventuelt teste eu-konteringsregel
      *
N17  c  N89wSavd         ifne      *zeros
N17  c     wSopd         andne     *zeros
N17  c     wSpro         orne      *zeros
     C                   MOVE      'N'           REGMOD            1
N17  c                   exsr      eusr
N17  C     EUKODE        IFNE      *BLANKS
N17  C     GEBKEYE       CHAIN     KODTG3                             89
N17  C                   SETOFF                                       89
N17  C                   END
N17  c                   end
     C     *IN89         IFEQ      '1'
     C                   MOVE      'SPG0010'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     40            POSNBR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLTB1
     C                   ENDIF
      *
      *ER PLIKTIG/FRI KOSTN.FØRING TILLATT PÅ AKTUELL VAREKODE
      * VED SPLITT=J STÅR KOSTNADSKONTO PÅ "1." LINJE ELLERS I "2"
      *
     C     *IN89         IFEQ      '0'                                          B1
     C     KG2XXX        IFEQ      'J'                                           B2
     C     KG2KON        IFEQ      *ZEROS                                         B3
     C                   MOVE      KGEKON        KG2KON
     C                   END                                                      E3
     C     KGEKON        IFEQ      99999                                          B3
     C                   MOVE      'N'           OKPLI
     C                   END                                                      E3
     C     KG2KON        IFEQ      99999                                          B3
     C                   MOVE      'N'           OKFRI
     C                   END                                                      E3
     C                   ELSE                                                    X2
     C     KG2UTG        IFEQ      *ZEROS                                         B3
     C                   MOVE      KG2MOT        KG2UTG
     C                   END                                                      E3
     C     KG2MOT        IFEQ      99999                                          B3
     C     KG2MOT        OREQ      *ZEROS
     C                   MOVE      'N'           OKPLI
     C                   END                                                      E3
     C     KG2UTG        IFEQ      99999                                          B3
     C     KG2UTG        OREQ      *ZEROS
     C                   MOVE      'N'           OKFRI
     C                   END                                                      E3
     C                   ENDIF                                                   E2
     C                   ENDIF                                                  E1
      *
      *KOSTNAD IKKE TILLATT I DET HELE TATT.....
      *
     C     OKPLI         IFEQ      'N'
     C     OKFRI         ANDEQ     'N'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPG0010'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     40            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN89
     C                   ENDIF
     C     *IN30         CABEQ     '1'           SLTB1
      *
      * KODE P/F/+ RIKTIG
     C     WSKDPF        IFNE      'P'
     C     WSKDPF        ANDNE     'F'
     C     WSKDPF        ANDNE     '+'
     C     KODWKY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    WSKDPF
     C                   MOVE      *BLANKS       WMVAKD            2
     C     KODWKY        CHAIN     KODWL01                            31
     C     *IN31         IFEQ      *OFF
     C     MVAAVI        IFEQ      *ZERO
     C                   MOVE      *ON           *IN31
     C                   ELSE
     C     UBDT8         IFLT      WITAXD
     C     GMVATW        DIV       100           FITAXN
     C                   ELSE
     C     MVAAVI        DIV       100           FITAXN
     C                   ENDIF
     C                   ADD       1             FITAXN
     C                   ENDIF
     C                   ENDIF
      *
     C     WSKDPF        IFNE      'P'
     C     WSKDPF        ANDNE     'F'
     C     WSKDPF        ANDNE     '+'
     C     *IN31         ANDNE     *OFF
      *
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0044'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     48            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN88
     C                   GOTO      SLTB1
      *
     C                   ENDIF
     C                   ENDIF
      *
      *ER FØRING MED AKTUELL MOMSKODE TILLATT....
      *
     C     *IN88         IFEQ      '0'
     C     WSKDPF        IFEQ      'F'
     C     OKFRI         IFEQ      'N'
     C                   MOVE      '1'           *IN88
     C                   ENDIF
     C                   ELSE
     C     OKPLI         IFEQ      'N'
     C                   MOVE      '1'           *IN88
     C                   ENDIF
     C                   ENDIF
     C     *IN88         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'JOV0295'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     48            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   ENDIF
      *
     C     WSKDM         IFEQ      ' '
     C     WSKDPF        IFEQ      'F'
     C                   MOVE      '0'           WSKDM
     C                   ELSE
     C                   MOVE      '1'           WSKDM
     C                   END
     C                   END
     C                   ENDIF
      *
     C     *IN88         IFEQ      '0'
     C     WSKDPF        ANDEQ     'F'
     C     WSKDM         ANDNE     '0'
     C                   MOVE      '1'           *IN88
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0046'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     48            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   ENDIF
     C     *IN30         CABEQ     '1'           SLTB1
      *
     C     WSKDM         IFNE      '0'
     C     WSKDM         ANDNE     '1'
     C     WSKDM         ANDNE     '9'
     C                   MOVE      '1'           *IN87
     C                   MOVE      'SPK0045'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     55            POSNBR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLTB1
     C                   END
      *
      * MOMSKODE FOR INNTEKTSLINJE
      *
     C     WSPROS        IFNE      *ZEROS
     C     WSKDMV        ANDNE     'J'
     C     WSKDMV        ANDNE     'N'
     C                   MOVE      'JOV0143'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     79            POSNBR
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN82
     C                   GOTO      SLTB1
     C                   END
      *
      * TEST AVD. DERSOM F23 BENYTTET (IKKE FORDEL I TRAFIKK)
      * (TESTEN VAR TIDLIGERE(FØR F23) BORTE FOR Å KUNNE "DUMMYFØRE")
      *
     C     *IN23         IFEQ      '1'                                          B1
     C     WSAVD         ANDNE     *ZEROS
      *
     C     KODAOP        IFNE      '1'                                           B2
     C                   OPEN      KODTA
     C                   END                                                     E2
     C     KODTAK        CHAIN     KODTA                              86
     C     *IN86         IFEQ      '1'                                           B2
     C                   MOVE      'SPA0001'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLTB1
     C                   ENDIF                                                   E2
      *
     C                   ENDIF                                                  E1
      *
      * SKJEKKER OM STYKKGODSFRAKTBREV
      *
     C     WSGN          IFNE      *BLANKS
     C                   MOVEL     WSGN17        FSSOK
     C     FRIKEY        CHAIN     FRISOL01                           33
     C     *IN33         IFEQ      '0'
     C                   MOVE      *BLANKS       WSGN17
     C                   MOVE      FSAVD         WSAVD
     C                   MOVE      FSOPD         WSOPD
     C                   END
     C                   END
      *
      * test av avvikende periode
      *
     C     WSPMN         IFNE      0
     C                   Z-ADD     20            WSPCC
     C                   Z-ADD     21            LINNBR
     C     KODTÅK2       CHAIN     KODTÅ                              97
     C     *in97         ifeq      '1'
     C     *in30         andeq     '0'
     C                   MOVE      'SPP0001'     MSGNR
     C                   Z-ADD     7             POSNBR
     C                   SETON                                        30
     C                   END
     C                   ELSE
     C                   Z-ADD     0             WSPÅR
     C                   END
      *
      * TESTER TASTET OPPDRAGSNUMMER
      *
     C     WSOPD         IFNE      0                                            B1
     C     WSAVD         IFEQ      0
     C                   MOVE      XXAVD         WSAVD
     C                   END
     C     HEADFK        CHAIN     HEADF                              85
      *
      * IKKE FØR PÅ SLETTET OPPDRAG
      *
     C     *IN85         IFEQ      '0'                                           B2
     C     HEST          IFEQ      'S'
     C                   MOVE      '1'           *IN85
     C                   ELSE
      *
      * TESTER OM OPPDRAG ER AVSLUTTET
      *
     C     HEADFK        CHAIN     AVSLUTF                            33
     C   33HEPRO         IFNE      *ZEROS
     C     HEPRO         CHAIN     AVSLUTL2                           33
     C                   END
     C     *IN33         IFEQ      '0'
     C                   MOVE      'SHU0579'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     32            POSNBR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLTB1
     C                   ENDIF                                                   E2
     c*
N18  c     KODTVK        CHAIN     KODTV                              33
N18  c     *in(33)       IFEQ      '0'
N18  c     KOVPRO        ANDEQ     'J'
N18  C     HEPRO         ANDEQ     0
N18  C                   MOVE      'SHU1584'     MSGNR
N18  C                   Z-ADD     20            LINNBR
N18  C                   Z-ADD     32            POSNBR
N18  C                   MOVE      '1'           *IN30
N18  C                   GOTO      SLTB1
N18  C                   END
     C                   ENDIF                                                   E2
     C                   ENDIF                                                   E2
      *
      * X BEGGE VEIER PÅ OPOPDRAG ER FEIL
      *
     C     *IN85         IFEQ      '0'                                           B2
     C     HEKDFS        IFEQ      'X'
     C     HEKDFK        ANDEQ     'X'
     C                   MOVE      'SHU0824'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     30            POSNBR
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN85
     C                   MOVE      '1'           *IN86
     C                   GOTO      SLTB1
     C                   END
     C                   END
      *
     C     *IN85         IFEQ      '1'                                           B2
     C     *IN30         IFEQ      '0'                                            B3
     C                   MOVE      'JOV0362'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     30            POSNBR
     C                   ENDIF                                                    E3
      *
      *
      *
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN86
     C                   ELSE                                                    X2
      * OPPDRAG OK
     C                   GOTO      SLTB1
     C                   ENDIF                                                   E2
     C                   ENDIF                                                  E1
      *
      *
      * TEST PROSJEKTNUMMER
      *
      *
     C     WSPRO         IFNE      0
     C     WSPRO         CHAIN     AVSLUTL2                           33
     C     *IN33         IFEQ      '0'
     C                   MOVE      'SHU0580'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     50            POSNBR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLTB1
     C                   ENDIF                                                   E2
     C                   MOVE      'N'           ANNAVD            1
     C     HEA11K        SETLL     HEAD11
     C     NXTPRO        TAG
     C     WSPRO         READE     HEAD11                                 84
      *
      * VED SLETTET OPPDRAG LES NESTE
      *
     C     *IN84         IFEQ      '0'
     C     HEST          IFEQ      'S'
     C                   GOTO      NXTPRO
     C                   ELSE
     C     HEADFK        CHAIN     AVSLUTF                            33
     C  N33              GOTO      NXTPRO
     C                   END
      *
      * HVIS AVDELING VALGT MÅ DETTE STEMME I HEADF
      *
     C     WSAVD         IFNE      *ZEROS
     C     WSAVD         ANDNE     HEAVD
     C                   MOVE      'J'           ANNAVD
     C                   GOTO      NXTPRO
     C                   END
     C                   END
      *
      *
      *
      * LEST FERDIG MÅ ETT HEADFOPPDRAG VÆRE FUNNET
      *
     C     *IN84         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C     ANNAVD        IFEQ      'J'
     C                   MOVE      'JOV0739'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   MOVE      '1'           *IN86
     C                   ELSE
     C                   MOVE      'SPT0002'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     50            POSNBR
     C                   END
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   ELSE
      * PROSJEKTNUMMER OK
     C                   GOTO      SLTB1
     C                   ENDIF
     C                   ENDIF
      *
      * GAMMEL SJEKK MOT HEAD3 FJERNET FOR Å FÅ KLARERE LOGIKK.
      * VIA AWB/GODSNR - ENTEN REELT GODSNR                     (HEGN)
      *                  ELLER AWBNR (FLY IMP GODSNR F75766767) (HEGN)
      *                  ELLER AWBNR MED 4 BLANKE FORAN(INL/EKS)(HEGN)
      *                  ELLER AGENTREF (MASTER IMPORT)         (HERFA)
      * I HEGN??
      *************************************************************
      *
      * TEST AV GODSNUMMER
      *
     C     WSGN          IFNE      *BLANKS                                      B1
     C                   MOVE      'N'           BLANK4            1
     C                   MOVE      'N'           ANNAVD
     C     WSGN          SETLL     HEAD18
     C     NXTGN         TAG
     C     WSGN          READE     HEAD18                                 83
     C     *IN83         IFEQ      '0'
     C     HEST          IFEQ      'S'                                           2<-B
     C                   GOTO      NXTGN
     C                   ELSE
     C     HEADFK        CHAIN     AVSLUTF                            33
     C   33HEPRO         IFNE      *ZEROS
     C     HEPRO         CHAIN     AVSLUTL2                           33
     C                   END
     C  N33              GOTO      NXTGN
     C                   END                                                     2<-E
     C     WSAVD         IFNE      *ZEROS                                        2<-B
     C     WSAVD         ANDNE     HEAVD
     C                   MOVE      'J'           ANNAVD
     C                   GOTO      NXTGN
     C                   END                                                     2<-E
     C                   GOTO      SLTB1
     C                   END                                                     2<-E
      *
      * IKKE FUNNET GYLDIG GODSNR -> NYTT FORSØK MED 4 BLANKE FORAN
      * DETTE ER FORDI FLY EKSPORT FUNGERER SLIK DELSYSTEM=D
      *
     C                   MOVEL     WSGN          UGN11            11
     C                   MOVE      UGN11         UGNTMP           15
     C     UGNTMP        SETLL     HEAD18
     C     NXTGNT        TAG
     C     UGNTMP        READE     HEAD18                                 83
      *
      * LES NESTE HVIS SLETTET
      *
     C     *IN83         IFEQ      '0'
     C     HEST          IFEQ      'S'                                           2<-B
     C                   GOTO      NXTGNT
     C                   ELSE
     C     HEADFK        CHAIN     AVSLUTF                            33
     C   33HEPRO         IFNE      *ZEROS
     C     HEPRO         CHAIN     AVSLUTL2                           33
     C                   END
     C  N33              GOTO      NXTGNT
     C                   END                                                     2<-E
      *
      * LES NESTE HVIS AVDELING DIFFERERER
      *
     C     WSAVD         IFNE      *ZEROS                                        2<-B
     C     WSAVD         ANDNE     HEAVD
     C                   GOTO      NXTGNT
     C                   END                                                     2<-E
     C                   END
     C     *IN83         IFEQ      *OFF
     C                   MOVE      'J'           BLANK4            1
     C                   MOVE      UGNTMP        WSGN
     C                   END
      *
      * I FELTET HERFA..
      * FANT INGENTING PÅ GODSNR - SJEKK VIA AREF
      *
     C     *IN83         IFEQ      '1'                                            B3
     C     WSAREF        SETLL     HEAD17
     C     NXTARE        TAG
     C     WSAREF        READE     HEAD17                                 83
      *
      * HOPPER OVER SLETTEDE
      *
     C     *IN83         IFEQ      '0'
     C     HEST          IFEQ      'S'                                           2<-B
     C                   GOTO      NXTARE
     C                   ELSE
     C     HEADFK        CHAIN     AVSLUTF                            33
     C   33HEPRO         IFNE      *ZEROS
     C     HEPRO         CHAIN     AVSLUTL2                           33
     C                   END
     C  N33              GOTO      NXTARE
     C                   END                                                     2<-E
      *
      * LES NESTE HVIS AVDELING DIFFERERER
      *
     C     WSAVD         IFNE      *ZEROS                                        2<-B
     C     WSAVD         ANDNE     HEAVD
     C                   MOVE      'J'           ANNAVD
     C                   GOTO      NXTARE
     C                   END                                                     2<-E
     C                   END                                                      E3
     C                   END                                                      E3
     C     *IN83         IFEQ      '1'                                           B2
     C     *IN30         IFEQ      '0'                                            B3
     C     ANNAVD        IFEQ      'J'
     C                   MOVE      'JOV0738'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   MOVE      '1'           *IN86
     C                   ELSE
     C                   MOVE      'JOV0363'     MSGNR
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     69            POSNBR
     C                   END
     C                   ENDIF                                                    E3
     C                   MOVE      '1'           *IN30
     C                   ELSE                                                    X2
      * GODSNUMMER OK
     C                   GOTO      SLTB1
     C                   ENDIF                                                   E2
     C                   END                                                    E1
      *
      *  HAR IKKE VALG OPPDRAG/TUR ELLER GODSNUMMER
      *
     C     *IN23         IFEQ      '0'
     C     *IN30         ANDEQ     '0'
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   MOVE      'DIV2144'     MSGNR
     C                   MOVE      '1'           *IN30
     C                   ENDIF
     C     SLTB1         TAG
      * NETTOBELØP INNLAGT SOM SKAL FØRES PLIKTIG ? (GENERER BRUTTO)
     C     *IN30         IFEQ      '0'
     C     WSKDPF        ANDEQ     '+'
     C                   MOVE      'P'           WSKDPF
     C                   MOVE      FITAXOri      FITAXN
     C                   MULT(H)   FITAXN        WSBLFD
     C                   ENDIF
      *
     C                   ENDSR
      *************************************************************************
     C     TESTB1L1      BEGSR
      *************************************************************************
      *
      * TESTER FRA BILDET MED NYREGISTRERING
      *
      *
      * BELØP KAN IKKE VÆRE 0
      *
     C     WSBLFD        IFEQ      0
     C                   MOVE      'SPB0007'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN90
     C                   GOTO      SLTB1L1
     C                   ENDIF
      *
      *
      *ER PLIKTIG/FRI KOSTN.FØRING TILLATT PÅ AKTUELL VAREKODE
      * VED SPLITT=J STÅR KOSTNADSKONTO PÅ "1." LINJE ELLERS I "2"
      *
      *
      * KODE P/F/+ RIKTIG
     C     WSKDPF        IFNE      'P'
     C     WSKDPF        ANDNE     'F'
     C     WSKDPF        ANDNE     '+'
     C                   MOVE      *BLANKS       WMVAKD            2
     C     KODWKY        CHAIN     KODWL01                            31
     C     *IN31         IFEQ      *OFF
     C     MVAAVI        IFEQ      *ZERO
     C                   MOVE      *ON           *IN31
     C                   ELSE
     C     UBDT8         IFLT      WITAXD
     C     GMVATW        DIV       100           FITAXN
     C                   ELSE
     C     MVAAVI        DIV       100           FITAXN
     C                   ENDIF
     C                   ADD       1             FITAXN
     C                   ENDIF
     C                   ENDIF
      *
     C     WSKDPF        IFNE      'P'
     C     WSKDPF        ANDNE     'F'
     C     WSKDPF        ANDNE     '+'
     C     *IN31         ANDNE     *OFF
      *
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0044'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     48            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN88
     C                   GOTO      SLTB1L1
      *
     C                   ENDIF
     C                   ENDIF
      *
      *ER FØRING MED AKTUELL MOMSKODE TILLATT....
      *
     C     *IN88         IFEQ      '0'
     C     WSKDPF        IFEQ      'F'
     C     OKFRI         IFEQ      'N'
     C                   MOVE      '1'           *IN88
     C                   ENDIF
     C                   ELSE
     C     OKPLI         IFEQ      'N'
     C                   MOVE      '1'           *IN88
     C                   ENDIF
     C                   ENDIF
     C     *IN88         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'JOV0295'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     48            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   ENDIF
      *
     C     WSKDM         IFEQ      ' '
     C     WSKDPF        IFEQ      'F'
     C                   MOVE      '0'           WSKDM
     C                   ELSE
     C                   MOVE      '1'           WSKDM
     C                   END
     C                   END
     C                   ENDIF
      *
     C     *IN88         IFEQ      '0'
     C     WSKDPF        ANDEQ     'F'
     C     WSKDM         ANDNE     '0'
     C                   MOVE      '1'           *IN88
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0046'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     48            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   ENDIF
     C     *IN30         CABEQ     '1'           SLTB1L1
      *
     C     WSKDM         IFNE      '0'
     C     WSKDM         ANDNE     '1'
     C     WSKDM         ANDNE     '9'
     C                   MOVE      '1'           *IN87
     C                   MOVE      'SPK0045'     MSGNR
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     55            POSNBR
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLTB1L1
     C                   END
      *
      *
      * test av avvikende periode
      *
     C     WSPMN         IFNE      0
     C                   Z-ADD     20            WSPCC
     C                   Z-ADD     21            LINNBR
     C     KODTÅK2       CHAIN     KODTÅ                              97
     C     *in97         ifeq      '1'
     C     *in30         andeq     '0'
     C                   MOVE      'SPP0001'     MSGNR
     C                   Z-ADD     7             POSNBR
     C                   SETON                                        30
     C                   END
     C                   ELSE
     C                   Z-ADD     0             WSPÅR
     C                   END
     C     SLTB1L1       Tag
      * NETTOBELØP INNLAGT SOM SKAL FØRES PLIKTIG ? (GENERER BRUTTO)
     C     *IN30         IFEQ      '0'
     C     WSKDPF        ANDEQ     '+'
     C                   MOVE      'P'           WSKDPF
     C                   MOVE      FITAXOri      FITAXN
     C                   MULT(H)   FITAXN        WSBLFD
     C                   ENDIF
      *
     C                   ENDSR
     c***********************************************************************
     C     TESTB2        BEGSR
     c***********************************************************************
      * VALIDATE ENTER                                              TESTB2 //
     C                   Z-ADD     22            LINNBR
      *
      * tester på endringsbilder variable starter med W2
      *
     C     *IN40         IFEQ      '0'
     C                   MOVE      W2AVD         KBKAVD
     C                   MOVE      *BLANKS       KBKKEY
     C                   MOVEL     W2OPD         KBKKEY
     C                   MOVE      W2KN          KBKKEY
     C                   END
      *
     C     W2AVD         IFNE      *ZEROS
     C     W2OPD         ANDEQ     *ZEROS
     C     KODAOP        IFNE      '1'                                           B2
     C                   OPEN      KODTA
     C                   END                                                     E2
     C     KODTA2        CHAIN     KODTA                              90
     C     *IN90         IFEQ      '1'
     C                   MOVE      'SPA0001'     MSGNR
     C                   Z-ADD     10            POSNBR
     C                   MOVE      '1'           *IN30
     C                   ENDIF
     C                   ENDIF
      *
     C     W2OPD         IFNE      *ZEROS
     C     HEAFK2        CHAIN     HEADF                              89
     C     *IN30         IFEQ      '0'
     C     *IN89         ANDEQ     '1'
     C                   MOVE      'SPO0001'     MSGNR
     C                   Z-ADD     14            POSNBR
     C                   MOVE      '1'           *IN30
     C                   ENDIF
      * KUNDEN NR GYLDIG?? HVIS ULIK SELGER/KJØPER SETT X=3.PART
     C     *IN89         IFEQ      '0'
     C                   MOVE      HEOT          WSOT
     C                   MOVE      HEFR          WSFR
      *
     C     W2KN          IFEQ      *ZEROS
      *
     C     HEKDFS        IFEQ      'X'
     C     HEKDFK        ANDNE     'X'
     C                   Z-ADD     HEKNKF        W2KN
     C                   END
     C     HEKDFK        IFEQ      'X'
     C     HEKDFS        ANDNE     'X'
     C                   Z-ADD     HEKNSF        W2KN
     C                   END
      * Begge parter fins, sett etter imp/eksp
     C     HEKDFS        IFNE      'X'
     C     HEKDFK        ANDNE     'X'
     C                   SELECT
     C     HEUR          WHENEQ    'H'
     C     HELKA         IFEQ      'NO'                                         EKSPORT
     C     HETRI         ANDNE     'NO'
     C                   MOVE      HEKNSF        W2KN
     C                   ELSE                                                   IMP. ELLER
     C                   MOVE      HEKNKF        W2KN                             INNLAND
     C                   END
     C     HEUR          WHENEQ    'A'
     C     HEUR          OREQ      'C'                                          IMPORT
     C     HEUR          OREQ      'F'
     C                   MOVE      HEKNKF        W2KN
     C     HEUR          WHENEQ    'B'                                          EKSPORT
     C     HEUR          OREQ      'D'
     C     HEUR          OREQ      'G'
     C                   MOVE      HEKNSF        W2KN
     C                   ENDSL
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C     KUND1K        CHAIN     CUNDL01                            88
     C     *IN88         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0001'     MSGNR
     C                   Z-ADD     22            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   ENDIF
     C     W2OPD         IFNE      *ZEROS
     C     *IN89         ANDEQ     '0'
      * SELG/KJØP-KODE - HVIS ULIK BEGGE PARTER - SETT X=TREDJE PART
     C     W2KN          IFEQ      HEKNSF
     C                   MOVE      'S'           WSSK
     C                   ELSE
     C     W2KN          IFEQ      HEKNKF
     C                   MOVE      'K'           WSSK
     C                   ELSE
     C                   MOVE      'X'           WSSK
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      * FINNES GEBYRKODE/ER KOSTNADSKONTO REGISTRERT
      * VED SPLITT=J STÅR KOSTNADSKONTO PÅ "1." LINJE ELLERS I "2"
     C                   MOVE      ' '           OKPLI
     C                   MOVE      ' '           OKFRI
     C                   MOVE      W2VK          YVK
     C     KODGEK        CHAIN     KODTGE                             87
     C  N87KODG2K        CHAIN     KODTG2                             87
      *
      * eventuelt teste eu-konteringsregel
      *
N17  c  N87w2avd         ifne      *zeros
N17  c     w2opd         andne     *zeros
     C                   MOVE      'E'           REGMOD            1
N17  c                   exsr      eusr
N17  C     EUKODE        IFNE      *BLANKS
N17  C     GEBKEYE       CHAIN     KODTG3                             87
N17  C                   SETOFF                                       87
N17  C                   END
N17  c                   end
     C     *IN87         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPG0010'     MSGNR
     C                   Z-ADD     31            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   ENDIF
      *
     C     W2KDPF        IFNE      'P'
     C     W2KDPF        ANDNE     'F'
     C     W2KDPF        ANDNE     '+'
     C                   MOVE      '1'           *IN86
     C                   ENDIF
      * KODE P/F/+ RIKTIG
     C     KODWK2        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WMVAKD
     C                   KFLD                    W2KDPF
     C                   MOVE      *BLANKS       WMVAKD            2
     C     *IN86         IFEQ      *ON
     C     KODWK2        CHAIN     KODWL01                            86
     C     *IN86         IFEQ      *OFF
     C     MVAAVI        IFEQ      *ZERO
     C                   MOVE      *ON           *IN86
     C                   ELSE
     C     UBDT8         IFLT      WITAXD
     C     GMVATW        DIV       100           FITAXN
     C                   ELSE
     C     MVAAVI        DIV       100           FITAXN
     C                   ENDIF
     C                   ADD       1             FITAXN
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C  N86KG2XXX        IFEQ      'J'
     C     KGEKON        IFEQ      99999
     C                   MOVE      'N'           OKPLI
     C                   ENDIF
     C     KG2KON        IFEQ      99999
     C                   MOVE      'N'           OKFRI
     C                   ENDIF
     C                   ELSE
     C     KG2MOT        IFEQ      0
     C                   MOVE      '1'           *IN86
     C                   ENDIF
     C  N86KG2MOT        IFEQ      99999
     C                   MOVE      'N'           OKPLI
     C                   ENDIF
     C  N86KG2UTG        IFEQ      99999
     C                   MOVE      'N'           OKFRI
     C                   ENDIF
     C                   ENDIF
     C     *IN86         IFEQ      '0'
     C     W2KDPF        IFEQ      'F'
     C     OKFRI         IFEQ      'N'
     C                   MOVE      '1'           *IN86
     C                   ENDIF
     C                   ELSE
     C     OKPLI         IFEQ      'N'
     C                   MOVE      '1'           *IN86
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C     *IN86         IFEQ      '1'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0044'     MSGNR
     C                   Z-ADD     37            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   ENDIF
      *
     C     W2BLHB        IFEQ      0
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPB0007'     MSGNR
     C                   Z-ADD     40            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN85
     C                   ENDIF
      *
     C     *IN88         IFEQ      '0'
     C     W2KDM         ANDEQ     ' '
     C     W2KDPF        IFEQ      'F'
     C                   MOVE      '0'           W2KDM
     C                   ELSE
     C                   MOVE      '1'           W2KDM
     C                   ENDIF
     C                   ENDIF
      *
      * test av momskode   feil ved 84
      *
     C     W2KDM         IFNE      '0'
     C     W2KDM         ANDNE     '1'
     C     W2KDM         ANDNE     '9'
     C                   MOVE      '1'           *IN84
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0045'     MSGNR
     C                   Z-ADD     57            POSNBR
     C                   MOVE      '1'           *IN30
     C                   ENDIF
     C                   ENDIF
      *
     C     W2KDPF        IFEQ      'F'
     C     W2KDM         ANDNE     '0'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0046'     MSGNR
     C                   Z-ADD     57            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN84
     C                   ENDIF
      *
      * test av avvikende periode
      *
     C     W2PMN         IFNE      0
     C                   Z-ADD     20            W2PCC
     C     KODTÅK        CHAIN     KODTÅ                              97
     C     *in97         ifeq      '1'
     C     *in30         andeq     '0'
     C                   Z-ADD     23            LINNBR
     C                   MOVE      'SPP0001'     MSGNR
     C                   Z-ADD     45            POSNBR
     C                   SETON                                        30
     C                   END
     C                   ELSE
     C                   Z-ADD     0             W2PÅR
     C                   END
      *
     C     *IN30         IFEQ      '1'
     C                   GOTO      SLTB2
     C                   ENDIF
      *
      * NETTOBELØP INNLAGT SOM SKAL FØRES PLIKTIG ? (GENERER BRUTTO)
     C     W2KDPF        IFEQ      '+'
     C                   MOVE      'P'           W2KDPF
     C                   MOVE      FITAXOri      FITAXN
     C                   MULT(H)   FITAXN        W2BLHB
     C                   END
      *_____________________________________________________
      * Update Database and subfile (både ved ny og emdring)
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      W2KDM         KBKDM
     C   40RECNUM        CHAIN     KOSTBR                             20
     C   40              SUB       KBBLHB        WSBLF
     C  N40              MOVE      *ZEROS        KBBLF
     C                   EXSR      MOVWSK
N22  c     l1dir         ifEQ      '*L1*'
N22  C                   EXSR      MOVWSKL1
N22  C                   END
      *
      *
      *tester om postens periode differerer fra bilagets
      * IN28
      *
     C                   EXSR      TESTPER
      *
     C                   MOVE      KBBLHB        WSBLHB
s07  C*  41              DIV(H)    UVKU          WSBLHB
     C   41              MOVE      UVAL          WSVAL
     C  N41              MOVE      *BLANKS       WSVAL
     C   44KBKDM         IFEQ      1
     C                   DIV(H)    FITAXN        WSBLHB
     C                   END
     C     KBGEBY        COMP      1                                      43
     C                   MOVE      KBAVD         WXAVD
     C                   MOVE      *BLANKS       WXTXT
     C                   MOVE      KBOPD         WXOPD
     C                   MOVE      WSOT          WXOT
     C                   MOVE      WSFR          WXFR
     C                   MOVE      KBNØKK        WXNØKK
     C                   MOVE      WSSK          WXSK
     C   40KBNØKK        IFLT      1
     C     KBNØKK        ORGT      4
     C                   MOVE      W2AVD         KBKAVD
     C                   MOVE      *BLANKS       KBKKEY
     C                   MOVEL     W2OPD         KBKKEY
     C                   MOVE      W2KN          KBKKEY
     C                   END
     C     *IN40         IFEQ      '0'                                          Create
     C                   WRITE     KOSTBR
     C                   Z-ADD     RECNOB        RECNUM
     C                   ADD       1             YRECNO
     C                   Z-ADD     YRECNO        ZRECNO
N10  c                   exsr      testbud
     C                   WRITE     SUBFIL
     C                   ELSE                                                   Update
     C     KBOPD         IFNE      *ZEROS
     C     KBNØKK        ANDEQ     9
     C                   MOVE      1             KBNØKK
     C                   MOVE      '1'           WXNØKK
     C                   END
N07  c                   z-add     w2blhb        kbblhb
     C                   UPDATE    KOSTBR
     C                   IF        UPARM2 = *BLANKS
     C                   UPDATE    SUBFIL
     C                   END
     C                   ENDIF
      *
     C                   EXSR      MOVB2
      *
     C                   ADD       KBBLHB        WSBLF
     C     UBL           ADD       WSBLF         WSBLD
     C     SLTB2         ENDSR
     c***********************************************************************
     C     TESTB2L1      BEGSR
     c***********************************************************************
      * VALIDATE ENTER                                              TESTB2 //
     C                   SETOFF                                       88
     C                   Z-ADD     22            LINNBR
      *
      * tester på endringsbilder variable starter med W2
      *
     C     W2KDM         IFEQ      ' '
     C     W2KDPF        IFEQ      'F'
     C                   MOVE      '0'           W2KDM
     C                   ELSE
     C                   MOVE      '1'           W2KDM
     C                   ENDIF
     C                   ENDIF
      *
      * test av momskode   feil ved 84
      *
     C     W2KDM         IFNE      '0'
     C     W2KDM         ANDNE     '1'
     C     W2KDM         ANDNE     '9'
     C                   MOVE      '1'           *IN84
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0045'     MSGNR
     C                   Z-ADD     57            POSNBR
     C                   MOVE      '1'           *IN30
     C                   ENDIF
     C                   ENDIF
      *
     C     W2KDPF        IFEQ      'F'
     C     W2KDM         ANDNE     '0'
     C     *IN30         IFEQ      '0'
     C                   MOVE      'SPK0046'     MSGNR
     C                   Z-ADD     57            POSNBR
     C                   ENDIF
     C                   MOVE      '1'           *IN30
     C                   MOVE      '1'           *IN84
     C                   ENDIF
      *
      * test av avvikende periode
      *
     C     W2PMN         IFNE      0
     C                   Z-ADD     20            W2PCC
     C     KODTÅK        CHAIN     KODTÅ                              97
     C     *in97         ifeq      '1'
     C     *in30         andeq     '0'
     C                   Z-ADD     23            LINNBR
     C                   MOVE      'SPP0001'     MSGNR
     C                   Z-ADD     45            POSNBR
     C                   SETON                                        30
     C                   END
     C                   ELSE
     C                   Z-ADD     0             W2PÅR
     C                   END
      *
     C     *IN30         IFEQ      '1'
     C                   GOTO      SLTB2N
     C                   ENDIF
      *
      * NETTOBELØP INNLAGT SOM SKAL FØRES PLIKTIG ? (GENERER BRUTTO)
     C     W2KDPF        IFEQ      '+'
     C                   MOVE      'P'           W2KDPF
     C                   MOVE      FITAXOri      FITAXN
     C                   MULT(H)   FITAXN        W2BLHB
     C                   END
      *_____________________________________________________
      * Update Database and subfile (både ved ny og emdring)
      *"""""""""""""""""""""""""""""""""""""""""""""""""""""
     C                   MOVE      W2KDM         KBKDM
     C   40RECNUM        CHAIN     KOSTBR                             20
     C   40              SUB       KBBLHB        WSBLF
     C  N40              MOVE      *ZEROS        KBBLF
     C                   EXSR      MOVWSK
N22  c     l1dir         ifEQ      '*L1*'
N22  C                   EXSR      MOVWSKL1
N22  C                   END
      *
      *
      *tester om postens periode differerer fra bilagets
      * IN28
      *
     C                   EXSR      TESTPER
      *
     C                   MOVE      KBBLHB        WSBLHB
s07  C*  41              DIV(H)    UVKU          WSBLHB
     C   41              MOVE      UVAL          WSVAL
     C  N41              MOVE      *BLANKS       WSVAL
     C   44KBKDM         IFEQ      1
     C                   DIV(H)    FITAXN        WSBLHB
     C                   END
     C     KBGEBY        COMP      1                                      43
     C                   MOVE      KBAVD         WXAVD
     C                   MOVE      *BLANKS       WXTXT
     C                   MOVE      KBOPD         WXOPD
     C                   MOVE      WSOT          WXOT
     C                   MOVE      WSFR          WXFR
     C                   MOVE      KBNØKK        WXNØKK
     C                   MOVE      WSSK          WXSK
     C   40KBNØKK        IFLT      1
     C     KBNØKK        ORGT      4
     C                   MOVE      W2AVD         KBKAVD
     C                   MOVE      *BLANKS       KBKKEY
     C                   MOVEL     W2OPD         KBKKEY
     C                   MOVE      W2KN          KBKKEY
     C                   END
     C     *IN40         IFEQ      '0'                                          Create
     C                   WRITE     KOSTBR
     C                   Z-ADD     RECNOB        RECNUM
     C                   ADD       1             YRECNO
     C                   Z-ADD     YRECNO        ZRECNO
N10  c                   exsr      testbud
     C                   WRITE     SUBFIL
     C                   ELSE                                                   Update
     C     KBOPD         IFNE      *ZEROS
     C     KBNØKK        ANDEQ     9
     C                   MOVE      1             KBNØKK
     C                   MOVE      '1'           WXNØKK
     C                   END
N07  c                   z-add     w2blhb        kbblhb
     C                   UPDATE    KOSTBR
     C                   IF        UPARM2 = *BLANKS
     C                   UPDATE    SUBFIL
     C                   END
     C                   ENDIF
      *
     C                   EXSR      MOVB2
      *
     C                   ADD       KBBLHB        WSBLF
     C     UBL           ADD       WSBLF         WSBLD
     C     SLTB2N        ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                             TSTBUD //
      *//////////////////////////////////////////////////////////////////////
     C     TSTBUD        BEGSR
      * P I P1FLAG ETTER RUTINA = PLUKKING ER UTFØRT
     C                   MOVE      ' '           P1FLAG
      *
     C     WSOPD         IFNE      *ZEROS                                       B1
      * .... MEN FINNES DET ÅPEN FORVENTET KOSTN PÅ DETTE OPPDRAG...
     C     KOSB9K        CHAIN     KOSBU9                             33
     C     *IN33         IFEQ      *OFF                                          B2
     C                   MOVE      'K'           P1FLAG
     C                   Z-ADD     UBNR          P1BNR
     C                   MOVE      *ZEROS        P1AVD
     C                   MOVE      *ZEROS        P1TUNR
     C                   MOVE      WSAVD         P1OAVD
     C                   MOVE      WSOPD         P1OPD
     C                   MOVE      *BLANKS       P1GN
     C                   MOVE      WSKDPF        P1KDM
      * WSBLFD ER ALLTID I NOK- SEND INN EVT BEL I VALUTA..
     C     WSBLFD        DIV(H)    UVKU          P1BL
     C                   MOVE      P1DS          PARM1           256            *PARM  UT
     C                   CALL      'SYKS12'
     C                   PARM                    PARM1
     C                   MULT(H)   UVKU          P1BL
     C                   MOVE      PARM1         P1DS                           *PARM RETUR
     C                   END                                                     E2
     C                   ELSE                                                   X1
     C     WSPRO         IFNE      *ZEROS                                        B2
      * .... MEN FINNES DET ÅPEN FORVENTET KOSTN PÅ DENNE TUR ......
     C     KOSB2K        CHAIN     KOSBU2                             33
     C     *IN33         IFEQ      *OFF                                           B3
     C                   MOVE      'K'           P1FLAG
     C                   Z-ADD     UBNR          P1BNR
     C                   MOVE      *ZEROS        P1AVD
     C                   MOVE      WSPRO         P1TUNR
     C                   MOVE      *ZEROS        P1OAVD
     C                   MOVE      *ZEROS        P1OPD
     C                   MOVE      *BLANKS       P1GN
     C                   MOVE      WSKDPF        P1KDM
      * WSBLFD ER ALLTID I NOK- SEND INN EVT BEL I VALUTA..
     C     WSBLFD        DIV(H)    UVKU          P1BL
     C                   MOVE      P1DS          PARM1           256            *PARM UT
     C                   CALL      'SYKS12'
     C                   PARM                    PARM1
     C                   MULT(H)   UVKU          P1BL
     C                   MOVE      PARM1         P1DS                           *PARM RETUR
     C                   END                                                      E3
      *
     C                   ELSE                                                    X2
     C     WSGN          IFNE      *BLANKS                                        B3
      * .... MEN FINNES DET ÅPEN FORVENTET KOSTN PÅ DETTE AWB.NR ...
     C                   MOVE      *BLANKS       BUTXT
     C                   MOVEL     WSGN          BUTXT
     C     KOS15K        CHAIN     KOSBU15                            33
     C     *IN33         IFEQ      *ON                                             B4
     C                   MOVE      *BLANKS       BUTXT
     C                   MOVE      *BLANKS       BUTX15
     C     BLANK4        IFEQ      'N'
     C                   MOVEL     WSGN          BUTX15           15
     C                   ELSE
     C                   MOVE      WSGN          BUTX11           11
     C                   MOVEL     BUTX11        BUTX15
     C                   END
     C                   MOVE      BUTX15        BUTX19           19
     C                   MOVEL     'AWB:'        BUTX19
     C                   MOVEL     BUTX19        BUTXT
     C     KOS15K        CHAIN     KOSBU15                            33
     C                   END                                                       E4
     C     *IN33         IFEQ      *OFF                                            B4
     C                   MOVE      'K'           P1FLAG
     C                   Z-ADD     UBNR          P1BNR
     C                   MOVE      *ZEROS        P1AVD
     C                   MOVE      *ZEROS        P1TUNR
     C                   MOVE      *ZEROS        P1OAVD
     C                   MOVE      *ZEROS        P1OPD
     C                   MOVEL     BUTXT         P1GN
     C                   MOVE      WSKDPF        P1KDM
      * WSBLFD ER ALLTID I NOK- SEND INN EVT BEL I VALUTA..
     C     WSBLFD        DIV(H)    UVKU          P1BL
     C                   MOVE      P1DS          PARM1           256            *PARM UT
     C                   CALL      'SYKS12'
     C                   PARM                    PARM1
     C                   MULT(H)   UVKU          P1BL
     C                   MOVE      PARM1         P1DS                           *PARM RETUR
     C                   MOVE      *BLANKS       P1GN
     C                   END                                                       E4
     C                   END                                                      E3
     C                   END                                                     E2
     C                   END                                                    E1
     C                   MOVE      *ZEROS        BUBNR
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                             GETLIN //
      *//////////////////////////////////////////////////////////////////////
     C     GETLIN        BEGSR
      *
     C                   Z-ADD     0             LINNBR
     C                   MOVE      '0'           *IN92
     C                   MOVE      '0'           *IN99
     C                   READC     SUBFIL                                 98
      *
     C     *IN12         DOWEQ     '0'
     C     *IN98         ANDEQ     '0'
      *
     C     ZRECNO        DIV       13            LINNBR
     C                   MVR                     XLIN              2 0
     C     XLIN          IFEQ      0
     C                   Z-ADD     13            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   ENDIF
      *
     C     KBVK          IFNE      '*DL'
     C     WSNR          ANDNE     ' '
      *
     C     *IN39         IFEQ      '0'
     C     KBNØKK        ORLT      2
     C     KBNØKK        ORGT      4
     C  N29WSNR          CASEQ     '2'           CHGKB                          Endre
     C  N29WSNR          CASEQ     '4'           DLTKB                          Slette
     C     WSNR          CASEQ     '5'           SEOPD                          Se oppdrag
     C     WSNR          CASEQ     '6'           SEFAK                          Se faktura
N03  C     WSNR          CASEQ     'V'           SELIN                          Se faktura
N09  C     WSNR          CASEQ     'R'           REKSR                          Se faktura
N14  C     WSNR          CASEQ     'O'           OREKSR                         Se faktura
N09  C     WSNR          CASEQ     'S'           DSPEPO                         Se faktura
N09  C     WSNR          CASEQ     'T'           WRKTT                          Se faktura
     C                   ENDCS
     C                   ELSE
     C     WSNR          IFEQ      '4'
     C                   EXSR      DLTKB2                                       Slette
     C  N12              MOVE      'J'           XNYSTR            1
     C                   ELSE
     C                   MOVE      'JOV1081'     MSGNR
     C                   MOVE      '1'           *IN99
     C                   MOVE      '1'           *IN30
     C                   GOTO      SLGETL
     C                   END
     C                   END
      *
     C                   ENDIF
      *
     C  N12              READC     SUBFIL                                 98
     C  N12
     CANN98              ENDDO
      *
     C     SLGETL        TAG
      *
     C                   Z-ADD     1             LINNBR
     C                   ADD       4             LINNBR
     C                   Z-ADD     2             POSNBR
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      * DELETE RECORD                                                DLTKB //
      *//////////////////////////////////////////////////////////////////////
     C     DLTKB         BEGSR
      *
     C                   MOVE      '1'           *IN99
     C                   MOVE      KBAVD         W2AVD
     C                   MOVE      KBOPD         W2OPD
     C                   MOVE      KBKN          W2KN
     C                   MOVE      KBVK          W2VK
     C                   MOVE      KBKDPF        W2KDPF
     C                   MOVE      *ZEROS        W2BLF
     C                   EXFMT     VAREL3
      *
     C     *IN12         IFEQ      '0'
     C     RECNUM        CHAIN     KOSTBR                             33
     C     *IN33         IFEQ      '0'
     C                   DELETE    KOSTBR
     C                   SUB       KBBLHB        WSBLF
     C     UBL           ADD       WSBLF         WSBLD
     C                   EXSR      MOVB1
     C                   MOVE      ' '           WSNR
     C                   ENDIF
     C                   ENDIF
      *
     C                   MOVE      KBBLHB        WSBLHB
     C   41              DIV(H)    UVKU          WSBLHB
     C   41              MOVE      UVAL          WSVAL
     C  N41              MOVE      *BLANKS       WSVAL
     C   44KBKDM         IFEQ      1
     C                   DIV(H)    FITAXN        WSBLHB
     C                   END
     C     KBGEBY        COMP      1                                      43
     C                   MOVE      '1'           *IN29
     C                   UPDATE    SUBFIL
     C                   MOVE      '0'           *IN29
      *
     C     XLIN          IFEQ      0
     C                   Z-ADD     13            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      * DELETE RECORD (SAMME KONTERINGSNØKKEL)                      DLTKB2 //
      *//////////////////////////////////////////////////////////////////////
     C     DLTKB2        BEGSR
      *
     C     STDKB2        TAG
     C                   EXFMT     BEKREFT
     C   12              GOTO      SLDKB2
     C  N23              GOTO      STDKB2
      *
     C                   MOVE      ' '           WSNR
     C                   UPDATE    SUBFIL
     C                   MOVE      KBVK          WXVK
     C                   MOVE      KBKDM         WXKDM
     C     UBNR          SETLL     KOSTBSLT
     C     UBNR          READE     KOSTBSLT                               33
     C     *IN33         DOWEQ     '0'
     C     KBKAVD        IFEQ      WXAVD
     C     KBKKEY        ANDEQ     WXTXT
     C     KBVK          ANDEQ     WXVK
     C     KBKDM         ANDEQ     WXKDM
     C                   DELETE    KOSBRS
     C                   SUB       KBBLHB        WSBLF
     C                   ELSE
     C                   UPDATE    KOSBRS
     C                   END
     C     UBNR          READE     KOSTBSLT                               33
     C  N33              ENDDO
     C     UBL           ADD       WSBLF         WSBLD
      *
     C     SLDKB2        ENDSR
      ************************************************************************
     C     CHGKB         BEGSR
      ************************************************************************
      *
N22  c     l1dir         ifne      '*L1*'
     C                   EXSR      MOVKWS
N22  C                   ELSE
N22  C                   EXSR      MOVKWSL1
N22  C                   END
     C                   MOVE      '1'           *IN99
      *
     C     STCHG         TAG
      *
N22  c     l1dir         ifne      '*L1*'
     C                   EXFMT     VARELI
N22  C                   else
N22  c                   EXFMT     VARELIL1
N22  C                   END
     C                   MOVE      '0'           *IN30
     C                   MOVEA     '00000000'    *IN(83)
     C                   MOVEA     '00'          *IN(27)
     C     *IN12         IFEQ      '1'
      *
      *tester om postens periode differerer fra bilagets
      * IN28
      *
     C                   EXSR      TESTPER
      *
     C                   MOVE      KBBLHB        WSBLHB
s07  C*  41              DIV(H)    UVKU          WSBLHB
     C   41              MOVE      UVAL          WSVAL
     C   44KBKDM         IFEQ      1
     C                   DIV(H)    FITAXN        WSBLHB
     C                   END
     C  N41              MOVE      *BLANKS       WSVAL
     C     KBGEBY        COMP      1                                      43
     C                   UPDATE    SUBFIL
     C                   EXSR      MOVB2
     C                   ELSE
N22  c     l1dir         ifne      '*L1*'
     C                   EXSR      TESTB2
N22  C                   ELSE
N22  C                   EXSR      TESTB2L1
N22  C                   END
     C     *IN30         CABEQ     '1'           STCHG
     C                   ENDIF
      *
     C     XLIN          IFEQ      0
     C                   Z-ADD     13            LINNBR
     C                   ELSE
     C                   Z-ADD     XLIN          LINNBR
     C                   END
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      * VIEW ORDER                                                   CHGKB //
      *//////////////////////////////////////////////////////////////////////
     C     SEOPD         BEGSR
      *
     C                   MOVE      '1'           *IN99
     C                   MOVE      *ZEROS        DUMFLA            1 0
     C                   CALL      'SYFM21A'
     C                   PARM                    FIFIRM
     C                   PARM                    KBAVD
     C                   PARM                    KBOPD
     C                   PARM                    DUMFLA
      *
     C                   MOVE      ' '           WSNR
      *
      *tester om postens  periode differerer fra bilagets
      * IN28
      *
     C                   EXSR      TESTPER
      *
     C                   MOVE      KBBLHB        WSBLHB
     C   41              DIV(H)    UVKU          WSBLHB
     C   41              MOVE      UVAL          WSVAL
     C  N41              MOVE      *BLANKS       WSVAL
     C   44KBKDM         IFEQ      1
     C                   DIV(H)    FITAXN        WSBLHB
     C                   END
     C     KBGEBY        COMP      1                                      43
     C                   UPDATE    SUBFIL
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      * VIEW Invoice picture                                         CHGKB //
      *//////////////////////////////////////////////////////////////////////
     C     SEFAK         BEGSR
      *
     C                   MOVE      '1'           *IN99
     C                   MOVE      *ZEROS        DUMFLA            1 0
     C                   CALL      'SYFM21B'
     C                   PARM                    FIFIRM
     C                   PARM                    KBAVD
     C                   PARM                    KBOPD
     C                   PARM                    DUMFLA
      *
     C                   MOVE      ' '           WSNR
      *
     C                   EXSR      TESTPER
      *
     C                   MOVE      KBBLHB        WSBLHB
     C   41              DIV(H)    UVKU          WSBLHB
     C   41              MOVE      UVAL          WSVAL
     C  N41              MOVE      *BLANKS       WSVAL
     C   44KBKDM         IFEQ      1
     C                   DIV(H)    FITAXN        WSBLHB
     C                   END
     C     KBGEBY        COMP      1                                      43
     C                   UPDATE    SUBFIL
      *
     C                   ENDSR
N03   *//////////////////////////////////////////////////////////////////////
N03   * VIEW linjedetaljer                                           SELIN //
N03   *//////////////////////////////////////////////////////////////////////
N03  C     SELIN         BEGSR
N03   *
N16  C                   EXSR      TESTPER
N03  C                   MOVE      ' '           WSNR
N03  C                   UPDATE    SUBFIL
N03   *
N03  c     KUND1KB       CHAIN     cundl01                            33
N03  c   33              eval      knavn='* NN *'
N03  C                   WRITE     SUBCTL
N03  c                   EXFMT     VISLIN
N03   *
N03  C                   ENDSR
n09   ***********************************************
n09  C     REKSR         BEGSR
n09   ***********************************************
N09  C                   MOVE      *BLANKS       FSSOK
N09  C     FRIKEY0       CHAIN     FRISOK                             20
n09  c                   move      'R'           ukode
n09  c                   move      kbavd         epavd             4 0
n09  c                   move      kbopd         epopd             7 0
n19  c                   move      kbavd         kbavda            4
n19  c                   move      kbopd         kbopda            7
n19  C                   eval      EMNE = 'Faktura:'
n19  C     EMNE          CAT       KAFNR:1       EMNE             80
n19  C     EMNE          CAT       'Sndnr:':1    EMNE
n19  C     EMNE          CAT       FSSOK:1       EMNE
n19  C     EMNE          CAT       'Vår ref:':1  EMNE
n19  C     EMNE          CAT       KBAVDA:1      EMNE
n19  C     EMNE          CAT       '/':0         EMNE
n19  C     EMNE          CAT       KBOPDA:0      EMNE
n09  C                   CALL      'ARC045'
n09  C                   PARM                    epAVD
n09  C                   PARM                    epOPD
n09  c                   parm                    levkun
n09  C                   PARM                    UKODE             1
N19  C                   PARM                    EMNE             80
n09  C
      * hvis epost sendt oppdater
n09  C     ukode         ifeq      'S'
n09  C     RECNUM        CHAIN     KOSTBR                             20
n09  c                   move      'RS'          KBREKL
n09  c                   update    kostbr
n09  c                   end
N16  C                   EXSR      TESTPER
N16  C     KBGEBY        COMP      1                                      43
N09  C                   MOVE      ' '           WSNR
n09  C                   UPDATE    SUBFIL
n09  C                   endsr
n14   ***********************************************
n14  C     OREKSR        BEGSR
n14   ***********************************************
n14   * hvis epost sendt oppdater
n14  C     RECNUM        CHAIN     KOSTBR                             20
n14  c                   move      'RO'          KBREKL
n14  c                   update    kostbr
N16  C                   EXSR      TESTPER
N16  C     KBGEBY        COMP      1                                      43
N14  C                   MOVE      ' '           WSNR
n14  C                   UPDATE    SUBFIL
n14  c                   exsr      ttsr
n14  C                   endsr
n14   *
n09   ***********************************************
n09  C     DSPEPO        BEGSR
n09   ***********************************************
n09  C     HEADKK        CHAIN     ARKLOGH4                           33
n09  C  N33              DO
n09  C                   CALL      'ARC012'
n09  c                   PARM                    epavd
n09  C                   PARM                    epopd
n09  C                   END
N16  C                   EXSR      TESTPER
N16  C     KBGEBY        COMP      1                                      43
N09  C                   MOVE      ' '           WSNR
n09  C                   UPDATE    SUBFIL
n09   *
n09  C                   ENDSR
n09   *
n09   ***********************************************
n09  C     WRKTT         BEGSR
n09   ***********************************************
n09   *
n09  C                   Z-ADD     1             UFLAGG
n09  C                   z-add     0             UTTUR             8 0
n09  C                   CALL      'SYTT01CL'
n09  C                   PARM                    KBAVD
n09  C                   PARM                    KBOPD
N09  C                   PARM                    UTTUR
n09  C                   PARM                    UFLAGG
N16  C                   EXSR      TESTPER
N16  C     KBGEBY        COMP      1                                      43
N09  C                   MOVE      ' '           WSNR
n09  C                   UPDATE    SUBFIL
n09   *
n09  C                   ENDSR
      *
      *//////////////////////////////////////////////////////////////////////
      *                                                             HENBUD //
      *//////////////////////////////////////////////////////////////////////
     C     HENBUD        BEGSR
      *
      * FORESLÅ BASERT PÅ BUDSJETTBILAG ????
      * VED MANGE - HENT NESTE TIL FØRING - EOF -> START PÅ  NY
      *
      *ER BELØP SOM FORESLÅS BASERT PÅ BUDSJ.POST....
     C                   MOVE      'N'           SISBUD            1
     C                   MOVE      *BLANKS       BUVK
     C                   MOVE      *ZEROS        BUOAVD
     C                   MOVE      *ZEROS        BUOPD
     C                   MOVE      *ZEROS        BUTAVD
     C                   MOVE      *ZEROS        BUTUNR
     C                   Z-ADD     WSBLD         WSBLFD
     C                   MOVE      *BLANKS       BUBLST
     C                   MOVE      *ZEROS        WSPROS
      * 96 ON= FLAGG TIL SKJERMBILDE OM AT HENFØRING ER VIA BUD.POST
     C                   MOVE      '0'           *IN96
     C     UBNR          SETLL     KOSBU5
     C     STHEBU        TAG
     C     UBNR          READE     KOSBU5                                 33
     C     *IN33         IFEQ      '0'
      *
     C                   MOVE      ' '           WSKDPF
     C     BUKDM         IFEQ      'J'
     C     BUKDM         OREQ      'Y'
     C                   MOVE      '+'           WSKDPF
     C                   ELSE
     C     BUKDM         IFEQ      'N'
     C                   MOVE      'F'           WSKDPF
     C                   ELSE
     C     BUKDM         IFEQ      ' '
     C                   MOVE      UPF           WSKDPF
     C                   END
     C                   END
     C                   END
     C     BUBL          IFEQ      BUBLFD
     C                   GOTO      STHEBU
     C                   ELSE
     C                   MOVE      'J'           SISBUD
     C                   MOVE      *ON           *IN96
     C     BUBL          SUB       BUBLFD        WSBLFD
     C                   Z-SUB     WSBLFD        WSBLFD
     C                   MULT      UVKU          WSBLFD
     C                   END
      *
     C                   ENDIF
      *
     C     *IN96         IFEQ      '0'
     C                   MOVE      *ZEROS        BUBNR
     C                   ELSE
      *
     C*
     C                   MOVE      BUVK          WSVK
     C     BUOPD         IFNE      *ZEROS
     C                   MOVE      BUOAVD        WSAVD
     C                   MOVE      BUOPD         WSOPD
     C                   ELSE
     C                   MOVE      BUTUNR        WSPRO
     C                   END
      * BELASTES KUNDE HVIS IKKE INNTEKT FINNES FRA FØR....
     C     BUBLST        IFEQ      'K'
     C                   Z-ADD     100           WSPROS
     C                   ENDIF
      * BELASTES KUNDE UBETINGET(SELV OM INNTEKT FINNES FRA FØR)....
     C     BUBLST        IFEQ      'U'
     C                   Z-ADD     999.99        WSPROS
     C                   ENDIF
     C                   END
      *
     C     UTHBUD        ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                              MOVB1 //
      *//////////////////////////////////////////////////////////////////////
     C     MOVB1         BEGSR
      *
     C                   MOVE      *ZEROS        RECNUM
     C                   MOVE      *ZEROS        KBAVD
     C                   MOVE      *ZEROS        KBOPD
     C                   MOVE      *ZEROS        KBKN
     C                   MOVE      '*DL'         KBVK
     C                   MOVE      ' '           KBKDPF
     C                   MOVE      *ZEROS        KBBLHB
     C                   MOVE      *ZEROS        KBKDM
     C                   MOVE      *BLANKS       KBBILT
     C                   MOVE      *zeros        KBPMN
     C                   MOVE      *zeros        KBPÅR
     C                   MOVE      *zeros        KBPCC
     C                   MOVE      *ZEROS        KBBLF
     C                   MOVE      ' '           KBKDMV
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                              MOVB2 //
      *//////////////////////////////////////////////////////////////////////
     C     MOVB2         BEGSR
      *
     C                   MOVE      '0'           *IN40
     C                   MOVE      *ZEROS        W2AVD
     C                   MOVE      *ZEROS        W2OPD
     C                   MOVE      *ZEROS        W2KN
     C                   MOVE      UVK           W2VK
     C                   MOVE      UPF           W2KDPF
     C                   MOVE      *ZEROS        W2BLHB
     C                   MOVE      ' '           W2KDM
     C                   MOVE      *BLANKS       W2BILT
     C                   MOVE      *zeros        W2PMN
     C                   MOVE      *zeros        W2PÅR
     C                   MOVE      *ZEROS        W2BLF
     C                   MOVE      ' '           W2KDMV
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                             MOVBFD //
      *//////////////////////////////////////////////////////////////////////
     C     MOVBFD        BEGSR
      *
      * Diff er mindre enn 0.1 - legg rest til siste post
      *
     C     WSBLD         IFNE      *ZEROS
     C     WSBLD         ANDLT     0.10
     C     WSBLD         ANDGT     -0.10
     C     YRECNO        ANDGT     0
     C     YRECNO        CHAIN     SUBFIL                             20
     C     RECNUM        CHAIN     KOSTBR                             20
     C                   SUB       KBBLHB        WSBLF
     C     KBBLHB        SUB       WSBLD         KBBLHB
     C                   UPDATE    KOSTBR
     C                   MOVE      KBBLHB        WSBLHB
     C   41              DIV(H)    UVKU          WSBLHB
     C   41              MOVE      UVAL          WSVAL
     C  N41              MOVE      *BLANKS       WSVAL
     C   44KBKDM         IFEQ      1
     C                   DIV(H)    FITAXN        WSBLHB
     C                   END
     C     KBGEBY        COMP      1                                      43
     C                   UPDATE    SUBFIL
     C                   ADD       KBBLHB        WSBLF
     C     UBL           ADD       WSBLF         WSBLD
     C                   END
      *
     C                   MOVE      WSBLD         WSBLFD
     C     UVK           IFNE      *BLANKS
     C                   MOVE      UVK           WSVK
     C                   END
     C                   MOVE      UPF           WSKDPF
     C                   MOVE      ' '           WSKDM
     C                   MOVE      WSAVD         XXAVD
     C                   MOVE      WSOPD         XXOPD
     C                   MOVE      WSPRO         XXPRO
     C                   MOVE      *ZEROS        WSAVD
     C                   MOVE      *ZEROS        WSOPD
     C                   MOVE      *ZEROS        WSPRO
     C                   MOVE      *ZEROS        WSPROS
     C                   MOVE      *BLANKS       WSGN
     C                   MOVE      ' '           WSKDMV
     C                   MOVE      *ZEROS        WSPÅR
     C                   MOVE      *ZEROS        WSPMN
      * INCL/OMIT BEHOLDES INNEN SAMME BILAG
      *
     C     WSBLFD        IFNE      0
     C                   EXSR      HENBUD
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   END
      *
     C                   ENDSR
      ************************************************************************
     C     MOVKWS        BEGSR
      ************************************************************************
      *
     C                   MOVE      KBAVD         W2AVD
     C                   MOVE      KBOPD         W2OPD
     C                   MOVE      KBKN          W2KN
     C                   MOVE      KBVK          W2VK
     C                   MOVE      KBKDPF        W2KDPF
     C                   MOVE      KBBLHB        W2BLHB
n07  C**   W2BLHB        DIV       -1            W2BLHB
n07  C     W2BLHB        DIV(H)    UVKU          W2BLHB
     C                   MOVE      KBKDM         W2KDM
     C                   MOVE      KBBILT        W2BILT
     C                   MOVE      KBPMN         W2PMN
     C                   MOVE      KBPÅR         W2PÅR
     C                   MOVE      KBBLF         W2BLF
     C                   MOVE      '1'           *IN40
s07  C*                  Z-ADD     22            LINNBR
n07  C                   Z-ADD     21            LINNBR
     C     W2AVD         IFEQ      *ZEROS
     C                   Z-ADD     10            POSNBR                           AVD/OPD
     C                   ELSE
     C                   Z-ADD     40            POSNBR                           BELØP
     C                   END
      *
     C                   ENDSR
N22   ************************************************************************
N22  C     MOVKWSL1      BEGSR
N22   ************************************************************************
N22   *
N22  C                   MOVE      kbrefcko      WNKONT
N22  C                   MOVE      kbrefcav      WNAVD
N22  C                   MOVE      kbrefcba      WNBAR
N22  C                   MOVE      kbrefcpr      WNPRO
N22  C                   MOVE      KBKDPF        W2KDPF
N22  C                   MOVE      KBBLHB        W2BLHB
N22  C     W2BLHB        DIV(H)    UVKU          W2BLHB
N22  C                   MOVE      KBKDM         W2KDM
N22  C                   MOVE      KBBILT        W2BILT
N22  C                   MOVE      KBPMN         W2PMN
N22  C                   MOVE      KBPÅR         W2PÅR
N22  C                   MOVE      KBBLF         W2BLF
N22  C                   MOVE      '1'           *IN40
N22  C                   Z-ADD     21            LINNBR
N22  C                   Z-ADD     9             POSNBR
N22   *
N22  C                   ENDSR
      ***********************************************************************
     C     MOVWSK        BEGSR
      ***********************************************************************
      *
     C                   MOVE      RECNOB        RECNUM
     C                   MOVE      UBNR          KBBNR
     C                   MOVE      W2AVD         KBAVD
     C                   MOVE      W2OPD         KBOPD
     C                   MOVE      W2KN          KBKN
     C                   MOVE      W2VK          KBVK
     C                   MOVE      W2KDPF        KBKDPF
     C                   MOVE      W2BLHB        KBBLHB
n07  C**   W2BLHB        MULT      -1            W2BLHB
n07  C     W2BLHB        MULT(H)   UVKU          W2BLHB
     C                   MOVE      W2KDM         KBKDM
     C                   MOVE      W2BILT        KBBILT
     C                   MOVE      W2PMN         KBPMN
     C                   MOVE      W2PÅR         KBPÅR
     C     KBPÅR         ifne      0
     C                   Z-ADD     20            KBPCC
     C                   ELSE
     C                   Z-ADD     0             KBPCC
     C                   END
     C                   MOVE      W2BLF         KBBLF
     C                   MOVE      W2KDMV        KBKDMV
     C                   ENDSR
      ***********************************************************************
N22  C     MOVWSKL1      BEGSR
N22   ***********************************************************************
N22  c                   move      '*K*'         fastko
N22  c                   move      '*A*'         fastav
N22  c                   move      '*B*'         fastba
N22  c                   move      '*P*'         fastpr
N22  C                   MOVE      WNKONT        kbrefcko
N22  C                   MOVE      WNAVD         kbrefcav
N22  C                   MOVE      WNBAR         kbrefcba
N22  C                   MOVE      WNPRO         kbrefcpr
N22  C                   ENDSR
      *************************************************************************
     C     FORDEL        BEGSR
      *************************************************************************
      *
      * UFLAGG = 7/9 BETYR DET AT VARSEL ER GITT OM IKKE NOK INNT.
      *
     C     *IN09         IFEQ      '1'
     C     UFLAGG        ANDNE     9
     C                   Z-ADD     1             UFLAGG
     C                   ENDIF
     C     *IN11         IFEQ      '1'
     C     UFLAGG        ANDNE     7
     C                   Z-ADD     2             UFLAGG
     C                   ENDIF
     C     *IN23         IFEQ      '1'
     C                   Z-ADD     3             UFLAGG
     C                   ENDIF
      *** UFLAGG = 1  -->  FORDELER ETTER GEBYRKODE
      *** UFLAGG = 2  -->  FORDELER ETTER VEKT
      *** UFLAGG = 3  -->  INGEN FORDELING (EN LINJE MED 0/0 AVD OPD)
      *
     C                   MOVE      WSKDMV        UKDMV             1
     C                   MOVE      WSKDM         UKDM              1 0
     C                   MOVE      UIODS         UIO              24
      *
      * HVIS VIA TURNR, HJELPEFLAGG FOR "*AVRDIR*" I GN.(=TRAN-TURKOST)
     C     WSPRO         IFNE      *ZEROS
     C     BUBNR         ANDNE     *ZEROS
     C     BUBNR         CHAIN(N)  KOSBU                              33
     C     *IN33         IFEQ      '0'
     C                   MOVEL     BUTXT         BUTXTT            8
     C     BUTXTT        IFEQ      '* TUR * '
     C                   MOVEL     '*TURAVR'     WSGN
     C                   END
     C                   END
     C                   END
      *
     C*                  dump
      *
     C                   CALL      'SYKS04'
     C                   PARM                    UBNR
     C                   PARM                    WSAVD
     C                   PARM                    WSOPD
     C                   PARM                    WSPRO
     C                   PARM                    WSGN
     C                   PARM                    WSPROS
     C                   PARM                    WSBLFD
     C                   PARM                    WSVK
     C                   PARM                    WSKDPF
     C                   PARM                    WSBILT
     C                   PARM                    UKDM
     C                   PARM                    UKDMV
     C                   PARM                    UBDT
     C                   PARM                    UFLAGG
     C                   PARM                    UIO
      *
     C     UFLAGG        IFEQ      9
     C     UFLAGG        OREQ      7
     C     UFLAGG        OREQ      -9
     C     UFLAGG        IFEQ      9
     C                   MOVE      'SPF0039'     MSGNR
     C                   ELSE
     C     UFLAGG        IFEQ      7
     C                   MOVE      'JOV0247'     MSGNR
     C                   ELSE
     C                   MOVE      'DIV4226'     MSGNR
     C                   Z-ADD     7             UFLAGG
     C                   END
     C                   END
     C                   Z-ADD     19            LINNBR
     C                   Z-ADD     18            POSNBR
     C                   MOVE      '1'           *IN30
     C                   ELSE
     C     BUBNR         CHAIN     KOSBU                              33
     C     *IN33         IFEQ      '0'
      *
      *
      * SETT STAUS F PÅ BUDSJ.POSTEN/OPPDATER TURSTATUS M.M.
      *(MEN KUN VED 1. DELBELØP AV EVT FLERE SPLITTEDE FØRINGER)
     C     BUBLFD        IFEQ      0
     C                   EXSR      OPBUST
     C                   ENDIF
      *
     C     WSBLFD        DIV(H)    UVKU          XBLFD            13 2
     C                   Z-SUB     XBLFD         XBLFD
      * BRUK NETTO I BELØP FORDELT...
     C     WSKDPF        IFEQ      'P'
     C                   DIV(H)    FITAXN        XBLFD
     C                   END
     C                   ADD       XBLFD         BUBLFD
     C     BUBL          SUB       BUBLFD        XBLFD
     C     XBLFD         IFLT      0
     C                   MULT      -1            XBLFD
     C                   MOVE      '1'           *IN33
     C                   ENDIF
      *
     C     XBLFD         IFLT      1
     C     *IN33         IFEQ      '0'
     C                   MULT      -1            XBLFD
     C                   ENDIF
     C                   MULT      UVKU          XBLFD
     C                   ADD       XBLFD         WSBLFD
     C                   Z-ADD     BUBL          BUBLFD
     C                   ENDIF
      *
     C                   UPDATE    KOSBUR
     C                   ENDIF
     C                   ENDIF
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                             OPBUST //
      *//////////////////////////////////////////////////////////////////////
     C     OPBUST        BEGSR
      *
     C     TUREOP        IFNE      '1'
     C                   OPEN      TURER
     C                   END
      *
     C     TRAVOP        IFNE      '1'
     C                   OPEN      TRAVH1
     C                   END
      *
     C                   MOVE      'F'           BUST
      *
     C     BUFER         IFEQ      'T'
     C                   MOVEL     '*AVRDIR*'    BUTXT
      *
     C     TURERK        CHAIN     TURER                              33
     C     *IN33         IFEQ      '0'
     C                   MOVE      BUTYPE        TUTAKO
     C                   MOVE      BUVAL         TUTVAL
     C                   Z-ADD     BUBL          TUTBEL
     C                   MOVE      'X'           TUAVRE
     C                   UPDATE    TURERR
     C                   ENDIF
      *
     C     TURERK        CHAIN     TRAVH1                             33
     C     *IN33         IFEQ      '0'
     C                   MOVE      'A'           THST
     C                   UPDATE    TRAVHR
     C                   ENDIF
      *
     C                   ENDIF
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                       OMRBL1 //
      *//////////////////////////////////////////////////////////////////////
     C     OMRBL1        BEGSR
      *
      * ETTER  INNFØRING AV PLUKKING FRA BUDSJETT ER DET IKKE LENGER SLIK
      * AT DERSOM REST=INNG.BELØP SÅ SKAL ALT TIL FORDELING
     C                   MULT      -1            WSBLFD
     C                   DIV(H)    UVKU          WSBLFD
     C     WSBLD         IFEQ      0
     C                   MOVE      '1'           *IN95
     C                   ELSE
     C                   MOVE      '0'           *IN95
     C                   END
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                       OMRBL2 //
      *//////////////////////////////////////////////////////////////////////
     C     OMRBL2        BEGSR
      *
     C     WSBLFD        MULT      -1            WSBLFD
     C     WSBLFD        MULT(H)   UVKU          WSBLFD
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                             SØKKUN //
      *//////////////////////////////////////////////////////////////////////
     C     SØKKUN        BEGSR
      *
     C                   MOVE      *BLANKS       USØKKN           30
     C                   CALL      'SOEKKUN'
     C                   PARM                    W2KN
     C                   PARM                    UFIRM
     C                   PARM                    USØKKN           30
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                             SØKDTA //
      *//////////////////////////////////////////////////////////////////////
     C     SØKDTA        BEGSR
      *
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
      *
     C                   Z-ADD     1             UFLAGG
     C     LINNBR        IFEQ      19
     C     POSNBR        ANDGE     40
     C     POSNBR        ANDLE     42
     C                   MOVE      'XXK'         UUVK
N21  C     KON           IFEQ      *ZEROS
     C                   CALL      'SYFI10D'
     C                   PARM                    UUVK              3
N21  C                   ELSE
N21  C                   CALL      'SYNA05'
N21  C                   PARM                    KALNR
N21  C                   PARM                    UUVK              3
N21  C                   END
     C                   Z-ADD     19            LINNBR
S21  C*                  Z-ADD     50            POSNBR
N21  C                   Z-ADD     48            POSNBR
     C     UUVK          IFNE      'XXK'
     C                   MOVE      UUVK          WSVK
     C                   END
     C                   GOTO      SLSØK
     C                   END
      *
     C     LINNBR        IFEQ      21
     C                   MOVE      'J'           USPED             1
     C     POSNBR        IFGE      29
     C     POSNBR        ANDLE     31
     C                   CALL      'SYFI10G'
     C                   PARM                    WSFR01
     C                   PARM                    USPED
     C                   Z-ADD     33            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     POSNBR        IFGE      33
     C     POSNBR        ANDLE     35
     C                   CALL      'SYFI10G'
     C                   PARM                    WSFR02
     C                   PARM                    USPED
     C                   Z-ADD     37            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     POSNBR        IFGE      37
     C     POSNBR        ANDLE     39
     C                   CALL      'SYFI10G'
     C                   PARM                    WSFR03
     C                   PARM                    USPED
     C                   Z-ADD     47            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     POSNBR        IFGE      54
     C     POSNBR        ANDLE     55
     C                   CALL      'SYFI10C'
     C                   PARM                    WSOT01
     C                   Z-ADD     57            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     POSNBR        IFGE      57
     C     POSNBR        ANDLE     58
     C                   CALL      'SYFI10C'
     C                   PARM                    WSOT02
     C                   Z-ADD     60            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C     POSNBR        IFGE      60
     C     POSNBR        ANDLE     61
     C                   CALL      'SYFI10C'
     C                   PARM                    WSOT03
     C                   Z-ADD     70            POSNBR
     C                   GOTO      SLSØK
     C                   END
     C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   MOVE      '1'           *IN30
      *
     C     SLSØK         ENDSR
      *//////////////////////////////////////////////////////////////////////
      *                                                             SØKDT2 //
      *//////////////////////////////////////////////////////////////////////
     C     SØKDT2        BEGSR
      *
     C                   Z-ADD     1             UFLAGG
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     22
     C     POSNBR        ANDLE     29
     C                   EXSR      SØKKUN
     C                   Z-ADD     31            POSNBR
     C                   GOTO      SLSØK2
     C                   END
      *
     C     LINNBR        IFEQ      22
     C     POSNBR        ANDGE     31
     C     POSNBR        ANDLE     33
     C                   MOVE      'XXK'         UUVK              3
     C                   CALL      'SYFI10D'
     C                   PARM                    UUVK
     C     UUVK          IFNE      'XXK'
     C                   MOVE      UUVK          W2VK
     C                   END
     C                   Z-ADD     37            POSNBR
     C                   GOTO      SLSØK2
     C                   END
      *
     C                   MOVE      'DIV1037'     MSGNR
     C                   MOVE      '1'           *IN30
      *
     C     SLSØK2        ENDSR
      *
      *******************************************************************************
     C     INIT          BEGSR
      *******************************************************************************
      *
     C     KODTÅK        KLIST
     C                   KFLD                    YÅUNI
     C                   KFLD                    W2PCC             2 0
     C                   KFLD                    W2PÅR
     C                   KFLD                    W2PMN
     C     KODTÅK2       KLIST
     C                   KFLD                    YÅUNI
     C                   KFLD                    WSPCC             2 0
     C                   KFLD                    WSPÅR
     C                   KFLD                    WSPMN
     C     KODTÅK3       KLIST
     C                   KFLD                    YÅUNI
     C                   KFLD                    U1PCC             2 0
     C                   KFLD                    U1PÅR
     C                   KFLD                    U1PMN
     C     FRIKEY        KLIST
     C                   KFLD                    FSKODE
     C
     C                   MOVE      'IFB'         FSKODE
     C     FRIKEY0       KLIST
     C                   KFLD                    KBAVD
     C                   KFLD                    KBOPD
     C                   KFLD                    FSKODE
     C                   MOVE      'IFB'         FSKODE
     C     KOSTBK        KLIST
     C                   KFLD                    UBNR
     C                   KFLD                    YAVD              4 0
     C                   KFLD                    YOPD              7 0
     C                   KFLD                    YKN               8 0
     C     KODTAK        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    WSAVD
     C     KODTA2        KLIST
     C                   KFLD                    YAUNI
     C                   KFLD                    W2AVD
     C     KODGEK        KLIST
     C                   KFLD                    YGEUNI
     C                   KFLD                    YVK
     C     KODG2K        KLIST
     C                   KFLD                    YG2UNI
     C                   KFLD                    YVK
     C     HEAFK2        KLIST
     C                   KFLD                    W2AVD
     C                   KFLD                    W2OPD
     C     HEADFK        KLIST
     C                   KFLD                    WSAVD
     C                   KFLD                    WSOPD
N18  C     KODTVK        KLIST
N18  C                   KFLD                    KOVUNI
N18  C                   KFLD                    WSAVD
N18  C                   MOVE      'V'           KOVUNI
     C     HEADKK        KLIST
     C                   KFLD                    KBAVD
     C                   KFLD                    KBOPD
N10  C     TRACKK        KLIST
N10  C                   KFLD                    KBAVD
N10  C                   KFLD                    KBOPD
s14  C*                  KFLD                    TTACTI
s14  c*                  move      'INC'         TTACTI
s14  C                   KFLD                    TTACT3
s14  c                   move      'INC'         TTACT3            3
N10  C                   move      *zeros        vekt01
N11  C                   move      *zeros        wsnt
N10  C                   move      *zeros        vekt02
     C     HEA11K        KLIST
     C                   KFLD                    WSPRO
     C     KUND1K        KLIST
     C                   KFLD                    UFIRM
     C                   KFLD                    W2KN
N03  C     KUND1KB       KLIST
N03  C                   KFLD                    UFIRM
N03  C                   KFLD                    KBKN
     C     TURERK        KLIST
     C                   KFLD                    BUTAVD
     C                   KFLD                    BUTUNR
     C     KOSB2K        KLIST
     C                   KFLD                    YYST
     C                   KFLD                    WSPRO
     C     KOSB9K        KLIST
     C                   KFLD                    YYST
     C                   KFLD                    WSAVD
     C                   KFLD                    WSOPD
     C     KOS15K        KLIST
     C                   KFLD                    YYST
     C                   KFLD                    BUTXT
     C                   MOVE      ' '           YYST              1
N05  C     LEVEK         KLIST
N05  C                   KFLD                    UFIRM
N05  C                   KFLD                    KALNR
N05  C     KOSTAK        KLIST
N05  C                   KFLD                    KABNR
      * OBS! PARAMETER UBNR="INNREGISTRERINGSNR"(UNIKT LØPENR)
      *      PARAMETER UBNR2="ENDELIG BILAGSNR" (TIL ØKONOMI)
     C     *ENTRY        PLIST
     C                   PARM                    UFIRM             2
     C                   PARM                    UBNR              7 0
     C                   PARM                    UBDT              6 0
     C                   PARM                    UPÅR              2 0
     C                   PARM                    UPMN              2 0
     C                   PARM                    UVK               3
     C                   PARM                    UVAL              3
     C                   PARM                    UVKU             10 7
     C                   PARM                    UBLFD            13 2
     C                   PARM                    UBLM             13 2
     C                   PARM                    ULNR              8 0
     C                   PARM                    UBL              13 2
     C                   PARM                    UPF               1
     C                   PARM                    UBNR2             7 0
     C                   PARM                    UFLAGG            1 0
     C                   PARM                    UPARM2          512
     C                   MOVE      *ZEROS        KBPER
     C                   IF        UPARM2 = *BLANKS
     C                   MOVE      'K'           YÅUNI             1
     C                   ELSE
     C                   MOVE      'W'           YÅUNI             1
     C                   END
N05  c                   move      ubnr          kabnr
N05  c     kostak        chain     kosta                              33
N22  c  N33              move      katxt         l1dir             4
N05  c  N33LEVEK         chain     level01                            33
N09  c  N33              move      kundnr        levkun            8 0
N21  C                   MOVE      *ZEROS        KON
N21  c     LEVEK         chain     NAVLEV                             33
      *
     C     UPÅR          IFGT      50
     C     UPÅR          ADD       1900          UPÅR4             4 0
     C                   ELSE
     C     UPÅR          ADD       2000          UPÅR4
     C                   END
     C     UFLAGG        IFEQ      5
     C                   MOVE      '1'           *IN29
     C                   ENDIF
     C                   MOVE      *ZEROS        UFLAGG
     C                   MOVE      *ZEROS        HEDTOP
     C                   MOVE      *ZEROS        UIODS                          *INC/OM.FELT
     C                   MOVE      *BLANKS       UIODS20                        *INC/OM.FELT
     C     UBNR          SETLL     KOSBU5
     C                   MOVE      ' '           YTYP              1
     C                   MOVE      'A'           YAUNI             1
     C                   MOVE      'GE'          YGEUNI            2
     C                   MOVE      'G2'          YG2UNI            2
     C                   MOVE      *BLANKS       YVK               3
     c                   move      'N'           EDIMATCH          1
     C     *LIKE         DEFINE    WSAVD         XXAVD
     C     *LIKE         DEFINE    WSOPD         XXOPD
     C     *LIKE         DEFINE    WSPRO         XXPRO
     C     *LIKE         DEFINE    WBBLF         WSBLF
     C     *LIKE         DEFINE    WBBLD         WSBLD
      *
     C                   MOVE      UBNR2         WSBNR2
NV5  C     UBDT          IFGT      501231
NV5  C     UBDT          ADD       19000000      UBDT8             8 0
NV5  C                   ELSE
NV5  C     UBDT          ADD       20000000      UBDT8
NV5  C                   END
     C                   MOVE      UBDT          WSBDT
     C                   MOVEL     UBDT          WSBDTÅ
     C                   MOVE      UBDT          WSBDTD
     C                   MOVE      WSBDTD        UDT1              2 0
     C                   MOVE      WSBDTM        UDT2              2 0
     C                   MOVE      WSBDTÅ        UDT3              2 0
     C                   EXSR      KDTFMT
     C                   MOVE      UDT1          WSBDTD
     C                   MOVE      UDT2          WSBDTM
     C                   MOVE      UDT3          WSBDTÅ
      *
     c                   read      firmkos                                33
     c     tillat        comp      'J'                                5050
     C                   READ      FIRM                                   33
     C*
     C     FITAXD        IFNE      *ZEROS
     C     FITAX2        ANDNE     *ZEROS
SV5  C*          UBDT      ANDLTFITAXD
NV5  C     UBDT8         ANDLT     FITAXD
     C                   MOVE      FITAX2        FITAX
     C                   END
     C     FITAX         ADD       1             FITAXN            5 4
     C                   Move      FITAXN        FITAXORI          5 4
     C* 42 ON: VALUTA/NOK-SWITCH TILLATT - 41 ON: FREMMED ER DEFAULT
     C     FICURR        COMP      UVAL                               4242
     C     FICURR        COMP      UVAL                               4141
     C* 45 ON:(NOK) BRUTTO/NETTO-SWITCH TILLATT 44 OFF:BRUTTO er dft.
     C     *IN42         IFEQ      *OFF
     C     UPF           ANDNE     'F'
     C                   MOVEA     '01'          *IN(44)
     C                   ELSE
     C                   MOVEA     '00'          *IN(44)
     C                   END
      *
     C                   Z-ADD     1024          UCMDL            15 5
     C                   EVAL      UCMD = XCMD11
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   OPEN      KOSTBVIS
     C                   EVAL      UCMD = XCMD12
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   OPEN      KOSTBSLT
     C                   IF        UPARM2 <> *BLANKS
     C                   EXSR      SRWEB
     C                   MOVE      *ON           *INLR
     C                   RETURN
     C                   END
      *
      * HENT/VIS DE 3 FØRSTE F-TASTENE (+F24)
     C                   EXSR      CMD24
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      * CHANGES DATE-FORMAT FROM FIRM TO INTERNAL                   KDTFMT //
      *//////////////////////////////////////////////////////////////////////
     C     KDTFMT        BEGSR
      *
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
      *
     C                   ENDSR
      *//////////////////////////////////////////////////////////////////////
      * INPUT ER FRA WEB-PROGRAM (ESKS02)                            SRWEB //
      *//////////////////////////////////////////////////////////////////////
     C     SRWEB         BEGSR
      *
     C                   EVAL      UPARM1 = UPARM2
     C                   SELECT
     C                   WHEN      U13FM    = 'J'
     C                   EXSR      SRWEB3
     C                   WHEN      U12ENDRE = 'N'
     C                   EXSR      SRWEB1
     C                   OTHER
     C                   EXSR      SRWEB2
     C                   ENDSL
      *
     C                   EVAL      UPARM2 = UPARM1
      *
     C                   CLOSE     KOSTBVIS
     C                   CLOSE     KOSTBSLT
      *
     C                   ENDSR
      *
      ************************************************************************
     C     SRWEB1        BEGSR
      ************************************************************************
      *
S15  C*                  EVAL      WSBLFD = U1BL
N15  C                   EVAL      WSBLFD = U12BLHB
S15  C*                  EVAL      WSVK   = U1VK
N15  C                   EVAL      WSVK   = U12VK
s15  C*                  EVAL      WSKDPF = U1KDPF
n15  C                   EVAL      WSKDPF = U12KDPF
s15  C*                  EVAL      WSKDM  = U1KDM
n15  C                   EVAL      WSKDM  = U12KDM
xxxx C*                  EVAL      WSPROS = U1PROS
s15  C*                  EVAL      WSKDMV = U1KDMV
n15  C                   EVAL      WSKDMV = U12KDMV
s15  C*                  EVAL      WSAVD  = U1AVD
n15  C                   EVAL      WSAVD  = U12AVD
s15  C*                  EVAL      WSOPD  = U1OPD
n15  C                   EVAL      WSOPD  = U12OPD
xxxx C*                  EVAL      WSPRO  = U1PRO
xxxx C*                  EVAL      WSGN17 = U1GN17
s15  C*                  EVAL      WSBILT = U1BILT
n15  C                   EVAL      WSBILT = U12BILT
     C                   EVAL      WSFRIO = U1FRIO
     C                   EVAL      WSFR01 = U1FR01
     C                   EVAL      WSFR02 = U1FR02
     C                   EVAL      WSFR03 = U1FR03
     C                   EVAL      WSOTIO = U1OTIO
     C                   EVAL      WSOT01 = U1OT01
     C                   EVAL      WSOT02 = U1OT02
     C                   EVAL      WSOT03 = U1OT03
     C                   EVAL      WSSKIO = U1SKIO
     C                   EVAL      WSSK01 = U1SK01
s15  C*                  EVAL      WSPMN  = U1PMN
n15  C                   EVAL      WSPMN  = U12PMN
s15  C*                  EVAL      WSPÅR  = U1PÅR
n15  C                   EVAL      WSPÅR  = U12PÅR
     C     U1F23         COMP      'Y'                                    23
      *
     C                   EXSR      TESTB1
      *
S15  C*    STWEB11       TAG
      *
      * IN30 på fra TESTB1
      *
     C                   IF        *IN30
      *
      * TILDEL FEILMELDINGSNUMMER
      *
N15  C                   EXSR      WEBFEIL
      *
      * IN30=0 ikke feiil
      *
     C                   ELSE
      *
S15  C*                  IF        WSOPD = 0
S15  C*                  MOVE      *ON           *IN11
S15  C*                  MOVE      7             UFLAGG
S15  C*                  ELSE
S15  C*                  MOVE      *ON           *IN09
S15  C*                  MOVE      9             UFLAGG
S15  C*                  END
      * FORDEL ETTER VEKT
     C                   Z-ADD     2             UFLAGG
     C                   EXSR      FORDEL
      *
N15  C     *IN30         IFEQ      '1'
N15  C                   EXSR      WEBFEIL
N15  C                   ELSE
      *
S15  C**   *IN30         CABEQ     *ON           STWEB11
      *
     C                   MOVE      *ZEROS        UFLAGG
      *
     C                   END
N15  C                   END
      *
     C                   ENDSR
      *
      *************************************************************************
     C     SRWEB2        BEGSR
      *************************************************************************
      * ENDRE POST
      *
     C                   EVAL      RECNUM = U12RECNO
     C                   EVAL      W2AVD  = U12AVD
     C                   EVAL      W2OPD  = U12OPD
     C                   EVAL      W2KN   = U12KN
     C                   EVAL      W2VK   = U12VK
     C                   EVAL      W2KDPF = U12KDPF
     C                   EVAL      W2BLHB = U12BLHB
     C                   EVAL      W2KDM  = U12KDM
     C                   EVAL      W2BLF  = U12BLF
     C                   EVAL      W2KDMV = U12KDMV
     C                   EVAL      W2BILT = U12BILT
     C                   EVAL      W2PMN  = U12PMN
     C                   EVAL      W2PÅR  = U12PÅR
     C                   EVAL      *IN40  = *ON
      *
     C                   EXSR      TESTB2
      *
     C                   IF        *IN30
      *
N15  C                   EXSR      WEBFEIL
      *
     C                   ELSE
      *
     C                   MOVE      *ZEROS        UFLAGG
      *
     C                   END
      *
     C                   ENDSR
      *
      *//////////////////////////////////////////////////////////////////////
      * FERDIG MELDE                                                SRWEB3 //
      *//////////////////////////////////////////////////////////////////////
     C     SRWEB3        BEGSR
      *
     C                   Z-ADD     20            U1PCC             2 0
     C     KODTÅK3       CHAIN     KODTÅ                              97
     C                   IF        *IN97
     C                   Z-ADD     3             UFLAGG
     C                   ELSE
      * TEST OM UFERDIG KONTERING(EDI) / OM MOMS ER FORDELT
     C                   MOVE      FITAXOri      FITAXN
     C                   Z-ADD     9             UFLAGG
     C                   CALL      'SYKS05'
     C                   PARM                    UBNR
     C                   PARM                    UBLM
     C                   PARM                    FITAXN
     C                   PARM                    UFLAGG
     C                   END
      *
     C     UFLAGG        IFEQ      1
     C     UFLAGG        OREQ      2
     C     UFLAGG        OREQ      3
      *
     C                   EVAL      UCMD = XCMD13
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    UCMD
     C                   PARM                    UCMDL
     C                   SELECT
     C                   WHEN      UFLAGG = 1
     C                   MOVE      'YBC1935'     XMSGNR            7
     C                   WHEN      UFLAGG = 2
     C                   MOVE      'YBC1937'     XMSGNR
     C                   WHEN      UFLAGG = 3
     C                   MOVE      'SPP0001'     XMSGNR
     C                   ENDSL
     C                   Z-ADD     3             XLEVEL            1 0          NIVÅ
     C                   Z-ADD     0             XRETUR            1 0          RETURKODE
     C                   Z-ADD     78            XMSGL             4 0          LENGDE PÅ MELDING
     C                   CALL      'SUBR23R3'
     C                   PARM                    XMSGNR
     C                   PARM                    XMSG             78
     C                   PARM                    XLEVEL
     C                   PARM                    XRETUR
     C                   PARM                    XMSGL
     C                   MOVEL     XMSG          U1FEILMELDING
     C                   Z-ADD     1             UFLAGG
      *
     C                   END
      *
     C                   ENDSR
      *************************************************************************************
N15  C     WEBFEIL       BEGSR
      *************************************************************************************
      *
N15   * finner tekst til msg-nummer
N15   *
N15  C                   Z-ADD     1             UFLAGG
N15  C                   EVAL      UCMD = XCMD13
N15  C                   CALL      'QCMDEXC'                            33
N15  C                   PARM                    UCMD
N15  C                   PARM                    UCMDL
N15  C                   MOVE      MSGNR         XMSGNR            7
N15  C                   Z-ADD     3             XLEVEL            1 0          NIVÅ
N15  C                   Z-ADD     0             XRETUR            1 0          RETURKODE
N15  C                   Z-ADD     78            XMSGL             4 0          LENGDE PÅ MELDING
N15  C                   CALL      'SUBR23R3'
N15  C                   PARM                    XMSGNR
N15  C                   PARM                    XMSG             78
N15  C                   PARM                    XLEVEL
N15  C                   PARM                    XRETUR
N15  C                   PARM                    XMSGL
N15  C                   MOVEL     XMSG          U1FEILMELDING
N15   *
N15   * feilmeldingskode tilbake til web
N15   *
N15  C                   SELECT
N15  C                   WHEN      *IN90
N15  C                   MOVE      '01'          U1FMELDNR
N15  C                   WHEN      *IN89
N15  C                   MOVE      '02'          U1FMELDNR
N15  C                   WHEN      *IN88
N15  C                   MOVE      '03'          U1FMELDNR
N15  C                   WHEN      *IN87
N15  C                   MOVE      '04'          U1FMELDNR
N15  C                   WHEN      *IN86
N15  C                   MOVE      '05'          U1FMELDNR
N15  C                   WHEN      *IN85
N15  C                   MOVE      '06'          U1FMELDNR
N15  C                   WHEN      *IN84
N15  C                   MOVE      '07'          U1FMELDNR
N15  C                   WHEN      *IN83
N15  C                   MOVE      '08'          U1FMELDNR
N15  C                   WHEN      *IN82
N15  C                   MOVE      '09'          U1FMELDNR
N15  C                   WHEN      *IN97
N15  C                   MOVE      '10'          U1FMELDNR
N15  C                   ENDSL
N15  C                   ENDSR
N15   **********************************************************
     C     TESTPER       BEGSR
      **********************************************************
N16  c                   setoff                                       28        28 On=Avvik fra opd
N16  c     KBOPD         ifne      *zeros
N16  C     HEADKK        CHAIN     HEADF                              33
N16   * På Tur - Turens peri høyere prio enn peri fra opdragets dato
N16  C                   IF        HEUR = 'H'
N16  C     HEPRO         CHAIN     TURER14                            33
N16  C                   IF        *in33= '0'
N16  C                   MOVE      TURACC        HEDTÅC
N16  C                   MOVE      TURAAR        HEDTÅÅ
N16  C                   MOVE      TURMND        HEDTM
N16  C                   ENDIF
N16  C                   ENDIF
N16   * Oppdragets priode satt(minnst en faktura utstedet) høyeste prio.
N16  C     HEDTCP        IFNE      *ZEROS                                         3<-B
N16  C                   MOVE      HEDTCP        HEDTÅC
N16  C                   MOVE      HEDTÅP        HEDTÅÅ
N16  C                   MOVE      HEDTMP        HEDTM
N16  C                   END                                                      3<-E
      *
     C     KBPÅR         IFEQ      0
     C     UPÅR4         COMP      HEDTÅ                              2828
     C  N28UPMN          COMP      HEDTM                              2828
     C                   ELSE
     C     KBPCÅ         COMP      HEDTÅ                              2828
     C  N28KBPMN         COMP      HEDTM                              2828
     C                   END
N16  c                   endif
     C   28              SETON                                        27        27 = Minst en
     C                   ENDSR
      **********************************************************
n10  C     TESTBUD       BEGSR
      **********************************************************
n10  c                   setoff                                       80
n10  c     kbbuds        ifeq      0
s12  c*                  z-add     100           kbdiff
n12  c                   z-add     0             kbdiff
n12  c                   z-add     0             upros
n10  c                   else
n12  c                   move      kbkdm         ukdm71            1 0
n12  c   44              z-add     0             ukdm71            1 0
n10  C                   call      'SYGE71'
n10  C                   parm                    kbavd
n10  C                   parm                    kbopd
n10  C                   parm                    kbvk
n10  c                   parm                    WSblhb
n10  c                   parm                    kbbuds
n10  c                   parm                    faktur           13 2
n10  c                   parm                    upros             3 1
n10  c                   parm                    kbdiff            5 2
n12  c                   parm                    KALNR             8 0
n12  c                   parm                    ukdm71            1 0
n10  c                   parm                    feil1             1
n10  c                   end
n10  c                   z-sub     upros         uprosm            3 1
n10  c     kbdiff        ifgt      upros
n10  c     kbdiff        orlt      uprosm
n10  c                   seton                                        80
n10  c                   end
n10  c     kbavd         ifne      *zeros
n10  c     kbopd         andne     *zeros
N11  c     hent          ifgt      999
n11  c                   z-add     999           wsnt
n11  c                   else
n11  c                   z-add     hent          wsnt
n11  c                   end
n10  c                   z-add     hevkt         vekt01
n13  c                   movea     *ZEROS        T2
n10  c     hem3          mult      200           vekt01k          11 2
n10  c     vekt01k       ifgt      vekt01
n10  c                   z-add     vekt01k       vekt01
n10  c                   end
n10  c     trackk        chain     trackl08                           34
n10  c     *in34         ifeq      '0'
n10  c                   z-add     8             n8                2 0
n10  c                   z-add     5             n5                2 0
n10  c                   do        5
n10  c     tt(n8)        ifne      ' '
n10  c                   move      tt(N8)        t2(N5)
n10  c                   sub       1             n5
n10  c                   end
n10  c                   sub       1             n8
n10  c                   enddo
n10  c                   end
n10  c                   end
n14  c     kbrekl        comp      *blanks                            7979
n10  c                   endsr
n14  C***********************************************
n14  C     TTSR          BEGSR
n14  C***********************************************
n14  C                   MOVE      KBAVD         TTAVD
n14  C                   MOVE      KBOPD         TTOPD
n14  C                   TIME                    XULTID
n14  C                   MOVE      XULDD         ULDD
n14  C                   MOVE      XULMM         ULMM
n14  C                   MOVE      XULÅÅ         ULÅÅ
n14  C                   MOVE      'REO'         TTACTI
n14  C                   MOVE      ULDT          TTDATE
n14  C                   MOVE      XULTM         TTTIME
n14  C                   MOVE      TTDATE        TTDATL
n14  C                   MOVE      TTTIME        TTTIML
n14  C                   MOVE      ZUSER         TTUSER
n14  C                   MOVE      *blanks       TTTEXT
n14  c                   move      *blanks       TTTEXL
n14  C                   eval      TTTEXT = 'Complaint ended inv:'
n14  C     TTTEXT        cat       KAFNR         TTTEXT
N14  C                   eval      TTTEXL = 'Reklamasjon avsluttet Fakt:'
n14  C     TTTEXL        CAT       KAFNR:1       TTTEXL
n14  C                   WRITE     TRACKFR
n14  C                   ENDSR
N17  C***********************************************
N17  C     EUSR          BEGSR
N17  C***********************************************
N17  C     GEBKEYE       KLIST
N17  C                   KFLD                    EUKODE
N17  C                   KFLD                    KGEKOD
N17  C     GEBKEY3E      KLIST
N17  C                   KFLD                    EUKODE
N17  C                   KFLD                    TUBILK
N17  C                   MOVE      *BLANKS       EUKODE            1
N17   *
N17   * HENTER ORDEREDATA
N17   *
     C     REGMOD        IFEQ      'N'
N17  C     wsavd         ifne      *zeros
N17  c     wsopd         andne     *zeros
N17  C     HEADFK        CHAIN     HEADF                              33
N17  C                   ELSE
N17  c     wspro         chain     head11                             33
N17  C                   END
     C                   END
      *
N17   *
     C     REGMOD        IFEQ      'E'
N17  C     HEAFK2        CHAIN     HEADF                              33
     C                   END
      *
N17  C     *IN33         IFEQ      '0'
      *
N17   * SPESIALKONTERING EU
N17  C     KODTS2K       KLIST
N17  C                   KFLD                    KS2UNI
N17  C                   KFLD                    KS2LK
N17  C                   MOVEL     'S2'          KS2UNI
N17  C
N17   *
N17   * unntak for eu (KS2PRE=B)
N17   *
N17  C                   MOVE      FILAND        KS2LK
N17  C     KODTS2K       CHAIN     KODTS2                             33
N17   *
N17   * EGET LAND ER EU
N17   *
N17  C  N33KS2PRE        IFEQ      'B'
N17   *
N17   *   IMPORT
N17   *
N17  C     HEUR          IFEQ      'A'
N17  C     HEUR          OREQ      'C'
N17  C     HEUR          OREQ      'F'
N17  C                   MOVE      HELKA         FIRLKF
N17  C     KOAPOS        IFEQ      'J'
N17  C                   MOVE      FILAND        FIRLKT
N17  C                   ELSE
N17  C     HESDT         CHAIN     STED2                              33
N17  C                   MOVE      ST2LK         FIRLKT
N17  C                   END
N17  C                   END
N17   *
N17   *   EKSPORT
N17   *
N17  C     HEUR          IFEQ      'B'
N17  C     HEUR          OREQ      'D'
N17  C     HEUR          OREQ      'G'
N17  C                   MOVE      HELKA         FIRLKT
N17  C     KOAPOS        IFEQ      'J'
N17  C                   MOVE      FILAND        FIRLKF
N17  C                   ELSE
N17  C     HESDT         CHAIN     STED2                              33
N17  C                   MOVE      ST2LK         FIRLKF
N17  C                   END
N17  C                   END
N17   *
N17   * TRANSPORTDISPONERING
N17   *
N17  C     HEUR          IFEQ      'H'
N17  C                   MOVE      HELKA         FIRLKF            2
N17  C                   MOVE      HETRI         FIRLKT            2
N17  C                   END
N17   *
N17   * DOMESTIC
N17   *
N17  C     FILAND        IFEQ      FIRLKF
N17  C     FILAND        ANDEQ     FIRLKT
N17  C                   MOVE      'D'           EUKODE
N17  C                   END
N17   *
N17   *
N17   * TRANSIT  BEGGE LAND I EU
N17   *
N17  C     FIRLKF        IFNE      FIRLKT
N17  C                   MOVE      FIRLKF        KS2LK
N17  C     KODTS2K       CHAIN     KODTS2                             33
N17  C  N33KS2PRE        IFEQ      'B'
N17  C                   MOVE      FIRLKT        KS2LK
N17  C     KODTS2K       CHAIN     KODTS2                             33
N17  C  N33KS2PRE        IFEQ      'B'
N17  C                   MOVE      'T'           EUKODE
N17  C                   END
N17  C                   END
N17  C                   END
N17   *
N17  C                   END
N17  C                   END
N17  C                   SETOFF                                       33
N17  C                   ENDSR
