********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11139 * 01 CB  PTF11 Ikke automatisk omkjøring av utvekslinger med status=E
********************************************************************
     FEDIS      UF   E           K DISK
     FEDIS3     UF   E           K DISK    PREFIX(X_)
     F                                     RENAME(EDISR:EDISR3)
     FEDIM6     UF   E           K DISK
     FSADH      UF   E           K DISK    USROPN
     FSAEH      UF   E           K DISK    USROPN
     FTRUH      UF   E           K DISK    USROPN
     FTRIH      UF   E           K DISK    USROPN
     FTRUGH     UF   E           K DISK    USROPN
     FSVIH      UF   E           K DISK    USROPN
     FDKIH      UF   E           K DISK    USROPN
     FDKEH      UF   E           K DISK    USROPN
     FSVXH      UF   E           K DISK    USROPN
     F                                     PREFIX(SV_)
     FSVNH      UF   E           K DISK    USROPN
     F                                     PREFIX(SV_)
     FSVXGH     UF   E           K DISK    USROPN
     F                                     PREFIX(SV_)
     FDKXH      UF   E           K DISK    USROPN
     F                                     PREFIX(DK_)
     FDKNH      UF   E           K DISK    USROPN
     F                                     PREFIX(DK_)
     FDKXGH     UF   E           K DISK    USROPN
     F                                     PREFIX(DK_)
     FEDISS     O  A E             DISK
     FSVEH      UF   E           K DISK    USROPN
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *___________________
      * Definiere Workfelt
      *"""""""""""""""""""
     C     *LIKE         DEFINE    SSN           WSN
     C     *LIKE         DEFINE    SST           WST
     C     *LIKE         DEFINE    SVIH_SYAV     WVIH_SYAV
     C     *LIKE         DEFINE    SVIH_SYOP     WVIH_SYOP
      *__________________
      * Definiere Nøkkler
      *""""""""""""""""""
     C     KEYA          KLIST
     C                   KFLD                    WSN
     C     KEYB          KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C     KEYBSVX       KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C     KEYBDKX       KLIST
     C                   KFLD                    MAVD
     C                   KFLD                    MTDN
     C     SVIH_KEY      KLIST
     C                   KFLD                    WVIH_SYAV
     C                   KFLD                    WVIH_SYOP
      *______________________
      * Åpne filer fra SYSPED
      *""""""""""""""""""""""
     C                   OPEN      SADH                                 53
     C                   OPEN      SAEH                                 54
     C                   OPEN      TRUH                                 55
     C                   OPEN      TRIH                                 56
     C                   OPEN      TRUGH                                57
     C                   OPEN      SVIH                                 58
     C                   OPEN      DKIH                                 58
     C                   OPEN      DKEH                                 58
     C                   OPEN      SVEH                                 58
     C                   OPEN      SVXH                                 59
     C                   OPEN      SVNH                                 59
     C                   OPEN      SVXGH                                59
     C                   OPEN      DKXH                                 59
     C                   OPEN      DKNH                                 59
     C                   OPEN      DKXGH                                59
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C     WSN           PARM                    WSN
     C                   PARM                    WST
     C                   PARM                    WMBRS            10 0
      *_________________________
      * HENTE DAGENS DATO OG TID
      *"""""""""""""""""""""""""
     C                   CALL      'SYGE15C'
     C                   PARM                    WDATO             8
     C                   PARM                    WTID              6
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Bearbeide Formater                                   SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR
      *_________________________________
      * Oppdatere status i sendningslogg
      *"""""""""""""""""""""""""""""""""
     C     KEYA          CHAIN     EDIS                               51
     C                   MOVE      WST           SST
     C                   MOVEL     WDATO         SDT
     C                   MOVEL     WTID          STM
     C     WMBRS         MULT      80            SMBRS
     C                   EVAL      SSR='S'
     C                   UPDATE    EDISR
      *________________________________
      * Oppdatere status i meldingslogg
      *""""""""""""""""""""""""""""""""
     C     KEYA          CHAIN     EDIM6                              51
     C     *IN51         DOWEQ     '0'
     C                   MOVE      WST           MST
     C                   MOVEL     WDATO         MDT
     C                   MOVEL     WTID          MTM
     C                   UPDATE    EDIMR
      *
     C     *IN53         IFEQ      *OFF
     C     *IN54         ANDEQ     *OFF
     C     *IN55         ANDEQ     *OFF
     C     *IN56         ANDEQ     *OFF
     C     *IN57         ANDEQ     *OFF
     C     *IN59         ANDEQ     *OFF
     C     KEYB          CHAIN     SADH                               52
     C     *IN52         IFEQ      '0'
     C     SIST          IFEQ      'A'
     C     SIST          OREQ      'B'
     C     SIST          OREQ      'E'
     C                   MOVE      WST           SIST
     C                   ENDIF
     C                   UPDATE    SADHR
     C                   ENDIF
     C     KEYB          CHAIN     SAEH                               52
     C     *IN52         IFEQ      '0'
     C     SEST          IFEQ      'A'
     C     SEST          OREQ      'B'
     C     SEST          OREQ      'E'
     C                   MOVE      WST           SEST
     C                   UPDATE    SAEHR
     C                   ENDIF
     C                   ENDIF
     C     KEYB          CHAIN     TRUH                               52
     C     *IN52         IFEQ      '0'
     C     THST          IFEQ      'A'
     C     THST          OREQ      'B'
     C     THST          OREQ      'E'
     C                   MOVE      WST           THST
     C                   ENDIF
     C                   UPDATE    TRUHR
     C                   ENDIF
     C     KEYB          CHAIN     TRIH                               52
     C     *IN52         IFEQ      '0'
     C     TIST          IFEQ      'A'
     C     TIST          OREQ      'B'
     C     TIST          OREQ      'E'
     C     TIMF          IFEQ      '007'
     C     WST           ORNE      'C'
     C                   MOVE      WST           TIST
     C                   ELSE
     C                   MOVE      'F'           TIST
     C                   ENDIF
     C                   ENDIF
     C                   UPDATE    TRIHR
     C                   ENDIF
     C                   MOVEL     M0068         TGGNR
     C     TGGNR         CHAIN     TRUGH                              52
     C     *IN52         IFEQ      '0'
     C     TGST          IFEQ      'A'
     C     TGST          OREQ      'B'
     C     TGST          OREQ      'E'
     C                   MOVE      'P'           TGST
     C                   ENDIF
     C                   UPDATE    TRUGHR
     C                   ENDIF
      * TDS
     C                   EVAL      WVIH_SYAV=MAVD
     C                   EVAL      WVIH_SYOP=MTDN
     C     SVIH_KEY      CHAIN     SVIH                               52
     C     *IN52         IFEQ      '0'
     C     SVIH_SYST     IFEQ      'A'
     C     SVIH_SYST     OREQ      'B'
     C     SVIH_SYST     OREQ      'E'
     C                   MOVE      WST           SVIH_SYST
     C                   ENDIF
     C                   UPDATE    SVIHR
     C                   ENDIF
     C     SVIH_KEY      CHAIN     SVEH                               52
     C     *IN52         IFEQ      '0'
     C     SVEH_SYST     IFEQ      'A'
     C     SVEH_SYST     OREQ      'B'
     C     SVEH_SYST     OREQ      'E'
     C                   MOVE      WST           SVEH_SYST
     C                   ENDIF
     C                   UPDATE    SVEHR
     C                   ENDIF
      * SKAT/TOLD
     C     SVIH_KEY      CHAIN     DKIH                               52
     C     *IN52         IFEQ      '0'
     C     DKIH_SYST     IFEQ      'A'
     C     DKIH_SYST     OREQ      'B'
     C     DKIH_SYST     OREQ      'E'
     C                   MOVE      *BLANKS       DKIH_SYST
     C                   MOVEL     WST           DKIH_SYST
     C                   ENDIF
     C                   UPDATE    DKIHR
     C                   ENDIF
     C     SVIH_KEY      CHAIN     DKEH                               52
     C     *IN52         IFEQ      '0'
     C     DKEH_SYST     IFEQ      'A'
     C     DKEH_SYST     OREQ      'B'
     C     DKEH_SYST     OREQ      'E'
     C                   MOVE      *BLANKS       DKEH_SYST
     C                   MOVEL     WST           DKEH_SYST
     C                   ENDIF
     C                   UPDATE    DKEHR
     C                   ENDIF
      *
     C     KEYBSVX       CHAIN     SVXH                               52
     C     *IN52         IFEQ      '0'
     C     SV_THST       IFEQ      'A'
     C     SV_THST       OREQ      'B'
     C     SV_THST       OREQ      'E'
     C                   MOVE      WST           SV_THST
     C                   ENDIF
     C                   UPDATE    SVXHR
     C                   ENDIF
      *
     C                   MOVEL     M0068         SV_TGGNR
     C     SV_TGGNR      CHAIN     SVXGH                              52
     C     *IN52         IFEQ      '0'
     C     SV_TGST       IFEQ      'A'
     C     SV_TGST       OREQ      'B'
     C     SV_TGST       OREQ      'E'
     C                   MOVE      'P'           SV_TGST
     C                   ENDIF
     C                   UPDATE    SVXGHR
     C                   ENDIF
      *
     C     KEYBSVX       CHAIN     SVNH                               52
     C     *IN52         IFEQ      '0'
     C     SV_TIST       IFEQ      'A'
     C     SV_TIST       OREQ      'B'
     C     SV_TIST       OREQ      'E'
     C     SV_TIMF       IFEQ      '007'
     C                   MOVE      'C'           SV_TIST
     C                   ELSE
     C                   MOVE      'L'           SV_TIST
     C                   ENDIF
     C                   ENDIF
     C                   UPDATE    SVNHR
     C                   ENDIF
     C                   ENDIF
      *
     C     KEYBDKX       CHAIN     DKXH                               52
     C     *IN52         IFEQ      '0'
     C     DK_THST       IFEQ      'A'
     C     DK_THST       OREQ      'B'
     C     DK_THST       OREQ      'E'
     C                   MOVE      WST           DK_THST
     C                   ENDIF
     C                   UPDATE    DKXHR
     C                   ENDIF
      *
     C                   MOVEL     M0068         DK_TGGNR
     C     DK_TGGNR      CHAIN     DKXGH                              52
     C     *IN52         IFEQ      '0'
     C     DK_TGST       IFEQ      'A'
     C     DK_TGST       OREQ      'B'
     C     DK_TGST       OREQ      'E'
     C                   MOVE      'P'           DK_TGST
     C                   ENDIF
     C                   UPDATE    DKXGHR
     C                   ENDIF
      *
     C     KEYBDKX       CHAIN     DKNH                               52
     C     *IN52         IFEQ      '0'
     C     DK_TIST       IFEQ      'A'
     C     DK_TIST       OREQ      'B'
     C     DK_TIST       OREQ      'E'
     C     DK_TIMF       IFEQ      '007'
     C                   MOVE      'C'           DK_TIST
     C                   ELSE
     C                   MOVE      'L'           DK_TIST
     C                   ENDIF
     C                   ENDIF
     C                   UPDATE    DKNHR
     C                   ENDIF
      *
     C     KEYA          READE     EDIM6                                  51
     C  N51              END
      * SKRIV POST TIL DETALJ LOGG
     C                   CLEAR                   EDISSR
     C                   Z-ADD     SSN           SSSN
     C                   MOVEL     WDATO         SSDT
     C                   MOVEL     WTID          SSTM
     C                   MOVEL     SST           SSST
     C                   EVAL      SSTEXT='Successfull Transmission'
     C                   WRITE     EDISSR
      *_______________________________________________
      * Endre status på på alle sendninger med E til A
      *"""""""""""""""""""""""""""""""""""""""""""""""
     C     'E'           CHAIN     EDIS3                              51
     C     *IN51         DOWEQ     '0'
N01  C     *IN51         ANDEQ     '1'
      * Oppdater hovedlogg
     C                   EVAL      X_SST='A'
     C                   UPDATE    EDISR3
      * Skriv post til detaljlogg
     C                   CLEAR                   EDISSR
     C                   Z-ADD     X_SSN         SSSN
     C                   MOVEL     WDATO         SSDT
     C                   MOVEL     WTID          SSTM
     C                   MOVEL     X_SST         SSST
     C                   EVAL      SSTEXT='Automatic reesend is ordered'
     C                   WRITE     EDISSR
      *
     C     'E'           READE     EDIS3                                  51
     C  N51              END
     C                   ENDSR
