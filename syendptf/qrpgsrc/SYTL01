********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 SH  PTF10 Krav til varemottager
10326 * 02 YBC PTF10 SVENSK TOLLAGER
10326 * 03 YBC PTF10 oppdaterer turnummer
      *%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
12138 * 04 JOV PTF12 T-papirtype - eget felt i godsjf (var 3 siste av avg.tollsted)
12138 * 05 sh  PTF12 visning siste nummer
12138 * 06 sh  PTF12 PRINT SKILLEARK
********************************************************************
      ***********************************************************
      *** REGISTRERING AV GODSJOURNAL                         ***
      ***                                                     ***
      *** INDIKATORER  01 - 26 FUNCTION  / ROLL KEYS          ***
      *** BRUKTE INDIKATORER                                  ***
      ***                                                     ***
      ***  03 - GÅ UT                                         ***
      ***  06 - LAG NY                                        ***
      ***  12 - ANNULLER                                      ***
      ***  25 - ROLL                                          ***
      ***                                                     ***
      ***  30 - GENERELL FEIL                                 ***
      ***  41 - SE PÅ GODSREGISTRERINGSDATA                   ***
      ***  42 - PROTECT PÅ GODSNUMMER                         ***
      ***  43 - TILEGG AV TRANSITTRINGSNR PÅ GODSNUMMER       ***
      ***  45 - PÅ VED VISNING IKKE VED SLETTING              ***
      ***  56 - MARKNADSJOUTNAL FINNES
      ***  57 - SØK PÅ TUR
      ***  60 - PLUKKING FRA TET IMPORT
      ***  61 - FORHÅNDSREGISTRERING
      ***  62 - ETTERBEHANDLING
      ***  63 - merknadsregistrering
      ***  63 - full modus
      ***  91 - SFLDSP                                        ***
      ***  92 - SFLDSPCTL                                     ***
      ***  93 - SFLCLR                                        ***
      ***  94 - SFLEND                                        ***
      ***  98 - END OF READC SUBFILE                          ***
      ***********************************************************
      *
N02  FFIRM      IF   E           K DISK
N02  FGODSGFSE  UF A E           K DISK
     FGODSHF    IF A E           K DISK
     FGODSAF    IF   E           K DISK
     FGODSJL01  IF   E           K DISK
     F                                     RENAME(GODSJR:GODSJR1)
     F                                     INFDS(PARDS1)
     FGODSJL02  IF   E           K DISK
     F                                     RENAME(GODSJR:GODSJR2)
     F                                     INFDS(PARDS2)
     FGODSJL03  IF   E           K DISK
     F                                     RENAME(GODSJR:GODSJR3)
     F                                     INFDS(PARDS3)
     FGODSJL04  IF   E           K DISK
     F                                     RENAME(GODSJR:GODSJR4)
     F                                     INFDS(PARDS4)
     FGODSJL05  IF   E           K DISK
     F                                     RENAME(GODSJR:GODSJR5)
     FGODSJL06  IF   E           K DISK
     F                                     RENAME(GODSJR:GODSJR6)
     F                                     INFDS(PARDS6)
     FGODSJF    UF A E             DISK
     F                                     INFDS(PARDS)
     FGODSFI    IF   E           K DISK
     FGODSGF    UF A E           K DISK
     FMERKNF    UF   E           K DISK
N04  FLLMRFL12  IF   E           K DISK
     FSYTL01FM  CF   E             WORKSTN
     F                                     INFDS(FBAREA)
     F                                     SFILE(STL01H50:ZRECNO)
      ***********************************************************
      *___________________________
      * Finner username
      *"""""""""""""""""""""""""""
     D                SDS
     D  ZUSER                254    263
     D                 DS
     D  MXFELT                 1     20
     D  MX                     1     20
     D                                     DIM(20)
     D PARDS           DS
     D  RRNC                 397    400B 0
     D PARDS1          DS
     D  RRNCL1               397    400B 0
     D PARDS2          DS
     D  RRNCL2               397    400B 0
     D PARDS3          DS
     D  RRNCL3               397    400B 0
     D PARDS4          DS
     D  RRNCL4               397    400B 0
     D PARDS6          DS
     D  RRNCL6               397    400B 0
     D FBAREA          DS
     D  WSCLOC               370    371B 0
     D  WSSUBN               378    379B 0
     D                 DS
     D  SEGN                   1     15
     D  SEAAR                  1      4
     D  SEDAG                 10     12
     D                 DS
     D  SISTGN                 1     15
     D  SIST13                13     13
     D  KEYSIS                 1     13
     D  SISTGA                 1     12
     D  SISTGB                13     15
     D                 DS
     D  WRAVG                  1     15
     D  WRAVGT                 1      8
     D                 DS
     D  DSTID                  1     14  0
     D  DSDAG                  7      8  0
     D  DSMND                  9     10  0
     D  DSAAR                 13     14  0
     D  DSCCAA                11     14  0
     D                 DS
     D  UDMA                   1      6  0
     D  UDAG                   1      2  0
     D  UMND                   3      4  0
     D  UAAR                   5      6  0
     D                 DS
     D  WRTRDT                 1      6  0
     D  WRTRDD                 1      2  0
     D  WRTRMM                 3      4  0
     D  WRTRÅÅ                 5      6  0
     D                 DS
     D  WRGRDT                 1      6  0
     D  WRGRDD                 1      2  0
     D  WRGRMM                 3      4  0
     D  WRGRÅÅ                 5      6  0
     D                 DS
     D  WRLSDT                 1      6  0
     D  WRLSDD                 1      2  0
     D  WRLSMM                 3      4  0
     D  WRLSÅÅ                 5      6  0
     D                 DS
     D  SFTRDT                 1      6  0
     D  SFTRDD                 1      2  0
     D  SFTRMM                 3      4  0
     D  SFTRÅÅ                 5      6  0
     D                 DS
     D  SEDATF                 1      6  0
     D  SEFDD                  1      2  0
     D  SEFMM                  3      4  0
     D  SEFÅÅ                  5      6  0
     D                 DS
     D  SEDATT                 1      6  0
     D  SETDD                  1      2  0
     D  SETMM                  3      4  0
     D  SETÅÅ                  5      6  0
     D                 DS
     D  SDDATF                 1      8  0
     D  SDFÅÅ                  1      4  0
     D  SDFMM                  5      6  0
     D  SDFDD                  7      8  0
     D                 DS
     D  SDDATT                 1      8  0
     D  SDTÅÅ                  1      4  0
     D  SDTMM                  5      6  0
     D  SDTDD                  7      8  0
     D                 DS
     D  GOTRDT                 1      8  0
     D  GOTRÅÅ                 1      4  0
     D  GOTRMM                 5      6  0
     D  GOTRDD                 7      8  0
     D                 DS
     D  GOGRDT                 1      8  0
     D  GOGRÅÅ                 1      4  0
     D  GOGRMM                 5      6  0
     D  GOGRDD                 7      8  0
     D                 DS
     D  GOLSDT                 1      8  0
     D  GOLSÅÅ                 1      4  0
     D  GOLSMM                 5      6  0
     D  GOLSDD                 7      8  0
s04  D*                DS
s04  D* GOAVG                  1     15
s04  D* GOTTYP                13     15
     D                 DS
     D  GOGN                   1     15
     D  GOGNA                  1     12
     D  GOGNBV                 5      9
     D  GOGNB2                 1      5
     D  GOGN1                  1     12
     D  GOGN2                 13     15
     D  GOGN13                13     13
N02  D  GOGNSEA                1      7
     D                 DS
     D  WRGN                   1     15
     D  WRGNA                  1     12
     D  WRGNB                 13     15
     D  XAN13                  1     13
     D  XAN02                 14     15
     D  WRGN13                13     13
N02  D  WRGNSEA                1      7
N02  D  WRGNSEB                8     15
     D                 DS
     D  MAXGN                  1     15
     D  MAXGN1                 1     12
     D  MAXGN2                13     15
     D                 DS
     D  UUAVDA                 1      4
     D  UUAVD1                 1      1
     D  UUAVD2                 2      2
     D  UUAVD3                 3      3
     D  UUAVD4                 4      4
     D                UDS
     D  UUAVD                 15     18
      *______________________
      * Initiering
      *""""""""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UPLUK             1
     C                   PARM                    UGN              15
     C                   PARM                    UMOTT            15
     C                   PARM                    UTRNR            18
     C     UPLUK         COMP      'P'                                    60
     C     UPLUK         COMP      'F'                                    61
     C     UPLUK         COMP      'E'                                    62
     C     UPLUK         COMP      'M'                                    63
     C     UPLUK         COMP      ' '                                    64
      *
     C     START0        TAG
     C                   EXSR      INIT
      *___________________________
      * Hovedlogikk
      *"""""""""""""""""""""""""""
      *______________
      * Clear Subfil
      *""""""""""""""
     C     START         TAG
     C                   MOVE      '1'           *IN93
     C                   WRITE     STL01K60
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     0             ZRECNO
      *_____________
      * Fyll Subfil
      *"""""""""""""
     C**>                  MOVE *BLANKS   SFGN
      * START LES
      *
     C   51GODKE1        SETLL     GODSJL01                           77
     C   52GODKE2        SETLL     GODSJL02                           77
     C   53GODKE3        SETLL     GODSJL03                           77
     C   54GODKE4        SETLL     GODSJL04                           77
     C   57GODKE6        SETLL     GODSJL06                           77
      *
      * lager maxverdi for bilnummer
      *
     C     SEBILN        IFNE      *BLANKS
     C                   MOVEL     SEBILN        MXFELT
     C                   Z-ADD     13            XN                2 0
     C     MX(XN)        DOWEQ     ' '
     C                   MOVE      '9'           MX(XN)
     C                   SUB       1             XN
     C                   END
     C                   MOVEL     MXFELT        MXBILN
     C                   end
      *
     C     START1        TAG
S02  C*                  DO        14
N02  C                   DO        17
     C     NEXT          TAG
     C   51              READ      GODSJL01                               94
     C   52              READ      GODSJL02                               94
     C   53              READ      GODSJL03                               94
     C   54              READ      GODSJL04                               94
     C   57              READ      GODSJL06                               94
      *
      * LESR KUN PÅ ANGITT DAG VED 51 PÅ
      *
N02  C   51              IF        FILAND = 'SE'
N02  C  N94GOGNSEA       COMP      XBEVSEA                            9494
N02  C                   ELSE
      * sjekk om nytt bevilningsnummer
S05  C*  51
s05  C*NN94GOGNA         COMP      XBEVDG                             9494
N05  c     *in51         ifeq      '1'
N05  c     *in94         andeq     '0'
N05  C     GOGNA         COMP      XBEVDG                             9494
N05  c   94              move      gognold       gogn
N05  c                   end
N02  C                   END
     C   52
     CANN94GOBILN        COMP      MXBILN                             94
     C     *IN94         IFEQ      '0'
N05  c                   move      gogn          gognold          15
      *
      * ENHETSNR   UTFYLT
      *
N02  C                   IF        FILAND = 'SE'
N02  C                   IF        WSDATOSE <> 0 AND GOGRDT <> 0
N02  C     WSDATOSE      CABGT     GOGRDT        NEXT
N02  C                   END
N02  C                   IF        %SUBST(GOGN:1:1) >= '0' AND
N02  C                             %SUBST(GOGN:1:1) <= '9'
N02  C                   GOTO      NEXT
N02  C                   END
N02  C                   ELSE
N02  C                   IF        %SUBST(GOGN:1:1) < '0' OR
N02  C                             %SUBST(GOGN:1:1) > '9'
N02  C                   GOTO      NEXT
N02  C                   END
     C     SEENH         IFNE      *BLANKS
     C     GOGN13        ANDNE     SEENH
     C                   GOTO      NEXT
     C                   ENDIF
N02  C                   END
      *
      * TRANSITTERINGSNR UTFYLT
      *
     C     SETRNR        IFNE      *BLANKS
     C                   MOVEL     SETRNR        MXFELT
     C                   Z-ADD     20            XN                2 0
     C     MX(XN)        DOWEQ     ' '
     C                   MOVE      '9'           MX(XN)
     C                   SUB       1             XN
     C                   END
     C                   MOVEL     MXFELT        MXTRNR
     C     GOTRNR        IFLT      SETRNR
     C     GOTRNR        ORGT      MXTRNR
     C                   GOTO      NEXT
     C                   ENDIF                                                  <GOTRNR
     C                   ENDIF                                                  <SETRNR
      *
      * AVGANGSTOLLSTED UTFYLT
      *
     C     SEAVG         IFNE      *BLANKS
     C                   MOVEL     SEAVG         MXFELT
     C                   MOVE      '9'           MX(15)
     C                   MOVE      '9'           MX(14)
     C                   MOVE      '9'           MX(13)
     C                   Z-ADD     12            XN                2 0
     C     MX(XN)        DOWEQ     ' '
     C                   MOVE      '9'           MX(XN)
     C                   SUB       1             XN
     C                   END
     C                   MOVEL     MXFELT        MXAVG
     C     GOAVG         IFLT      SEAVG
     C     GOAVG         ORGT      MXAVG
     C                   GOTO      NEXT
     C                   ENDIF                                                  <GOAVG
     C                   ENDIF                                                  <SEAVG
      *
      * TRANSITT-TYPE    UTFYLT
      *
     C     SETTYP        IFNE      *BLANKS
S04  C*    GOTTYP        ANDNE     SETTYP
N04  C     GOTRTY        ANDNE     SETTYP
     C                   GOTO      NEXT
     C                   ENDIF
      *
      * KJENNETEGN UTFYLT
      *
     C     SEBILN        IFNE      *BLANKS
     C     GOBILN        IFLT      SEBILN
     C     GOBILN        ORGT      MXBILN
     C                   GOTO      NEXT
     C                   ENDIF                                                  <GOBILN
     C                   ENDIF                                                  <SEBILN
      *
      * DATO UTFYLT
      *
     C     SDDATF        IFNE      *ZERO
     C     GOTRDT        IFLT      SDDATF
     C     GOTRDT        ORGT      SDDATT
     C                   GOTO      NEXT
     C                   ENDIF                                                  <GODAT
     C                   ENDIF                                                  <SDDATF
      *
S02  C*    GOGN2         IFEQ      *BLANKS
S02  C*                  MOVEL     GOGN          SFFGN
S02  C*                  ELSE
     C                   MOVE      GOGN          SFFGN
S02  C*                  END
     C                   MOVEL     GOTURN        SFTURN
S02  C*                  MOVEL     GOBILN        SFBI10           10
S02  C*                  MOVE      SFBI10        SFTURN
N02  C                   MOVE      GOBILN        SFBILN
     C                   MOVEL     GOAVG         SFAVG
S04  C*                  MOVE      GOAVG         SFTYPE
N04  C                   MOVEL     GOTRTY        SFTRTY
     C                   MOVEL     GOTRNR        SFTRNR
     C                   MOVE      GOTRÅÅ        SFTRÅÅ
     C                   Z-ADD     GOTRMM        SFTRMM
     C                   Z-ADD     GOTRDD        SFTRDD
     C   51              Z-ADD     RRNCL1        SFRRN
     C   52              Z-ADD     RRNCL2        SFRRN
     C   53              Z-ADD     RRNCL3        SFRRN
     C   54              Z-ADD     RRNCL4        SFRRN
     C   57              Z-ADD     RRNCL6        SFRRN
     C                   ADD       1             ZRECNO
      * REVERSE PÅ GRENSE
     C     GOGREN        COMP      *BLANKS                            5050
      * REVERSE VED MERKNADSJOURNAL
     C                   SETOFF                                       56
     C     MERKEY        CHAIN(N)  MERKNF                             33
     C  N33              SETON                                        56
     C                   EXSR      KDTFM3
     C                   WRITE     STL01H50
     C                   ENDIF                                                  <*IN94
     C  N94              ENDDO                                                  <DO 14
      *
     C                   Z-ADD     ZRECNO        YRECNO            5 0
     C     ZRECNO        IFGT      0
     C     ZRECNO        SUB       1             CURS1
S02  C*    CURS1         DIV       14            CURS1
S02  C*    CURS1         MULT      14            CURS1
N02  C     CURS1         DIV       17            CURS1
N02  C     CURS1         MULT      17            CURS1
     C                   ADD       1             CURS1
     C                   ENDIF
      *________________
      * Display Subfil
      *""""""""""""""""
     C     START3        TAG
     C                   MOVEA     '11'          *IN(91)
      *
      * INGEN RECORDS PÅ SKJERM
      *
     C     ZRECNO        IFEQ      0
     C     VISB30        TAG
     C                   EXFMT     STL01B30
      *
      * BYTTE AV DATO
      *
      *
     C                   ELSE                                                   <ZRECNO
     C                   WRITE     STL01B40
     C                   EXFMT     STL01K60
     C                   ENDIF                                                  <ZRECNO
      *
     C                   MOVEA     '0000000'     *IN(30)
      *
     C                   SETOFF                                       9998
      *
      * BYTTE AV DATO
      *
     C     WSDANY        IFNE      *ZEROS
     C                   EXSR      BYTTDA
     C                   EXSR      FIXVAR
     C                   GOTO      START
N02  C                   ELSE
N02  C                   EVAL      WSDATOSE = 0
     C                   END
      *
      *
      * F5 REFRESH PÅ DATO
      *
     C     *IN(05)       IFEQ      '1'
     C                   MOVE      WSDATO        WSDANY
     C                   EXSR      BYTTDA
     C                   EXSR      FIXVAR
     C                   GOTO      START
     C                   END
      *** F12=Forige bilde (=valg av Bev.kode/eller ut hvis bare en)
     C     *IN12         IFEQ      *ON
     C     FLELBK        IFEQ      'J'
     C                   GOTO      START0
     C                   ELSE
     C                   GOTO      ENDPGM
     C                   ENDIF                                                  <FLELBK
     C                   ENDIF                                                  <*IN12
      *** F3=Gå ut
     C     *IN03         IFEQ      '1'
     C                   GOTO      ENDPGM
     C                   ENDIF                                                  <*IN03
      *** F6=Lag ny
     C     *IN06         IFEQ      '1'
     C                   EXSR      LAGNY
     C                   GOTO      START
     C                   ENDIF                                                  <*IN06
      *** Søk
     C     *IN08         IFEQ      *ON
     C                   Z-ADD     6             LINNBR
     C                   Z-ADD     20            POSNBR
     C                   EXSR      KDTFMT
     C                   EXFMT     STL01B10
     C                   EXSR      KDTFMT
     C     *IN03         IFEQ      *ON
     C                   GOTO      ENDPGM
     C                   ENDIF                                                  <*IN03
     C                   EXSR      SØK
     C                   GOTO      START
     C                   ENDIF                                                  <*IN08
      *** Roll
     C     *IN25         IFEQ      '1'
     C     *IN94         ANDEQ     '0'                                           EOF
     C                   Z-ADD     YRECNO        ZRECNO
     C                   MOVE      '0'           *IN25
     C                   GOTO      START1
     C                   ENDIF                                                  <*IN25
      *** Finn valg
     C     ZRECNO        IFNE      0
     C                   MOVE      *OFF          *IN12
     C                   EXSR      GETOPT
     C     ENDRET        IFEQ      'J'
     C                   MOVE      GOGN          SEGN
     C                   GOTO      START
     C                   END
      *** F3=Gå ut
     C     *IN03         IFEQ      '1'
     C                   GOTO      ENDPGM
     C                   ENDIF                                                  <*IN03
      *** F12=Annuller
     C     *IN12         IFEQ      '1'
     C                   GOTO      START3
     C                   ENDIF                                                  <*IN12
     C                   ENDIF                                                  <ZRECNO
      *
     C     *IN44         IFEQ      *ON
     C                   MOVE      *OFF          *IN44
     C                   GOTO      START
     C                   ENDIF                                                  <*IN44
     C                   GOTO      START3
      *
     C     ENDPGM        TAG
     C                   MOVE      '1'           *INLR
     C                   RETURN
      *
      ***********************************************
     C     GETOPT        BEGSR
      ***********************************************
     C                   MOVE      'N'           ENDRET            1
     C                   MOVE      'N'           FLERTR            1
     C                   SETOFF                                       919299
     C     *IN98         DOWEQ     '0'
     C                   READC     STL01H50                               98
     C     *IN98         IFEQ      '1'
     C                   GOTO      ENDGET
     C                   ENDIF                                                  <*IN98
     C                   MOVEA     '000000'      *IN(30)
     C                   MOVE      *OFF          *IN45
      *
     C                   Z-ADD     ZRECNO        CURS1
      *
      *** 1=PLUKKING FRA TET
      *
     C     WSNR          IFEQ      '1'
     C     *IN60         ANDEQ     '1'
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN     GODSJF                             88
     C     *IN88         IFEQ      *OFF
     C     UTRNR         IFNE      *BLANKS
     C     GOTRNR        ANDEQ     *BLANKS
     C                   MOVEL     UTRNR         GOTRNR
     C                   END
     C                   MOVEL     GOGN          UGN
     C                   MOVEL     GOMOTT        UMOTT
     C     UTRNR         IFEQ      *BLANKS
     C                   MOVEL     GOTRNR        UTRNR
     C                   END
     C                   UPDATE    GODSJR
     C                   MOVE      'E'           GOHKOD
     C                   EXSR      gohist
     C                   END
     C                   SETON                                        LR
     C                   RETURN
     C                   END
      *
      *** 2=Endre
      *
     C     WSNR          IFEQ      '2'
     C                   MOVE      'J'           ENDRET
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN(N)  GODSJF                             88
     C                   EXSR      ENDRE
     C                   MOVE      *BLANK        WSNR
     C     GOGREN        COMP      *BLANKS                            5050
      * REVERSE VED MERKNADSJOURNAL
     C                   SETOFF                                       56
     C     MERKEY        CHAIN(N)  MERKNF                             33
     C  N33              SETON                                        56
     C  N12              EXSR      KDTFM3
     C                   UPDATE    STL01H50
     C                   ENDIF                                                  <WSNR
      *
      *** 4=Slette
      *
     C     WSNR          IFEQ      '4'
     C                   MOVE      *ON           *IN44
     C                   EXSR      SLETTE
     C                   MOVE      *BLANK        WSNR
     C                   UPDATE    STL01H50
     C                   ENDIF                                                  <WSNR
      *
      *** F=FLERE TRASITTERINGER
      **  IKKE VED FORH.REG
      ** FØRST ENDRES 1. POST
      *
     C  N61WSNR          IFEQ      'F'
     C                   MOVE      'J'           ENDRET
     C                   MOVE      'F'           FLERTR            1
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN(N)  GODSJF                             88
      *
      * HVIS 1. POST MANGLER TRANSITTERINGSNR GÅS TIL ENDRING FØRST
      *
     C     GOTRNR        IFEQ      *BLANKS
     C                   EXSR      ENDRE
     C                   END
      * OPPDATER SUBFIL
     C                   MOVE      *BLANK        WSNR
     C     GOGREN        COMP      *BLANKS                            5050
      * REVERSE VED MERKNADSJOURNAL
     C                   SETOFF                                       56
     C     MERKEY        CHAIN(N)  MERKNF                             33
     C  N33              SETON                                        56
     C  N12              EXSR      KDTFM3
     C                   UPDATE    STL01H50
      *
      *
     C     *IN12         IFEQ      '0'
     C                   SETON                                        43
     C                   EXSR      MOVEFW
     C                   EXSR      LAGNY
     C                   SETOFF                                       43
     C                   END
     C                   ENDIF                                                  <WSNR
      *
      *
      *** M = MERKNADSJOURNAL
      **  IKKE VED FORH.REG
      *
     C  N61WSNR          IFEQ      'M'
     C                   MOVE      'J'           ENDRET
     C                   MOVE      *ON           *IN44
     C                   EXSR      MERKSR
     C                   MOVE      *BLANK        WSNR
     C     GOGREN        COMP      *BLANKS                            5050
      * REVERSE VED MERKNADSJOURNAL
     C                   SETOFF                                       56
     C     MERKEY        CHAIN(N)  MERKNF                             33
     C  N33              SETON                                        56
     C                   UPDATE    STL01H50
     C                   ENDIF                                                  <WSNR
      *
      *** H = vis history
      *
     C     WSNR          IFEQ      'H'
     C                   MOVE      *ON           *IN44
     C                   EXSR      vishst
     C                   MOVE      *BLANK        WSNR
     C     GOGREN        COMP      *BLANKS                            5050
     C                   SETOFF                                       56
     C     MERKEY        CHAIN(N)  MERKNF                             33
     C  N33              SETON                                        56
     C                   UPDATE    STL01H50
     C                   ENDIF                                                  <WSNR
      *
N06   *
N06   *** S = SKILLEARK
N06   *
N06  C     WSNR          IFEQ      'S'
N06  C                   EXSR      PRTSKILL
N06  C                   MOVE      *BLANK        WSNR
N06  C                   UPDATE    STL01H50
N06  C                   ENDIF                                                  <WSNR
      *
      *** P D = SKRIV MERKNADSJOURNAL
      **  IKKE VED FORH.REG
      *
     C  N61WSNR          IFEQ      'P'
     C     WSNR          OREQ      'D'
     C                   MOVE      *ON           *IN44
     C                   EXSR      PRIMSR
     C                   MOVE      *BLANK        WSNR
     C     GOGREN        COMP      *BLANKS                            5050
      *
      * REVERSE VED MERKNADSJOURNAL
      *
     C                   SETOFF                                       56
     C     MERKEY        CHAIN(N)  MERKNF                             33
     C  N33              SETON                                        56
     C                   UPDATE    STL01H50
     C                   ENDIF                                                  <WSNR
      *
      *** 5=Vis
      *
     C     WSNR          IFEQ      '5'
     C                   MOVE      *ON           *IN45
     C                   MOVE      *ON           *IN41
     C*
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN(N)  GODSJF                             88
     C                   Move      *blanks       gohusr
     C                   Move      *zeros        gohdat
     C                   Move      *zeros        gohtim
     C     merkey        setll     godshf                             33
     C     merkey        reade     godshf
     c
     C     *IN88         IFEQ      *OFF
     C                   EXSR      MOVEFW
     C                   ENDIF                                                  <*IN88
     C                   Z-ADD     05            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   EXSR      KDTFM2
     C                   EXSR      NESTGO
     C                   EXFMT     STL01B20
     C                   EXSR      KDTFM2
     C                   MOVE      *BLANK        WSNR
     C     GOGREN        COMP      *BLANKS                            5050
      *
      * REVERSE VED MERKNADSJOURNAL
      *
     C                   SETOFF                                       56
     C     MERKEY        CHAIN(N)  MERKNF                             33
     C  N33              SETON                                        56
     C                   UPDATE    STL01H50
     C                   ENDIF                                                  <WSNR
      *
     C     *IN03         IFEQ      '1'
     C     *IN12         OREQ      '1'
     C                   GOTO      ENDGET
     C                   ENDIF                                                  <*IN03
      *
     C                   ENDDO
      *
     C     ENDGET        TAG
      *
     C                   ENDSR
      *
      ***********************************************
     C     INIT          BEGSR
      ***********************************************
N02  C     *LOVAL        SETLL     FIRM
N02  C                   READ      FIRM                                   33
      *
     C                   Z-ADD     0             ZRECNO            4 0
     C                   TIME                    DSTID
     C                   MOVE      DSAAR         UAAR
     C                   MOVE      DSMND         UMND
     C                   MOVE      DSDAG         UDAG
      * FØRSTE GANG TILORDNER UDATE
     C     UDATO         IFEQ      *BLANKS
     C                   MOVE      UDMA          UDATO
     C                   MOVE      UDMA          WSDANY
     C                   END
      *
     C                   MOVE      'N'           FLELBK
     C     *LOVAL        SETLL     GODSFI
     C                   READ      GODSFI                                 33
     C                   READ      GODSFI                                 33
N02  C                   DOW       *IN33 = *OFF
N02  C                   SELECT
N02  C                   WHEN      FILAND='SE' AND %SUBST(GFLBKO:4:2)=*BLANKS
N02  C                   LEAVE
N02  C                   WHEN      FILAND='NO' AND %SUBST(GFLBKO:4:2)<>*BLANKS
N02  C                   LEAVE
N02  C                   ENDSL
N02  C                   READ      GODSFI                                 33
N02  C                   ENDDO
     C   33              MOVE      GFLBKO        UULBKO
     C   33              MOVE      GFENH         UUENH
     C   33              EXSR      BYTTDA
      *
      * KALLER INITIERING VED FLER ENN 1 LAGERKODE
      *
     C     *IN33         IFEQ      '0'
      *
      * SKJEKKER OM AVDELING HAR LÅS BEVILNINGSKODE
      *
     C                   EXSR      TESTAV
     C     AVDLAS        IFEQ      'J'
     C                   MOVE      GFLBKO        UULBKO
     C                   MOVE      GFENH         UUENH
     C                   EXSR      BYTTDA
     C                   ELSE
     C                   MOVE      'J'           FLELBK            1
     C                   MOVE      *BLANKS       UULBKO            5
     C                   MOVE      *BLANKS       UUENH             1
     C                   MOVE      'N'           UUPDAT            1
      *
      * HENTER BEVILNINGSKODE OG DAGNR
      *
     C                   CALL      'SYTL03B'
     C                   PARM                    UULBKO
     C                   PARM                    UUENH
     C                   PARM                    UDATO             6
     C                   PARM                    UDAGNR            3
     C                   PARM                    UUPDAT            1
     C                   END
     C                   END
      *
      * FIKSER VARIABLE
      *
     C                   EXSR      FIXVAR
      *
      *
     C     *LIKE         DEFINE    SEGN          MXGN
     C     *LIKE         DEFINE    SETRNR        MXTRNR
     C     *LIKE         DEFINE    SEBILN        MXBILN
     C     *LIKE         DEFINE    SEAVG         MXAVG
      *
     C     BEVKEY        KLIST
     C                   KFLD                    UULBKO
     C                   KFLD                    UUENH
      *
     C     GODKE1        KLIST
     C                   KFLD                    SEGN
      *
      *
     C     GODKE2        KLIST
     C                   KFLD                    SEBILN
      *
     C     GODKE3        KLIST
     C                   KFLD                    SEAVG
      *
     C     GODKE4        KLIST
     C                   KFLD                    SETRNR
      *
     C     GODKE5        KLIST
     C                   KFLD                    WRGN
     C                   KFLD                    WRTRNR
      *
     C     GODKE6        KLIST
     C                   KFLD                    SETURN
      *
     C     GODK01        KLIST
     C                   KFLD                    WRGN
      *
     C     GODK04        KLIST
     C                   KFLD                    WRTRNR
      *
     C     GODK06        KLIST
     C                   KFLD                    WRTURN
      *
     C     AVDKEY        KLIST
     C                   KFLD                    AVDTES
      *
     C     MERKEY        KLIST
     C                   KFLD                    GOGN
     C                   KFLD                    GOTRNR
      *
      *
     C     MERKE2        KLIST
     C                   KFLD                    GOGN
     C                   KFLD                    GMTRNR
      *
      * PLUKKING
      *
     C     UPLUK         IFEQ      'P'
     C     UGN           ANDNE     *BLANKS
     C                   MOVEL     UGN           SEGN
     C     SEDAG         IFEQ      *BLANKS
     C                   MOVE      UDAGNR        SEDAG
     C                   END
     C                   END
      *
     C                   ENDSR
      ***********************************************
     C     SØK           BEGSR
      ***********************************************
N02  C                   IF        FILAND = 'SE'
N02  C                   EVAL      XBEVSEA = %SUBST(SEGN:1:7)
N02  C                   EVAL      GFLBKO  = %SUBST(SEGN:1:3)
N02  C                   END
      * KUN GODSNUMMER UTFYLT
     C     SETRNR        IFEQ      *BLANKS
     C     SEAVG         ANDEQ     *BLANKS
     C     SEBILN        ANDEQ     *BLANKS
     C     SEGN          andne     *BLANKS
N02  C     FILAND        ANDNE     'SE'
     C                   MOVEA     '1000'        *IN(51)
     C                   MOVEA     '0'           *IN(57)
     c                   movel     seaar         segn07            7
     C                   move      sedag         segn07
     C                   movel     segn07        segn10           10
     C                   call      'SYGE25CLB'
     C                   parm                    segn10
     C                   movel     segn10        wsdany
     C                   EXSR      BYTTDA
     C                   EXSR      FIXVAR
     c
     C                   ENDIF                                                  <SETRNR
      * TRANSITTERINGSNR UTFYLT
     C     SETRNR        IFNE      *BLANKS
     C                   MOVEA     '0001'        *IN(51)
     C                   MOVEA     '0'           *IN(57)
     C                   ENDIF                                                  <SETRNR
      * AVGANGSTOLLSTED UTFYLT
     C     SEAVG         IFNE      *BLANKS
     C                   MOVEA     '0010'        *IN(51)
     C                   MOVEA     '0'           *IN(57)
     C                   ENDIF                                                  <SEAVG
      * KJENNETEGN UTFYLT
     C     SEBILN        IFNE      *BLANKS
     C                   MOVEA     '0100'        *IN(51)
     C                   MOVEA     '0'           *IN(57)
     C                   ENDIF                                                  <SEBILN
      * TURNUMMER  UTFYLT
     C     SETURN        IFNE      *BLANKS
     C                   MOVEA     '0000'        *IN(51)
     C                   MOVEA     '1'           *IN(57)
     C                   ENDIF                                                  <SEBILN
      * FIX DATO
     C                   MOVE      *ZEROS        SDDATF
     C                   MOVE      SEFDD         SDFDD
     C                   MOVE      SEFMM         SDFMM
     C     SDDATF        IFNE      *ZEROS
     C     SEFÅÅ         IFGT      50
     C     SEFÅÅ         ADD       1900          SDFÅÅ
     C                   ELSE
     C     SEFÅÅ         ADD       2000          SDFÅÅ
     C                   END
     C                   END
      *
     C                   MOVE      *ZEROS        SDDATT
     C                   MOVE      SETDD         SDTDD
     C                   MOVE      SETMM         SDTMM
     C     SDDATT        IFNE      *ZEROS
     C     SETÅÅ         IFGT      50
     C     SETÅÅ         ADD       1900          SDTÅÅ
     C                   ELSE
     C     SETÅÅ         ADD       2000          SDTÅÅ
     C                   END
     C                   END
      *
     C                   ENDSR
      ***********************************************
     C     ENDRE         BEGSR
      ***********************************************
      * PROTEKT PÅ BILDET VED ENDRING
     C                   MOVE      *ON           *IN42
     C                   MOVE      *OFF          *IN41
     C     *IN88         IFEQ      *OFF
     C                   EXSR      MOVEFW
     C                   ENDIF                                                  <*IN88
     C     END01         TAG
     C*
     C* SETT CURSOR PÅ T1 VED ETTERBEHANDLING
     C*
     C     *IN62         IFEQ      '1'
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   ELSE
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     20            POSNBR
     C                   END
     C     CHG01         TAG
N04   * 49 ON = F10 = tilatt
N04  c                   setoff                                       49
N04  c                   if        WRORTN <> *blanks  and
N04  c                             (WRORTY='T1' or WRORTY='T2' or WRORTY='T-')
N04   * Vis F10 / aktiver tollager kun dersom minst en åpen mottaksrapport med atuelt MRNNR
N04  c                   eval      MRTRNR = WRORTN
N04  c     MRTRNR        setll     LLMRFL12
N04  c     MRTRNR        reade     LLMRFL12                               33
N04  c     *in33         doweq     '0'
N04  C     MRST          ifeq      ' '
N04  c                   leave
N04  c                   endif
N04  c     MRTRNR        reade     LLMRFL12                               33
N04  c                   enddo
N04  c                   if        *in33 = *off
N04  c                   seton                                        49
N04  c                   endif
N04  c                   endif
     C                   EXSR      KDTFM2
     C                   EXSR      NESTGO
     C                   EXFMT     STL01B20
     C                   EXSR      KDTFM2
     C                   EXSR      SETOFI
     C*
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C*
     C     *IN03         IFEQ      *ON
     C                   GOTO      END99
     C                   ENDIF                                                  <*IN03
     C     *IN12         IFEQ      *ON
     C                   GOTO      END99
     C                   ENDIF                                                  <*IN12
      * TEST UTFYLLING
     C                   EXSR      TESTBI
      * FEIL
     C     *IN30         IFEQ      *ON
     C                   GOTO      CHG01
     C                   ENDIF                                                  <*IN30
N04   * F10 = aktiver gitt MRNnr (kun M-rap(er) med status blank medfører aktivering.
N04  C     *in10         ifeq      *on
N04  c                   movel     WRORTN        XXTRNR           18            MRN-nr
N04  c                   movel     WRORTY        XXDK              2            T2/T1/T-
N04  c                   call      'SYXML17B2'
N04  c                   parm                    XXTRNR                         MRN-nr
N04  c                   parm                    XXDK                           T2/T1/T-
N04  C                   endif
      *
      * Oppdaterer posten
      *
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN     GODSJF                             88
     C     *IN88         IFEQ      '0'
     C                   MOVE      WRGN          GOGN
     C                   MOVE      WRMOTT        GOMOTT
     C                   MOVE      WRBILN        GOBILN
s04  C*** MIDLERTIDIG NÅR GOTTYP LAGRES SOM 3 SISTE I AVG.TOLLSTED
s04  C*    WRTTYP        IFEQ      *BLANKS
s04  C*                  MOVE      'T1 '         WRTTYP
s04  C*                  END
S04  C*                  MOVE      WRTTYP        WRAVG                          (*3 SISTE)
     C                   MOVE      WRAVG         GOAVG
n04  C     WRTRTY        IFEQ      *BLANKS
n04  C                   MOVEL     'T1   '       WRTRTY
n04  C                   END
n04  C                   MOVE      WRTRTY        GOTRTY
     C                   MOVE      WRTRNR        GOTRNR
N04  C                   MOVE      WRORTN        GOORTN
n04  C     WRORTN        IFNE      *BLANKS
n04  C     WRORTY        ANDEQ     *BLANKS
n04  C                   MOVEL     'T2   '       WRORTY
n04  C                   END
n04  C                   MOVE      WRORTY        GOORTY
     C                   MOVE      WRTURN        GOTURN
N02  C                   IF        WRTRDT = 0
N02  C                   EVAL      GOTRDT = 0
N02  C                   ELSE
     C     WRTRÅÅ        IFGT      50
     C     WRTRÅÅ        ADD       1900          GOTRÅÅ
     C                   ELSE
     C     WRTRÅÅ        ADD       2000          GOTRÅÅ
     C                   END
N02  C                   END
     C                   Z-ADD     WRTRMM        GOTRMM
     C                   Z-ADD     WRTRDD        GOTRDD
     C                   MOVE      WRGREN        GOGREN
     C     WRGRDT        IFEQ      *ZEROS
     C                   MOVE      *ZEROS        GOLSDT
     C                   ELSE
     C     WRGRÅÅ        IFGT      50
     C     WRGRÅÅ        ADD       1900          GOGRÅÅ
     C                   ELSE
     C     WRGRÅÅ        ADD       2000          GOGRÅÅ
     C                   END
     C                   MOVE      WRGRMM        GOGRMM
     C                   MOVE      WRGRDD        GOGRDD
     C                   END
     C                   MOVE      WRGRKL        GOGRKL
     C                   MOVE      WRLSEN        GOLSEN
     C     WRLSDT        IFEQ      *ZEROS
     C                   MOVE      *ZEROS        GOLSDT
     C                   ELSE
     C     WRLSÅÅ        IFGT      50
     C     WRLSÅÅ        ADD       1900          GOLSÅÅ
     C                   ELSE
     C     WRLSÅÅ        ADD       2000          GOLSÅÅ
     C                   END
     C                   MOVE      WRLSMM        GOLSMM
     C                   MOVE      WRLSDD        GOLSDD
     C                   END
     C                   MOVE      WRLSKL        GOLSKL
     C                   MOVE      WRTYPE        GOTYPE
     C                   MOVE      WRREI1        GOREI1
     C                   MOVE      WRREI2        GOREI2
     C                   MOVE      WRREI3        GOREI3
     C                   MOVE      WRREI4        GOREI4
     C                   UPDATE    GODSJR
     C                   MOVE      'E'           GOHKOD
     C                   EXSR      gohist
      * BYTTE TRANSITTNR PÅ MEKNADSRECORD OGSÅ
     C     GMTRNR        IFNE      WRTRNR
     C                   EXSR      SETTRN
     C                   END
      *
      * HVIS TURNUMMER ER BYTTET SKAL ALLE POSTER BYTTES
      *
     C                   EXSR      BYTTTU
      *
     C                   MOVE      *OFF          *IN30
      *
     C                   MOVE      WRGN          WRGN2             4
S02  C*    WRGN2         IFEQ      *BLANKS
S02  C*                  MOVEL     WRGN          SFFGN
S02  C*                  ELSE
     C                   MOVE      WRGN          SFFGN
S02  C*                  END
     C                   MOVEL     WRTURN        SFTURN
S02  C*                  MOVEL     WRBILN        SFBI10
S02  C*                  MOVE      SFBI10        SFTURN
N02  C                   MOVEL     WRBILN        SFBILN
     C                   MOVEL     WRAVG         SFAVG
N04  C*                  MOVE      WRAVG         SFTYPE
N04  C                   MOVEL     WRTRTY        SFTRTY
     C                   MOVEL     WRTRNR        SFTRNR
     C                   Z-ADD     WRTRÅÅ        SFTRÅÅ
     C                   Z-ADD     WRTRMM        SFTRMM
     C                   Z-ADD     WRTRDD        SFTRDD
     C                   ENDIF
      *
     C     END99         TAG
     C                   ENDSR
      ***********************************************
     C     LAGNY         BEGSR
      ***********************************************
      * SLÅ AV PROTEKT PÅ BILDET VED NY
     C                   MOVE      *OFF          *IN42
      *
      * LØKKE START  FOR Å LAGE FLERE I SAMME SLENGEN
      *
     C     LAGXX         TAG
      *
      * TØMM BILDET FØR NESTE POST
      *
     C                   EXSR      TOMM
     C                   MOVE      *OFF          *IN41
     C                   MOVE      *ON           *IN88                           = NY!!!
      *
      * SETT CURSOR
      *
     C     FLERTR        IFNE      'F'
     C                   Z-ADD     08            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   ELSE
     C                   Z-ADD     13            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   END
      *
      * TAR MED INNGANGSPARAMETER VED TET IMPORT
      *
     C     UTRNR         IFNE      *BLANKS
     C                   MOVEL     UTRNR         WRTRNR
     C                   MOVE      *BLANKS       UTRNR
     C                   END
N02  C                   IF        FILAND = 'SE'
N02  C                   IF        WRGN = *BLANKS
N02  C                   MOVEL     SEGN          WRGNSEA
N02  C                   EVAL      WRGNSEB = '00000'
N02  C                   END
N02  C                   ELSE
     C     WRGN          IFEQ      *BLANKS
     C                   MOVEL     XBEVDG        WRGN                             12 FØRSTE
     C                   MOVE      XBEVD3        WRGN                             3 SISTE
     C                   END
     C     WRGN13        IFEQ      *BLANKS
     C                   MOVE      '0'           WRGN13                           siffer 13
     C                   END
N02  C                   END
     C*
     C     LAG01         TAG
     C                   EXSR      KDTFM2
      *
      * VIS NESTE GODSNR
      *
     C                   EXSR      NESTGO
     C                   EXFMT     STL01B20
     C                   EXSR      KDTFM2
     C                   EXSR      SETOFI
     C*
     C     WSCLOC        DIV       256           LINNBR
     C                   MVR                     POSNBR
     C*
     C                   MOVEA     '000000'      *IN(30)
     C     *IN03         IFEQ      *ON
     C                   GOTO      LAG99
     C                   ENDIF                                                  <*IN03
     C     *IN12         IFEQ      *ON
     C                   GOTO      LAG99
     C                   ENDIF                                                  <*IN12
      * TEST UTFYLLING
     C                   EXSR      TESTBI
     C     *IN30         IFEQ      *ON
     C                   GOTO      LAG01
     C                   ENDIF                                                  <*IN30
      *
      * Skriver posten
      *
     C     WRGN13        IFEQ      *BLANKS
     C                   MOVE      '0'           WRGN13                           siffer 13
     C                   END
      *
      * FLTTER EVENTUELLT MANUELLT NUMMER
      *
N02  C                   IF        FILAND = 'SE'
N02  C                   IF        GOMANSE <> 0
N02  C                   MOVEL     GOMANSE       XAN05             5
N02  C                   EVAL      WRGNSEB = XAN05
N02  C                   END
N02  C                   ELSE
     C     GOMAN         IFNE      *ZEROS
     C                   MOVE      GOMAN         WRGN
     C                   END
N02  C                   END
      *
      * TILDELER NESTE NUMMER IKKE VED F = FLERE PÅ SAMME
      *
     C     FLERTR        IFNE      'F'
N02  C                   IF        FILAND = 'SE'
N02  C                   IF        GOMANSE = 0
N02  C     WRGNSEA       CHAIN     GODSGFSE                           33
N02  C                   IF        *IN33
N02  C                   EVAL      GSEGN1 = WRGNSEA
N02  C                   EVAL      GSEGN2 = '00002'
N02  C                   WRITE     GODSGFSER
N02  C                   EVAL      WRGNSEB = '00001'
N02  C                   ELSE
N02  C                   EVAL      WRGNSEB = GSEGN2
N02  C                   MOVE      GSEGN2        XNR05             5 0
N02  C                   ADD       1             XNR05
N02  C                   MOVE      XNR05         GSEGN2
N02  C                   UPDATE    GODSGFSER
N02  C                   END
N02  C                   END
N02  C                   ELSE
     C     GOMAN         IFEQ      *ZEROS
     C     XAN13         CHAIN     GODSGF                             33
      ********************************************************
      * PASSERT 99 NÅR TELLER ER GÅTT TILBAKE TIL 00
      *******************************************************
     C                   SETOFF                                       34
     C  N33GGGN2         IFEQ      '00'
     C                   UPDATE    GODSGFR
     C                   MOVE      WRGN13        NUM13             1 0
     C     *IN34         DOWEQ     '0'
     C                   ADD       1             NUM13
     C                   MOVE      NUM13         WRGN13
     C     XAN13         CHAIN     GODSGF                             34
     C  N34GGGN2         IFNE      '00'
     C                   GOTO      UTTEL
     C                   END
     C                   END
     C                   END
      *
     C     UTTEL         TAG
      *
      * 34 NY POST OVER 99
      *
     C     *IN34         IFEQ      '1'
     C                   MOVE      '00'          WRGN
     C                   MOVE      XAN13         GGGN1
     C                   MOVE      '01'          GGGN2
     C                   WRITE     GODSGFR
     C                   ELSE
      *
      * NESTE NUMMER
      *
     C     *IN33         IFEQ      '0'
     C                   MOVE      GGGN2         WRGN
     C                   MOVE      GGGN2         XNR02             2 0
     C                   ADD       1             XNR02
     C                   MOVE      XNR02         GGGN2
     C                   UPDATE    GODSGFR
     C                   ELSE
      * FØRSTE PÅ ANGITT DATO
     C                   MOVE      '01'          WRGN
     C                   MOVE      XAN13         GGGN1
     C                   MOVE      '02'          GGGN2
     C                   WRITE     GODSGFR
     C                   END
     C                   END
     C                   END
     C                   END
N02  C                   END
      *
      * FLYTTER SKJERMVARIABLE TIL FIL
      *
N03  c     goturn        ifeq      *blanks
N03  C                   MOVE      WRTURN        GOTURN
N03  c                   end
     C                   MOVE      WRGN          GOGN
     C                   MOVE      WRMOTT        GOMOTT
     C                   MOVE      WRBILN        GOBILN
s04  C*** MIDLERTIDIG NÅR GOTTYP LAGRES SOM 3 SISTE I AVG.TOLLSTED
s04  C*    WRTTYP        IFEQ      *BLANKS
s04  C*                  MOVE      'T1 '         WRTTYP
s04  C*                  END
S04  C*                  MOVE      WRTTYP        WRAVG                          (*3 SISTE)
     C                   MOVE      WRAVG         GOAVG
n04  C     WRTRTY        IFEQ      *BLANKS
n04  C                   MOVEL     'T1'          WRTRTY
n04  C                   END
n04  C                   MOVE      WRTRTY        GOTRTY
     C                   MOVE      WRTRNR        GOTRNR
n04  C                   MOVE      WRORTN        GOORTN
n04  C     WRORTN        IFNE      *BLANKS
n04  C     WRORTY        ANDEQ     *BLANKS
n04  C                   MOVEL     'T2   '       WRORTY
n04  C                   END
n04  C                   MOVE      WRORTY        GOORTY
     C     WRTRÅÅ        IFGT      50
     C     WRTRÅÅ        ADD       1900          GOTRÅÅ
     C                   ELSE
     C     WRTRÅÅ        ADD       2000          GOTRÅÅ
     C                   END
     C                   Z-ADD     WRTRMM        GOTRMM
     C                   Z-ADD     WRTRDD        GOTRDD
     C                   MOVE      WRGREN        GOGREN
     C     WRGRÅÅ        IFGT      50
     C     WRGRÅÅ        ADD       1900          GOGRÅÅ
     C                   ELSE
     C     WRGRÅÅ        ADD       2000          GOGRÅÅ
     C                   END
     C                   MOVE      WRGRMM        GOGRMM
     C                   MOVE      WRGRDD        GOGRDD
     C                   MOVE      WRGRKL        GOGRKL
     C                   MOVE      WRLSEN        GOLSEN
     C     WRLSÅÅ        IFGT      50
     C     WRLSÅÅ        ADD       1900          GOLSÅÅ
     C                   ELSE
     C     WRLSÅÅ        ADD       2000          GOLSÅÅ
     C                   END
     C                   MOVE      WRLSMM        GOLSMM
     C                   MOVE      WRLSDD        GOLSDD
     C                   MOVE      WRLSKL        GOLSKL
     C                   MOVE      WRTYPE        GOTYPE
     C                   MOVE      WRREI1        GOREI1
     C                   MOVE      WRREI2        GOREI2
     C                   MOVE      WRREI3        GOREI3
     C                   MOVE      WRREI4        GOREI4
     C                   WRITE     GODSJR
     C                   MOVE      'N'           GOHKOD
     C                   EXSR      gohist
      * RETURNER AUTOMATISK VED PLUKKING
     C     *IN60         IFEQ      '1'
     C     UTRNR         IFNE      *BLANKS
     C                   MOVEL     UTRNR         GOTRNR
     C                   END
     C                   MOVEL     GOGN          UGN
     C                   MOVEL     GOMOTT        UMOTT
     C                   MOVEL     GOTRNR        UTRNR
     C                   SETON                                        LR
     C                   RETURN
     C                   END
     C                   MOVE      GOTRNR        SISTTR
      *
      * HVIS TURNUMMER ER BYTTET SKAL ALLE POSTER BYTTES
      *
     C                   EXSR      BYTTTU
     C                   MOVE      'JOV0728'     MSGNR
     C                   MOVE      *ON           *IN30
     C                   MOVE      *ZEROS        GOMAN
N02  C                   MOVE      *ZEROS        GOMANSE
     C                   GOTO      LAGXX
      *
     C     LAG99         TAG
     C                   ENDSR
      ***********************************************
     C     SLETTE        BEGSR
      ***********************************************
     C                   MOVE      *ON           *IN41
     C     SLET1         TAG
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN(N)  GODSJF                             88
     C     *IN88         IFEQ      *OFF
     C                   MOVE      GOGN          WRGN
     C                   MOVE      GOMOTT        WRMOTT
     C                   MOVE      GOBILN        WRBILN
     C                   MOVE      GOAVG         WRAVG
s04  C**                 MOVE      GOTTYP        WRTTYP
s04  C                   MOVE      GOTRTY        WRTRTY
     C                   MOVE      GOTRNR        WRTRNR
     C                   MOVE      GOTRNR        GMTRNR
n04  C                   MOVE      GOORTN        WRORTN
n04  C                   MOVE      GOORTY        WRORTY
     C                   Z-ADD     GOTRMM        WRTRMM
     C                   Z-ADD     GOTRDD        WRTRDD
     C                   MOVE      GOGREN        WRGREN
     C                   MOVE      GOGRDD        WRGRDD
     C                   MOVE      GOGRMM        WRGRMM
     C                   MOVE      GOGRÅÅ        WRGRÅÅ
     C                   MOVE      GOGRKL        WRGRKL
     C                   MOVE      GOLSEN        WRLSEN
     C                   MOVE      GOLSDD        WRLSDD
     C                   MOVE      GOLSMM        WRLSMM
     C                   MOVE      GOLSÅÅ        WRLSÅÅ
     C                   MOVE      GOLSKL        WRLSKL
     C                   MOVE      GOTYPE        WRTYPE
     C                   MOVE      GOREI1        WRREI1
     C                   MOVE      GOREI2        WRREI2
     C                   MOVE      GOREI3        WRREI3
     C                   MOVE      GOREI4        WRREI4
     C                   ENDIF                                                  <*IN88
     C                   Z-ADD     05            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   EXSR      KDTFM2
     C                   EXSR      NESTGO
     C                   EXFMT     STL01B20
     C                   EXSR      KDTFM2
     C                   MOVEA     '000000'      *IN(30)
     C     *IN03         IFEQ      *ON
     C                   GOTO      SLET99
     C                   ENDIF                                                  <*IN03
     C     *IN12         IFEQ      *ON
     C                   GOTO      SLET99
     C                   ENDIF                                                  <*IN12
      *
      * Oppdaterer posten
      *
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN     GODSJF                             88
     C     *IN88         IFEQ      '0'
     C                   MOVE      *BLANKS       GOTRNR
     C                   MOVEL     '*SLETTET'    GOTRNR
     C                   MOVE      *BLANKS       WRTRNR
     C                   MOVEL     '*SLETTET'    WRTRNR
     C                   UPDATE    GODSJR
     C                   MOVE      'E'           GOHKOD
     C                   EXSR      gohist
     C                   EXSR      SETTRN
     C                   ENDIF                                                  <*IN88
      *
     C     SLET99        TAG
     C                   ENDSR
      *
      ***********************************************
     C     TOMM          BEGSR
      ***********************************************
      *
      * TØMMER             VED NY POST
      *
     C     FLERTR        IFEQ      'F'
     C                   MOVE      *BLANKS       WRTRNR
     C                   ELSE
     C                   MOVE      *BLANKS       WRTRNR
     C                   MOVE      *BLANKS       WRTURN
     C                   MOVE      *BLANKS       WRGN
     C                   MOVE      *BLANKS       WRBILN
S04  C*                  MOVE      *BLANK        WRTTYP
N04  C                   MOVE      *BLANK        WRTRTY
n04  C                   MOVE      *BLANK        WRORTN
n04  C                   MOVE      *BLANK        WRORTY
     C                   MOVE      *BLANKS       WRGREN
     C                   MOVE      *BLANKS       GMTRNR
     C                   MOVE      *ZEROS        WRTRÅÅ
     C                   MOVE      *ZEROS        WRTRMM
     C                   MOVE      *ZEROS        WRTRDD
     C                   MOVE      *ZEROS        WRGRDD
     C                   MOVE      *ZEROS        WRGRMM
     C                   MOVE      *ZEROS        WRGRÅÅ
     C                   MOVE      *ZEROS        WRGRKL
     C                   MOVEL     GFLBS1        WRMOTT
     C                   MOVE      *BLANKS       WRAVG
     C                   MOVE      *BLANKS       WRLSEN
     C                   MOVE      *ZEROS        WRLSDD
     C                   MOVE      *ZEROS        WRLSMM
     C                   MOVE      *ZEROS        WRLSÅÅ
     C                   MOVE      *ZEROS        WRLSKL
     C                   MOVE      *BLANKS       WRTYPE
     C                   MOVE      *BLANKS       WRREI1
     C                   MOVE      *BLANKS       WRREI2
     C                   MOVE      *BLANKS       WRREI3
     C                   MOVE      *BLANKS       WRREI4
     C                   END
     C                   ENDSR
      *
      ***********************************************
     C     MERKSR        BEGSR
      ***********************************************
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN(N)  GODSJF                             88
     C     *IN88         IFEQ      *OFF
     C                   MOVE      GOTRDT        UTRDT             8 0
     C                   CALL      'SYTL05'
     C                   PARM                    GOGN
     C                   PARM                    GOTRNR
     C                   PARM                    UTRDT
     C                   END
     C                   ENDSR
      ***********************************************
     C     PRIMSR        BEGSR
      ***********************************************
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN(N)  GODSJF                             88
     C     *IN88         IFEQ      *OFF
     C                   CALL      'SYTL06CL'
     C                   PARM                    GOGN
     C                   PARM                    WSNR
     C                   END
     C                   ENDSR
      *
      ***********************************************
     C     SETOFI        BEGSR
      ***********************************************
     C                   MOVEA     '000000'      *IN(30)
     C                   MOVEA     '0000000'     *IN(70)
s01  C*                  MOVEA     '0'           *IN(78)
n01  C                   MOVEA     '00'          *IN(78)
     C                   ENDSR
      *
      ***********************************************
     C     TESTBI        BEGSR
      ***********************************************
      *
      * HENTER EVENTUELLE TURDATA
      *
     C     WRTURN        IFNE      *BLANKS
     C                   CALL      'SYTL07'
     C                   PARM                    WRTURN
     C                   PARM                    XXBILN           13
     C                   PARM                    XXFRA            20
     C                   PARM                    XXTIL            20
     C                   PARM                    XXTOLL            8
      * TILBAKEFØRER FRA SYSPED
     C     WRBILN        IFEQ      *BLANKS
     C                   MOVE      XXBILN        WRBILN
     C                   END
     C     WRREI1        IFEQ      *BLANKS
     C                   MOVE      XXFRA         WRREI1
     C                   END
     C     WRREI4        IFEQ      *BLANKS
     C                   MOVE      XXTIL         WRREI4
     C                   END
     C     WRAVGT        IFEQ      *BLANKS
     C                   MOVEL     XXTOLL        WRAVG
     C                   END
     C                   END
      *
      * VED FORHÅNDSREGISTRERING MÅ TOLLSTED TASTES
      *
     C   61WRGREN        IFEQ      *BLANKS
     C                   SETON                                        7630
     C                   MOVE      'SHU0965'     MSGNR
     C                   Z-ADD     8             LINNBR
     C                   Z-ADD     20            POSNBR
     C                   GOTO      UTTST
     C                   END
      *
      * GODKJENNER OVT OVERTALLIG SLETTET
      *
     c                   movel     wrtrnr        star              1
     c     star          ifne      '*'
      *
      * VED ETTERBEHANDLIN MÅ TRANSITT NUMMER REGISTRERES
      *
     C   62WRTRNR        IFEQ      *BLANKS
     C                   SETON                                        7430
     C                   MOVE      'SHU0961'     MSGNR
     C                   Z-ADD     14            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   GOTO      UTTST
     C                   END
      *
N01   * VED BYTTE AV TRANSITTNUMMER MÅ IKKE TILNUMMER FINNES FRA FØR
      *
N01  C     WRMOTT        IFEQ      *BLANKS
N01  C                   SETON                                        7930
N01  C                   MOVE      'SHU1248'     MSGNR
N01  C                   Z-ADD     12            LINNBR
N01  C                   Z-ADD     20            POSNBR
N01  C                   GOTO      UTTST
N01  C                   END
      *
      *
      * VED BYTTE AV TRANSITTNUMMER MÅ IKKE TILNUMMER FINNES FRA FØR
      *
     C     WRTRNR        IFNE      GMTRNR
     C     GODK04        CHAIN     GODSJL04                           33
     C     *IN33         IFNE      '1'
     C                   SETON                                        7430
     C                   MOVE      'SHU0962'     MSGNR
     C                   Z-ADD     14            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   GOTO      UTTST
     C                   END
     C                   END
      *
      * VED NY POST MÅ IKKE KOMBINASJON GODSNR TRANSITTNR FINNES FRA FØR
      * VED ENDRING SKAL ENDRET TIL IKKE FINNES FRA FØR
      *
      *
     C     GODKE5        CHAIN     GODSJL05                           34
     C     *IN34         IFEQ      '0'
     C     *IN42         IFEQ      '0'
     C                   SETON                                        7430
     C                   MOVE      'SHU0944'     MSGNR
     C                   Z-ADD     14            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   GOTO      UTTST
      *
      *ENDRING  VED BYTTE MÅ IKKE TRANSITTERINGSNR FINNES FRA FØR
      *PÅ SAMME TUR
     C                   ELSE
     C     GMTRNR        IFNE      WRTRNR
     C                   SETON                                        7430
     C                   MOVE      'SHU0945'     MSGNR
     C                   Z-ADD     14            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   GOTO      UTTST
     C                   END
     C                   END
     C                   END
     C                   END
      *
      * Turnummer må inntastes
      *
      *
      * VED TASTET TURNUMMER MÅ IKKE TUR FINNES PÅ ANNET GODSNR
      *
     C     WRTURN        IFNE      *BLANKS
     C                   EXSR      TURTST
     C   75              MOVE      'SHU0958'     MSGNR
     C   75              SETON                                        30
     C   75              Z-ADD     9             LINNBR
     C   75              Z-ADD     20            POSNBR
     C   75              GOTO      UTTST
     C                   END
      *
      *
      *
     C     *IN73         IFEQ      '0'
     C     XAN13         COMP      *BLANKS                                73
     C     *IN73         IFEQ      '1'
     C                   MOVE      'SPG0009'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     5             LINNBR
     C                   Z-ADD     20            POSNBR
     C                   GOTO      UTTST
     C                   END
     C                   END
      *
      * BILNUMMER MÅ TASTES
      *
     C     WRBILN        IFEQ      *BLANKS
     C                   SETON                                        7830
     C                   MOVE      'SHU0966'     MSGNR
     C                   Z-ADD     10            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   GOTO      UTTST
     C                   END
      *
N04   * når Original T-papir angis må type ver T1/T2/TN
N04  C     WRORTN        IFNE      *BLANKS
N04  C     WRORTY        ifeq      *blanks
N04  C                   eval      WRORTY = 'T2'
N04  C                   endif
N04  C     WRORTY        ifne      'T1'
N04  C     WRORTY        andne     'T2'
N04  C     WRORTY        andne     'T-'
N04  C                   SETON                                          30
N04  C                   MOVE      'JOV1779'     MSGNR
N04  C                   Z-ADD     17            LINNBR
N04  C                   Z-ADD     69            POSNBR
N04  C                   GOTO      UTTST
N04  C                   endif
N04  C                   END
      * SJEKK AKTUELLE DATO-FELT
      * TRANSITT DATO VED UTFYLLT ELLER ETTERBAHANDLING
      *
     C     WRTRDT        IFNE      *ZEROS
     C     *IN62         OREQ      '1'
     C                   MOVE      WRTRÅÅ        UÅÅ               2 0
     C                   MOVE      WRTRMM        UMM               2 0
     C                   MOVE      WRTRDD        UDD               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      70
     C   70*IN30         IFEQ      '0'
     C                   MOVE      'SPD0001'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     15            LINNBR
     C                   Z-ADD     20            POSNBR
     C                   GOTO      UTTST
     C                   END
     C                   END
      *
      *
     C     WRGRDT        IFNE      *ZEROS
     C                   MOVE      WRGRÅÅ        UÅÅ               2 0
     C                   MOVE      WRGRMM        UMM               2 0
     C                   MOVE      WRGRDD        UDD               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      71
     C   71*IN30         IFEQ      '0'
     C                   MOVE      'SPD0001'     MSGNR
     C                   SETON                                        30
S02  C*                  Z-ADD     19            LINNBR
N02  C                   Z-ADD     8             LINNBR
     C                   Z-ADD     41            POSNBR
     C                   GOTO      UTTST
     C                   END
     C                   END
      *
      *
     C     WRLSDT        IFNE      *ZEROS
     C                   MOVE      WRLSÅÅ        UÅÅ               2 0
     C                   MOVE      WRLSMM        UMM               2 0
     C                   MOVE      WRLSDD        UDD               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        COMP      1                                      72
     C   72*IN30         IFEQ      '0'
     C                   MOVE      'SPD0001'     MSGNR
     C                   SETON                                        30
     C                   Z-ADD     20            LINNBR
     C                   Z-ADD     41            POSNBR
     C                   GOTO      UTTST
     C                   END
     C                   END
      *
     C     UTTST         ENDSR
     C***********************************************
     C     KDTFMT        BEGSR
     C***********************************************
      * SELEKSJONSBILDE
      * FRADATO
     C                   MOVE      SEFDD         UDT1              2 0
     C                   MOVE      SEFMM         UDT2              2 0
     C                   MOVE      SEFÅÅ         UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          SEFDD
     C                   MOVE      UDT2          SEFMM
     C                   MOVE      UDT3          SEFÅÅ
     C*
      * TILDATO
     C                   MOVE      SETDD         UDT1              2 0
     C                   MOVE      SETMM         UDT2              2 0
     C                   MOVE      SETÅÅ         UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          SETDD
     C                   MOVE      UDT2          SETMM
     C                   MOVE      UDT3          SETÅÅ
     C*
     C                   ENDSR
      *
     C***********************************************
     C     KDTFM2        BEGSR
     C***********************************************
      * BILDE FOR EN GODSJOURNAL-POST
      * TRANSIT-DATO
     C                   MOVE      WRTRDD        UDT1              2 0
     C                   MOVE      WRTRMM        UDT2              2 0
     C                   MOVE      WRTRÅÅ        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          WRTRDD
     C                   MOVE      UDT2          WRTRMM
     C                   MOVE      UDT3          WRTRÅÅ
     C*
      * GRENSE-PASS-DATO
     C                   MOVE      WRGRDD        UDT1              2 0
     C                   MOVE      WRGRMM        UDT2              2 0
     C                   MOVE      WRGRÅÅ        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          WRGRDD
     C                   MOVE      UDT2          WRGRMM
     C                   MOVE      UDT3          WRGRÅÅ
     C*
      * LOSSSESTED-DATO
     C                   MOVE      WRLSDD        UDT1              2 0
     C                   MOVE      WRLSMM        UDT2              2 0
     C                   MOVE      WRLSÅÅ        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          WRLSDD
     C                   MOVE      UDT2          WRLSMM
     C                   MOVE      UDT3          WRLSÅÅ
     C*
     C                   ENDSR
      *
     C***********************************************
     C     KDTFM3        BEGSR
     C***********************************************
      * SUBFIL-BILDE
      * TRANSIT-DATO
     C                   MOVE      SFTRDD        UDT1              2 0
     C                   MOVE      SFTRMM        UDT2              2 0
     C                   MOVE      SFTRÅÅ        UDT3              2 0
     C                   CALL      'DATOFMT'
     C                   PARM                    UDT1
     C                   PARM                    UDT2
     C                   PARM                    UDT3
     C                   MOVE      UDT1          SFTRDD
     C                   MOVE      UDT2          SFTRMM
     C                   MOVE      UDT3          SFTRÅÅ
     C*
     C                   ENDSR
      *
     C***********************************************
     C     TURTST        BEGSR
     C***********************************************
      *
      * TEST AT IKKE TUR FINNES MED ET ANNET GODSNUMMER
      *
     C                   SETOFF                                       33
     C     GODK06        SETLL     GODSJL06
     C     *IN33         DOWEQ     '0'
     C     GODK06        READE     GODSJL06                               33
     C     *IN33         IFEQ      '0'
     C     GOGN          ANDNE     WRGN
     C                   SETON                                        75
     C                   GOTO      UTTUR
     C                   END
     C                   END
     C     UTTUR         ENDSR
      *
     C***********************************************
     C     TESTAV        BEGSR
     C***********************************************
      *
      * SKJEKKER OM LÅST AVDELING TIL BEVILNINGSKODE
      *
     C                   MOVE      'N'           AVDLAS            1
     C                   MOVE      UUAVD         UUAVDA
     C                   MOVE      UUAVDA        AVDTES            4
     C     AVDKEY        CHAIN     GODSAF                             33
N02  C                   DOW       *IN33 = *OFF
N02  C                   SELECT
N02  C                   WHEN      FILAND='SE' AND %SUBST(GFLBKO:4:2)=*BLANKS
N02  C                   LEAVE
N02  C                   WHEN      FILAND='NO' AND %SUBST(GFLBKO:4:2)<>*BLANKS
N02  C                   LEAVE
N02  C                   ENDSL
N02  C     AVDKEY        READE     GODSAF                                 33
N02  C                   ENDDO
      * XER FRA POS 1 -> 2
     C   33              MOVE      'X'           UUAVD1
     C   33              MOVE      UUAVDA        AVDTES            4
     C   33AVDKEY        CHAIN     GODSAF                             33
N02  C                   DOW       *IN33 = *OFF
N02  C                   SELECT
N02  C                   WHEN      FILAND='SE' AND %SUBST(GFLBKO:4:2)=*BLANKS
N02  C                   LEAVE
N02  C                   WHEN      FILAND='NO' AND %SUBST(GFLBKO:4:2)<>*BLANKS
N02  C                   LEAVE
N02  C                   ENDSL
N02  C     AVDKEY        READE     GODSAF                                 33
N02  C                   ENDDO
     C   33              MOVE      'X'           UUAVD2
     C   33              MOVE      UUAVDA        AVDTES            4
     C   33AVDKEY        CHAIN     GODSAF                             33
N02  C                   DOW       *IN33 = *OFF
N02  C                   SELECT
N02  C                   WHEN      FILAND='SE' AND %SUBST(GFLBKO:4:2)=*BLANKS
N02  C                   LEAVE
N02  C                   WHEN      FILAND='NO' AND %SUBST(GFLBKO:4:2)<>*BLANKS
N02  C                   LEAVE
N02  C                   ENDSL
N02  C     AVDKEY        READE     GODSAF                                 33
N02  C                   ENDDO
     C   33              MOVE      'X'           UUAVD3
     C   33              MOVE      UUAVDA        AVDTES            4
     C   33AVDKEY        CHAIN     GODSAF                             33
N02  C                   DOW       *IN33 = *OFF
N02  C                   SELECT
N02  C                   WHEN      FILAND='SE' AND %SUBST(GFLBKO:4:2)=*BLANKS
N02  C                   LEAVE
N02  C                   WHEN      FILAND='NO' AND %SUBST(GFLBKO:4:2)<>*BLANKS
N02  C                   LEAVE
N02  C                   ENDSL
N02  C     AVDKEY        READE     GODSAF                                 33
N02  C                   ENDDO
      * XER FRA POS 3 -> 4
     C   33              MOVE      UUAVD         UUAVDA
     C   33              MOVE      UUAVDA        AVDTES            4
     C   33              MOVE      'X'           UUAVD4
     C   33              MOVE      UUAVDA        AVDTES            4
     C   33AVDKEY        CHAIN     GODSAF                             33
N02  C                   DOW       *IN33 = *OFF
N02  C                   SELECT
N02  C                   WHEN      FILAND='SE' AND %SUBST(GFLBKO:4:2)=*BLANKS
N02  C                   LEAVE
N02  C                   WHEN      FILAND='NO' AND %SUBST(GFLBKO:4:2)<>*BLANKS
N02  C                   LEAVE
N02  C                   ENDSL
N02  C     AVDKEY        READE     GODSAF                                 33
N02  C                   ENDDO
     C   33              MOVE      'X'           UUAVD3
     C   33              MOVE      UUAVDA        AVDTES            4
     C   33AVDKEY        CHAIN     GODSAF                             33
N02  C                   DOW       *IN33 = *OFF
N02  C                   SELECT
N02  C                   WHEN      FILAND='SE' AND %SUBST(GFLBKO:4:2)=*BLANKS
N02  C                   LEAVE
N02  C                   WHEN      FILAND='NO' AND %SUBST(GFLBKO:4:2)<>*BLANKS
N02  C                   LEAVE
N02  C                   ENDSL
N02  C     AVDKEY        READE     GODSAF                                 33
N02  C                   ENDDO
     C   33              MOVE      'X'           UUAVD2
     C   33              MOVE      UUAVDA        AVDTES            4
     C   33AVDKEY        CHAIN     GODSAF                             33
N02  C                   DOW       *IN33 = *OFF
N02  C                   SELECT
N02  C                   WHEN      FILAND='SE' AND %SUBST(GFLBKO:4:2)=*BLANKS
N02  C                   LEAVE
N02  C                   WHEN      FILAND='NO' AND %SUBST(GFLBKO:4:2)<>*BLANKS
N02  C                   LEAVE
N02  C                   ENDSL
N02  C     AVDKEY        READE     GODSAF                                 33
N02  C                   ENDDO
     C  N33              MOVE      'J'           AVDLAS
     C                   ENDSR
      *
     C***********************************************
     C     BYTTDA        BEGSR
     C***********************************************
      *
      *
      * LOGIKK VED DATOBYTTE
      *
N02  C                   IF        FILAND = 'SE'
N02  C                   MOVE      *ZEROS        WSDATOSE          8 0
N02  C                   MOVE      WSDANY        XNR04             4 0
N02  C                   MOVE      XNR04         XNR02             2 0
N02  C                   EVAL      WSDATOSE = 20000000 + XNR02 * 10000
N02  C                   MOVEL     XNR04         XNR02
N02  C                   EVAL      WSDATOSE = WSDATOSE + XNR02 * 100
N02  C                   MOVEL     WSDANY        XNR02
N02  C                   EVAL      WSDATOSE = WSDATOSE + XNR02
N02  C                   ELSE
     C                   MOVE      WSDANY        UDATO             6
     C                   CALL      'SYGE25CL'
     C                   PARM                    UDATO
     C                   PARM                    UDAGNR            3
     C                   MOVE      UDATO         WSDATO
     C                   MOVE      UDAGNR        WSDAGN
N02  C                   END
     C                   ENDSR
      *
     C***********************************************
     C     FIXVAR        BEGSR
     C***********************************************
      *
      *
      * FIKSET VARIABLE ETTER DATOBYTTE
      *
      *
      * FLYTTER PARAMETRE TIL SKJERM
      *
     C                   MOVE      UDATO         WSDATO
     C                   MOVE      UDAGNR        WSDAGN
     C     BEVKEY        CHAIN     GODSFI                             33
     C   33              SETON                                        LR
     C   33              RETURN
      *
      * START MED Å FIKSE NØKKELFELT
      *
     C*
      *
     C                   MOVEA     '1000'        *IN(51)
     C                   MOVE      wsdato        XBEVD1            4
     C                   MOVEl     '20'          XBEVD1            4
N02  C                   IF        FILAND = 'SE'
N02  C                   EVAL      SEGN = %TRIM(GFLBKO) + '-  -'
N02  C                   EVAL      %SUBST(SEGN:5:2) = %SUBST(XBEVD1:3:2)
N02  C                   MOVEL     SEGN          XBEVSEA           7
N02  C                   EVAL      *IN39 = *ON
N02  C                   ELSE
N02  C                   EVAL      *IN39 = *OFF
     C                   MOVEL     GFLBKO        XBEVD2            8
     C                   MOVE      UDAGNR        XBEVD2
     C                   MOVEL     XBEVD1        XBEVDG           12
     C                   MOVE      XBEVD2        XBEVDG
     C                   MOVEL     XBEVDG        SEGN
     C                   MOVEL     GFENH         XBEVD3            3
     C                   MOVE      XBEVD3        SEGN
N02  C                   END
     C                   MOVE      *BLANKS       WRGN
     C                   MOVEL     GFENH         SEENH
     C                   Z-ADD     0             SEDATF
     C                   Z-ADD     0             SEDATT
     C                   Z-ADD     0             SDDATF
     C                   Z-ADD     0             SDDATT
     C                   Z-ADD     0             WRTRDT
     C                   Z-ADD     0             WRGRDT
     C                   Z-ADD     0             WRLSDT
     C                   Z-ADD     0             GOTRDT
     C                   Z-ADD     0             GOGRDT
     C                   Z-ADD     0             GOLSDT
     C                   ENDSR
      *
     C***********************************************
     C     MOVEFW        BEGSR
     C***********************************************
      *
     C                   MOVE      GOGN          WRGN
     C                   MOVE      GOMOTT        WRMOTT
     C                   MOVE      GOBILN        WRBILN
     C                   MOVE      GOAVG         WRAVG
S04  C*                  MOVE      GOTTYP        WRTTYP
N04  C                   MOVE      GOTRTY        WRTRTY
     C                   MOVE      GOTRNR        WRTRNR
N04  C                   MOVE      GOORTN        WRORTN
N04  C                   MOVE      GOORTY        WRORTY
     C                   MOVE      GOTURN        WRTURN
     C                   MOVE      GOTRNR        GMTRNR           20
     C                   MOVE      GOTRÅÅ        WRTRÅÅ
     C                   Z-ADD     GOTRMM        WRTRMM
     C                   Z-ADD     GOTRDD        WRTRDD
     C                   MOVE      GOGREN        WRGREN
     C                   MOVE      GOGRDD        WRGRDD
     C                   MOVE      GOGRMM        WRGRMM
     C                   MOVE      GOGRÅÅ        WRGRÅÅ
     C                   MOVE      GOGRKL        WRGRKL
     C                   MOVE      GOLSEN        WRLSEN
     C                   MOVE      GOLSDD        WRLSDD
     C                   MOVE      GOLSMM        WRLSMM
     C                   MOVE      GOLSÅÅ        WRLSÅÅ
     C                   MOVE      GOLSKL        WRLSKL
     C                   MOVE      GOTYPE        WRTYPE
     C                   MOVE      GOREI1        WRREI1
     C                   MOVE      GOREI2        WRREI2
     C                   MOVE      GOREI3        WRREI3
     C                   MOVE      GOREI4        WRREI4
     C                   ENDSR
      *
     C***********************************************
     C     BYTTTU        BEGSR
     C***********************************************
      *
      * BYTTER TURNUMMER PÅ ALLE MED TILHØRENDE GODSNUMMER
      *
     C                   SETOFF                                       33
     C     GODK01        SETLL     GODSJL01
     C     *IN33         DOWEQ     '0'
     C     GODK01        READE     GODSJL01                               33
     C     *IN33         IFEQ      '0'
     C     GOTURN        ANDNE     WRTURN
     C     RRNCL1        CHAIN     GODSJF                             34
     C  N34              MOVE      WRTURN        GOTURN
     C  N34              UPDATE    GODSJR
     C                   MOVE      'E'           GOHKOD
     C                   EXSR      gohist
     C                   END
     C                   END
     C     UTBYTT        ENDSR
      *
     C***********************************************
     C     SETTRN        BEGSR
     C***********************************************
      *
      * SETTER TRANSITTNR PÅ MERKNADSRECORD ETTER ENDRING
      *
     C                   SETOFF                                       33
      *
      *
     C     MERKE2        SETLL     MERKNF
     C     *IN33         DOWEQ     '0'
     C     MERKE2        READE     MERKNF                                 33
     C     *IN33         IFEQ      '0'
     C  N33              MOVE      WRTRNR        GOTRNR
     C  N33              UPDATE    MERKNFR
     C                   END
     C                   END
     C                   ENDSR
      *
     C***********************************************
     C     NESTGO        BEGSR
     C***********************************************
      *
      *
      *
     C                   MOVEL     XBEVDG        SISTGN           15              hele   gn
     C     SIST13        IFEQ      *BLANKS
     C                   MOVE      '0'           SIST13                           siffer 13
     C                   END
      *
     C     NYPOST        TAG
      *
     C     KEYSIS        CHAIN(N)  GODSGF                             33
      *
      * LOGIKK HVIS 99 ER PASSERT
      *
     C  N33GGGN2         IFEQ      '00'
     C                   MOVE      SIST13        NUM13             1 0
     C                   ADD       1             NUM13
     C                   MOVE      NUM13         SIST13
     C                   GOTO      NYPOST
     C                   END
     C     *IN33         IFEQ      '1'
     C                   MOVE      '001'         SISTGN
     C                   ELSE
     C                   MOVE      GGGN2         SISTGN
     C                   END
     C                   ENDSR
     C***********************************************
     C     gohist        BEGSR
     C***********************************************
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   movel     'SYTL01'      gohpgm
     c                   move      wdt           gohdat
     c                   move      wtm           gohtim
     c                   movel     zuser         gohusr
     c                   write     godshr
     c                   endsr
     C***********************************************
     C     vishst        BEGSR
     C***********************************************
     C                   Z-ADD     SFRRN         RRNC
     C     RRNC          CHAIN(N)  GODSJF                             88
     C                   CALL      'SYTL11C'
     C                   PARM                    GOGN
     c                   endsr
N06   ***********************************************
N06  C     PRTSKILL      BEGSR
N06   ***********************************************
N06  C                   MOVE      'Z '          SCATYP            2
N06  C                   MOVEL     SFFGN         SCASTR           20
N06  C                   CALL      'ARCA000CL'
N06  C                   PARM                    SCATYP
N06  C                   PARM                    SCASTR
N06  C                   ENDSR
      *
