      *
     FTHMELDING IP   F  500        DISK
     FTRREGEL1  IF A E           K DISK
     D                 DS
     D  TRTXT1                 1     70
     D  TRTXT2                71    140
     D  TRTXT3               141    210
     D  TRTXT4               211    280
     D  TRTXT5               281    350
     D  TRTXT6               351    420
     D  TRTXT7               421    490
     D  TRTXT8               491    560
     D  TRTXT9               561    630
     D  TRTXTA               631    700
     D  TRTXT                  1    700
     ITHMELDING NC  01
     I                                  1  500  TXT2
      *
     C                   IF        XINIT <> 'J'
     C                   EVAL      TRTXT = *BLANKS
     C                   MOVE      'J'           XINIT             1
     C                   END
      *
     C                   MOVE      *BLANKS       TXT             500
     C                   Z-ADD     0             XN2               3 0
     C     1             DO        500           XN                3 0
     C                   IF        %SUBST(TXT2:XN:1) <> X'34'
     C                             AND %SUBST(TXT2:XN:1) <> X'36'
     C                             AND %SUBST(TXT2:XN:1) <> X'31'
     C                             AND %SUBST(TXT2:XN:1) <> X'1A'
     C                             AND %SUBST(TXT2:XN:1) <> X'33'
     C                   ADD       1             XN2
     C                   EVAL      %SUBST(TXT:XN2:1) = %SUBST(TXT2:XN:1)
     C                   END
     C                   ENDDO
      *
     C     TXT           CABEQ     *BLANKS       SLUTT
     C                   IF        %SUBST(TXT:1:6) = 'TR0002'
     C                   MOVE      'J'           XSLUTT            1
     C                   END
     C     XSLUTT        CABEQ     'J'           SLUTT
      *
     C                   SELECT                                                 1<-B
     C                   WHEN      (%SUBST(TXT:1:1) = 'R' OR                    1
     C                              %SUBST(TXT:1:1) = 'C') AND
     C                             (%SUBST(TXT:2:1) >= '0' AND
     C                              %SUBST(TXT:2:1) <= '9')
      * NY REGEL ELLER BETINGELSE
     C     ':'           SCAN      TXT           XPOS              3 0
     C                   Z-ADD     XPOS          XPOS2             3 0
     C                   IF        TRUNI1 <> *BLANKS AND XPOS2 > 0               2<-B
     C                   IF        TRUNI1 = %SUBST(TXT:1:1) AND                   3<-B
     C                             TRUNI2 = %SUBST(TXT:2:XPOS2-2)
     C                   EVAL      XPOS = 1
     C                   END                                                      3<-E
     C                   END                                                     2<-E
      *
     C                   IF        XPOS >= 3 AND XPOS <= 5                       2<-B
      * OPPDATERE FORRIGE REGEL ELLER BETINGELSE
     C                   IF        TRTXT <> *BLANKS                               3<-B
     C                   IF        %SUBST(TRUNI2:2:1) = ' '                        4<-B
     C                   EVAL      TRUNI2 = '00' + %TRIM(TRUNI2)
     C                   ELSE                                                      4
     C                   IF        %SUBST(TRUNI2:3:1) = ' '                         5<-B
     C                   EVAL      TRUNI2 = '0' + %TRIM(TRUNI2)
     C                   END                                                        5<-E
     C                   END                                                       4<-E
     C                   WRITE     TRREGR
     C                   EVAL      TRTXT = *BLANKS
     C                   END                                                      3<-E
      * FINN FØRSTE IKKE BLANK TEGN
     C                   DO        500                                            3<-B
     C                   ADD       1             XPOS
     C                   IF        %SUBST(TXT:XPOS:1) <> ' '                       4<-B
     C                   LEAVE
     C                   END                                                       4<-E
     C                   ENDDO                                                    3<-E
      *
     C                   EVAL      TRUNI1 = %SUBST(TXT:1:1)
     C                   EVAL      TRUNI2 = %SUBST(TXT:2:XPOS2-2)
     C                   EVAL      TRTXT = %SUBST(TXT:XPOS:501-XPOS)
      *
     C                   ELSE                                                    2
      * FINN FØRSTE IKKE BLANK TEGN
     C                   Z-ADD     0             XPOS
     C                   DO        500                                            3<-B
     C                   ADD       1             XPOS
     C                   IF        %SUBST(TXT:XPOS:1) <> ' '                       4<-B
     C                   LEAVE
     C                   END                                                       4<-E
     C                   ENDDO                                                    3<-E
     C                   EVAL      TRTXT = %TRIM(TRTXT) + ' '
     C                             + %SUBST(TXT:XPOS:501-XPOS)
     C                   END                                                     2<-E
      *
     C                   OTHER                                                  1
      * FINN FØRSTE IKKE BLANK TEGN
     C                   Z-ADD     0             XPOS
     C                   DO        500                                           2<-B
     C                   ADD       1             XPOS
     C                   IF        %SUBST(TXT:XPOS:1) <> ' '                      3<-B
     C                   LEAVE
     C                   END                                                      3<-E
     C                   ENDDO                                                   2<-E
     C                   EVAL      TRTXT = %TRIM(TRTXT) + ' '
     C                             + %SUBST(TXT:XPOS:501-XPOS)
     C                   ENDSL                                                  1<-E
      *
     C     SLUTT         TAG
     CLR                 IF        TRTXT <> *BLANKS                             1<-B
     CLR                 IF        %SUBST(TRUNI2:2:1) = ' '                      2<-B
     CLR                 EVAL      TRUNI2 = '00' + %TRIM(TRUNI2)
     CLR                 ELSE                                                    2
     CLR                 IF        %SUBST(TRUNI2:3:1) = ' '                       3<-B
     CLR                 EVAL      TRUNI2 = '0' + %TRIM(TRUNI2)
     CLR                 END                                                      3<-E
     CLR                 END                                                     2<-E
     CLR                 WRITE     TRREGR
     CLR                 END                                                    1<-E
