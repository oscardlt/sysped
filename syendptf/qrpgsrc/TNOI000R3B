     H DFTACTGRP(*NO)
     FWRKR31L   UF A E           K DISK
     d WhereC          s            512a
     d FirstW          s              1A
     d cQuote          c                   const('''')
     d SqlStm          s            512a
     d myrows          s             10i 0
     d X               S             10  0
     d MyPoDS          ds                  Qualified  dim(500)
     d  SVAVD                         4S 0
     d  SVTDN                         7S 0
     d  SVFT01                       30
     ‚*  Prototype for tnoi000r3b
     d tnoi000r3b      pr
     d usrspcname_                         like(usrspcname)
     d wr31_                               like(wr31)
     ‚*  *ENTRY Interface for Main Procedure
     d tnoi000r3b      pi
     d usrspcname                    10
     d wr31                          28

         exsr SelSr;

         if myrows > 0;
           exsr LesSr;
         endif;

         *inlr = *on;
       //-----------------------------------------------------------------
       // Select fra fil via SQL
       //-----------------------------------------------------------------
       begsr     SelSr;

         Exsr  AddAnd;
         Eval  WhereC =  %trim(WhereC)  +
         ' SVFT01  <> ' + cQuote + ' ' + cQuote;

         Exsr  AddAnd;
         Eval  WhereC =  %trim(WhereC)  +
         ' UPPER(SVFT01) LIKE UPPER(' + cQuote + '%' +
         %trim(WR31) + '%' + cQuote + ')';

         Eval      WhereC =  ' Where ' + %trim(WhereC);

         Eval       SqlStm = 'Select SVAVD, SVTDN, SVFT01 ' +
                             'from SADV ' +
                              %trim(WhereC)  +
                             'FOR READ ONLY ';
         Exec SQL PREPARE DynSel from :SqlStm;
         EXEC SQL DECLARE  A33  cursor for DynSel;
         Exec SQL OPEN A33;
         Myrows = %elem(MyPoDS);
         exec sql FETCH A33   for :MyRows rows
                  INTO :MyPoDs;
         Exec SQL CLOSE A33;
       endsr;
       //-----------------------------------------------------------------
       // Set inn "AND" mellom where settninger
       //-----------------------------------------------------------------
       begsr     AddAnd;
       If        FirstW =   'N';
         WhereC =  %trim(WhereC) + ' and ';
       EndIf;
         FirstW =   'N';
       endsr;
        // __________________________________________________
        // Læs array                                    LESSR
        // """"""""""""""""""""""""""""""""""""""""""""""""""
           begsr LesSr;

       for x = 1 to myrows;

         if mypods(x).svft01 <> *blanks;
           chain (usrspcname: mypods(x).svavd: mypods(x).svtdn) WRKR31L;
           if not %found;
           clear wrkr31fr;
                  WRKSPCN=usrspcname;
                  WRKAVD=mypods(x).svavd;
                  WRKTDN=mypods(x).svtdn;
                  WRKR31=mypods(x).svft01;
           write wrkr31fr;
         endif;
         endif;

       endfor;

       endsr;
