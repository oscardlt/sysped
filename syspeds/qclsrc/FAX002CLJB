/* DENNE KJØRER BLUFAX FAKTURA-FAXING  */
             PGM        PARM(&BPARM)
             DCL        VAR(&BPARM)   TYPE(*CHAR) LEN(430)
             DCL        VAR(&UNIK) TYPE(*CHAR) LEN(7) /* Unikkode +
                          til register SORT. */
             DCL        VAR(&P1) TYPE(*CHAR) LEN(2)
             DCL        VAR(&P1E) TYPE(*CHAR) LEN(2)
             DCL        VAR(&P1S) TYPE(*CHAR) LEN(2)
             DCL        VAR(&P2) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P3) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P4) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P5) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P6) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P7) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P8) TYPE(*CHAR) LEN(1)
             DCL        VAR(&P9) TYPE(*CHAR) LEN(1)
             DCL        VAR(&TUR) TYPE(*CHAR) LEN(8)
             DCL        VAR(&MAPPE) TYPE(*CHAR) LEN(20)
             DCL        VAR(&PTIME) TYPE(*CHAR) LEN(8)
             DCL        VAR(&PDATE) TYPE(*CHAR) LEN(8)
             DCL        VAR(&QUSER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QJOB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QNBR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FAX) TYPE(*CHAR) LEN(21)
             DCL        VAR(&FILEN) TYPE(*CHAR) LEN(10)
             DCL        VAR(&KNAVN) TYPE(*CHAR) LEN(30)
             DCL        VAR(&AVD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&OPD) TYPE(*CHAR) LEN(7)
             DCL        VAR(&KODE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&DONAV) TYPE(*CHAR) LEN(12)
             DCL        VAR(&CVP1) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP2) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP3) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP4) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP5) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP6) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP7) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP8) TYPE(*CHAR) LEN(40)
             DCL        VAR(&CVP) TYPE(*CHAR) LEN(1)
             DCL        VAR(&LTYPE) TYPE(*CHAR) LEN(1)
    /*                                    */
    /* SKRIVER UT FAKTURAKOPI             */
    /*                                    */
             CHGVAR     VAR(&FAX) VALUE(%SST(&BPARM 1 21))
             CHGVAR     VAR(&FILEN) VALUE(%SST(&BPARM 22 10))
             CHGVAR     VAR(&PTIME) VALUE(%SST(&BPARM 32 8))
             CHGVAR     VAR(&PDATE) VALUE(%SST(&BPARM 40 8))
             CHGVAR     VAR(&KNAVN) VALUE(%SST(&BPARM 48 30))
             CHGVAR     VAR(&AVD) VALUE(%SST(&BPARM 78 4))
             CHGVAR     VAR(&OPD) VALUE(%SST(&BPARM 82 7))
             CHGVAR     VAR(&KODE) VALUE(%SST(&BPARM 89 1))
             CHGVAR     VAR(&DONAV) VALUE(%SST(&BPARM 90 12))
             CHGVAR     VAR(&P1) VALUE(%SST(&BPARM 102 2))
             CHGVAR     VAR(&P2) VALUE(%SST(&BPARM 104 1))
             CHGVAR     VAR(&P3) VALUE(%SST(&BPARM 105 1))
             CHGVAR     VAR(&P4) VALUE(%SST(&BPARM 106 1))
             CHGVAR     VAR(&P5) VALUE(%SST(&BPARM 107 1))
             CHGVAR     VAR(&P6) VALUE(%SST(&BPARM 108 1))
             CHGVAR     VAR(&P7) VALUE(%SST(&BPARM 109 1))
             CHGVAR     VAR(&CVP1) VALUE(%SST(&BPARM 110 40))
             CHGVAR     VAR(&CVP2) VALUE(%SST(&BPARM 150 40))
             CHGVAR     VAR(&CVP3) VALUE(%SST(&BPARM 190 40))
             CHGVAR     VAR(&CVP4) VALUE(%SST(&BPARM 230 40))
             CHGVAR     VAR(&CVP5) VALUE(%SST(&BPARM 270 40))
             CHGVAR     VAR(&CVP6) VALUE(%SST(&BPARM 310 40))
             CHGVAR     VAR(&CVP7) VALUE(%SST(&BPARM 350 40))
             CHGVAR     VAR(&CVP8) VALUE(%SST(&BPARM 390 40))
             CHGVAR     VAR(&CVP) VALUE(%SST(&BPARM 430 1))
             RTVDTAARA  DTAARA(*LDA (81 1)) RTNVAR(&LTYPE)

             /* BLUEFAX OVERRIDE     */
             OVRPRTF    FILE(FAKTURA) DEVTYPE(*SCS) PAGESIZE(72 80) +
                          LPI(8) CPI(10) OVRFLW(72) +
                          OUTQ(FAX/FAXOUT) FORMTYPE(*STD)
             OVRPRTF    FILE(SYFA20P) DEVTYPE(*SCS) PAGESIZE(72 80) +
                          LPI(6) CPI(12) OVRFLW(72) +
                          OUTQ(FAX/FAXOUT) FORMTYPE(*STD)

             IF         COND(&LTYPE = 'S') THEN(OVRPRTF +
                          FILE(SYFA20PS) DEVTYPE(*SCS) PAGESIZE(96 +
                          80) LPI(8) CPI(12) OVRFLW(96) +
                          OUTQ(FAX/FAXOUT) FORMTYPE(*STD))
             ELSE       CMD(OVRPRTF FILE(SYFA20PS) DEVTYPE(*SCS) +
                          PAGESIZE(72 90) LPI(8) CPI(12) OVRFLW(72) +
                          OUTQ(FAX/FAXOUT) FORMTYPE(*STD))

             OVRPRTF    FILE(SYFA20PD) DEVTYPE(*SCS) PAGESIZE(72 80) +
                          LPI(6) CPI(12) OVRFLW(72) +
                          OUTQ(FAX/FAXOUT) FORMTYPE(*STD)
             OVRPRTF    FILE(SYFA20PT) PAGESIZE(72 80) CPI(10) +
                          OVRFLW(72) OUTQ(FAX/FAXOUT) +
                          FORMTYPE(*STD) /*N01*/
             OVRPRTF    FILE(SYFA27PF) PAGESIZE(72 80) CPI(10) +
                          OVRFLW(72) OUTQ(FAX/FAXOUT) +
                          FORMTYPE(*STD) /*N01*/
             OVRPRTF    FILE(SYFA20PS) PAGESIZE(72 80) CPI(10) +
                          OVRFLW(72) OUTQ(QPRINT) +
                          FORMTYPE(*STD) /*N01*/
    /* */
    /* */
    /* FIX SEPARATE GIRO */
    /* */
    /* */
             RTVJOBA    JOB(&QJOB) USER(&QUSER) NBR(&QNBR)
    /* */
    /*                                    */
    /*                                    */
             CHGVAR     VAR(&UNIK) VALUE('W' *CAT &QNBR)
/* SORT OGSÅ I LØSNING 1 - INLIBL FOR Å SIKRE BIBLIOTEKSLISTE */
             CALL INLIBL
             RMVM       FILE(SORT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310 CPF5815 CPF7315)
             ADDPFM     FILE(SORT) MBR(&UNIK)
             OVRDBF     FILE(SORT) TOFILE(SORT) MBR(&UNIK)
             OVRMSGF    MSGF(QUSERMSG) TOMSGF(SYMSGF)

             CALL       PGM(SYFA20) PARM(&P1 &P1E &P1S &P2 &P3 &P4 +
                          &P5 &P6 &P7 &P8 &P9)
             RMVM       FILE(SORT) MBR(&UNIK)
             MONMSG     MSGID(CPF7310 CPF5815 CPF7315)
             CALL       PGM(FAX017) PARM(&FAX)

             /*                      */
             /* BLUFAX SENDING       */
             /*                      */
             IF         COND(&CVP = 'J') THEN(FAX/SNDFAXSPLF +
                          FILE(&FILEN) JOB(&QNBR/&QUSER/&QJOB) +
                          SPLNBR(*LAST) RCP((&FAX *N &KNAVN)) +
                          CPGPAG(*DFT) CPGTXT(&CVP1 &CVP2 &CVP3 +
                          &CVP4 &CVP5 &CVP6 &CVP7 &CVP8))

             ELSE       CMD(FAX/SNDFAXSPLF FILE(&FILEN) +
                          JOB(&QNBR/&QUSER/&QJOB) SPLNBR(*LAST) +
                          RCP((&FAX *N &KNAVN)))

             CALL       PGM(FAX013) PARM(&QUSER &QNBR &QJOB +
                          &FAX &DONAV &MAPPE &PTIME &PDATE &KNAVN +
                          &AVD &OPD &TUR &KODE)
    /* */
 SLUTT:      ENDPGM
