********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11096 * 01 CB  Inte skriv ut och arkivera
********************************************************************
     FEDIM      IF   E           K DISK
     FERFF96B   IF   E           K DISK
     FSVIH      UF   E           K DISK
     FSVEH      UF   E           K DISK
     FSVIHH     O  A E             DISK
     FSVEHH     O  A E             DISK
     FTVINF     O  A E             DISK
     D A               S              1    DIM(79)
     D B               S              1    DIM(18)
      *________________________
      * DS for decimal handling
      *""""""""""""""""""""""""
     D                 DS
     D  WMN2                   1      9  0
      */////////////
      * MAIN LOGIC /
      */////////////
      *___________
      * Initiering
      *"""""""""""
     C                   EXSR      INIT
      *________
      * CONVERT
      *""""""""
     C  N51              EXSR      SRA

     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *                                                      INIT /
      *////////////////////////////////////////////////////////////
     C     INIT          BEGSR
     C     KEYMS0        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN0
     C     KEYMS1        KLIST
     C                   KFLD                    ZMN
     C                   KFLD                    ZGN1
     C                   KFLD                    ZREPB0

     C     *LIKE         DEFINE    RMN           ZMN
     C     *LIKE         DEFINE    RGN           ZGN0
     C     *LIKE         DEFINE    RGN           ZGN1
     C     *LIKE         DEFINE    RREP0         ZREPB0
     C     *LIKE         DEFINE    SVIH_SYAV     WVIH_SYAV
     C     *LIKE         DEFINE    SVIH_SYOP     WVIH_SYOP
      * INIT WORKFIELDS

     C     *ENTRY        PLIST
     C                   PARM                    WMN1              9
     C                   MOVEL     WMN1          WMN2
     C                   Z-ADD     WMN2          ZMN
      * Definiere Nøkkler
     C     SVIH_KEY      KLIST
     C                   KFLD                    WVIH_SYAV
     C                   KFLD                    WVIH_SYOP
      * Get msg and interchange values
     C     ZMN           CHAIN     EDIM                               51

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Vilken typ av svar ?                                  SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_________________
      * Finnes ærendet ?
      *"""""""""""""""""
     C                   MOVEL     M0062         WVIH_SYAV
     C     7             SUBST     M0062:5       M0062B            7
     C                   MOVE      M0062B        WVIH_SYOP
     C     SVIH_KEY      CHAIN(N)  SVIH                               51
     C                   IF        *IN51 = *OFF
     C                   EXSR      SRAI
S01  C*                  EVAL      WATYPE='SI'
S01  C*                  EVAL      WUSER=SVIH_SGID
     C                   ELSE
     C     SVIH_KEY      CHAIN(N)  SVEH                               51
     C                   IF        *IN51 = *OFF
     C                   EXSR      SRAE
S01  C*                  EVAL      WATYPE='SE'
S01  C*                  EVAL      WUSER=SVEH_SGID
     C                   ENDIF
     C                   ENDIF
      *_________________________
      * Aktivera arkivfunktionen
      *"""""""""""""""""""""""""
S01  C*                  CALL      'ARC002CLB'
S01  C*                  PARM                    WATYPE            2
S01  C*                  PARM                    WUSER            10
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Import                                               SRAI /
      *////////////////////////////////////////////////////////////
     C     SRAI          BEGSR
      *_____________
      * Læs alla RFF
      *"""""""""""""
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     3             ZGN0
     C     KEYMS0        SETLL     ERFF96B                                20
     C     KEYMS0        READE     ERFF96B                                51
     C     *IN51         DOWEQ     '0'
      *
     C     R1153         IFEQ      'GKL'
     C     R1153         OREQ      'GKL'
      * Skriv til historikfil
     C                   CLEAR                   SVIHHR
     C                   EVAL      SVIHH_SYA = SVIH_SYAV
     C                   EVAL      SVIHH_SYO = SVIH_SYOP
     C                   MOVEL     MDT           SVIHH_DTH
     C                   MOVEL     MTM           SVIHH_TMH
     C                   EVAL      SVIHH_SR  = 'R'
     C                   EVAL      SVIHH_TXH  = 'CUSRESU-IEMD RES'
     C                   CAT       R1153:1       SVIHH_TXH
     C                   CAT       R1154:1       SVIHH_TXH
     C                   WRITE     SVIHHR
      * Skriv til TVINF
     C                   CLEAR                   TVINFF
     C                   EVAL      FMN = ZMN
     C                   EVAL      FLN = 1
     C                   EVAL      F0078A = SVIHH_TXH
     C                   EVAL      F0078B = SVIHH_TX1
     C                   WRITE     TVINFF
     C                   ENDIF

     C     KEYMS0        READE     ERFF96B                                51
     C  N51              ENDDO
      *__________________
      * Uppdatera ærendet
      *""""""""""""""""""
     C     SVIH_KEY      CHAIN     SVIH                               61
     C                   IF        *IN61 = *OFF
     C                   EVAL      SVIH_SYST='G'
     C                   UPDATE    SVIHR
     C                   ENDIF
      *_________________
      * Skriv ut ærendet
      *"""""""""""""""""
     C     SVIH_EUP1     IFEQ      '4200'
     C                   CALL      'SVI041R'
     C                   PARM                    SVIH_SYAV
     C                   PARM                    SVIH_SYOP
S01  C*                  ELSE
S01  C*                  MOVE      'C'           calltyp
S01  C*                  MOVE      SVIH_SYAV     SVIHASYAV         4
S01  C*                  MOVE      SVIH_SYOP     SVIHASYOP         7
S01  C*                  CALL      'SVI006R'
S01  C*                  PARM                    SVIHASYAV
S01  C*                  PARM                    SVIHASYOP
S01  C*                  PARM                    calltyp           1
     C                   ENDIF

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      * Export                                               SRAE /
      *////////////////////////////////////////////////////////////
     C     SRAE          BEGSR
      *_____________
      * Læs alla RFF
      *"""""""""""""
     C                   MOVE      '0'           *IN51
     C                   Z-ADD     3             ZGN0
     C     KEYMS0        SETLL     ERFF96B                                20
     C     KEYMS0        READE     ERFF96B                                51
     C     *IN51         DOWEQ     '0'
      *
     C     R1153         IFEQ      'GKL'
     C     R1153         OREQ      'GKL'
      * Skriv til historikfil
     C                   CLEAR                   SVEHHR
     C                   EVAL      SVEHH_SYA = SVEH_SYAV
     C                   EVAL      SVEHH_SYO = SVEH_SYOP
     C                   MOVEL     MDT           SVEHH_DTH
     C                   MOVEL     MTM           SVEHH_TMH
     C                   EVAL      SVEHH_SR  = 'R'
     C                   EVAL      SVEHH_TXH  = 'CUSRESU-IEMD RES'
     C                   CAT       R1153:1       SVEHH_TXH
     C                   CAT       R1154:1       SVEHH_TXH
     C                   WRITE     SVEHHR
      * Skriv til TVINF
     C                   CLEAR                   TVINFF
     C                   EVAL      FMN = ZMN
     C                   EVAL      FLN = 1
     C                   EVAL      F0078A = SVIHH_TXH
     C                   EVAL      F0078B = SVIHH_TX1
     C                   WRITE     TVINFF
     C                   ENDIF

     C     KEYMS0        READE     ERFF96B                                51
     C  N51              ENDDO
      *__________________
      * Uppdatera ærendet
      *""""""""""""""""""
     C     SVIH_KEY      CHAIN     SVEH                               61
     C                   IF        *IN61 = *OFF
     C                   EVAL      SVEH_SYST='G'
     C                   UPDATE    SVEHR
     C                   ENDIF

     C                   ENDSR
