
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
12342 * 01 CB  PTF12 Nye pgm i PT for å plukke exportdeklarsjoner
********************************************************************
     ‚***********************************************************
     ‚*** PROGRAM SKAL OVERFØRE SAD-LINJER TIL NCTS           ***
     ‚*** INDIKATORER 01 - 26 KUN CMD-TASTER / ROLL TASTER    ***
     ‚*** LEDIGE INDIKATORER 01-26                            ***
     ‚*** LEDIGE INDIKATORER 27-32 34-99                      ***
     ‚***********************************************************
     H DFTACTGRP(*NO)
     fsaeh      if   e           k disk
     fsaev4     if   e           k disk
     fsaevcn    if   e           k disk
     fnctsec    o  a e             disk
     fnctsecam  o  a e             disk
     fnctsei    o  a e             disk
     fcundl01   if   e           k disk
     d                 ds
     d syrg                          14
     d  syfore                       11    overlay(syrg)
     d   syfor9                       9    overlay(syfore)
     ‚*  Prototype for ncts012rb
     d ncts012rb       pr
     d ufirm_                              like(ufirm)
     d uavd_                               like(uavd)
     d utdn_                               like(utdn)
     d uli_                                like(uli)
     d uavd2_                              like(uavd2)
     d utdn2_                              like(utdn2)
     d ukdc_                               like(ukdc)
     ‚*  *ENTRY Interface for Main Procedure
     d ncts012rb       pi
     d ufirm                          2
     d uavd                           4
     d utdn                           7
     d uli                            5
     d uavd2                          4
     d utdn2                          7
     d ukdc                           1
     ‚*----------------------------------------------------------------------
     ‚* Stand Alone Fields - TOP
     ‚*----------------------------------------------------------------------
     d xli             s              5  0
     d xli2            s              5  0
     d xln             s              5  0
     ‚*----------------------------------------------------------------------
     ‚* Stand Alone Fields - BOTTOM
     ‚*----------------------------------------------------------------------

      /free
       exsr init;

       xln = *zeros;
       setll ( seavd : setdn ) saev4;
       reade ( seavd : setdn ) saev4;
       dow not %eof;
         select;
         when xln = 0;
           exsr srhent;                                                         // HENT DATA FRA SAE
         when svln = xln;
           exsr srsum;                                                          // SUMMERE VEKT
         other;
           write nctseir;
           exsr srhent;                                                         // HENT DATA FRA SAE
         endsl;
         reade ( seavd : setdn ) saev4;
       enddo;

       if tili2 <> 0;
         write nctseir;
       endif;

      /end-free
     C                   MOVE      TCLI          ULI
      /free

       *inlr = *on;

       //**********************************************
       begsr srhent;
         //**********************************************
         xln    = svln;
         xli2   = xli2 +1;
         tili2  = xli2;
      /end-free
     C                   MOVEL     SVVNT         XN06              6 0
      /free
         ticch  = xn06;
         tivkb  = svvktb;
         tivkn  = svvktn;
         tints  = svntm;
         tipmrk = svft01;
         tipnt  = svnt01;
         tipty  = sveh01;
         tictx  = svvt01;
         //tcdty = '830';
         //tcdref = %trim(setle) + ' ' + %trim(setll);
         if ukdc = '1';
           chain ( seavd : setdn : svli ) saevcn;
           if %found;
             ticnr = svcnr;
           endif;
         endif;
         exsr hadr12;

       endsr;

       //**********************************************
       begsr srsum;
         //**********************************************
           tivkb = tivkb + svvktb;
           tivkn = tivkn + svvktn;
           tints = tints + svntm;
       endsr;

       //**********************************************
       begsr hadr12;
         //**********************************************
         tckns = seknk;
         tcnas = senak;
         tcad1s = seadk1;
        if seadk3 = *blanks;
         tcpns = seadk2;
         tcpss = seadk2;
        else;
         tcpns = seadk3;
         tcpss = seadk3;
        endif;
         tclks = 'NO';
         if seknk = 0;                                                          // 1<-B
           tctins = *blanks;
         else;                                                                  // 1
           kundnr = seknk;
           chain ( ufirm : kundnr ) cundl01;
           *in34 = not %found;
           tctins = *blanks;
          if %found;
           select;                                                              // 2<-B
           when eori = *blanks;                                                 // 2
             if ((syfor9 <> *blanks) and (syfor9 <> *zeros));                   //   3<-B
               tctins = tclks + syfor9;
             else;                                                              //  3
               tctins = *blanks;
             endif;                                                             //   3<-E
           other;                                                               // 2
             tctins = eori;
           endsl;                                                               //  2<-E
          endif;
         endif;                                                                 // 1<-E

         tcknk = sekns;
         tcnak = senas;
         tcad1s = seads1;
        if seads3 = *blanks;
         tcpnk = seads2;
         tcpsk = seads2;
        else;
         tcpnk = seads3;
         tcpsk = seads3;
        endif;
         tclkk = selkb;
         if sekns = 0;                                                          // 1<-B
           tctink = *blanks;
         else;                                                                  // 1
           kundnr = sekns;
           chain ( ufirm : kundnr ) cundl01;
           *in34 = not %found;
           tctink = *blanks;
          if %found;
           select;                                                              // 2<-B
           when eori = *blanks;                                                 // 2
             if ((syfor9 <> *blanks) and (syfor9 <> *zeros));                   //   3<-B
               tctink = tclkk + syfor9;
             else;                                                              //  3
               tctink = *blanks;
             endif;                                                             //   3<-E
           other;                                                               // 2
             tctink = eori;
           endsl;                                                               //  2<-E
          endif;
         endif;                                                                 // 1<-E

         if tcad1s = *blanks;                                                   // 1<-B
           %subst(tcad1s:1:1) = '.';
         endif;                                                                 // 1<-E
         if tcad1k = *blanks;                                                   // 1<-B
           %subst(tcad1k:1:1) = '.';
         endif;                                                                 // 1<-E

         write nctsecamr;

       endsr;

       //**********************************************
       begsr init;
         //**********************************************

         seavd = %dec(uavd2:4:0);
      /free
     C                   MOVE      UTDN2         SETDN
      /end-free
         tcavd = %dec(uavd:4:0);
         tctdn = %dec(utdn:7:0);
         tcli  = %dec(uli:5:0) + 1;
         tcln  = tcli;
         tcavd2 = %dec(uavd2:4:0);
      /free
     C                   MOVE      UTDN2         TCTDN2
      /end-free
         tiavd = tcavd;
         titdn = tctdn;
         tili  = tcli;

         chain ( seavd : setdn ) saeh;

         // Oppdater House Consignment
         tcvktb = sevkb;
S01      //tcpdty = 'N830';
S01      //tcpdrf = %trim(setle) + ' ' + %trim(setll);
         write nctsecr;

       endsr;
      /end-free
