      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/ETUR02 MODULE(*LIBL/ETUR02 *LIBL/INCGI)
CRTPGM*         ACTGRP(CGI) AUT(*USE)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 BIAKT=L ER ENDRET TIL Å TESTE AUTORISASJON
10XXX * 02 YBC PTF10 NYE PARAMETRE
10014 * 03 YBC PTF10 TUTARF BRUKT TIL CARRIER OG DOC.RECEIVED
10XXX * 04 JOC PTF10 Felles T&T-kode ved datoendring CHD (før ETD,ATD....)
10XXX * 05 YBC PTF10 ÅRSAK TIL DATO ENDRING
10XXX * 06 YBC PTF10 OPPDATER DATO PÅ BILLOF/HEADF
10XXX * 07 JOV PTF10 *Missing.. i SLREASON ved blank
10XXX * 08 YBC PTF10 RETTELSE PÅ ENDRING 06
10XXX * 09 JOV PTF10 tildeling av rundtursnr
10XXX * 10 JOV PTF10 kunne endre turstatus blank/A
10172 * 11 SH  PTF10 norsk text til Track and trace
10184 * 12 jov PTF10 Ikke error ved M3 over 999,99
      * 13 jov PTF10 Ikke test på Bilnr (men på bilkode)
10XXX * 14 YBC PTF10 HENT DATO TIL EN ARB.VARIABEL FØRST
      * 15 jov PTF10 Notisblokk på tur-header (notis type G=Godl/meld til  transp)
      *              grafisk Appostro HEX-definert(før BITON..) XAPSTR->Appo (ingen merking)
10XXX * 16 JOV PTF10 CLOSE AV TUR
10XXX * 17 YBC PTF10 OPPDATER REASON CODE PÅ EPOH OG EPOL
10XXX * 18 JOV PTF10 utviding av ptf 16 - også REOPEN AV TUR
10XXX * 19 JOV PTF10 LANDBASERT, DATO KAN GID MED KUN DD ELLER DDMM
10261 * 20 YBC PTF10 VEKT/KUBIKK I TURER ER ENDRET TIL 9.0 OG 7.3
10XXX * 21 JOV PTF10 OPPDATER CARRIER PÅ OPPDRAG
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
10XXX * 22 JOV PTF11 Avvikende avdeling
10XXX * 23 JOV PTF11 Tillatt (men ikke krav) å taste periode også i oversjø-variant
********************************************************************
      *
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
S02  F*TURER     UF A E           K DISK    USROPN
N02  FTURER14   UF A E           K DISK    USROPN
N15  FFREETUR1  UF A E           K DISK    USROPN
     FHEAD14    IF   E           K DISK    USROPN
N06  F                                     RENAME(HEADFR:HEADFR14)
N06  FHEADF     UF   E           K DISK    USROPN
N02  FDISP      IF   E           K DISK    USROPN
     FBILLOF    UF   E           K DISK    USROPN
     FBLV1      UF A E           K DISK    USROPN
     FTRACKT    UF   E           K DISK    USROPN
     FTRACKF    O  A E             DISK    USROPN
     FTELL      UF   E           K DISK    USROPN
N09  FTELLRU    UF   E           K DISK    USROPN
N03  FCDTRAFL2  IF   E           K DISK    USROPN
     FCDCON4    IF   E           K DISK    USROPN
     FSTED2     IF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     FFIRMARC   IF   E           K DISK    USROPN
     FARKTXT    IF   E           K DISK    USROPN
     FARKEXT    IF   E           K DISK    USROPN
     FARKIVL11  IF   E           K DISK    USROPN
     FFIRM      IF   E           K DISK    USROPN
     FBILK      IF   E           K DISK    USROPN
     FDRIV      IF   E           K DISK    USROPN
     FKODTLK    IF   E           K DISK    USROPN
     FKODTÅ     IF   E           K DISK    USROPN
     FSTED2D    IF   E           K DISK    USROPN
     F                                     RENAME(STED2R:STED2RD)
     FUNITL01   IF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
     FTRAN      IF   E           K DISK    USROPN
     FVALUL01   IF   E           K DISK    USROPN
      *********************************************************************
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *
      * Client input variables
     D user            s             10
     D UsrSpcName      s             10
     D WSSTART         s              1
     D WSCAN           s              1
     D WSTUR           s              8
     D WBTUR           s              8  0
     D WSFRAMES        s              1
N10  D WSST            s              1
     D WSLSH           s              5
     D WSLOH           s              5
     D WSBLNR          s             17
N03  D WSBLORR         s              1
N03  D WSTR            S              4
     D WSBNV           s             30
     D WSETD           s             10
     D WSETA           s             10
     D WSATD           s             10
     D WSATA           s             10
N14  D XN10            s             10  0
N05  D WSEDRE          S              3
     D WSCON1          s             17
     D WSCKD1          s              2
      *
     D WSRAR4          s              4
     D WSRMND          s              2
     D WBRMND          s              2  0
     D WSBILK          s              3
     D WSBILN          s             10
     D WSLK            s              2
     D WSHENG          s             10
     D WSLKH           s              2
     D WSKNT2          s              8
     D WBKNT2          s              8  0
     D WSNAT           s             30
     D WSSJA1          s              8
     D WBSJA1          s              8  0
     D WSSJN1          s             30
     D WSSJA2          s              8
     D WBSJA2          s              8  0
     D WSSJN2          s             30
     D WSDT            s             10
     D WSTM            s              5
     D WBTM            s              4  0
     D WSSTEF          s              5
     D WSLKFR          s              2
     D WSSDF           s             20
     D WSDTT           s             10
     D WSTMT           s              5
     D WBTMT           s              4  0
     D WSSTET          s              5
     D WSLKTO          s              2
     D WSSDT           s             20
     D WSTVAL          s              3
     D WSTAKO          s              1
     D WSTBEL          s             12
     D WBTBEL          s             11  2
N02  D WSHSD           S              1
N02  D WSSORT          S              1
N02  D WSSNR           S              1
N02  D WSSST           S              1
N02  D WSSAVD          S              4
N22  D WBSAVD          s              4  0
N09  D AVDZER          S              4  0
N15  D WSTTxt          S           2100
N19  D TmpAlf          S              1
      *
     D FMELDNR         S              2
     D FEILMELDING     S             80
     D EMNE            S             44
     D SENDER          S             17
     D CMD             S           5000
     D MELD            S           5000
      *
     D OddEven         s             10
      * OBS! feilmeldingen burde være enten KUN engelsk eller både norsk / engelsk
      *      Fra nr 38 - er det innført (rett i rpg) kun kokumentert i toppen her
      *
     D FEIL01          C                   CONST('Port of loading is not -
     D                                     valid.')
     D FEIL02          C                   CONST('Port of unloading is not -
     D                                     valid.')
     D FEIL03          C                   CONST('Vessel has to be given.')
     D FEIL04          C                   CONST('ETD is not valid.')
     D FEIL05          C                   CONST('ETA is not valid.')
     D FEIL06          C                   CONST('ATD is not valid.')
     D FEIL07          C                   CONST('ATA is not valid.')
     D FEIL08          C                   CONST('Container no. is not valid.')
     D FEIL09          C                   CONST('Type of container can not be -
     D                                     blank.')
N05  D FEIL10          C                   CONST('You have to select a reason -
N05  D                                     since at least one of dates is -
N05  D                                     changed.')
s23  D*FEIL21          C                   CONST('Tastet periode er ikke gyldig-
s23  D*                                    .')
s23  D*FEIL22          C                   CONST('Periode er ikke åpen.')
N23  D FEIL21          C                   CONST('Periode is not valid')
N23  D FEIL22          C                   CONST('Periode is not open.')
S13  D*FEIL23          C                   CONST('Bilnr. er ikke registrert.')
S13  D*FEIL24          C                   CONST('Landkode er ikke registrert.')
S13  D*FEIL25          C                   CONST('Landkode er ikke registrert.')
N13  D FEIL23          C                   CONST('Bilnr (og landkode/bilkode) -
N13  D                                     må oppgis')
N13  D FEIL24          C                   CONST('Bilens landkode er ugyldig.')
N13  D FEIL25          C                   CONST('Hengerens landkode er -
N13  D                                     ugyldig.')
     D FEIL26          C                   CONST('Oppgitt bilkode er ugyldig.')
     D FEIL27          C                   CONST('Oppgitt transportør finnes -
     D                                     ikke i register.')
     D FEIL28          C                   CONST('Transportør har stoppkode -
     D                                     - kan ikke benyttes.')
     D FEIL29          C                   CONST('Sjåførnr 1 finnes ikke -
     D                                     eller navn ikke utfyllt.')
     D FEIL30          C                   CONST('Sjåførnr 2 finnes ikke -
     D                                     eller navn ikke utfyllt.')
     D FEIL31          C                   CONST('Fra-dato er ugyldig.')
     D FEIL32          C                   CONST('Fra-sted er ugyldig.')
     D FEIL33          C                   CONST('Til-dato er ugyldig.')
     D FEIL34          C                   CONST('Fra-dato kan ikke være -
     D                                     senere enn til-dato.')
     D FEIL35          C                   CONST('Til-sted er ugyldig.')
     D FEIL36          C                   CONST('Valutakode er gyldig.')
     D FEIL37          C                   CONST('Tastet kode må være A=avtalt -
     D                                     pris eller E=estimat N=nei -
     D                                     M=maskinell.')
N15  D*FEIL38               i RPG       -  Max 30 tekstlinjer
      *
      *
N15   * Definere  hex appostrof
N15  D Appo            c                   x'7D'
N15   * Definere  CrLf =  hex 0D / 25
N15  D CrLf            c                   x'0D25'
N15  D Cr              c                   x'0D'
N15  D Lf              c                   x'25'
N15   *Array for fri-tekster
N15  D TX              S             70    DIM(30)
N15
N15  D                 DS
N15  D  KVTXT                  1   2100
N15  D  KVT                    1   2100    DIM(2100)
N15  D                 DS
N15  D  TXT70                  1     70
N15  D  T70                    1     70    DIM(70)
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
N12  D                 DS
N12  D XIDAG                   1      8  0
N12  D  XIÅR                   1      4  0
N12  D  XIMM                   5      6  0
N12  D  XIDD                   7      8  0
     D                 DS
     D WBETDÅ                  1      4  0
     D WBETDM                  5      6  0
     D WBETDD                  7      8  0
     D WBETD                   1      8  0
     D                 DS
     D WBETAÅ                  1      4  0
     D WBETAM                  5      6  0
     D WBETAD                  7      8  0
     D WBETA                   1      8  0
     D                 DS
     D WBATDÅ                  1      4  0
     D WBATDM                  5      6  0
     D WBATDD                  7      8  0
     D WBATD                   1      8  0
     D                 DS
     D WBATAÅ                  1      4  0
     D WBATAM                  5      6  0
     D WBATAD                  7      8  0
     D WBATA                   1      8  0
     D                 DS
     D WBDTTÅ                  1      4  0
     D WBDTTM                  5      6  0
     D WBDTTD                  7      8  0
     D WBDTT                   1      8  0
     D                 DS
     D WBDTÅ                   1      4  0
     D WBDTM                   5      6  0
     D WBDTD                   7      8  0
     D WBDT                    1      8  0
     D                 DS
     D WBRAR4                  1      4  0
     D WBRACC                  1      2  0
     D WBRAAR                  3      4  0
     D                 DS
     D TURACC                  1      2  0
     D TURAAR                  3      4  0
     D TURAR4                  1      4  0
N19  D                 DS
N19  D  TmpDat                 1      4  0
N19  D   TmpDT12               1      2  0
N19  D   TmpDT34               3      4  0
N19  D                 DS
N19  D  FixedDat               1      8  0
N19  D   FxÅÅÅÅ                1      4  0
N19  D   FxMM                  5      6  0
N19  D   FxDD                  7      8  0
S20  D*                DS
S20  D*TUTVKT                  5      9  0
S20  D*XTUTVKT                 1      9  0
N02  D                 DS
N02  D TUTLM                   3      6  2
N02  D XTUTLM                  1      6  2
N02  D                 DS
S20  D*TUTM3                   3      7  2
S20  D*XTUTM3                  1      7  2
N02  D                 DS
N02  D  DIDATF                 1      8  0
N02  D  DITIMF                 9     12  0
N02  D  DIFRA                  1     12  0
N02  D                 DS
N02  D  DIDATT                 1      8  0
N02  D  DITIMT                 9     12  0
N02  D  DITIL                  1     12  0
N02  D                 DS
N02  D  MINDT                  1     12  0
N02  D  MINDAT                 1      8  0
N02  D  MINTIM                 9     12  0
N02  D  MINSTE                13     17
N02  D  MINLK                 18     19
N02  D                 DS
N02  D  MAXDT                  1     12  0
N02  D  MAXDAT                 1      8  0
N02  D  MAXTIM                 9     12  0
N02  D  MAXSTE                13     17
N02  D  MAXLK                 18     19
N02  D                 DS
N02  D  TUTARF                 1     15
N02  D  TUBLORR                1      1
N02  D  TUTR                   2      5
     D                 DS
     D  UNRETU                 1     30
     D  UNPDA                  1      4
     D  UNSJNR                 5     12
N17  D                 DS
N17  D  POMSDS1                1    256
N17  D  P1WSEDRE               1      3
      *
     D XBANE           S             50
     D                 DS
     D  updf1                  1    400
     D  updf2                401    800
     D  updf3                801   1200
     D  updf4               1201   1600
     D  updf5               1601   2000
     D  updf6               2001   2400
     D  updf7               2401   2800
     D  updf8               2801   3200
     D  updf9               3201   3600
     D  updf10              3601   4000
     D  updf11              4001   4400
     D  updf12              4401   4800
     D  updf13              4801   5200
     D  updf14              5201   5600
     D  updf15              5601   6000
     D  updf16              6001   6400
     D  updf17              6401   6800
     D  updf18              6801   7200
     D  updf19              7201   7600
     D  updf20              7601   8000
     D  updf21              8001   8400
     D  updf22              8401   8800
     D  updf23              8801   9200
     D  updf24              9201   9600
     D  updf25              9601  10000
     D  updf26             10001  10400
     D  updf27             10401  10800
     D  updf28             10801  11200
     D  updf29             11201  11600
     D  updf30             11601  12000
     D  updf31             12001  12400
     D  updf32             12401  12800
     D  updf33             12801  13200
     D  updf34             13201  13600
     D  updf35             13601  14000
     D  updf36             14001  14400
     D  updf37             14401  14800
     D  updf38             14801  15200
     D  updf39             15201  15600
     D  updf40             15601  16000
     D  updf                   1  16000    DIM(40)
      *
      /copy syspeds/qrpgsrcpy,prolog3
      *
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input / cvt to numeric
     C                   exsr      Parse
      * File open / keys
     C                   EXSR      INIT
      *
     C                   SELECT
     C                   WHEN      WSSTART = 'J'
     C                   IF        WBTUR = 0
     C                   EXSR      SRBLANK
     C                   ELSE
     C                   EXSR      SRGET
     C                   END
     C                   WHEN      WSCAN   = 'J'
     C                   IF        XTURTYPE = 'O'
     C                   EXSR      TESTB1
     C                   ELSE
     C                   EXSR      TESTB1LT
     C                   END
     C                   IF        FEILMELDING = *BLANKS
     C                   EXSR      SREND
     C                   END
     C                   WHEN      WSCAN   = 'Y'
     C                   EXSR      SREND
s18  C*                  WHEN      WSCAN   = 'A'                                Avslutt
s18  C*                  EXSR      SRAVSL
N18  C                   WHEN      WSCAN   = 'A' or WSCAN = 'O'                  Avslutt/Open
N18  C                   EXSR      SRAVSLOPN
N16  C                   EXSR      SREND
     C                   OTHER
     C                   IF        XTURTYPE = 'O'
     C                   EXSR      TESTB1
     C                   ELSE
     C                   EXSR      TESTB1LT
     C                   END
     C                   ENDSL
      *
     C                   IF        ((FMELDNR = *BLANKS) AND (WSSTART <> 'J'))
     C                   IF        XTURTYPE = 'O'
     C                   EXSR      SRUPD
     C                   ELSE
     C                   EXSR      SRUPDLT
     C                   END
     C                   ELSE
     C*                  MOVE      WSKDB         TRBCD
     C                   END
N02   *
N02   * HENT FRA/TIL STED
N02  C                   IF        WSHSD <> *BLANKS
N02  C                   EXSR      SRHENTSD
N02  C                   END
      *
      * Read output skeleton html member into memory
     C                   exsr      LoadHtml
      * Set section variables
     C                   exsr      Settop
     C                   callp     wrtsection('top')
      *
     C                   IF        XTURTYPE = 'O'
      *
     C     TUPRO         SETLL     HEAD14                                 33
     C                   IF        (*IN33 AND (TUPRO <> 0))
     C                   MOVE      'J'           XVIS              1
     C                   callp     wrtsection('VisSted')
     C                   ELSE
     C                   MOVE      'N'           XVIS              1
     C                   callp     wrtsection('EndreSted')
     C                   END
     C                   callp     wrtsection('Tur1')
N03  C                   EXSR      DSPTROB
N05  C                   exsr      VISREASON
     C                   EXSR      HENTDOK
     C                   callp     wrtsection('VisDok')
      *
     C                   IF        XVIS = 'J'
     C                   callp     wrtsection('VisSted2')
     C                   ELSE
     C                   callp     wrtsection('VisSted1')
     C                   END
     C                   callp     wrtsection('VisSted3')
     C                   IF        XVIS = 'N'
     C                   callp     wrtsection('VisSted4')
     C                   ELSE
     C                   callp     wrtsection('VisSted5')
     C                   END
     C                   callp     wrtsection('VisSted6')
      *
     C                   ELSE
     C                   callp     wrtsection('Tur1')
     C                   EXSR      HENTDOK
     C                   callp     wrtsection('VisDok')
     C                   callp     wrtsection('VisSted6')
     C                   END
      *
      *
      * Quit
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   callp     wrtsection('bot')
     C                   exsr      Exit
      *
     C                   eval      *inlr = *on
     C                   return
      *
      *
      *=====================================================================
      * Parse input / cvt to numeric
      *=====================================================================
     C     Parse         begsr
N19   * dagens dato benytte i FIXDAT - SYFE15 derfor flyttet far INIT -> PARSE
N19  C                   CALL      'SYGE15C'
N19  C                   PARM                    WDT               8
N19  C                   PARM                    WTM               6
N19  C                   MOVE      WDT           XIDAG             8 0
      * Parse variables from QUERY_STRING environment variable
     C                   eval      user     = zhbgetvar('user')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   eval      WSTUR    = zhbgetvar('WSTUR')
     C                   EVAL      WBTUR    = c2n2(WSTUR)
     C                   eval      WSFRAMES = zhbgetvar('FRAMES')
     C                   eval      WSSTART  = zhbgetvar('WSSTART')
     C                   eval      WSCAN    = zhbgetvar('WSCAN')
     C                   eval      WSTUR    = zhbgetvar('WSTUR')
     C                   EVAL      WBTUR    = c2n2(WSTUR)
N10  C                   eval      WSST     = zhbgetvar('WSST')
N10  C     LC:UC         XLATE     WSST          WSST
     C                   eval      WSLSH    = zhbgetvar('WSLSH')
     C     LC:UC         XLATE     WSLSH         WSLSH
     C                   eval      WSLOH    = zhbgetvar('WSLOH')
     C     LC:UC         XLATE     WSLOH         WSLOH
     C                   eval      WSBLNR   = zhbgetvar('WSBLNR')
     C     LC:UC         XLATE     WSBLNR        WSBLNR
N03  C                   eval      WSBLORR = zhbgetvar('WSBLORR')
N03  C                   eval      WSTR    = zhbgetvar('WSTR')
     C                   eval      WSBNV    = zhbgetvar('WSBNV')
     C     LC:UC         XLATE     WSBNV         WSBNV
     C                   eval      WSETD    = zhbgetvar('WSETD')
S14  C*                  EVAL      WBETD    = c2n2(WSETD)
N14  C                   EVAL      XN10     = c2n2(WSETD)
N14  C                   MOVE      XN10          WBETD
     C                   eval      WSETA    = zhbgetvar('WSETA')
S14  C*                  EVAL      WBETA    = c2n2(WSETA)
N14  C                   EVAL      XN10     = c2n2(WSETA)
N14  C                   MOVE      XN10          WBETA
     C                   eval      WSATD    = zhbgetvar('WSATD')
S14  C*                  EVAL      WBATD    = c2n2(WSATD)
N14  C                   EVAL      XN10     = c2n2(WSATD)
N14  C                   MOVE      XN10          WBATD
     C                   eval      WSATA    = zhbgetvar('WSATA')
S14  C*                  EVAL      WBATA    = c2n2(WSATA)
N14  C                   EVAL      XN10     = c2n2(WSATA)
N14  C                   MOVE      XN10          WBATA
N05  C                   eval      WSEDRE  = zhbgetvar('WSEDRE')
     C                   eval      WSCON1   = zhbgetvar('WSCON1')
     C     LC:UC         XLATE     WSCON1        WSCON1
     C                   eval      WSCKD1   = zhbgetvar('WSCKD1')
     C     LC:UC         XLATE     WSCKD1        WSCKD1
      *
     C                   eval      WSRAR4   = zhbgetvar('WSRAR4')
     C                   EVAL      WBRAR4   = c2n2(WSRAR4)
     C                   eval      WSRMND   = zhbgetvar('WSRMND')
     C                   EVAL      WBRMND   = c2n2(WSRMND)
     C                   eval      WSBILK   = zhbgetvar('WSBILK')
     C     LC:UC         XLATE     WSBILK        WSBILK
     C                   eval      WSBILN   = zhbgetvar('WSBILN')
     C     LC:UC         XLATE     WSBILN        WSBILN
     C                   eval      WSLK     = zhbgetvar('WSLK')
     C     LC:UC         XLATE     WSLK          WSLK
     C                   eval      WSHENG   = zhbgetvar('WSHENG')
     C     LC:UC         XLATE     WSHENG        WSHENG
     C                   eval      WSLKH    = zhbgetvar('WSLKH')
     C     LC:UC         XLATE     WSLKH         WSLKH
     C                   eval      WSKNT2   = zhbgetvar('WSKNT2')
     C                   EVAL      WBKNT2   = c2n2(WSKNT2)
     C                   eval      WSNAT    = zhbgetvar('WSNAT')
     C     LC:UC         XLATE     WSNAT         WSNAT
     C                   eval      WSSJA1   = zhbgetvar('WSSJA1')
     C                   EVAL      WBSJA1   = c2n2(WSSJA1)
     C                   eval      WSSJN1   = zhbgetvar('WSSJN1')
     C     LC:UC         XLATE     WSSJN1        WSSJN1
     C                   eval      WSSJA2   = zhbgetvar('WSSJA2')
     C                   EVAL      WBSJA2   = c2n2(WSSJA2)
     C                   eval      WSSJN2   = zhbgetvar('WSSJN2')
     C     LC:UC         XLATE     WSSJN2        WSSJN2
     C                   eval      WSDT     = zhbgetvar('WSDT')
     C                   EVAL      WBDT     = c2n2(WSDT)
N19  C                   if        WBDT  < 9999
N19  C                   eval      TmpAlf= WSDT
N19  C                   eval      TmpDat= WBDT
N19  C                   exsr      FixDat
N19  C                   eval      WBDT  = FixedDat
N19  c                   endif
     C                   eval      WSTM     = zhbgetvar('WSTM')
     C                   EVAL      WBTM     = c2n2(WSTM)
     C                   eval      WSSTEF   = zhbgetvar('WSSTEF')
     C     LC:UC         XLATE     WSSTEF        WSSTEF
     C                   eval      WSLKFR   = zhbgetvar('WSLKFR')
     C     LC:UC         XLATE     WSLKFR        WSLKFR
     C                   eval      WSDTT    = zhbgetvar('WSDTT')
     C                   EVAL      WBDTT    = c2n2(WSDTT)
N19  C                   if        WBDTT < 9999
N19  C                   eval      TmpAlf= WSDTT
N19  C                   eval      TmpDat= WBDTT
N19  C                   exsr      FixDat
N19  C                   eval      WBDTT = FixedDat
N19  c                   endif
     C                   eval      WSTMT    = zhbgetvar('WSTMT')
     C                   EVAL      WBTMT    = c2n2(WSTMT)
     C                   eval      WSSTET   = zhbgetvar('WSSTET')
     C     LC:UC         XLATE     WSSTET        WSSTET
     C                   eval      WSLKTO   = zhbgetvar('WSLKTO')
     C     LC:UC         XLATE     WSLKTO        WSLKTO
     C                   eval      WSTVAL   = zhbgetvar('WSTVAL')
     C     LC:UC         XLATE     WSTVAL        WSTVAL
     C                   eval      WSTAKO   = zhbgetvar('WSTAKO')
     C     LC:UC         XLATE     WSTAKO        WSTAKO
     C                   eval      WSTBEL   = zhbgetvar('WSTBEL')
     C                   EVAL      WBTBEL   = c2n2(WSTBEL)
N02  C                   eval      WSHSD    = zhbgetvar('WSHSD')
N02  C                   eval      WSSORT   = zhbgetvar('WSSORT')
N02  C                   eval      WSSNR    = zhbgetvar('WSSNR')
N02  C                   eval      WSSST    = zhbgetvar('WSSST')
N02  C                   eval      WSSAVD   = zhbgetvar('WSSAVD')
N22  C                   EVAL      WBSAVD   = c2n2(WSSAVD)                      I fall numerisk
N15  C                   eval      WSTtxt  = zhbgetvar('tTxta')
N15  C     LC:UC         XLATE     WSTtxt        WSTtxt
      *
     C                   eval      FEILMELDING = *BLANKS
     C                   eval      FMELDNR     = *BLANKS
      *
     C                   endsr
      *
N19  C***********************************************
N19  C     FIXDAT        BEGSR
N19  C***********************************************
N19  C* FixedDat settes vis DS FX...
N19  C                   MOVE      *zeros        FixedDat
N19  C     TMPDAT        ifeq      *zeros
N19  c     TMPALF        ifeq      'T'                                          T=Today
N19  c     TMPALF        oreq      't'                                          T=Today
N19  C                   MOVE      XIÅR          FXÅÅÅÅ
N19  C                   MOVE      XIMM          FXMM
N19  C                   MOVE      XIDD          FXDD
N19  c                   endif
N19  C                   else
N19  C                   MOVE      XIÅR          FXÅÅÅÅ
N19   * KUN 2 SIFFER GITT - DAG.
N19  C     TmpDAT        IFLE      99                                           '  29'
N19  C                   MOVE      XIMM          FXMM
N19  C                   MOVE      TmpDT34       FXDD
N19  C                   ELSE
N19   * mer enn 2 siffer gitt - DAG /MND                                        '2911'
N19  C                   MOVE      TmpDT34       FXMM
N19  C                   MOVE      TmpDT12       FXDD
N19  C                   END
N19  C                   endif
N19  C*
N19  C                   ENDSR
      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   CLOSE     BRIDF
S02  C*                  CLOSE     TURER
N02  C                   CLOSE     TURER14
N15  C                   CLOSE     FREETUR1
     C                   CLOSE     HEAD14
N06  C                   CLOSE     HEADF
N02  C                   CLOSE     DISP
     C                   CLOSE     BILLOF
     C                   CLOSE     BLV1
     C                   CLOSE     TRACKT
     C                   CLOSE     TRACKF
     C                   CLOSE     TELL
N09  C                   CLOSE     TELLRU
N03  C                   CLOSE     CDTRAFL2
     C                   CLOSE     CDCON4
     C                   CLOSE     STED2
     C                   CLOSE     BRPARF
     C                   CLOSE     FIRMARC
     C                   CLOSE     ARKTXT
     C                   CLOSE     ARKEXT
     C                   CLOSE     ARKIVL11
     C                   CLOSE     FIRM
     C                   CLOSE     BILK
     C                   CLOSE     DRIV
     C                   CLOSE     KODTLK
     C                   CLOSE     KODTÅ
     C                   CLOSE     STED2D
     C                   CLOSE     UNITL01
     C                   CLOSE     CUNDL01
     C                   CLOSE     VALUL01
      *
     C                   endsr
      *
      *=====================================================================
      * Read output skeleton html member into memory
      *=====================================================================
     C     LoadHtml      begsr
      *
     C                   IF        XTURTYPE = 'O'
     C                   callp     gethtml('HTMLSRC':
     C                             '*LIBL':
     C                             'ETUR02':'/CGITAG/')
     C                   ELSE
     C                   callp     gethtml('HTMLSRC':
     C                             '*LIBL':
     C                             'ETUR02L':'/CGITAG/')
     C                   END
      *
     C                   endsr
      *=====================================================================
      *  Set variable data for section /$top
      *=====================================================================
     C     SetTop        begsr
      *
OddEvC                   callp     updHTMLvar('ROWHEAD':RowHead)
OddEvC                   callp     updHTMLvar('LogoImg':LogoImg)
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHTMLvar('USER':USER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHtmlVar('WSTUR':
     C                             %trim(%editc(WBTUR:'L')))
     C                   callp     updHTMLvar('FRAMES':WSFRAMES)
N02  C                   callp     updHTMLvar('WSSORT':WSSORT)
N02  C                   callp     updHTMLvar('WSSNR':WSSNR)
N02  C                   callp     updHTMLvar('WSSST':WSSST)
N02  C                   callp     updHTMLvar('WSSAVD':WSSAVD)
      *
S02  C*    TURERK        CHAIN     TURER                              33
N02  C     WBTUR         CHAIN     TURER14                            33
     C                   EVAL      TUAO   = 0
     C                   EVAL      TUTS   = 0
S02  C*                  EVAL      TUTVKT = 0
S02  C*                  EVAL      TUTM3  = 0
S02  C*                  EVAL      TUTLM  = 0
S20  C*                  EVAL      XTUTVKT = 0
S20  C*                  EVAL      XTUTM3  = 0
N20  C                   EVAL      TUTVKT = 0
N20  C                   EVAL      TUTM3  = 0
N02  C                   EVAL      XTUTLM  = 0
     C                   IF        *IN33 = *OFF
     C     TUPRO         SETLL     HEAD14
     C     TUPRO         READE     HEAD14                                 33
     C                   DOW       *IN33 = *OFF
     C                   EVAL      TUAO   = TUAO + 1
     C                   EVAL      TUTS   = TUTS + HENT
S02  C*                  EVAL      TUTVKT = TUTVKT + HEVKT
S02  C*                  EVAL      TUTM3  = TUTM3 + HEM3
S02  C*                  EVAL      TUTLM  = TUTLM + HELM
S20  C*                  EVAL      XTUTVKT = XTUTVKT + HEVKT
S20  C*                  EVAL      XTUTM3  = XTUTM3 + HEM3
N20  C                   EVAL      TUTVKT = TUTVKT + HEVKT
N20  C                   EVAL      TUTM3  = TUTM3 + HEM3
N02  C                   EVAL      XTUTLM  = XTUTLM + HELM
     C     TUPRO         READE     HEAD14                                 33
     C                   ENDDO
S20  c*                  if        XTUTM3 > 999.99
S20  c*                  eval      XTUTM3 = 999.99
S20  c*                  endif
     C                   UPDATE    TURERR
     C                   END
      *
N10  C                   callp     updHTMLvar('WSST':WSST)
     C                   callp     updHTMLvar('WSLSH':WSLSH)
     C                   callp     updHTMLvar('WSLOH':WSLOH)
     C                   callp     updHTMLvar('WSBLNR':WSBLNR)
N03  C                   callp     updHtmlVar('WSBLORR':WSBLORR)
     C                   callp     updHTMLvar('WSBNV':WSBNV)
     C                   callp     updHtmlVar('WSETD':
     C                             %trim(%editw(WBETD:'    .  .  ')))
     C                   callp     updHtmlVar('WSETA':
     C                             %trim(%editw(WBETA:'    .  .  ')))
     C                   callp     updHtmlVar('WSATD':
     C                             %trim(%editw(WBATD:'    .  .  ')))
     C                   callp     updHtmlVar('WSATA':
     C                             %trim(%editw(WBATA:'    .  .  ')))
     C                   callp     updHTMLvar('WSCON1':WSCON1)
     C                   callp     updHTMLvar('WSCKD1':WSCKD1)
     C                   callp     updHtmlVar('TUAO':
     C                             %trim(%editc(TUAO:'Z')))
     C                   callp     updHtmlVar('TUTS':
     C                             %trim(%editc(TUTS:'Z')))
     C                   callp     updHtmlVar('TUTVKT':
     C                             %trim(%editc(TUTVKT:'Z')))
     C                   callp     updHtmlVar('TUTM3':
     C                             %trim(%editc(TUTM3:'3')))
     C                   callp     updHtmlVar('TUTLM':
     C                             %trim(%editc(TUTLM:'3')))
      *
N23  C*                  callp     updHtmlVar('WSRAR4':
N23  C*                            %trim(%editc(WBRAR4:'3')))
N23  C                   callp     updHtmlVar('WSRAR4':
N23  C                             %trim(%editc(WBRAR4:'Z')))
S12  C*                  callp     updHtmlVar('WSRMND':
S12  C*                            %trim(%editc(WBRMND:'3')))
N12  c                   move      WBRMND        WSRMND
N12  c                   if        WBRMND = 0
N12  c                   move      *blanks       WSRMND
N12  c                   endif
N12  C                   callp     updHtmlVar('WSRMND':WSRMND)
     C                   callp     updHTMLvar('WSBILK':WSBILK)
     C                   callp     updHTMLvar('WSBILN':WSBILN)
     C                   callp     updHTMLvar('WSLK':WSLK)
     C                   callp     updHTMLvar('WSHENG':WSHENG)
     C                   callp     updHTMLvar('WSLKH':WSLKH)
     C                   callp     updHtmlVar('WSKNT2':
     C                             %trim(%editc(WBKNT2:'3')))
     C                   callp     updHTMLvar('WSNAT':WSNAT)
     C                   callp     updHtmlVar('WSSJA1':
     C                             %trim(%editc(WBSJA1:'3')))
     C                   callp     updHTMLvar('WSSJN1':WSSJN1)
     C                   callp     updHtmlVar('WSSJA2':
     C                             %trim(%editc(WBSJA2:'3')))
     C                   callp     updHTMLvar('WSSJN2':WSSJN2)
     C                   callp     updHtmlVar('WSDT':
     C                             %trim(%editw(WBDT:'    .  .  ')))
     C                   callp     updHtmlVar('WSTM':
     C                             %trim(%editw(WBTM:'0 :  ')))
     C                   callp     updHTMLvar('WSSTEF':WSSTEF)
     C                   callp     updHTMLvar('WSLKFR':WSLKFR)
     C                   callp     updHTMLvar('WSSDF':WSSDF)
     C                   callp     updHtmlVar('WSDTT':
     C                             %trim(%editw(WBDTT:'    .  .  ')))
     C                   callp     updHtmlVar('WSTMT':
     C                             %trim(%editw(WBTMT:'0 :  ')))
     C                   callp     updHTMLvar('WSSTET':WSSTET)
     C                   callp     updHTMLvar('WSLKTO':WSLKTO)
     C                   callp     updHTMLvar('WSSDT':WSSDT)
     C                   callp     updHTMLvar('WSTVAL':WSTVAL)
     C                   callp     updHTMLvar('WSTAKO':WSTAKO)
     C                   callp     updHtmlVar('WSTBEL':
     C                             %trim(%editc(WBTBEL:'3')))
N15  C                   callp     updhtmlvar('WSTtxt':WSTtxt)
      *
     C                   callp     updhtmlvar('FEILMELDING':
     C                             FEILMELDING)
     C                   callp     updhtmlvar('FMELDNR':FMELDNR)
      *
     C                   endsr
      *
      *=====================================================================******
      *  SRBLANK
      *=====================================================================******
     C     SRBLANK       begsr
      *
     C                   EVAL      WBTUR  = 0
     C                   EVAL      WSLSH  = *BLANKS
     C                   EVAL      WSLOH  = *BLANKS
     C                   EVAL      WSBLNR = *BLANKS
N03  C                   EVAL      WSBLORR = *BLANKS
     C                   EVAL      WSBNV  = *BLANKS
     C                   EVAL      WBETD  = 0
     C                   EVAL      WBETA  = 0
     C                   EVAL      WBATD  = 0
     C                   EVAL      WBATA  = 0
     C                   EVAL      WSCON1 = *BLANKS
     C                   EVAL      WSCKD1 = *BLANKS
      *
     C                   EVAL      WBRAR4 = 0
     C                   EVAL      WBRMND = 0
      * ved land- foreslå periode (men ikke kloss i overgang, MINDRE her enn i GR-skjerm)
N12  C                   IF        XTURTYPE<>'O'
N12  C                             and XIDD>2 and  XIDD<27
N12  C                   EVAL      WBRAR4 = XIÅR
N12  C                   EVAL      WBRMND = XIMM
N12  c                   endif
N10  C                   EVAL      WSST   = *BLANKS
     C                   EVAL      WSBILK = *BLANKS
     C                   EVAL      WSBILN = *BLANKS
     C                   EVAL      WSLK   = *BLANKS
     C                   EVAL      WSHENG = *BLANKS
     C                   EVAL      WSLKH  = *BLANKS
     C                   EVAL      WBKNT2 = 0
     C                   EVAL      WSNAT  = *BLANKS
     C                   EVAL      WBSJA1 = 0
     C                   EVAL      WSSJN1 = *BLANKS
     C                   EVAL      WBSJA2 = 0
     C                   EVAL      WSSJN2 = *BLANKS
     C                   EVAL      WBDT   = 0
     C                   EVAL      WBTM   = 0
     C                   EVAL      WSSTEF = *BLANKS
     C                   EVAL      WSLKFR = *BLANKS
     C                   EVAL      WSSDF  = *BLANKS
     C                   EVAL      WBDTT  = 0
     C                   EVAL      WBTMT  = 0
     C                   EVAL      WSSTET = *BLANKS
     C                   EVAL      WSLKTO = *BLANKS
     C                   EVAL      WSSDT  = *BLANKS
     C                   EVAL      WSTVAL = *BLANKS
     C                   EVAL      WSTAKO = *BLANKS
     C                   EVAL      WBTBEL = 0
      *
     C                   endsr
      *
      *=====================================================================******
      *  SRGET
      *=====================================================================******
     C     SRGET         begsr
      *
S02  C*    TURERK        CHAIN(N)  TURER                              33
N02  C     WBTUR         CHAIN(N)  TURER14                            33
     C                   IF        TUST <> ' '
     C                   EXSR      SREND
     C                   GOTO      SRGETEND
     C                   END
N10  C                   EVAL      WSST   = TUST
     C                   EVAL      WSLSH  = TUSTEF
     C                   EVAL      WSLOH  = TUSTET
     C                   EVAL      WSBLNR = TUBLNR
N03  C                   EVAL      WSBLORR = TUBLORR
N03  C                   EVAL      WSTR   = TUTR
     C                   EVAL      WSBNV  = TUBNV
     C                   EVAL      WSCON1 = TUCON1
     C                   EVAL      WSCKD1 = TUCKD1
     C                   EVAL      WBETD  = TUETD
     C                   EVAL      WBETA  = TUETA
     C                   EVAL      WBATD  = TUATD
     C                   EVAL      WBATA  = TUATA
      *
     C                   EVAL      WBRAR4 = TURAR4
     C                   EVAL      WBRMND = TURMND
     C                   EVAL      WSBILK = TUBILK
     C                   EVAL      WSBILN = TUBILN
     C                   EVAL      WSLK   = TULK
     C                   EVAL      WSHENG = TUHENG
     C                   EVAL      WSLKH  = TULKH
     C                   EVAL      WBKNT2 = TUKNT2
     C                   EVAL      WSNAT  = TUNAT
     C                   EVAL      WBSJA1 = TUSJA1
     C                   EVAL      WSSJN1 = TUSJN1
     C                   EVAL      WBSJA2 = TUSJA2
     C                   EVAL      WSSJN2 = TUSJN2
     C                   EVAL      WBDT   = TUDT
     C                   EVAL      WBTM   = TUTM
     C                   EVAL      WSSTEF = TUSTEF
     C                   MOVEL     TUSONF        WSLKFR
     C                   EVAL      WSSDF  = TUSDF
     C                   EVAL      WBDTT  = TUDTT
     C                   EVAL      WBTMT  = TUTMT
     C                   EVAL      WSSTET = TUSTET
     C                   MOVEL     TUSONT        WSLKTO
     C                   EVAL      WSSDT  = TUSDT
     C                   EVAL      WSTVAL = TUTVAL
     C                   EVAL      WSTAKO = TUTAKO
     C                   EVAL      WBTBEL = TUTBEL
      *
N15
N15   * Hent Fritekst.
N15  C                   MOVE      *BLANKS       TX
N15  C                   MOVE      *ZEROS        NR
N15  C                   MOVE      'J'           X1LIN             1
N15  C     Turkey        SETLL     FREETUR1
N15  C     Turkey        Reade(N)  FREETUR1                               33
N15  C                   DOW       *IN33 = *OFF
N15  C     FRTKOD        IFEQ      'G'
N15  C                   IF        X1LIN = 'J'
N15  C                   EVAL      X1LIN = 'N'
N15  C                   ELSE
N15  C                   CAT       CRLF:0        WSTTXT
N15  C                   END
N15  C                   CAT       FRTTXT:0      WSTTXT
N15  C                   END
N15  C     Turkey        Reade(N)  FREETUR1                               33
N15  C                   END
      *
     C     SRGETEND      ENDSR
      *
      *=====================================================================******
      *  TESTB1
      *=====================================================================******
     C     TESTB1        begsr
N23   * Period KAN, men MÅ ikke angis i OVERSJ - test hvis oppgitt
N23   * TESTER PERIODE  (26 ON=STATUS ULIK ' ' - PROTECT/IKKE TEST)
N23  c                   IF        WBRMND <> 0   OR  WBRAR4 <> 0
N23  C                   IF        ((WBRMND < 1) AND (WBRMND > 12))
N23  C                   EVAL      FEILMELDING = FEIL21
N23  C                   EVAL      FMELDNR     = '21'
N23  C                   GOTO      SLTB1
N23  C                   END
N23   *
N23  C     WBRAR4        SUB       XIÅR          DIFFYE            4 0
N23  C     DIFFYE        IFLT      -1
N23  C     DIFFYE        ORGT      1
N23  C                   EVAL      FEILMELDING = FEIL21
N23  C                   EVAL      FMELDNR     = '21'
N23  C                   GOTO      SLTB1
N23  C                   END
N23   *
N23  C     KODTÅK        CHAIN     KODTÅ                              33
N23  C                   IF        *IN33
N23  C                   EVAL      FEILMELDING = FEIL22
N23  C                   EVAL      FMELDNR     = '22'
N23  C                   GOTO      SLTB1
N23  C                   END
N23  C                   END
     c*
     C                   IF        WSLSH = *BLANKS
     C     WSLSH         CHAIN     STED2                              33
     C                   IF        *IN33
     C                   MOVEL     FEIL01        FEILMELDING
     C                   MOVE      '01'          FMELDNR
     C                   GOTO      SLTB1
     C                   ENDIF
     C                   ENDIF
      *
     C                   IF        WSLOH = *BLANKS
     C     WSLOH         CHAIN     STED2                              33
     C                   IF        *IN33
     C                   MOVEL     FEIL02        FEILMELDING
     C                   MOVE      '02'          FMELDNR
     C                   GOTO      SLTB1
     C                   ENDIF
     C                   ENDIF
      *
     C                   IF        WSBNV = *BLANKS
     C                   MOVEL     FEIL03        FEILMELDING
     C                   MOVE      '03'          FMELDNR
     C                   GOTO      SLTB1
     C                   ENDIF
      *
     C                   IF        WBETD <> 0
     C                   MOVE      WBETDD        UDD               2 0
     C                   MOVE      WBETDM        UMM               2 0
     C                   MOVE      WBETDÅ        UÅÅ               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL04        FEILMELDING
     C                   MOVE      '04'          FMELDNR
     C                   GOTO      SLTB1
     C                   ENDIF
     C                   ENDIF
      *
     C                   IF        WBETA <> 0
     C                   MOVE      WBETAD        UDD               2 0
     C                   MOVE      WBETAM        UMM               2 0
     C                   MOVE      WBETAÅ        UÅÅ               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL05        FEILMELDING
     C                   MOVE      '05'          FMELDNR
     C                   GOTO      SLTB1
     C                   ENDIF
     C                   ENDIF
      *
     C                   IF        WBATD <> 0
     C                   IF        WBATD > XIDAG
     C                   Z-ADD     1             UFLAGG
     C                   ELSE
     C                   MOVE      WBATDD        UDD               2 0
     C                   MOVE      WBATDM        UMM               2 0
     C                   MOVE      WBATDÅ        UÅÅ               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C                   END
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL06        FEILMELDING
     C                   MOVE      '06'          FMELDNR
     C                   GOTO      SLTB1
     C                   ENDIF
     C                   ENDIF
      *
     C                   IF        WBATA <> 0
     C                   IF        WBATA > XIDAG
     C                   Z-ADD     1             UFLAGG
     C                   ELSE
     C                   MOVE      WBATAD        UDD               2 0
     C                   MOVE      WBATAM        UMM               2 0
     C                   MOVE      WBATAÅ        UÅÅ               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C                   END
     C     UFLAGG        IFEQ      1
     C                   MOVEL     FEIL07        FEILMELDING
     C                   MOVE      '07'          FMELDNR
     C                   GOTO      SLTB1
     C                   ENDIF
     C                   ENDIF
N05   * TEST OM ÅRSAK ER GITT
N05  C     WBTUR         SETLL     HEAD14
N05  C     WBTUR         READE     HEAD14                                 33
N05  C  N33TRACKTK       CHAIN(N)  TRACKT                             33
N05  C  N33              IF        (((((TXETAD <> 0) AND (TXETAD <> WBETA)) OR
N05  C                                ((TXETDD <> 0) AND (TXETDD <> WBETD))) OR
N05  C                                ((TXATAD <> 0) AND (TXATAD <> WBATA))) OR
N05  C                                ((TXATDD <> 0) AND (TXATDD <> WBATD)))
N05  C                   IF        WSEDRE = *BLANKS
N05  C                   MOVEL     FEIL10        FEILMELDING
N05  C                   MOVE      '10'          FMELDNR
N05  C                   GOTO      SLTB1
N05  C                   END
N05  C                   END
      *
     C                   IF        ((WSCON1 = *BLANKS) AND (WSCKD1 <> *BLANKS))
     C                   EVAL      FEILMELDING = FEIL08
     C                   EVAL      FMELDNR     = '08'
     C                   GOTO      SLTB1
     C                   END
      *
     C                   IF        ((WSCKD1 <> *BLANKS) OR (WSCON1 <> *BLANKS))
     C     WSCKD1        CHAIN     CDCON4                             33
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL09
     C                   EVAL      FMELDNR     = '09'
     C                   GOTO      SLTB1
     C                   END
     C                   END
      *
     C     SLTB1         ENDSR
      *
      *=====================================================================******
      *  TESTB1LT
      *=====================================================================******
     C     TESTB1LT      begsr
      *
      * TESTER PERIODE  (26 ON=STATUS ULIK ' ' - PROTECT/IKKE TEST)
     C                   IF        ((WBRMND < 1) AND (WBRMND > 12))
     C                   EVAL      FEILMELDING = FEIL21
     C                   EVAL      FMELDNR     = '21'
     C                   GOTO      SLTB1LT
     C                   END
      *
     C     WBRAR4        SUB       XIÅR          DIFFYE            4 0
     C     DIFFYE        IFLT      -1
     C     DIFFYE        ORGT      1
     C                   EVAL      FEILMELDING = FEIL21
     C                   EVAL      FMELDNR     = '21'
     C                   GOTO      SLTB1LT
     C                   END
      *
     C     KODTÅK        CHAIN     KODTÅ                              33
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL22
     C                   EVAL      FMELDNR     = '22'
     C                   GOTO      SLTB1LT
     C                   END
N10   * STATUS - annet enn A/blank = sett til blank
N10  C                   IF        WSST<>' ' and WSST<>'A'
N10  c                   move      ' '           WSST
N10  c                   endif
      *
      * TESTER BILNUMMER
      *
     C     WSBILN        CHAIN     UNITL01                            33
     C                   IF        *IN33
s13  C*                  IF        WSBILK = *BLANKS
N13  C                   IF        WSBILN = *BLANKS
     C                   EVAL      FEILMELDING = FEIL23
     C                   EVAL      FMELDNR     = '23'
     C                   GOTO      SLTB1LT
     C                   END
      *
     C                   ELSE
      *
     C*                  MOVE      UNHØYD        WSHØYB
     C                   MOVE      UNTRME        WSBILK
     C*                  IF        WBTRMA = 0
     C*                  MOVE      UNTRMA        WBTRMA
     C*                  END
     C                   IF        WBKNT2 = 0
     C                   MOVE      UNTRAN        WBKNT2
     C                   END
     C     UNPDA         IFEQ      'PDA:'
     C     UNSJNR        ANDGT     '00000000'
     C     UNSJNR        ANDLT     '99999999'
     C     WSSJN1        ANDEQ     *BLANKS
     C                   MOVE      UNSJNR        WSSJA1
     C                   END
     C                   MOVE      UNLAND        WSLK
     C                   MOVE      UNRUND        GMRUND            8 0
     C     UNTILH        IFNE      *BLANKS
     C     WSHENG        ANDEQ     *BLANKS
     C                   MOVE      UNTILH        WSHENG
     C                   END
     C*                  Z-ADD     UNTARA        WSTARA
     C*                  Z-ADD     UNVEKT        WSKVKT
     C*    WSTARA        ADD       WSKVKT        WSTOV1
     C*                  Z-ADD     UNM3          WSKAM3
     C*                  Z-ADD     UNLM          WSKALM
      *
     C                   END
      *
      * LEGGER OVER HENGER
     C     WSHENG        CHAIN     UNITL01                            33
     C                   IF        *IN33 = *OFF
     C*                  MOVE      UNHØYD        WSHØYH
     C*                  ADD       UNTARA        WSTARA
     C*                  ADD       UNVEKT        WSKVKT
     C*                  ADD       UNTARA        WSTOV1
     C*                  ADD       UNVEKT        WSTOV1
     C*                  ADD       UNM3          WSKAM3
     C*                  ADD       UNLM          WSKALM
     C*                  MOVE      UNLAND        WSLKH
      * "HENGER" ER STEDSKODE BETYR AT DET ER RUTENR DISTRIBUSJON.
      * LEGG RUTE I FRA/TIL STEDSKODE, DAGENS DATO I FRA/TIL DATO
     C                   MOVEL     WSHENG        ST2KOD
     C     ST2KOD        CHAIN     STED2                              33
     C     *IN33         IFEQ      '0'                                           HENGER=RUTE
     C     WSSTEF        IFEQ      *BLANKS
     C                   MOVE      ST2KOD        WSSTEF
     C                   MOVE      ST2LK         WSLKFR
     C                   END
     C     WSSTET        IFEQ      *BLANKS
     C                   MOVE      ST2KOD        WSSTET
     C                   MOVE      ST2LK         WSLKTO
     C                   END
     C     WSDT          IFEQ      *ZEROS
     C                   MOVE      WSDT          WSDT
     C                   END
     C     WSDTT         IFEQ      *ZEROS
     C                   MOVE      WSDTT         WSDTT
     C                   END
     C                   END
      *
     C                   END
      *
      *** TEST LANDKODE BIL
      *
     C                   MOVE      WSLK          KLKLK
     C     KODTLKK       CHAIN     KODTLK                             33
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL24
     C                   EVAL      FMELDNR     = '24'
     C                   GOTO      SLTB1LT
     C                   END
      *
      *** TEST LANDKODE HENGER
      *
     C     WSHENG        IFNE      *BLANKS
     C     WSLKH         IFEQ      *BLANKS
     C                   MOVE      WSLK          WSLKH
     C                   END
     C                   MOVE      WSLKH         KLKLK
     C     KODTLKK       CHAIN     KODTLK                             33
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL25
     C                   EVAL      FMELDNR     = '25'
     C                   GOTO      SLTB1LT
     C                   END
     C                   END
      *
      *          TESTER BILKODE
      * GJØRES NOE SENERE DA DENNE HENTES FRA BIL
      *
     C     WSBILK        CHAIN     BILK                               33
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL26
     C                   EVAL      FMELDNR     = '26'
     C                   GOTO      SLTB1LT
     C                   END
      *
      *
      * TEST TRANSPORTØR
      *
      * FLYTTET SOM EGEN SR
     C                   MOVE      *BLANKS       WSAD1T           30
     C                   MOVE      *BLANKS       WSAD2T           30
     C                   MOVE      *BLANKS       WSAD3T           30
     C                   MOVE      WBKNT2        KUNDNR
     C     CUNDL01K      CHAIN     TRAN                               33
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL27
     C                   EVAL      FMELDNR     = '27'
     C                   GOTO      SLTB1LT
     C                   ELSE
      * FEILMELDING DERSOM STOPPKODE SATT
     C     VMSTOP        IFEQ      'J'
     C     VMSTOP        OREQ      'Y'
     C                   EVAL      FEILMELDING = FEIL28
     C                   EVAL      FMELDNR     = '28'
     C                   GOTO      SLTB1LT
     C                   END
     C                   MOVE      VMNAVN        WSNAT
      * HENT FULLSTENDIG NAVN/ADR VIA KUNDENR.
     C                   MOVE      VMTRKU        KUNDNR
     C     CUNDL01K      CHAIN     CUNDL01                            33
     C     *IN33         IFEQ      '0'
     C                   MOVE      ADR1          WSAD1T
     C                   MOVE      ADR2          WSAD2T
     C                   MOVE      *BLANKS       WSAD3T
     C     POSTNR        IFEQ      0
     C                   MOVEL     ADR3          WSAD3T
     C                   ELSE
     C                   MOVEL     POSTNR        WSAD3T
     C                   MOVE      ADR3          WSAD3T
     C                   END
     C                   END
     C                   END
      *
      *  TEST SJÅFØR 1
      *
     C     WBSJA1        IFNE      *ZEROS
     C     WBSJA1        CHAIN     DRIV                               33
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL29
     C                   EVAL      FMELDNR     = '29'
     C                   GOTO      SLTB1LT
     C                   ELSE
     C                   MOVE      DRNAVN        WSSJN1
     C                   END
     C                   ELSE
     C     VMINCR        IFEQ      2
     C     WSSJN1        ANDEQ     *BLANKS
     C                   EVAL      FEILMELDING = FEIL29
     C                   EVAL      FMELDNR     = '29'
     C                   GOTO      SLTB1LT
     C                   END
     C                   END
      *
      *  TEST SJÅFØR 2
      *
     C     WBSJA2        IFNE      *ZEROS
     C     WBSJA2        CHAIN     DRIV                               33
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL30
     C                   EVAL      FMELDNR     = '30'
     C                   GOTO      SLTB1LT
     C                   ELSE
     C                   MOVE      DRNAVN        WSSJN2
     C                   END
     C                   END
      *
      *** TEST DATO  FRA
      *
     C                   MOVE      WBDTÅ         UÅÅ               2 0
     C                   MOVE      WBDTM         UMM               2 0
     C                   MOVE      WBDTD         UDD               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C                   IF        UFLAGG = 1
      * GODTAR 0 VED NY TUR
     C                   IF        ((WBDT <> 0) OR (TUAO <> 0))
     C                   EVAL      FEILMELDING = FEIL31
     C                   EVAL      FMELDNR     = '31'
     C                   GOTO      SLTB1LT
     C                   END
     C                   END
      *
     C                   IF        ((WSSTEF <> *BLANKS) AND (WSLKFR = *BLANKS))
     C                   MOVE      FILAND        WSLKFR
     C                   END
      * TEST/HENT STED FRA
     C     WSLKFR        IFEQ      *BLANKS
     C     WSSTEF        CHAIN     STED2                              33
     C  N33              MOVEL     ST2LK         WSLKFR
     C                   ELSE
     C     ST2DFK        CHAIN     STED2D                             33
     C                   END
      * GODTAR BLANKT STED VED NYTT OPPDRAG
     C   33WSSTEF        IFEQ      *BLANKS
     C     TUAO          COMP      *ZEROS                             3333
     C  N33              MOVE      *BLANKS       ST2NVN
     C  N33              MOVE      *BLANKS       ST2SOL
     C  N33              MOVE      *BLANKS       ST2LK
     C                   END
     C                   MOVE      *BLANKS       WSSDF
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL32
     C                   EVAL      FMELDNR     = '32'
     C                   GOTO      SLTB1LT
     C                   ELSE
     C                   MOVEL     ST2NVN        WSSDF
     C                   MOVE      ST2SOL        WSSONF            5
     C                   MOVEL     ST2LK         WSSONF
     C                   END
      *** TEST DATO  TIL
     C                   MOVE      WBDTTÅ        UÅÅ               2 0
     C                   MOVE      WBDTTM        UMM               2 0
     C                   MOVE      WBDTTD        UDD               2 0
     C                   CALL      'TESTDATO'
     C                   PARM                    UDD
     C                   PARM                    UMM
     C                   PARM                    UÅÅ
     C                   PARM                    UFLAGG            1 0
     C                   IF        UFLAGG = 1
      * GODTAR 0 VED NY TUR
     C                   IF        ((WBDTT <> 0) OR (TUAO <> 0))
     C                   EVAL      FEILMELDING = FEIL33
     C                   EVAL      FMELDNR     = '33'
     C                   GOTO      SLTB1LT
     C                   END
     C                   END
      *
      * FRADAT IKKE STØRRE ENN TILDAT
      *
     C                   IF        WSDT > WSDTT
     C                   EVAL      FEILMELDING = FEIL34
     C                   EVAL      FMELDNR     = '34'
     C                   GOTO      SLTB1LT
     C                   END
      *
     C                   IF        ((WSSTET <> *BLANKS) AND (WSLKTO = *BLANKS))
     C                   MOVE      FILAND        WSLKTO
     C                   END
      * TEST/HENT STED TIL
     C     WSLKTO        IFEQ      *BLANKS
     C     WSSTET        CHAIN     STED2                              33
     C  N33              MOVEL     ST2LK         WSLKTO
     C                   ELSE
     C     ST2DTK        CHAIN     STED2D                             33
     C                   END
     C   33WSSTET        IFEQ      *BLANKS
     C     TUAO          COMP      *ZEROS                             3333
     C  N33              MOVE      *BLANKS       ST2SOL
     C  N33              MOVE      *BLANKS       ST2NVN
     C  N33              MOVE      *BLANKS       ST2LK
     C                   END
     C                   MOVE      *BLANKS       WSSDT
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL35
     C                   EVAL      FMELDNR     = '35'
     C                   GOTO      SLTB1LT
     C                   ELSE
     C                   MOVEL     ST2NVN        WSSDT
     C                   MOVE      ST2SOL        WSSONT            5
     C                   MOVEL     ST2LK         WSSONT
     C                   END
      *
      * TESTER VALUTAKODE
      *
     C                   IF        WBTBEL <> 0
      *
     C                   IF        WSTVAL = *BLANKS
     C                   MOVE      FICURR        WSTVAL
     C                   END
      *
     C     WSTAKO        IFEQ      *BLANKS
     C                   MOVE      'A'           WSTAKO
     C                   END
      *
     C     VALKEY        CHAIN     VALUL01                            33
     C                   IF        *IN33
     C                   EVAL      FEILMELDING = FEIL36
     C                   EVAL      FMELDNR     = '36'
     C                   GOTO      SLTB1LT
     C                   END
      *
     C                   IF        ((WSTAKO <> 'A') AND (WSTAKO <> 'E'))
     C                   EVAL      FEILMELDING = FEIL37
     C                   EVAL      FMELDNR     = '37'
     C                   GOTO      SLTB1LT
     C                   END
      *
     C                   END
      *
N15
N15   * MAX 30 LINJER MELDING
N15  C                   IF        XTURTYPE<>'O'
N15  C                   EXSR      SRTESTL
N15  C                   IF        XANTL > 30
N15  C                   IF        XSPRÅK = 'EN'
N15  C                   eval      FEILMELDING='Number of freetext lines '
N15  c                             +'cannot exeed 30.'
N15  C                   ELSE
N15  C                   eval      FEILMELDING='Max 30 linjer fritekst.'
N15  C                   END
N15  C                   MOVE      '38'          FMELDNR
N15  C                   GOTO      SLTB1LT
N15  C                   END
N15  C                   END
      *
      *
     C     SLTB1LT       ENDSR
      *
      *=====================================================================******
      *  SRUPD
      *=====================================================================******
     C     SRUPD         begsr
     C                   IF        WBTUR = 0
     C                   CLEAR                   TURERR
N12  C                   MOVE      TEAVD         TUAVD
     C     TEAVD         CHAIN     TELL                               33
     C                   MOVE      TETURN        WBTUR
     C                   ADD       1             TETURN
     C                   UPDATE    TELLR
N09  C     TEAVD         CHAIN     TELLRU                             34
N09  C   34AVDZER        CHAIN     TELLRU                             34
N09  C  N34              MOVE      TERUND        TURUND
N09  C  N34              ADD       1             TERUND
N09  C  N34              UPDATE    TELLRUR
      * TEAVD kan nå være 'ødelagt' av chain med avdzer i TELLRU - legg tilbake
N12  C                   MOVE      TUAVD         TEAVD
     C                   ELSE
S02  C*    TURERK        CHAIN     TURER                              33
N02  C     WBTUR         CHAIN     TURER14                            33
     C                   END
      *
     C                   MOVE      'WEB'         TUSG
     C                   MOVE      BIKUNR        TUKNA
     C                   MOVE      WSLSH         TUSTEF
     C                   MOVE      WSLOH         TUSTET
     C                   MOVE      WSBLNR        TUBLNR
N03  C                   IF        WSBLORR = TUBLORR
N03  C                   MOVE      'N'           XOPDORR           1
N03  C                   ELSE
N03  C                   MOVE      'J'           XOPDORR
N03  C                   END
N03  C                   MOVE      WSBLORR       TUBLORR
N03  C                   MOVE      WSTR          TUTR
     C                   MOVE      WSBNV         TUBNV
     C                   MOVE      WSCON1        TUCON1
     C                   MOVE      WSCKD1        TUCKD1
     C                   MOVE      WBATD         TUATD
     C                   MOVE      WBATA         TUATA
     C                   MOVEL     WBETD         TUETD
     C                   MOVEL     WBETA         TUETA
      *
     C                   IF        TUPRO = 0
S12  C*                  MOVE      TEAVD         TUAVD
     C                   MOVE      WBTUR         TUPRO
     C                   WRITE     TURERR
     C                   ELSE
     C                   UPDATE    TURERR
     C                   END
      *
     C     WBTUR         SETLL     HEAD14
     C     WBTUR         READE     HEAD14                                 33
     C                   DOW       *IN33 = *OFF
      * OPPDATER NY OPPDRAGSTYPE
     C                   IF        WBATA <> 0
     C                   call      'ESOVERS4C'
     C                   parm                    HEAVD
     C                   parm                    HEOPD
     C                   parm                    BIFIRM
     C                   parm                    BIBRID
     C                   END
      *
S21  C*                  IF        ((WSBLNR <> *BLANKS) OR (WSCON1 <> *BLANKS))
N21  C                   IF        WSBLNR <> *BLANKS OR WSCON1 <> *BLANKS OR
N21  C                             WSTR <> *BLANKS
     C     BILLOFK       CHAIN     BILLOF                             33
S03  C* N33              IF        WSBLNR <> *BLANKS
N03  C                   IF        *IN33 = *OFF
N03  C                   IF        WSBLNR <> *BLANKS
     C                   EVAL      BLBLNR = WSBLNR
N03  C                   END
N03  C                   IF        ((WSBLORR <> *BLANKS) AND (XOPDORR = 'J'))
N03  C                   EVAL      BLCH = WSBLORR
N03  C                   END
N03  C                   IF        WSTR <> *BLANKS
N03  C                   EVAL      BLTR = WSTR
N03  C                   END
N06  C                   MOVE      WBATD         BLDLOS
N06  C                   MOVE      WBATA         BLDTA
     C                   UPDATE    BILLOFR
     C                   END
     C  N33              IF        WSCON1 <> *BLANKS
     C     BILLOFK       CHAIN     BLV1                               33
     C                   EVAL      BVMN   = WSCON1
     C                   EVAL      BVVKT  = HEVKT
     C                   EVAL      BVM3   = HEM3
     C                   IF        BVVKT  = 0
     C                   EVAL      BVNT   = 0
     C                   ELSE
     C                   EVAL      BVNT   = 1
     C                   END
     C                   EVAL      BVKDC  = WSCKD1
     C     BVKDC         CHAIN     CDCON4                             34
     C                   EVAL      BVVS   = CC4FT
      *
     C                   IF        *IN33
     C                   EVAL      BVAVD  = BLAVD
     C                   EVAL      BVOPD  = BLOPD
     C                   EVAL      BVLI   = 1
     C                   EVAL      BVSORT = 10
     C                   WRITE     BLV1R
     C                   ELSE
     C                   UPDATE    BLV1R
     C                   END
     C                   END
     C                   END
      *
     C     TRACKTK       CHAIN     TRACKT                             33
     C                   IF        *IN33 = *OFF
     C                   EXSR      OPDLOG
cc    * POMS er CC-spesial, men lagt inn i std/hos Systema for å kunne teste
cc   c                   IF        WBETA <> TXETAD
cc   c                             or WBETD <> TXETDD
cc   c                             or WBATA <> TXATAD
cc   c                             or WBATD <> TXATDD
N17  C                   EVAL      POMSDS1  = *BLANKS
N17  C                   EVAL      P1WSEDRE = WSEDRE
N17  C                   EVAL      POMSDS   = POMSDS1
cc   c                   call      'EPOMS41'
cc   c                   parm                    HEAVD
cc   c                   parm                    HEOPD
cc   c                   parm      WBETD         UUETD             8 0
cc   c                   parm      WBETA         UUETA             8 0
cc   c                   parm      WBATD         UUATD             8 0
cc   c                   parm      WBATA         UUATA             8 0
cc   c                   parm                    POMSDS          256
cc   c                   endif
     C                   MOVE      WBETD         TXETDD
     C                   MOVE      WBETA         TXETAD
     C                   MOVE      WBATD         TXATDD
     C                   MOVE      WBATA         TXATAD
     C                   UPDATE    TRACKTR
     C                   END
N06   *
N06  C     HEADFK        CHAIN     HEADF                              33
N06  C                   MOVE      WBATD         TRSDFD
N06  C                   MOVE      WBATA         TRSDTD
N08  C                   IF        WBATA = 0
N08  C                   MOVE      WBETA         HEDTOP
N08  C                   ELSE
N08  C                   MOVE      WBATA         HEDTOP
N08  C                   END
N06  C                   UPDATE    HEADFR
N08  C     BILLOFK       CHAIN     BILLOF                             33
N08  C                   IF        WBATA = 0
N08  C                   MOVE      WBETA         BLDTA
N08  C                   ELSE
N08  C                   MOVE      WBATA         BLDTA
N08  C                   END
N08  C  N33              UPDATE    BILLOFR
      *
     C     WBTUR         READE     HEAD14                                 33
     C                   ENDDO
      *
     C     SRUPDEND      ENDSR
      *
      *=====================================================================******
      *  SRUPDLT
      *=====================================================================******
     C     SRUPDLT       begsr
     C                   IF        WBTUR = 0
     C                   CLEAR                   TURERR
N12  C                   MOVE      TEAVD         TUAVD
     C     TEAVD         CHAIN     TELL                               33
     C                   MOVE      TETURN        WBTUR
     C                   ADD       1             TETURN
     C                   UPDATE    TELLR
N10  C     TEAVD         CHAIN     TELLRU                             34
N10  C   34AVDZER        CHAIN     TELLRU                             34
N10  C  N34              MOVE      TERUND        TURUND
N10  C  N34              ADD       1             TERUND
N10  C  N34              UPDATE    TELLRUR
      * TEAVD kan nå være 'ødelagt' av chain med avdzer i TELLRU - legg tilbake
N12  C                   MOVE      TUAVD         TEAVD
     C                   ELSE
S02  C*    TURERK        CHAIN     TURER                              33
N02  C     WBTUR         CHAIN     TURER14                            33
     C                   END
      *
N10  C                   MOVE      WSST          TUST
     C                   MOVE      WBRACC        TURACC
     C                   MOVE      WBRAAR        TURAAR
     C                   MOVE      WBRMND        TURMND
     C                   MOVE      WSBILK        TUBILK
     C                   MOVE      WSBILN        TUBILN
     C                   MOVE      WSLK          TULK
     C                   MOVE      WSHENG        TUHENG
     C                   MOVE      WSLKH         TULKH
     C                   MOVE      WBKNT2        TUKNT2
     C                   MOVE      WSNAT         TUNAT
     C                   MOVE      WSAD1T        TUAD1T
     C                   MOVE      WSAD2T        TUAD2T
     C                   MOVE      WSAD3T        TUAD3T
     C                   MOVE      WBSJA1        TUSJA1
     C                   MOVE      WSSJN1        TUSJN1
     C                   MOVE      WBSJA2        TUSJA2
     C                   MOVE      WSSJN2        TUSJN2
     C                   MOVE      WBDT          TUDT
     C                   MOVE      WBTM          TUTM
     C                   MOVE      WSSDF         TUSDF
     C                   MOVE      WSSTEF        TUSTEF
     C                   MOVE      WSSONF        TUSONF
     C                   MOVE      WSSDF         TUSDF
     C                   MOVE      WBDTT         TUDTT
     C                   MOVE      WBTMT         TUTMT
     C                   MOVE      WSSDT         TUSDT
     C                   MOVE      WSSTET        TUSTET
     C                   MOVE      WSSONT        TUSONT
     C                   MOVE      WSSDT         TUSDT
     C                   MOVE      WSTVAL        TUTVAL
     C                   MOVE      WSTAKO        TUTAKO
     C                   MOVE      WBTBEL        TUTBEL
      *
     C                   IF        TUPRO = 0
S12  C*                  MOVE      TEAVD         TUAVD
     C                   MOVE      WBTUR         TUPRO
     C                   WRITE     TURERR
     C                   ELSE
     C                   UPDATE    TURERR
     C                   END
N15   * Oppdater Fritekst.
N15  C                   IF        XTURTYPE<>'O'
N15   * slett gml type G
N15  C     Turkey        SETLL     FREETUR1
N15  C     Turkey        Reade     FREETUR1                               33
N15  C     *in33         doweq     '0'
N15  c                   if        FRTKOD='G'
N15  c                   delete    FREETURR
N15  c                   else
N15  c                   update    FREETURR
N15  c                   endif
N15  C     Turkey        Reade     FREETUR1                               33
N15  c                   end
N15   * legg ut nye type G
N15  c                   move      TUAVD         FRTAVD
N15  c                   move      TUPRO         FRTTUR
N15  c                   move      *zeros        FRTLI
N15  c                   move      XIDAG         FRTDT
N15  c     WSTtxt        Ifne      *blanks
N15  c                   move      'G'           FRTKOD
N15  C                   EVAL      KVTXT = WSTTXT
N15  C                   Z-ADD     70            XLINL             3 0
N15  C                   EXSR      KVTLIN
N15  c                   exsr      SkrivFrt
N15  c                   end
N15   *
N15  c                   endif
      *
     C     SRUPDENDLT    ENDSR
      *
S18  C*    SRAVSL        begsr
N16   *=====================================================================******
N16   *  SRAVSLOPN
N16   *=====================================================================******
N16  C     SRAVSLOPN     begsr
N16  c*sett avsluttet  (eller open)
N16  C     WBTUR         CHAIN     TURER14                            33
N16  c     *in33         ifeq      '0'
N18  c                   move      'ESOVERS4C'   BYTTOTPGM        10
s18  c*    TUST          ifeq      ' '
N18  c     WSCAN         ifeq      'A'
N16  c                   move      'A'           TUST
N18  C                   else
N18  c                   move      ' '           TUST                           Open
N18  c                   move      'ESOVERS4C2'  BYTTOTPGM        10
N18  C                   endif
N16  C     TUPRO         SETLL     HEAD14
N16  C     TUPRO         READE     HEAD14                                 33
N16  C                   DOW       *IN33 = *OFF
s18  C*                  call      'ESOVERS4C'                                  Bytt OTYPE
N18  C                   call      BYTTOTPGM                                    Bytt OTYPE
N16  C                   parm                    HEAVD
N16  C                   parm                    HEOPD
N16  C                   parm                    BIFIRM
N16  C                   parm                    BIBRID
N16  C     TUPRO         READE     HEAD14                                 33
N16  c                   enddo
s17  c*                  endif
N16  c                   update    TURERR
N16  c                   endif
N16  C                   endsr
      *
      *=====================================================================******
      *  SREND
      *=====================================================================******
     C     SREND         begsr
      *
     C                   callp     gethtml('HTMLSRC':
     C                             '*LIBL':
     C                             'ETUR02IC':'/CGITAG/')
     C                   callp     updHTMLvar('USER':USER)
     C                   callp     updHTMLvar('FRAMES':WSFRAMES)
     C                   callp     wrtsection('top')
     C                   exsr      Exit
     C                   eval      *inlr = *on
     C                   return
      *
     C                   endsr
      *
      *=====================================================================******
      * Send MEDLING TIL BRUKER
      *=====================================================================******
     C     SNDEMAIL      begsr
      *
     C                   Z-ADD     1024          CMDL             15 5
     C                   EVAL      SENDER = '*CURRENT'
     C*                  MOVE      TRTNO         XTRTNO            9
     C*                  MOVE      TRTNO         HEOPD
     C*                  MOVEL     TRTNO         HEAVD
      * Emne
     C                   Eval      EMNE = 'New trip is created '
     C*                                   + %trim(XTRTNO)
      *
     C                   EVAL      MELD = 'New trip is created by '
     C                             + %trim(BIBRID) + '/' + %trim(BIBESK)
     C*                            + ':/NAWB No. ' + %trim(WSGN)
     C                             + ':/P:/PThis message is created '
     C                             + 'automaticly by the booking system.'
     C                             + ':/NPlease do not reply!'
      *
      * param for tointnet og longmsg må være i apostrofer ( hex 7D )
      * (strenger i single-parametere som inneholder blank el. spesialtegn)
     C                   eval      cmd = 'SNDDST TYPE(*LMSG) TOINTNET('
     C                             +'('+ X'7D' + %trim(XEPMOTT) + X'7D' +')) +
     C                             DSTD('+ X'7D' + %trim(EMNE) + X'7D' + ') +
     C                             LONGMSG('+ X'7D' + %trim(MELD) + X'7D' +') +
     C                             USRID('+  %trim(SENDER) +') SNDFMT(*NOCHG)'
     C                   CALL      'QCMDEXC'                            33
     C                   PARM                    CMD
     C                   PARM                    CMDL
      *
     C                   ENDSR
      *
N03   *=====================================================================******
N03   *  Display TRAFIKK
N03   *=====================================================================******
N03  C     DspTROB       begsr
N03   * TRAFIKK
N03  C                   callp     wrtsection('Trafictop')
N03   *
N03  C                   IF        WSTR = *BLANKS
N03  C                   callp     updhtmlvar('CTKD':'')
N03  C                   callp     updhtmlvar('CTFT':' -- blank -- ')
N03  C                   callp     wrtsection('Traficrow')
N03  C                   END
N03   *
N03  C     BIFIRM        SETLL     CDTRAFL2
N03  C     BIFIRM        READE     CDTRAFL2                               33
N03  C                   DOW       *IN33 = *OFF
N03  C                   callp     updhtmlvar('CTKD':CTKD)
N03  C                   callp     updhtmlvar('CTFT':CTFT)
N03  C                   IF        CTKD = WSTR
N03  C                   callp     updhtmlvar('SLTRSEL':'SELECTED')
N03  C                   else
N03  C                   callp     updhtmlvar('SLTRSEL':'')
N03  C                   END
N03  C                   callp     wrtsection('Traficrow')
N03  C     BIFIRM        READE     CDTRAFL2                               33
N03  C                   ENDDO
N03   *
N03   * legg på mulighet til å velge (tilbake til) kun blank når kode er valgt..
N03  C                   IF        WSTR <> *BLANKS
N03  C                   callp     updhtmlvar('SLTRSEL':'')
N03  C                   callp     updhtmlvar('CTKD':'  ')
N03  C                   callp     updhtmlvar('CTFT':' -- blank -- ')
N03  C                   callp     wrtsection('Traficrow')
N03  C                   END
N03  C                   callp     wrtsection('TraficBot')
N03   *
N03  C                   endsr
N03   *
      *=====================================================================
      *  HENT DOKUMENTER
      *=====================================================================
     C     HENTDOK       BEGSR
     C                   MOVE      *BLANKS       UPDF
     C     WBTUR         CABEQ     0             SLHENTDOK
     C                   MOVEL     'T:'          ARUNDE
     C                   MOVE      WBTUR         ARUNDE
      *
     C     ARKIVL11K     SETLL     ARKIVL11
     C     ARKIVL11K     READE     ARKIVL11                               33
     C                   MOVE      *ZEROS        XN                3 0
     C                   DOW       *IN33 = *OFF
     C                   ADD       1             XN
     C                   EVAL      UPDF(XN) = '<a href="'
     C                   CAT       XBANE:0       UPDF(XN)
     C                   CAT       ARLINK:0      UPDF(XN)
     C                   CAT       '" target="':0UPDF(XN)
     C                   CAT       'SyPDFWind': 0UPDF(XN)
     C                   CAT       '">':0        UPDF(XN)
     C                   IF        ARRFK = *BLANKS
     C                   CAT       'DOC':0       UPDF(XN)
     C                   MOVE      XN            XAN               3
     C                   CAT       XAN:0         UPDF(XN)
     C                   ELSE
     C                   CAT       ARRFK:0       UPDF(XN)
     C                   END
     C                   CAT       '<img src="':0UPDF(XN)
     C                   CAT       '/syspeddev':0UPDF(XN)
     C                   CAT       '/PDF.gif"':0 UPDF(XN)
     C                   CAT       'ALT="':1     UPDF(XN)
     C                   CAT       'DOC':0       UPDF(XN)
     C                   CAT       XAN:0         UPDF(XN)
     C                   CAT       '"></a>':0    UPDF(XN)
      *
S01  C*                  IF        ((XBIAKT = 'L') OR (XAGENT = 'J'))
N01  C                   IF        ((XAUT = 'L') OR (XAGENT = 'J'))
     C                   EVAL      UPDF(XN) = %trim(UPDF(XN))
     C                             + ' <a href="#" OnClick="DltDoc('
     C                             + 'this.form,'
     C                             + %trim(Appo)
     C                             + %trim(XBANE) + %trim(ARLINK)
     C                             + %trim(Appo) + ',' + %trim(Appo)
     C                             + %trim(ARRFK)
     C                             + %trim(Appo)
     C                             + ')"> <img src="/syspeddev/DeleteX.gif"'
     C                             + ' width=13 height=13 border=0>'
     C                   END
      *
     C     XN            COMP      40                                 33  33
     C  N33ARKIVL11K     READE     ARKIVL11                               33
     C                   ENDDO
      *
     C                   MOVE      *BLANKS       ARUNDE
     C                   MOVEL     WBTUR         ARUNDE
     C                   MOVEL     WBTUR         XAN081            8
     C                   MOVE      *BLANKS       XLINKGM          40
      *
     C     ARKIVL11K     SETLL     ARKIVL11
     C     ARSTAT        READE     ARKIVL11                               33
     C  N33              MOVEL     ARUNDE        XAN082            8
     C  N33XAN081        COMP      XAN082                             3333
     C                   DOW       *IN33 = *OFF
     C                   IF        ARLINK <> XLINKGM
     C                   ADD       1             XN
     C                   EVAL      UPDF(XN) = '<a href="'
     C                   CAT       XBANE:0       UPDF(XN)
     C                   CAT       ARLINK:0      UPDF(XN)
N11  C     '.pdf'        SCAN      UPDF(XN)                               34
N11  C  N34'.PDF'        SCAN      UPDF(XN)                               34
     C  N34              CAT       '.pdf':0      UPDF(XN)
     C                   CAT       '" target="':0UPDF(XN)
     C                   CAT       'SyPDFWind': 0UPDF(XN)
     C                   CAT       '">':0        UPDF(XN)
     C                   IF        ARRFK = *BLANKS
     C                   CAT       'DOC':0       UPDF(XN)
     C                   MOVE      XN            XAN               3
     C                   CAT       XAN:0         UPDF(XN)
     C                   ELSE
     C                   CAT       ARRFK:0       UPDF(XN)
     C                   END
     C                   CAT       '<img src="':0UPDF(XN)
     C                   CAT       '/syspeddev':0UPDF(XN)
     C                   CAT       '/PDF.gif"':0 UPDF(XN)
     C                   CAT       'ALT="':1     UPDF(XN)
     C                   CAT       'DOC':0       UPDF(XN)
     C                   CAT       XAN:0         UPDF(XN)
     C                   CAT       '"></a>':0    UPDF(XN)
      *
S01  C*                  IF        ((XBIAKT = 'L') OR (XAGENT = 'J'))
N01  C                   IF        ((XAUT = 'L') OR (XAGENT = 'J'))
     C                   EVAL      UPDF(XN) = %trim(UPDF(XN))
     C                             + ' <a href="#" OnClick="DltDoc('
     C                             + 'this.form,'
     C                             + %trim(Appo)
     C                             + %trim(XBANE) + %trim(ARLINK)
     C                             + %trim(Appo) + ',' + %trim(Appo)
     C                             + %trim(ARRFK)
     C                             + %trim(Appo)
     C                             + ')"> <img src="/syspeddev/DeleteX.gif"'
     C                             + ' width=13 height=13 border=0>'
     C                   END
     C                   EVAL      XLINKGM = ARLINK
      *
     C     XN            COMP      40                                 33  33
     C                   END
      *
     C  N33ARSTAT        READE     ARKIVL11                               33
     C  N33              MOVEL     ARUNDE        XAN082            8
     C  N33XAN081        COMP      XAN082                             3333
     C                   ENDDO
      *
     C     SLHENTDOK     TAG
     C                   callp     updHTMLvar('UPDF1':UPDF1)
     C                   callp     updHTMLvar('UPDF2':UPDF2)
     C                   callp     updHTMLvar('UPDF3':UPDF3)
     C                   callp     updHTMLvar('UPDF4':UPDF4)
     C                   callp     updHTMLvar('UPDF5':UPDF5)
     C                   callp     updHTMLvar('UPDF6':UPDF6)
     C                   callp     updHTMLvar('UPDF7':UPDF7)
     C                   callp     updHTMLvar('UPDF8':UPDF8)
     C                   callp     updHTMLvar('UPDF9':UPDF9)
     C                   callp     updHTMLvar('UPDF10':UPDF10)
     C                   callp     updHTMLvar('UPDF11':UPDF11)
     C                   callp     updHTMLvar('UPDF12':UPDF12)
     C                   callp     updHTMLvar('UPDF13':UPDF13)
     C                   callp     updHTMLvar('UPDF14':UPDF14)
     C                   callp     updHTMLvar('UPDF15':UPDF15)
     C                   callp     updHTMLvar('UPDF16':UPDF16)
     C                   callp     updHTMLvar('UPDF17':UPDF17)
     C                   callp     updHTMLvar('UPDF18':UPDF18)
     C                   callp     updHTMLvar('UPDF19':UPDF19)
     C                   callp     updHTMLvar('UPDF20':UPDF20)
     C                   callp     updHTMLvar('UPDF21':UPDF21)
     C                   callp     updHTMLvar('UPDF22':UPDF22)
     C                   callp     updHTMLvar('UPDF23':UPDF23)
     C                   callp     updHTMLvar('UPDF24':UPDF24)
     C                   callp     updHTMLvar('UPDF25':UPDF25)
     C                   callp     updHTMLvar('UPDF26':UPDF26)
     C                   callp     updHTMLvar('UPDF27':UPDF27)
     C                   callp     updHTMLvar('UPDF28':UPDF28)
     C                   callp     updHTMLvar('UPDF29':UPDF29)
     C                   callp     updHTMLvar('UPDF30':UPDF30)
     C                   callp     updHTMLvar('UPDF31':UPDF31)
     C                   callp     updHTMLvar('UPDF32':UPDF32)
     C                   callp     updHTMLvar('UPDF33':UPDF33)
     C                   callp     updHTMLvar('UPDF34':UPDF34)
     C                   callp     updHTMLvar('UPDF35':UPDF35)
     C                   callp     updHTMLvar('UPDF36':UPDF36)
     C                   callp     updHTMLvar('UPDF37':UPDF37)
     C                   callp     updHTMLvar('UPDF38':UPDF38)
     C                   callp     updHTMLvar('UPDF39':UPDF39)
     C                   callp     updHTMLvar('UPDF40':UPDF40)
      *
     C                   ENDSR
      *
      *////////////////////////////////////////////////////////////
     C     OPDLOG        BEGSR
      *////////////////////////////////////////////////////////////
      * ETA
     C                   IF        WBETA <> TXETAD
     C                   MOVE      TXAVD         TTAVD
     C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
s04  C*                  MOVE      'ETA'         TTACTI
N04  C                   MOVE      'CHD'         TTACTI
N05  C                   MOVE      WSEDRE        TTEDRE
     C                   MOVE      USER          TTUSER
     C                   EVAL      TTDEPO = 'ETUR02'
     C                   MOVE      TXETAD        XAN08             8
     C                   EVAL      TTTEXT = 'ETA changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(WSETA) + ' by '
     C                             + %TRIM(USER)
n11  C                   EVAL      TTTEXL = 'ETA endret fra '
n11  C                             + %TRIM(XAN08) + ' til '
n11  C                             + %TRIM(WSETA) + ' av '
n11  C                             + %TRIM(USER)
     C                   WRITE     TRACKFR
     C                   END
      * ETD
     C                   IF        WBETD <> TXETDD
     C                   MOVE      TXAVD         TTAVD
     C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
s04  C*                  MOVE      'ETD'         TTACTI
n04  C                   MOVE      'CHD'         TTACTI
N05  C                   MOVE      WSEDRE        TTEDRE
     C                   MOVE      USER          TTUSER
     C                   EVAL      TTDEPO = 'ETUR02'
     C                   MOVE      TXETDD        XAN08
     C                   EVAL      TTTEXT = 'ETD changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(WSETD) + ' by '
     C                             + %TRIM(USER)
n11  C                   EVAL      TTTEXL = 'ETD endret fra '
n11  C                             + %TRIM(XAN08) + ' til '
n11  C                             + %TRIM(WSETD) + ' av '
n11  C                             + %TRIM(USER)
     C                   WRITE     TRACKFR
     C                   END
      * ATA
     C                   IF        WBATA <> TXATAD
     C                   MOVE      TXAVD         TTAVD
     C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
s04  C*                  MOVE      'ATA'         TTACTI
n04  C                   MOVE      'CHD'         TTACTI
N05  C                   MOVE      WSEDRE        TTEDRE
     C                   MOVE      USER          TTUSER
     C                   EVAL      TTDEPO = 'ETUR02'
     C                   MOVE      TXATAD        XAN08             8
     C                   EVAL      TTTEXT = 'ATA changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(WSATA) + ' by '
     C                             + %TRIM(USER)
n11  C                   EVAL      TTTEXL = 'ATA endret fra'
n11  C                             + %TRIM(XAN08) + ' til '
n11  C                             + %TRIM(WSATA) + ' av '
n11  C                             + %TRIM(USER)
     C                   WRITE     TRACKFR
     C                   END
      * ETD
     C                   IF        WBATD <> TXATDD
     C                   MOVE      TXAVD         TTAVD
     C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
s04  C*                  MOVE      'ATD'         TTACTI
n04  C                   MOVE      'CHD'         TTACTI
N05  C                   MOVE      WSEDRE        TTEDRE
     C                   MOVE      USER          TTUSER
     C                   EVAL      TTDEPO = 'ETUR02'
     C                   MOVE      TXATDD        XAN08
     C                   EVAL      TTTEXT = 'ATD changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(WSATD) + ' by '
     C                             + %TRIM(USER)
n11  C                   EVAL      TTTEXL = 'ATD endret fra '
n11  C                             + %TRIM(XAN08) + ' til '
n11  C                             + %TRIM(WSATD) + ' av '
n11  C                             + %TRIM(USER)
     C                   WRITE     TRACKFR
     C                   END
N05   * INGEN DATO ENDRING
N05  C                   IF        ((((WBETA = TXETAD) AND
N05  C                                (WBETD = TXETDD)) AND
N05  C                                (WBATA = TXATAD)) AND
N05  C                                (WBATD = TXATDD))
N05  C                   IF        WSEDRE <> *BLANKS
N05  C                   MOVE      TXAVD         TTAVD
N05  C                   MOVE      TXOPD         TTOPD
N05  C                   MOVE      WDT           TTDATE
N05  C                   MOVE      WTM           TTTIME
N05  C                   MOVE      WDT           TTDATL
N05  C                   MOVE      WTM           TTTIML
N05  C                   MOVE      'CHD'         TTACTI
N05  C                   MOVE      USER          TTUSER
N05  C                   EVAL      TTDEPO = 'ETUR02'
N05  C                   MOVE      WSEDRE        TTEDRE
N05  C                   EVAL      TTTEXT = 'New information from '
N05  C                             + %TRIM(USER)
N11  C                   EVAL      TTTEXL = 'Ny informasjon fra '
N11  C                             + %TRIM(USER)
N05  C                   WRITE     TRACKFR
N05  C                   END
N05  C                   END
      *
     C                   ENDSR
      *
N02   ***********************************************
N02  C     SRHENTSD      BEGSR
N02   ***********************************************
N02  C                   MOVE      *ZEROS        MINDT
N02  C                   MOVEL     '99999999'    MINDT
N02  C                   MOVE      *ZEROS        MAXDT
N02  C     WBTUR         SETLL     HEAD14
N02  C     WBTUR         READE     HEAD14                                 33
N02  C                   DOW       *IN33 = *OFF
N02  C     DISPK         CHAIN     DISP                               33
N02  C  N33              IF        DIFRA < MINDT
N02  C                   MOVE      DIFRA         MINDT
N02  C                   MOVE      DISTEF        MINSTE
N02  C                   MOVEL     DISONF        MINLK
N02  C                   END
N02  C  N33DITIL         IFGT      MAXDT
N02  C                   MOVE      DITIL         MAXDT
N02  C                   MOVE      DISTET        MAXSTE
N02  C                   MOVEL     DISONT        MAXLK
N02  C                   END
N02  C     WBTUR         READE     HEAD14                                 33
N02  C                   ENDDO
N02   *
N02  C                   SELECT
N02  C                   WHEN      ((WSHSD = 'F') AND (MINDAT <> 99999999))
N02  C                   MOVE      MINDAT        WSDT
N02  C                   MOVE      MINTIM        WSTM
N02  C                   MOVE      MINSTE        WSSTEF
N02  C                   MOVE      MINLK         WSLKFR
N02  C                   IF        WSLKFR = *BLANKS
N02  C     WSSTEF        CHAIN     STED2                              33
N02  C  N33              MOVEL     ST2LK         WSLKFR
N02  C                   ELSE
N02  C     ST2DFK        CHAIN     STED2D                             33
N02  C                   END
N02  C  N33              MOVEL     ST2NVN        WSSDF
N02  C   33              MOVE      *BLANKS       WSSDF
N02  C                   WHEN      ((WSHSD = 'T') AND (MAXDAT <> 0))
N02  C                   MOVE      MAXDAT        WSDTT
N02  C                   MOVE      MAXTIM        WSTMT
N02  C                   MOVE      MAXSTE        WSSTET
N02  C                   MOVE      MAXLK         WSLKTO
N02  C                   IF        WSLKTO = *BLANKS
N02  C     WSSTET        CHAIN     STED2                              33
N02  C  N33              MOVEL     ST2LK         WSLKTO
N02  C                   ELSE
N02  C     ST2DTK        CHAIN     STED2D                             33
N02  C                   END
N02  C  N33              MOVEL     ST2NVN        WSSDT
N02  C   33              MOVE      *BLANKS       WSSDT
N02  C                   ENDSL
N02   *
N02  C                   ENDSR
N05   *////////////////////////////////////////////////////////////
N05  C     VISREASON     BEGSR
N05   *////////////////////////////////////////////////////////////
N05   * REASON
N05  C                   callp     wrtsection('Reasontop')
N05   *
N05  C                   IF        WSEDRE = *BLANKS
N07  C                   callp     updhtmlvar('SLREASON':'')
N05  C                   callp     updhtmlvar('RKD':'')
N05  C                   callp     updhtmlvar('RFT':' -- blank -- ')
N05  C                   callp     wrtsection('Reasonrow')
N05  C                   END
N05   *
N05  C                   MOVE      *ZEROS        XN                3 0
N05  C                   MOVEL     'OSREA'       PAID
N05  C                   MOVE      BIBRID        PABRID
N05  C     BRPARFK       CHAIN     BRPARF                             33
N05  c   33              Eval      PABRID = '*KUNDFT*'+BIFIRM
N05  C   33BRPARFK       CHAIN     BRPARF                             33
N05  C                   DOW       *IN33 = *OFF
N05  C                   ADD       1             XN
N05  C                   MOVEL     PAVRDA        XAN03             3
N05  C                   callp     updhtmlvar('RKD':XAN03)
N05  C                   callp     updhtmlvar('RFT':PAVRDA)
N05  C                   IF        XAN03 = WSEDRE
N05  C                   callp     updhtmlvar('SLREASON':'SELECTED')
N05  C                   else
N05  C                   callp     updhtmlvar('SLREASON':'')
N05  C                   END
N05  C                   callp     wrtsection('Reasonrow')
N05  C     BRPARFK       READE     BRPARF                                 33
N05  C                   ENDDO
N05   *
N05   * legg på mulighet til å velge (tilbake til) kun blank når kode er valgt..
N05  C                   callp     wrtsection('ReasonBot')
N05   *
N05  C                   ENDSR
N05   *
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     USER          CHAIN     BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
OddEv * hent Parametre som går igjen i mange prog:
OddEv *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPRÅK            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
      *
S02  C*                  OPEN      TURER
N02  C                   OPEN      TURER14
N15  C                   OPEN      FREETUR1
     C                   OPEN      HEAD14
N06  C                   OPEN      HEADF
N02  C                   OPEN      DISP
     C                   OPEN      BILLOF
     C                   OPEN      BLV1
     C                   OPEN      TRACKT
     C                   OPEN      TRACKF
N03  C                   OPEN      CDTRAFL2
     C                   OPEN      CDCON4
     C                   OPEN      STED2
     C                   OPEN      TELL
N09  C                   OPEN      TELLRU
     C                   OPEN      BRPARF
     C                   OPEN      FIRMARC
     C                   OPEN      ARKTXT
     C                   OPEN      ARKEXT
     C                   OPEN      ARKIVL11
     C                   OPEN      FIRM
     C                   OPEN      BILK
     C                   OPEN      DRIV
     C                   OPEN      KODTLK
     C                   OPEN      KODTÅ
     C                   OPEN      STED2D
     C                   OPEN      UNITL01
     C                   OPEN      CUNDL01
     C                   OPEN      TRAN
     C                   OPEN      VALUL01
      *
S02  C*    TURERK        klist
S02  C*                  kfld                    TEAVD
S02  C*                  kfld                    WBTUR
N02  C     DISPK         klist
N02  C                   kfld                    HEAVD
N02  C                   kfld                    HEOPD
N06  C     HEADFK        klist
N06  C                   kfld                    HEAVD
N06  C                   kfld                    HEOPD
n15  C     TURKey        klist
n15  C                   kfld                    TUAVD
n15  C                   kfld                    TUPRO
     C     BILLOFK       klist
     C                   kfld                    HEAVD
     C                   kfld                    HEOPD
     C     TRACKTK       klist
     C                   kfld                    HEAVD
     C                   kfld                    HEOPD
     C     ARKIVL11K     klist
     C                   kfld                    ARSTAT
     C                   kfld                    ARUNDE
     C                   MOVE      'A'           ARSTAT
     C     ARKLAGK       KLIST
     C                   KFLD                    BIFIRM
     C                   KFLD                    ARKLAG
     C     KODTÅK        KLIST
     C                   KFLD                    KOÅUNI
     C                   KFLD                    WBRACC
     C                   KFLD                    WBRAAR
     C                   KFLD                    WBRMND
     C     KODTLKK       KLIST
     C                   KFLD                    KLKUNI
     C                   KFLD                    KLKLK
     C     ST2DFK        KLIST
     C                   KFLD                    WSLKFR
     C                   KFLD                    WSSTEF
     C     ST2DTK        KLIST
     C                   KFLD                    WSLKTO
     C                   KFLD                    WSSTET
     C     CUNDL01K      KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    KUNDNR
N03  C     CDTRAFL2K     KLIST
N03  C                   KFLD                    BIFIRM
N03  C                   KFLD                    WSTR
     C     VALKEY        KLIST
     C                   KFLD                    FIFIRM
     C                   KFLD                    WSTVAL
N05  C     BRPARFK       KLIST
N05  C                   kfld                    PABRID
N05  C                   kfld                    PAKUNR
N05  C                   kfld                    PAID
     C     BrParKey      klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR
      *
     C                   MOVE      'TURPL'       PAID
     C     BrParKey      chain     BRPARF                             33
S03  C* N33              MOVEL     PAVRDN        XTURTYPE          1
N03  C  N33              MOVEL     PAVRDA        XTURTYPE          1
     C   33              MOVE      'O'           XTURTYPE
     C                   MOVE      'EPOST'       PAID
     C     BrParKey      chain     BRPARF                             33
     C  N33              MOVEL     PAVRDA        XEPMOTT          50
     C                   IF        XTURTYPE = 'O'
     C                   MOVE      'OSAVD'       PAID
     C                   ELSE
     C                   MOVE      'LTAVD'       PAID
     C                   END
     C     BrParKey      CHAIN     BRPARF                             33
     C                   Z-ADD     PAVRDN        TEAVD
N22  C                   IF        WBSAVD <> 0
N22  c     WBSAVD        chain(N)  TELL                               33
N22  C  N33              MOVE      WBSAVD        TEAVD
N22  C                   END
     C                   MOVE      'SSAGT'       PAID
     C     BrParKey      chain     BRPARF                             33
     C  N33              MOVE      'J'           XAGENT            1
N01  C                   MOVE      'AUTOR'       PAID
N01  C     BrParKey      chain     BRPARF                             33
N01  C                   IF        *IN33
N01  C                   MOVE      'N'           XAUT              1
N01  C                   ELSE
N01  C                   MOVEL     PAVRDA        XAUT
N01  C                   END
     C     'ZO'          CHAIN     ARKTXT                             33
     C                   IF        ARKLAG = *BLANKS
     C     BIFIRM        READE     FIRMARC                                50
     C                   ELSE
     C     ARKLAGK       CHAIN     ARKEXT                             33
     C                   END
     C                   EVAL      XBANE = '/' + %TRIM(ARCANE) + '/'
S01  C*                  MOVE      BIAKT         XBIAKT            1
S15  C*                  BITON     '123457'      XAPSTR            1
S15  C*                  BITOFF    '06'          XAPSTR
     C                   MOVE      'Å'           KOÅUNI
     C                   MOVE      'LK '         KLKUNI            3
      * syge15c flyttet til parse
s12  C*                  MOVEL     WDT           XIÅR              4 0
     C     BIFIRM        CHAIN     FIRM                               33
      *
     C                   endsr
      *
N15
N15   *=====================================================================
N15   *  FINNE LINJE
N15   *=====================================================================
N15  C     KVTLIN        BEGSR
N15  C                   MOVE      *BLANKS       T70
N15  C                   MOVE      *BLANKS       TX
N15  C                   MOVE      *ZEROS        XN1               5 0
N15  C                   MOVE      *ZEROS        YN2               5 0
N15  C     XLINL         MULT      30            XN5               5 0
N15  C     1             DO        XN5           XN3               5 0
N15  C                   ADD       1             YN2
N15  C                   SELECT
N15  C                   WHEN      YN2 > XLINL
N15  C                   ADD       1             XN1
N15  C                   MOVEL     TXT70         TX(XN1)
N15  C     XN1           CABEQ     30            SLKVTLIN
N15  C                   MOVE      *BLANKS       T70
N15  C                   IF        KVT(XN3) = Cr
N15  C     XN3           ADD       1             XN4               5 0
N15  C                   IF        KVT(XN4) = Lf
N15  C                   EVAL      XN3 = XN4
N15  C                   Z-ADD     0             YN2
N15  C                   ELSE
N15  C                   Z-ADD     1             YN2
N15  C                   MOVE      KVT(XN3)      T70(YN2)
N15  C                   END
N15  C                   ELSE
N15  C                   Z-ADD     1             YN2
N15  C                   MOVE      KVT(XN3)      T70(YN2)
N15  C                   END
N15  C                   WHEN      KVT(XN3) = Cr
N15  C     XN3           ADD       1             XN4               5 0
N15  C                   IF        KVT(XN4) = Lf
N15  C                   ADD       1             XN1
N15  C                   MOVEL     TXT70         TX(XN1)
N15  C     XN1           CABEQ     30            SLKVTLIN
N15  C                   MOVE      *BLANKS       T70
N15  C                   MOVE      *ZEROS        YN2
N15  C                   EVAL      XN3 = XN4
N15  C                   ELSE
N15  C                   MOVE      KVT(XN3)      T70(YN2)
N15  C                   END
N15  C                   OTHER
N15  C                   MOVE      KVT(XN3)      T70(YN2)
N15  C                   ENDSL
N15  C                   ENDDO
N15   *
N15  C     SLKVTLIN      ENDSR
N15   *=====================================================================
N15   *  Skriv fritekst til fil
N15   *=====================================================================
N15  C     SKRIVFRT      begsr
N15  C     1             Do        30            NR                2 0
N15  c     TX(NR)        Ifne      *blanks
N15  c                   add       1             FRTLI
N15  c                   move      TX(NR)        FRTTXT
N15  c                   write     FREETURR
N15  c                   end
N15  c                   end
N15   *
N15  C                   endsr
N15   *
N15   *=====================================================================
N15   *  TEST ANTALL MELDINGSLINJER
N15   *=====================================================================
N15
N15  C     SRTESTL       begsr
N15   *
N14  C                   Z-ADD     0             XANTL             3 0
N15   *
N15  C                   EVAL      KVTXT = WSTTXT
N15  C                   EXSR      SRTESTL2
N15   *
N15  C                   ENDSR
N15   *
N15   *=====================================================================
N15   *  TEST ANTALL MELDINGSLINJER
N15   *=====================================================================
N15  C     SRTESTL2      begsr
N15   *
N15  C                   EVAL      TXT70 = *BLANKS
N15  C                   Z-ADD     0             YN2
N15  C     1             DO        2100          YN                5 0
N15  C                   ADD       1             YN2
N15  C                   SELECT
N15  C                   WHEN      YN2 = 70
N15  C                   IF        KVT(YN) = Cr
N15  C                   EVAL      XN3 = YN + 1
N15  C                   IF        KVT(XN3) = Lf
N15  C                   EVAL      YN = XN3
N15  C                   ELSE
N15  C                   MOVE      KVT(YN)       T70(YN2)
N15  C                   END
N15  C                   ELSE
N15  C                   MOVE      KVT(YN)       T70(YN2)
N15  C                   END
N15  C                   IF        TXT70 <> *BLANKS
N15  C                   ADD       1             XANTL
N15  C                   END
N15  C                   Z-ADD     0             YN2
N15  C                   EVAL      TXT70 = *BLANKS
N15  C                   WHEN      KVT(YN) = Cr
N15  C                   EVAL      XN3 = YN + 1
N15  C                   IF        KVT(XN3) = Lf
N15  C                   EVAL      YN = XN3
N15  C                   IF        TXT70 <> *BLANKS
N15  C                   ADD       1             XANTL
N15  C                   END
N15  C                   Z-ADD     0             YN2
N15  C                   EVAL      TXT70 = *BLANKS
N15  C                   ELSE
N15  C                   MOVE      KVT(YN)       T70(YN2)
N15  C                   END
N15  C                   OTHER
N15  C                   MOVE      KVT(YN)       T70(YN2)
N15  C                   ENDSL
N15  C                   ENDDO
N15   *
N15  C                   ENDSR
N15   *
