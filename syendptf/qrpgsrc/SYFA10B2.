********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
11XXX * 01 JOV PTF11 Nye felt for Hentet hos avsender i header av bilde
11XXX * 02 JOV PTF11 Vis Term-tekst også på IN... og OU... egen terminal
      *                    avventer - bør utvide dokufm også med TERMK IN / OUT (lvlchk NO)
      *%%%%%%%%%%%%%%%%%%%
11XXX * 03 JOV PTF12 Vis skade/avvik
11XXX * 04 SH  PTF12 Endre logg
11XXX * 05 JOV PTF12 Liten feil i PTF 04
11XXX * 06 JOV PTF12 ev ukjent skadekode vis kode + IUKJENT
********************************************************************
S04  F*OKUFM1   IF   E           K DISK
N04  FDOKUFM1   UF   E           K DISK
     FDOKUFN    IF   E           K DISK
     FFIRM      IF   E           K DISK
     FBRPARF    IF   E           K DISK
     FSYFA10B2D CF   E             WORKSTN
     F                                     SFILE(SUBFIL:ZRECNO)
      * lookup-table for terminalkoder - max 100 a 5 tegn
     D                 DS
     D  TK                     1    500
     D                                     DIM(100)
      * lookup-table for terminaltekst - max 100 a 25 tegn
     D                 DS
     D  TT                     1   2500
     D                                     DIM(100)
N03   * lookup-table for avviks-koder - max 100 a 5 tegn
N03  D                 DS
N03  D  AK                     1    500
N03  D                                     DIM(100)
N03   * lookup-table for avviks-tekst - max 100 a 25 tegn
N03  D                 DS
N03  D  AT                     1   2500
N03  D                                     DIM(100)
N03  D                 DS
N03  D  FMLEDI                 1     10
N03  D   AVVK_IN               1      5
N03  D   AVVK_OU               6     10
N04  D                SDS
N04  D  ZUSER                254    263
     D                 DS
     D  PAVRDA                 1     50
     D  PAVRDA1_5              1      5
     D  PAVRDA7_46             7     46
      * DSer for datokonvertering
N01   * COL - Hentet hos kunde/avsender
N01  D                 DS
N01  D  FMCODT                 1      8  0
N01  D  FMCDTÅ                 1      4  0
N01  D  FMCDTM                 5      6  0
N01  D  FMCDTD                 7      8  0
N01  D                 DS
N01  D  FMCODT6                1      6  0
N01  D  FMCDTD6                1      2  0
N01  D  FMCDTM6                3      4  0
N01  D  FMCDTÅ6                5      6  0
N01  D                 DS
N01  D  FMCOTM                 1      6  0
N01  D  FMCOTM4                1      4  0
      * INN egen
     D                 DS
     D  FMITDT                 1      8  0
     D  FMIDTÅ                 1      4  0
     D  FMIDTM                 5      6  0
     D  FMIDTD                 7      8  0
     D                 DS
     D  FMITDT6                1      6  0
     D  FMIDTD6                1      2  0
     D  FMIDTM6                3      4  0
     D  FMIDTÅ6                5      6  0
S04  D*                DS
S04  D* FMITTM                 1      6  0
S04  D* FMITTM4                1      4  0
      * UT  egen
     D                 DS
     D  FMUTDT                 1      8  0
     D  FMUDTÅ                 1      4  0
     D  FMUDTM                 5      6  0
     D  FMUDTD                 7      8  0
     D                 DS
     D  FMUTDT6                1      6  0
     D  FMUDTD6                1      2  0
     D  FMUDTM6                3      4  0
     D  FMUDTÅ6                5      6  0
S04  D*                DS
S04  D* FMUTTM                 1      6  0
S04  D* FMUTTM4                1      4  0
      * POD
     D                 DS
     D  FMPODT                 1      8  0
     D  FMPDTÅ                 1      4  0
     D  FMPDTM                 5      6  0
     D  FMPDTD                 7      8  0
     D                 DS
     D  FMPODT6                1      6  0
     D  FMPDTD6                1      2  0
     D  FMPDTM6                3      4  0
     D  FMPDTÅ6                5      6  0
     D                 DS
     D  FMPOTM                 1      6  0
     D  FMPOTM4                1      4  0
      * Fremmed DATE
     D                 DS
     D  FNDATE                 1      8  0
     D  FNEDTÅ                 1      4  0
     D  FNEDTM                 5      6  0
     D  FNEDTD                 7      8  0
     D                 DS
     D  FNDATE6                1      6  0
     D  FNEDTD6                1      2  0
     D  FNEDTM6                3      4  0
     D  FNEDTÅ6                5      6  0
     D                 DS
     D  FNTIME                 1      6  0
     D  FNTIME4                1      4  0
      * Fremmed DATL - DATE LOGGED
     D                 DS
     D  FNDATL                 1      8  0
     D  FNLDTÅ                 1      4  0
     D  FNLDTM                 5      6  0
     D  FNLDTD                 7      8  0
     D                 DS
     D  FNDATL6                1      6  0
     D  FNLDTD6                1      2  0
     D  FNLDTM6                3      4  0
     D  FNLDTÅ6                5      6  0
     D                 DS
     D  FNTIML                 1      6  0
     D  FNTIML4                1      4  0
n04  D                 DS
N04  D  WSDTD1                 1      2  0
N04  D  WSDTM1                 3      4  0
N04  D  WSDTÅ1                 5      6  0
N04  D  WSSDFD                 1      6  0
N04   *____
      * Inz
      *""""
     c
     C                   exsr      INIT
      *______________
      * Clear Subfile
      *""""""""""""""
     C     START1        TAG
      * Info om inn/ut /Pod skal i header
s04  C*    FMMRK1        chain     DOKUFM1                            33
n04  C     FMMRK1        chain(N)  DOKUFM1                            33
     C                   exsr      fixdat1
N03  C                   Z-ADD     1             XN
N03  C     AVVK_IN       LOOKUP    AK(XN)                                 75
N03  C   75              eval      AvvInn  = AT(XN)
N03  C                   Z-ADD     1             XN
N03  C     AVVK_OU       LOOKUP    AK(XN)                                 75
N03  C   75              eval      AvvOut  = AT(XN)

     C                   MOVE      '1'           *IN93
     C                   WRITE     SUBCTL
     C                   MOVEA     '00'          *IN(93)
     C                   Z-ADD     *ZEROS        ZRECNO
      *_____________
      * Fyll Subfile (andre hendelser/fremmede terminaler  fra DOKUFN)
      *"""""""""""""
     C     FNCLID        SETLL     DOKUFN
     C     FNCLID        READE     DOKUFN                                 94

     C     *IN94         DOWEQ     '0'
     C                   exsr      fixdat2
     C                   eval      TermTxt = *blanks
     C                   Z-ADD     1             XN
     C     FNTERM        LOOKUP    TK(XN)                                 75
     C   75              eval      TermTxt = TT(XN)
N03  C                   Z-ADD     1             XN
N03  C     FNAVKO        LOOKUP    AK(XN)                                 75
N03  C   75              eval      TermAvv = AT(XN)
N06  C                   if        TermAvv = *blanks and FNAVKO <> *blanks
N06  C                   eval      TermAvv = FNAVKO + ' *Unknown code'
N06  c                   endif
     C                   ADD       1             ZRECNO
     C                   WRITE     SUBFIL
     C     FNCLID        READE     DOKUFN                                 94
     C  N94              ENDDO
     C                   IF        ZRECNO>0
     C                   EVAL      ZRECNO=1
     C                   ENDIF
      *________________
      * Display Subfile
      *""""""""""""""""
     C     START2        TAG

     C                   MOVE      *OFF          *IN51
     C                   MOVEA     '11'          *IN(91)
     C* KOMMER HIT VED TOM FIL
     C     ZRECNO        IFEQ      0
     C                   MOVE      *OFF          *IN94
     C                   ADD       1             ZRECNO
     C                   MOVE      *ON           *IN51
     C                   WRITE     SUBFIL
     C                   SETON                                        94
     C                   ENDIF
     C                   WRITE     WIND01
     C                   WRITE     BUNN
     C     STBUNN        TAG
     C                   EXFMT     SUBCTL
N04  c     *in55         ifeq      '0'
N04  C                   EXSR      TESTD
n04  C   30              GOTO      STBUNN
N04  c                   exsr      oppdater
n04  C                   GOTO      START1
N04  c                   end

      * FORRIGE
     C   12              GOTO      SLUTT
      * F5 - Refresg
     C   05              GOTO      START1
      * ANNET
     C                   GOTO      START2

     C     SLUTT         TAG
     C                   SETON                                        LR


      **************************************************************************
     c     FIXDAT1       BEGSR
      **************************************************************************
N01   * COL Hentet avsender
N01  C                   MOVE      FMCDTÅ        FMCDTÅ6
N01  C                   MOVE      FMCDTM        FMCDTM6
N01  C                   MOVE      FMCDTD        FMCDTD6
      * Inn egen
     C                   MOVE      FMIDTÅ        FMIDTÅ6
     C                   MOVE      FMIDTM        FMIDTM6
     C                   MOVE      FMIDTD        FMIDTD6
n04  C                   MOVEL     FMITTM        FMITTM4
N04  C  N55fmidtd        comp      0                                  5656
      * Ut  egen
     C                   MOVE      FMUDTÅ        FMUDTÅ6
     C                   MOVE      FMUDTM        FMUDTM6
     C                   MOVE      FMUDTD        FMUDTD6
s04  C**                 MOVEL     FMITTM        FMITTM4
n05  C                   MOVEL     FMUTTM        FMUTTM4
      * POD
     C                   MOVE      FMPDTÅ        FMPDTÅ6
     C                   MOVE      FMPDTM        FMPDTM6
     C                   MOVE      FMPDTD        FMPDTD6
N04  C  N55fmudtd        comp      0                                  5757
n04  C     *IN56         IFEQ      '1'
n04  C     *IN57         ANDEQ     '1'
N04  C                   SETON                                        55
n04  C                   END
     c                   endsr
      **************************************************************************
     c     FIXDAT2       BEGSR
      **************************************************************************
      * DATE - EVENT DATE
     C                   MOVE      FNEDTÅ        FNEDTÅ6
     C                   MOVE      FNEDTM        FNEDTM6
     C                   MOVE      FNEDTD        FNEDTD6
      * DATL - DATE LOGGED
     C                   MOVE      FNLDTÅ        FNLDTÅ6
     C                   MOVE      FNLDTM        FNLDTM6
     C                   MOVE      FNLDTD        FNLDTD6
     c                   endsr
      **************************************************************************
     c     INIT          BEGSR
      **************************************************************************
     C     *ENTRY        PLIST
     C                   PARM                    UUCLID           18
N04  C                   PARM                    UMODE             1
N04  c     umode         comp      'E'                                5555
N04  c     *in55         ifeq      '1'
N04  c                   seton                                        5657
N04  c                   end
     c                   movel     UUCLID        FNCLID
     c                   movel     UUCLID        FMMRK1
     c     *loval        setll     firm
     c                   read      firm
      * Clear numeriske DS-er
N01  c                   clear                   FMCODT
N01  c                   clear                   FMCODT6
N01  c                   clear                   FMCOTM
N01   *
     c                   clear                   FMITDT
     c                   clear                   FMITDT6
     c                   clear                   FMITTM
      *
     c                   clear                   FMUTDT
     c                   clear                   FMUTDT6
     c                   clear                   FMUTTM
      *
     c                   clear                   FMPODT
     c                   clear                   FMPODT6
     c                   clear                   FMPOTM
      *
     c                   clear                   FNDATE
     c                   clear                   FNDATE6
     c                   clear                   FNTIME
      *
     c                   clear                   FNDATL
     c                   clear                   FNDATL6
     c                   clear                   FNTIML
      *
      * Legg terminalkoder / tekster i lookuptable
     C     BrParKey      KLIST
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C                   MOVE      *zeros        PAKUNR
     C                   MOVEL     'TERMK'       PAID
     C                   MOVE      '*KUNDFT*  '  PABRID
     C                   MOVE      FIFIRM        PABRID
     C                   move      *zeros        XN                3 0
     c     BrParKey      setll     BRPARF
     c     BrParKey      reade     BRPARF                                 33
     c     *in33         doweq     '0'
     C                   add       1             XN
     c                   eval      TK(XN) = Pavrda1_5
     c                   eval      TT(XN) = Pavrda7_46
     c     XN            ifeq      100
     C                   leave
     c                   end
     c     BrParKey      reade     BRPARF                                 33
     c                   enddo
     c*
N03  c* Avvikskoder / tekster
N03  C                   MOVEL     'TKTKA'       PAID
N03  C                   move      *zeros        XN                3 0
N03  c     BrParKey      setll     BRPARF
N03  c     BrParKey      reade     BRPARF                                 33
N03  c     *in33         doweq     '0'
N03  C                   add       1             XN
N03  c                   eval      AK(XN) = Pavrda1_5
N03  c                   eval      AT(XN) = Pavrda7_46
N03  c     XN            ifeq      100
N03  C                   leave
N03  c                   end
N03  c     BrParKey      reade     BRPARF                                 33
N03  c                   enddo
N03  c
     c                   endsr
n04   **************************************************************************
n04  c     OPPDATER      BEGSR
n04   **************************************************************************
n04  c     FMITTM4       mult      100           fmittmn           6 0
n04  c     FMUTTM4       mult      100           fmuttmn           6 0
n04  C     FMMRK1        chain     DOKUFM1                            33
n04  c     *in33         ifeq      '0'
n04   * inn terminal
n04  c     *in56         ifeq      '0'
     C     FMITDT6       ANDNE     0
n04  C                   z-add     20000000      FMITDT
n04  C                   MOVE      FMIDTÅ6       FMIDTÅ
n04  C                   MOVE      FMIDTM6       FMIDTM
n04  C                   MOVE      FMIDTD6       FMIDTD
n04  c                   z-add     fmittmn       fmittm
N04  c                   move      'X'           fmiter
N04  c                   move      zuser         fmitus
n04  c                   end
n04  c     *in57         ifeq      '0'
     C     FMUTDT6       ANDNE     0
n04  C                   z-add     20000000      fmutdt
n04  C                   MOVE      FMUDTÅ6       FMUDTÅ
n04  C                   MOVE      FMUDTM6       FMUDTM
n04  C                   MOVE      FMUDTD6       FMUDTD
n04  c                   z-add     fmUttmn       fmUttm
N04  c                   move      'X'           fmuter
N04  c                   move      zuser         fmutus
n04  c                   end
N04  C                   UPDATE    DOKUFMR
n04  c                   end
n04  c                   endsr
N04   ************************************************************
n04  C     TESTD         BEGSR
N04   ************************************************************
n04   * INN DATO
n04  C                   SETOFF                                       585930
n04  C                   SETOFF                                       6061
N04  C     fmitdt6       IFNE      0
n04  C                   MOVE      FMITDT6       WSSDFD
N04  C                   MOVE      WSDTD1        UDT1              2 0
N04  C                   MOVE      WSDTM1        UDT2              2 0
N04  C                   MOVE      WSDTÅ1        UDT3              2 0
N04  C                   CALL      'TESTDATO'
n04  C                   PARM                    UDT1
N04  C                   PARM                    UDT2
n04  C                   PARM                    UDT3
n04  C                   PARM                    UFLAGG            1 0
N04  C     UFLAGG        COMP      1                                      58
n04  C   58              SETON                                        30
     C     FMITTM4       IFLT      1
     C     FMITTM4       ORGT      2400
     C                   SETON                                        6030
     C                   END
N04  C                   END
n04   * UT  DATO
N04  C     fmUtdt6       IFNE      0
n04  C                   MOVE      FMUTDT6       WSSDFD
N04  C                   MOVE      WSDTD1        UDT1              2 0
N04  C                   MOVE      WSDTM1        UDT2              2 0
N04  C                   MOVE      WSDTÅ1        UDT3              2 0
N04  C                   CALL      'TESTDATO'
n04  C                   PARM                    UDT1
N04  C                   PARM                    UDT2
n04  C                   PARM                    UDT3
n04  C                   PARM                    UFLAGG            1 0
N04  C     UFLAGG        COMP      1                                      59
n04  C   59              SETON                                        30
     C     FMUTTM4       IFLT      1
     C     FMUTTM4       ORGT      2400
     C                   SETON                                        6130
N04  C                   END
N04  C                   END
N04  C                   ENDSR
