      *********************************************************************
      *
CRTPG+*  CRTPGM SYSPED/ETUR05 MODULE(*LIBL/ETUR05 *LIBL/INCGI)
CRTPGM*         ACTGRP(CGI) AUT(*USE)
      *
      *********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
 0XXX * 01 JOV PTF10 MYE OMSKREVET-INGEN 'SERVERSORT',KUN JQUERY -TIDLIGERE MERKING FJERNET
10184 * 02 jov PTF10 Ikke error ved M3 over 999,99
      * 03 jov PTF10 bedre filter
10XXX * 04 YBC PTF10 OPPDATER BL-NR MED AA+DATO NÅR OPPDRAG ER FJERENT FRA TUR
10XXX * 05 YBC PTF10 BEVARE BL-NR VED PLUKKING, SETT TILBAKE VED REMOVING
      *              BENYTT FELTET "BLAD4G" FOR Å LAGRE BLBLNR VED PLUKKING
      * 06 JOV PTF10 VED LAND BLE DATO NULLET VED TURPLUKK- NÅ:LAND=UAVHENGIG AV TURS ETD/ETA...
10232 * 07 YBC PTF10 TEST FRA/TIL LANDKODE og TIL STED
10261 * 08 YBC PTF10 VEKT/KUBIKK/KOLLI I TURER ER ENDRET TIL 9.0, 7.3 OG 7.0
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 09 JOV PTF11 WSSAVD KAN STYRERS (DEFAULT=FØLGER TURAVD) ALL=ALLE/IN=INNG/OUT=UTGÅENDE
      * 10 JOV PTF11 multiPCK/RMV via checkBox innført /pos-rekkefølge UTEN agent(Head14->Head11)
      * %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      * 11 jov PTF12 Lagt til status-felt i liste (løsningn skal legges død MEN,,, NT slipper spes)
      * 12 jov PTF12 Landmodul - skipp HEST=S
********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
      *********************************************************************
     FBRIDF     IF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     FTURER14   UF   E           K DISK    USROPN
     FDISP      UF   E           K DISK    USROPN
     FDISPL04   IF   E           K DISK    USROPN
     F                                     RENAME(DISPR:DISPR04)
N09  FDISPL19   IF   E           K DISK    USROPN
N09  F                                     RENAME(DISPR:DISPR19)
N09  FKODTA     IF   E           K DISK    USROPN
     FHEADF     UF   E           K DISK    USROPN
     FHEAD11    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR11)
s10  F*EAD14    IF   E           K DISK    USROPN
s10  F*                                    RENAME(HEADFR:HEADFR14)
     FHEAD30    IF   E           K DISK    USROPN
     F                                     RENAME(HEADFR:HEADFR30)
     FBILLOF    UF   E           K DISK    USROPN
     FBLV1      UF A E           K DISK    USROPN
     FTRACKT    UF   E           K DISK    USROPN
     FTRACKF    O  A E             DISK    USROPN
N11  FTRACKL02  IF   E           K DISK    USROPN
N11  F                                     RENAME(TRACKFR:TRACKF2R)
     FCDCON4    IF   E           K DISK    USROPN
      *********************************************************************
      *--------------------------------------------------------------------
      * Variables common to all CGIs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      /copy syspeds/qrpgsrcpy,variables3
      *
      * Client input variables
     D user            s             10
     D UsrSpcName      s             10
     D WSTUR           s              8
     D WBTUR           s              8  0
     D WSAVD           s              4
     D WBAVD           s              4  0
     D WSOPD           s              7
     D WBOPD           s              7  0
     D WBETD           s              8  0
     D WBETA           s              8  0
     D WBATD           s              8  0
     D WBATA           s              8  0
     D WSSDF1          S              5
     D WSSDF2          S              5
     D WSSDF           S              8
     D WSSDT           S              8
     D TstSte          S              8
     D MaxSte          S              8
     D WSSAVD          S              4
     D WBSAVD          s              4  0
     D WSFRAMES        s              1
     D WSREMOVE        s              1
     D WSPICKUP        s              1
     D WSCAN           s              1
     D WSCHG           s              1
     D WSSTART         s              1
     D WSOPDPOS        s              1
     D XAVDA           s              4A
     D XAVDN           s              4  0
     D XOPDA           s              7A
     D XOPDN           s              7  0
     D XPOSA           s              3A
     D XPOSN           s              3  0
     D WSBLORR         s              1
     D UdispHea        s             70
     D OpdRef          s            500
     D Title           S            100
     D ItemCount       s             10i 0
     D i               s             10i 0
     D TS              s             16
     D WINT            s              6
     D WINTEG          s              6  0
     D WSMS01          s              1
     D WSMS02          s              1
     D WSMS03          s              1
     D WSMS04          s              1
N02  D TUTM3X          S              9  3
N11  D HENLEV          s             10
N11  D StatBg          s             10
      *
     D OddEven         s             10
      * For xlate mellom Upper Case og Lower Case
     D UC              C                   CONST('ABCDEFGHIJKLMNOPQRST-
     D                                     UVWXYZÆØÅ')
     D LC              C                   CONST('abcdefghijklmnopqrst-
     D                                     uvwxyzæøå')
      * Definere  hex appostrof
     D Ap              c                   x'7D'
      *

     D IfsMultIndicators...
     D                 ds
     D  NoErrors                       n
     D  NameTooLong                    n
     D  NotAccessible                  n
     D  NoFilesUsable                  n
     D  DupSections                    n
     D  FileIsEmpty                    n
     D                 DS
     D  ParmOS1                1   1024
     D  OSCHG                  1      1
     D  OSOT16                 2     49
     D  OT                     2     49    DIM(16)
     D  OSST08               150    197
     D  STD                  150    197    DIM(8)
     D  AV                   198    247    DIM(10)
N07  D  OSLKF16              248    295
N07  D  LKF                  248    295    DIM(16)
N07  D  OSLKT16              296    343
N07  D  LKT                  296    343    DIM(16)
N07  D  STDT                 344    391    DIM(8)
     D                 DS
     D  HEPOS1                 1      7
     D  POS                    1      7    DIM(7)
     D                 DS
     D  TUTARF                 1     15
     D  TUBLORR                1      1
     D  TUTR                   2      5
      *
      /copy syspeds/qrpgsrcpy,prolog3
      *
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input / cvt to numeric
     C                   exsr      Parse
      * File open / keys
     C                   EXSR      INIT
      *
     C                   SELECT
     C                   WHEN      WSOPDPOS = 'J'
     C                   EXSR      SROPDPOS
     C                   WHEN      WSCAN    = 'J'
     C                   WHEN      WSREMOVE = 'Y'
     C                   EXSR      SRREMOVE
     C                   WHEN      WSPICKUP = 'Y'
     C                   EXSR      SRPICKUP
     C                   ENDSL
      *
      * Read output skeleton html member into memory
     C                   exsr      LoadHtml
      * Set section variables
     C                   exsr      Settop
     C                   callp     wrtsection('StdtopTab')
     C                   callp     wrtsection('top')
     C                   IF        WBTUR <> 0
N10   * Utfør MLTpick/MltRemove - i fall checked - før turs innhold/udisponerte vises
N10  C                   exsr      MLTPCKRMV
      * HOVEDRUTINE
      * Vis ordre på trip.
     C                   callp     wrtsection('tablestr1')
E10  C     WBTUR         SETLL     HEAD11
E10  C     WBTUR         READE     HEAD11                                 35
     C                   DOW       *IN35 = *OFF
     C                   EXSR      SETROW
     C                   callp     wrtsection('tablerow1')
E10  C     WBTUR         READE     HEAD11                                 35
     C                   ENDDO
     C                   callp     updHTMLvar('TUTS':
     C                             %trim(%editc(TUTS:'Z')))
     C                   callp     updHTMLvar('TUTVKT':
     C                             %trim(%editc(TUTVKT:'3')))
     C                   callp     updHTMLvar('TUTM3':
     C                             %trim(%editc(TUTM3:'3')))
     C                   callp     updHTMLvar('TUTLM':
     C                             %trim(%editc(TUTLM:'3')))
     C                   callp     wrtsection('tableend')
     C                   END
      * Vis ordre på lager.
     c                   eval      UdispHea = 'Orders at warehouse:'
     C                   IF        (XTURTYPE <> 'O')
     c                   eval      UdispHea = 'Orders open for trip planning:'
     c                   endif
     C                   callp     updHTMLvar('UdispHea':UdispHea)
     C                   callp     wrtsection('tablestr2')
      *
     C                   IF        (XTURTYPE <> 'O')
     C                   callp     wrtsection('tablestr2A')
     C                   else
     C                   callp     wrtsection('tablestr2B')
     C                   END
     C                   callp     wrtsection('tablestr2C')
      *
      *
      *
      * Sjøbasert ..
     C                   IF        XTURTYPE = 'O'
      *
     C     1             DO        16            XN                3 0
     C                   MOVEL     OT(XN)        HEOT
     C                   IF        HEOT <> *BLANKS
      *
     C     HEOT          SETLL     HEAD30
     C     HEOT          READE     HEAD30                                 35
     C                   DOW       *IN35 = *OFF
     C                   EXSR      SRFILTER
     C                   IF        XVIS = 'J'
     C                   exsr      Setrow2
     C                   callp     wrtsection('tablerow2')
     C                   END
     C     HEOT          READE     HEAD30                                 35
     C                   ENDDO
      *
     c                   END
     C                   ENDDO
      * Landbasert..
     C                   ELSE
N09  C                   IF        WSSAVD='ALL' OR
N09  C                             WSSAVD='IN ' OR WSSAVD='OUT' OR
N09  C                             WSSAVD='IMP' OR WSSAVD='EXP' OR
N09  c                             WSSAVD='DOM'
N09  C     DISPL19K      SETLL     DISPL19
N09  C     DISPL19K      READE     DISPL19                                35
N09  C                   ELSE
     C     DISPL04K      SETLL     DISPL04
     C     DISPL04K      READE     DISPL04                                35
N09  C                   ENDIF
     C                   DOW       *IN35 = *OFF
     C                   EXSR      SRFILTER2
     C                   IF        XVIS = 'J'
     C                   exsr      Setrow2
     C                   callp     wrtsection('tablerow2')
     C                   END
N09  C                   IF        WSSAVD='ALL' OR
N09  C                             WSSAVD='IN ' OR WSSAVD='OUT' OR
N09  C                             WSSAVD='IMP' OR WSSAVD='EXP' OR
N09  c                             WSSAVD='DOM'
N09  C     DISPL19K      READE     DISPL19                                35
N09  C                   ELSE
     C     DISPL04K      READE     DISPL04                                35
N09  C                   ENDIF
     C                   ENDDO
     C                   END
      *
     C                   callp     wrtsection('tableend2')
      *
      * Quit
     C                   callp     wrtsection('bot')
     C                   callp     wrtsection('botStd')                         Body/htmlavsl
     C                   exsr      Exit
      *
     C                   eval      *inlr = *on
     C                   return
      *
      *
      *=====================================================================
      * Parse input / cvt to numeric
      *=====================================================================
     C     Parse         begsr
      * Parse variables from QUERY_STRING environment variable
     C                   eval      user     = zhbgetvar('user')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   eval      WSTUR    = zhbgetvar('WSTUR')
     C                   EVAL      WBTUR    = c2n2(WSTUR)
     C                   eval      WSAVD    = zhbgetvar('WSAVD')
     C                   EVAL      WBAVD    = c2n2(WSAVD)
     C                   eval      WSOPD    = zhbgetvar('WSOPD')
     C                   EVAL      WBOPD    = c2n2(WSOPD)
     C                   eval      WSFRAMES = zhbgetvar('FRAMES')
     C                   eval      WSREMOVE = zhbgetvar('WSREMOVE')
     C                   eval      WSPICKUP = zhbgetvar('WSPICKUP')
     C                   eval      WSCAN    = zhbgetvar('WSCAN')
     C                   eval      WSSTART  = zhbgetvar('WSSTART')
     C                   eval      WSOPDPOS = zhbgetvar('WSOPDPOS')
     C                   eval      TS       = zhbgetvar('TS')
     C                   eval      WSSDF1   = zhbgetvar('WSSDF1')
     C     LC:UC         XLATE     WSSDF1        WSSDF1
     C                   eval      WSSDF2   = zhbgetvar('WSSDF2')
     C     LC:UC         XLATE     WSSDF2        WSSDF2
     C                   eval      WSSDF    = zhbgetvar('WSSDF')
     C     LC:UC         XLATE     WSSDF         WSSDF
     C                   eval      WSSDT    = zhbgetvar('WSSDT')
     C     LC:UC         XLATE     WSSDT         WSSDT
     C                   eval      WSSAVD   = zhbgetvar('WSSAVD')
N09  C     LC:UC         XLATE     WSSAVD        WSSAVD                         I fall all,in,out..
     C                   EVAL      WBSAVD   = c2n2(WSSAVD)                      I fall numerisk
      *
     C                   endsr
      *
      *=====================================================================
      * Close output html and quit
      *=====================================================================
     C     Exit          begsr
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
      * Quit
     C                   CLOSE     BRIDF
     C                   CLOSE     BRPARF
     C                   CLOSE     TURER14
     C                   CLOSE     DISP
     C                   CLOSE     DISPL04
N09  C                   CLOSE     DISPL19
N09  C                   CLOSE     KODTA
     C                   CLOSE     HEADF
     C                   CLOSE     HEAD11
S10  C*                  CLOSE     HEAD14
     C                   CLOSE     HEAD30
     C                   CLOSE     BILLOF
     C                   CLOSE     BLV1
     C                   CLOSE     TRACKT
     C                   CLOSE     TRACKF
N11  C                   CLOSE     TRACKL02
     C                   CLOSE     CDCON4
      *
     C                   endsr
      *
      *=====================================================================
      * Read output skeleton html member into memory
      *=====================================================================
     C     LoadHtml      begsr
     C                   eval      IfsMultIndicators = gethtmlifsmult(
     C                             '/syspeddev/html/eSpedTop.html -
     C                             /syspeddev/html/ETUR05.html -
     C                             /syspeddev/html/eSpedBot.html':
     C                             '/CGITAG/')
     C                   endsr
      *=====================================================================******
      *  FILTRERE POSTER  - SJØ
      *=====================================================================******
     C     SRFILTER      begsr
     C                   MOVE      'N'           XVIS              1
      * hele SR bør skrives om..
      *   .. er startet som noen få IFsetninger som senere er blitt mer og mer uoversiktlige
      *   MYE ryddigere om en gjør test for test og dersom oppd. eksluderes hopp til slutten
      *
     C                   IF        ((HEST <> 'S') AND (HEPRO = 0))
      *
      * Kundenummer oppdragsgiver
     C     HEKNKF        IFNE      0
     C     HEKNKF        ANDEQ     BIKUNR
     C     HEKNK         ORNE      0
     C     HEKNK         ANDEQ     BIKUNR
     C     HEKNSF        ORNE      0
     C     HEKNSF        ANDEQ     BIKUNR
     C     HEKNS         ORNE      0
     C     HEKNS         ANDEQ     BIKUNR
     C     HEKNA         ORNE      0
     C     HEKNA         ANDEQ     BIKUNR
      *
     C                   IF        WBTUR <> 0
     C     TUSTEF        CABNE     HESDF         SLFILTER
     C     TUSTET        CABNE     HESDT         SLFILTER
     C                   END
      * TEST FRA-STED
     C                   IF        STD(1) <> *BLANKS
     C     1             DO        8             XN2               3 0
     C                   MOVEL     STD(XN2)      XFRASTED          5
     C     XFRASTED      CABEQ     *BLANKS       SLFILTER
     C     XFRASTED      CABEQ     HESDF         STFILTER
     C                   ENDDO
     C                   GOTO      SLFILTER
     C                   END
     C     STFILTER      TAG
N07   * TEST TIL-STED
N07  C                   IF        STDT(1) <> *BLANKS
N07  C     1             DO        8             XN2               3 0
N07  C                   MOVEL     STDT(XN2)     XTILSTED          5
N07  C     XTILSTED      CABEQ     *BLANKS       SLFILTER
N07  C     XTILSTED      CABEQ     HESDT         STFILTER11
N07  C                   ENDDO
N07  C                   GOTO      SLFILTER
N07  C                   END
N07  C     STFILTER11    TAG
N07   * TEST FRA-LANDKODE
N07  C                   IF        LKF(1) <> *BLANKS
N07  C     1             DO        16            XN2               3 0
N07  C                   MOVEL     LKF(XN2)      XLANDKODE         2
N07  C     XLANDKODE     CABEQ     *BLANKS       SLFILTER
N07  C     XLANDKODE     CABEQ     HELKA         STFILTER12
N07  C                   ENDDO
N07  C                   GOTO      SLFILTER
N07  C                   END
N07  C     STFILTER12    TAG
N07   * TEST TIL-LANDKODE
N07  C                   IF        LKT(1) <> *BLANKS
N07  C     1             DO        16            XN2               3 0
N07  C                   MOVEL     LKT(XN2)      XLANDKODE         2
N07  C     XLANDKODE     CABEQ     *BLANKS       SLFILTER
N07  C     XLANDKODE     CABEQ     HETRI         STFILTER13
N07  C                   ENDDO
N07  C                   GOTO      SLFILTER
N07  C                   END
N07  C     STFILTER13    TAG
      * TEST KUN avdelig
     C                   IF        AV(1)  <> *BLANKS
     C                   MOVE      HEAVD         HEAVDA            4
     C     1             DO        10            XN2               3 0
     C                   MOVEL     AV(XN2)       XAVD              4
     C     XAVD          CABEQ     *BLANKS       SLFILTER
     C     XAVD          CABEQ     HEAVDA        STFILTER2
     C                   ENDDO
     C                   GOTO      SLFILTER
     C                   END
     C     STFILTER2     TAG
      *
      * Siste test - dersom ATA-dato ER SATT - IKKE vis (men da skal normalt OT være annen)
     C     TRACKTK       CHAIN     TRACKT                             33
     C  N33              IF        TXATAD = 0
     C                   MOVE      'J'           XVIS
     C                   END
     C                   END
      *
     C                   END
      *
     C     SLFILTER      TAG
     C                   ENDSR
      *
      *=====================================================================******
      *  FILTRERE POSTER  - LAND
      *=====================================================================******
     C     SRFILTER2     begsr
     C                   MOVE      'N'           XVIS              1
     C     HEADFKLT      CHAIN(N)  HEADF                              35
     C     *in35         cabeq     '1'           SlFilter2
N12  C     HEST          cabeq     'S'           SlFilter2
      *  FRA - Postnr - Landkode/postnr eller SONE (land)
     C                   if        WSSDF<>*blanks
N03  c                   if        %subst(WSSDF:1:1)>='0'
N03  c                   eval      TstSte=HEADS3
N03  c                   else
     c                   eval      TstSte=HELKA+'-'+HEADS3
N03  c                   endif
     c                   eval      MaxSte=%trim(WSSDF)+'99999999'
     C                   if        TstSte<WSSDF or TstSte>MaxSte
     c                   goto      SlFilter2
     c                   endif
     c                   endif
      *  TIL - Postnr - Landkode/postnr eller SONE (land)
     C                   if        WSSDT<>*blanks
N03  c                   if        %subst(WSSDT:1:1)>='0'
N03  c                   eval      TstSte=HEADK3
N03  c                   else
     c                   eval      TstSte=HETRI+'-'+HEADK3
N03  c                   endif
     c                   eval      MaxSte=%trim(WSSDT)+'99999999'
     C                   if        TstSte<WSSDT or TstSte>MaxSte
     c                   goto      SlFilter2
     c                   endif
     c                   endif
      *
N09   *  IN - kun inngående avdelinger innland
N09  c                   if        WSSAVD = 'IN '
N09  c                   move      *blanks       KOAIE
N09  c     KOAkey        chain     KODTA
N09  c                   if        KOAIE <> '2'
N09  c                   goto      SlFilter2
N09  c                   endif
N09  c                   endif
N09   *  OUT- kun utgående  avdelinger innland
N09  c                   if        WSSAVD = 'OUT'
N09  c                   move      *blanks       KOAIE
N09  c     KOAkey        chain     KODTA
N09  c                   if        KOAIE <> '1'
N09  c                   goto      SlFilter2
N09  c                   endif
N09  c                   endif
N09   *  DOM- kun domestic (D/1/2)
N09  c                   if        WSSAVD = 'DOM'
N09  c                   move      *blanks       KOAIE
N09  c     KOAkey        chain     KODTA
N09  c                   if        KOAIE<>'D' and KOAIE<>'1' and KOAIE<>'2'
N09  c                   goto      SlFilter2
N09  c                   endif
N09  c                   endif
N09   *  IMP- kun import
N09  c                   if        WSSAVD = 'IMP'
N09  c                   move      *blanks       KOAIE
N09  c     KOAkey        chain     KODTA
N09  c                   if        KOAIE <> 'I'
N09  c                   goto      SlFilter2
N09  c                   endif
N09  c                   endif
N09   *  EXP- kun eksport
N09  c                   if        WSSAVD = 'EXP'
N09  c                   move      *blanks       KOAIE
N09  c     KOAkey        chain     KODTA
N09  c                   if        KOAIE <> 'E'
N09  c                   goto      SlFilter2
N09  c                   endif
N09  c                   endif
      *
      * KOMMET GJENNOM ALLE FILTER = J I XVIS
     C                   MOVE      'J'           XVIS              1

     C     SlFilter2     TAG
     C                   ENDSR
N11
N11  C***********************************************
N11  C     TTstatus      BEGSR
N11  C***********************************************
N11   * SYTR33 BENYTTER INIKATOR FOR Å STYRE FARGER
N11   * *IN(57) = '11' = ikke vis feltet
N11   *           '10' = Rød   Urørt
N11   *           '01' = Gul   Hentet
N11   *           '00' = Grønn Levert
N11  c                   EVAL      StatBg = *blanks
N11   * Status m.h.t. T&Tevents hentet / levert...
N11   * sjekk om den er levert / evt hentet
N11   * LEVERT ??
N11  C                   MOVE      'POD'         TTACTI
N11  c     TT02key       Chain     TRACKl02                           33
N11  C                   if        *in33=*on and TRSLAG='FF'
N11  C   33              MOVE      'TEI'         TTACTI
N11  c   33TT02key       Chain     TRACKl02                           33
N11  c                   endif
N11  C     *in33         ifeq      *ON
N11  C                   MOVE      'TE2'         TTACTI
N11  c     TT02key       setll     TRACKl02
N11  c     TT02key       reade     TRACKl02                               33
N11  c     *in33         doweq     '0'
N11  c                   if        %subst(TTTEXT:1:9)='Signed by'
N11  c                   leave
N11  c                   endif
N11  c     TT02key       reade     TRACKl02                               33
N11  c                   enddo
N11  c                   endif
N11   * levert
N11  c                   if        *in33=*off
N11  C                   eval      HENLEV='Levert'
N11  c*                  eval      StatBg='Green'
N11  c                   eval      StatBg='#2db92d'
N11  c                   endif
N11   * er ikke levert...
N11   * HENTET ??
N11  C     *in33         ifeq      *ON
N11  C                   eval      HENLEV='Hentet'
N11  c*                  eval      StatBg='Yellow'
N11  c                   eval      StatBg='#ffff4d'
N11  C                   MOVE      'COL'         TTACTI
N11  c     TT02key       Chain     TRACKl02                           33
N11  C   33              MOVE      'TEU'         TTACTI
N11  c   33TT02key       Chain     TRACKl02                           33
N11   * heller ikke hentet
N11  C   33              eval      HENLEV='Urørt'
N11  c*  33              eval      StatBg='Red'
N11  c   33              eval      StatBg='#ff5c33'
N11   * På term ?
N11  c     *in33         ifeq      '1'
N11  C                   MOVE      'TEI'         TTACTI
N11  c     TT02key       Chain     TRACKl02                           33
N11  C   33              MOVE      'TE2'         TTACTI
N11  c   33TT02key       Chain     TRACKl02                           33
N11  C  N33              eval      HENLEV='På Term'
N11  c* N33              eval      StatBg='Green'
N11  c  N33              eval      StatBg='#99e699'
N11  c                   endif
N11  c                   endif
N11   *
N11  c                   ENDSR
      *=====================================================================
      *  Set variable data for section /$top
      *=====================================================================
     C     SetTop        begsr
     c                   eval      Title='POMS Purchase Order Management System'
OddEvC                   callp     updHTMLvar('ROWHEAD':RowHead)
     C                   callp     updhtmlvar('TITLE':Title)
     C                   callp     updHTMLvar('LogoImg':LogoImg)
     C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHTMLvar('USER':USER)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHtmlVar('WSTUR':
     C                             %trim(%editc(WBTUR:'L')))
     C                   callp     updHTMLvar('FRAMES':WSFRAMES)
     C                   callp     updHTMLvar('WSCHG':WSCHG)
     C                   callp     updHTMLvar('WSSDF1':WSSDF1)
     C                   callp     updHTMLvar('WSSDF2':WSSDF2)
     C                   callp     updHTMLvar('WSSDF':WSSDF)
     C                   callp     updHTMLvar('WSSDT':WSSDT)
     C                   callp     updHTMLvar('WSSAVD':WSSAVD)
     C                   callp     updHTMLvar('XDIAVD':
     C                                        %trim(%editc(XDIAVD:'Z')))
      *
     C                   IF        WBTUR <> 0
     C                   callp     updhtmlvar('VisPick':', "bVisible": true')
     c                   else
     C                   callp     updhtmlvar('VisPick':', "bVisible": false')
     c                   endif
      *
     C                   endsr
      *
      *=====================================================================
      *  Set variable data for section /$row
      *=====================================================================
     C     Setrow        begsr
     c     OddEven       IFEQ      ODD
     c                   eval      OddEven = EVEN
     c                   else
     c                   eval      OddEven = ODD
     c                   end
     C                   callp     updHTMLvar('ODDEVEN':OddEven)
      *
N10  c                   movel     HEAVD         AvdOpd           11
N10  c                   move      HEOPD         AvdOpd
N10  C                   callp     updHTMLvar('AvdOpd':AvdOpd)
     C                   callp     updHTMLvar('HEAVD':
     C                             %trim(%editc(HEAVD:'Z')))
     C                   callp     updHTMLvar('HEOPD':
     C                             %trim(%editc(HEOPD:'Z')))
     C                   exsr      crtOpdRef
     C                   callp     updHTMLvar('OpdRef':OpdRef)
     C                   callp     updHTMLvar('HERFA':HERFA)
     C                   callp     updHTMLvar('HENAS':HENAS)
     C                   callp     updHTMLvar('HENAK':HENAK)
     C                   callp     updHTMLvar('HEVS1':HEVS1)
S01   *
S01  C*                  Z-ADD     0             XPOSNR            3 0
S01  C* N331             DO        3             XN
S01  C*                  IF        ((POS(XN) >= '0') AND (POS(XN) <= '9'))
S01  C*                  MULT      10            XPOSNR
S01  C*                  MOVE      POS(XN)       XPOSNR
S01  C*                  END
S01  C*                  ENDDO
S01  C*                  callp     updHTMLvar('WSPOS':
S01  C*                            %trim(%editc(XPOSNR:'Z')))
N10  C                   callp     updHTMLvar('WSPOS':HEPOS1)
     C     TRACKTK       CHAIN(N)  BILLOF                             33
     C                   callp     updHTMLvar('WSBLORR':BLCH)
     C                   callp     updHTMLvar('HENT':
     C                             %trim(%editc(HENT:'Z')))
     C                   callp     updHTMLvar('HEVKT':
     C                             %trim(%editc(HEVKT:'Z')))
     C                   callp     updHTMLvar('HEM3':
     C                             %trim(%editc(HEM3:'3')))
     C                   callp     updHTMLvar('HELM':
     C                             %trim(%editc(HELM:'3')))
      *
N11  C                   exsr      TTstatus
N11  C                   callp     updHTMLvar('HENLEV':HENLEV)
N11  C                   callp     updHTMLvar('StatBg':StatBg)
      *
     C                   endsr
      *
      *=====================================================================
      *  Set variable data for section /$row
      *=====================================================================
     C     Setrow2       begsr
      *
N10  c                   movel     HEAVD         AvdOpd           11
N10  c                   move      HEOPD         AvdOpd
N10  C                   callp     updHTMLvar('AvdOpd':AvdOpd)
     C                   callp     updHTMLvar('HEAVD':
     C                             %trim(%editc(HEAVD:'Z')))
     C                   callp     updHTMLvar('HEOPD':
     C                             %trim(%editc(HEOPD:'Z')))
     C                   exsr      crtOpdRef
     C                   callp     updHTMLvar('OpdRef':OpdRef)
     C                   callp     updHTMLvar('HERFA':HERFA)
     C                   callp     updHTMLvar('HENAS':HENAS)
     C                   callp     updHTMLvar('HENAK':HENAK)
     C                   IF        (XTURTYPE <> 'O')                            Land=LK/PN/Sted
     C                   callp     updHTMLvar('HEADS3':
     C                             HELKA+'-'+%subst(HEADS3:1:15))
     C                   callp     updHTMLvar('HEADK3':
     C                             HETRI+'-'+%subst(HEADK3:1:15))
     c                   else                                                   Sjø=Stedskode
     C                   callp     updHTMLvar('HEADS3':HESDF)
     C                   callp     updHTMLvar('HEADK3':HESDT)
     c                   endif
     C                   callp     updHTMLvar('HEVS1':HEVS1)
     C                   callp     updHTMLvar('HESDF':HESDF)
     C                   callp     updHTMLvar('HESDT':HESDT)
     C                   callp     updHTMLvar('HENT':
     C                             %trim(%editc(HENT:'Z')))
     C                   callp     updHTMLvar('HEVKT':
     C                             %trim(%editc(HEVKT:'Z')))
     C                   callp     updHTMLvar('HEM3':
     C                             %trim(%editc(HEM3:'3')))
     C                   callp     updHTMLvar('HELM':
     C                             %trim(%editc(HELM:'3')))
N11  C                   exsr      TTstatus
N11  C                   callp     updHTMLvar('HENLEV':HENLEV)
N11  C                   callp     updHTMLvar('StatBg':StatBg)
      *
     C                   endsr
      *
      ***************************************************
     C     crtOpdRef     begsr
      ***************************************************
      * DERSOM ship ikke ønsker å kunne endre - lehh kun Avd / Opd i OpdRef
     c                   movel     '810 '        width             4
     c                   movel     '900 '        height            4
     c                   eval      OpdRef='<a href="#" OnClick="'
     c                             +'window.open('
     c                             +Ap+'/sycgip/esovers5.pgm?user='
     c                             +%trim(USER)+'&UsrSpcName='
     c                             +UsrSpcName
     c                             +'&WSAVD='+%trim(%editc(HEAVD:'Z'))
     c                             +'&WSOPD='+%trim(%editc(HEOPD:'Z'))+Ap
     c                             +','+Ap+'OpdSubWindow'+Ap
     c                             +','+Ap+'width='+%trim(width)
     c                             +',height='+%trim(height)
     c                             +',left=170,top=30,scrollbars,resizable'+Ap
     c                             +')">'+%trim(%editc(HEAVD:'Z'))
     c                             +'&nbsp;/&nbsp;'+%trim(%editc(HEOPD:'Z'))
     c                             +'</a>'
      *
     C                   endsr
      *
      *=====================================================================******
      *  SRREMOVE
      *=====================================================================******
     C     SRREMOVE      begsr
      *
     C     HEADFK        CHAIN     HEADF                              33
     C                   IF        *IN33 = *OFF
     C                   MOVE      *ZEROS        HEPRO
     C                   MOVE      *BLANKS       HEPOS1
N06   * Sjøbasert ..
N06  C                   IF        XTURTYPE = 'O'
     C                   MOVE      *ZEROS        TRSDFD
     C                   MOVE      *ZEROS        TRSDTD
N06  C                   endif
     C                   UPDATE    HEADFR
     C     HEADFK        CHAIN     DISP                               33
     C                   IF        *IN33 = *OFF
     C                   MOVE      *ZEROS        DITUAV
     C                   MOVE      *ZEROS        DITUR
     C                   UPDATE    DISPR
     C                   END
      *
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   EVAL      TTTEXT='Order is removed from trip '
     C                             + %TRIM(WSTUR) + ' by '
     C                             + %TRIM(BIBRID)
     C                   EVAL      TTTEXL='Ordre er fjernet fra turen '
     C                             + %TRIM(WSTUR) + ' av '
     C                             + %TRIM(BIBRID)
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   MOVE      'RMV'         TTACTI
     C                   MOVEL     USER          TTUSER
     C                   EVAL      TTDEPO = 'ESOVERS5'
     C                   WRITE     TRACKFR
     C                   END
      *
     C     HEADFK        CHAIN     BILLOF                             33
S04  C* N33              EVAL      BLBLNR = *BLANKS
N05  C  N33              IF        BLAD4G = *BLANKS
N04  C  N33              MOVE      HEDTR         XAN08             8
N04  C  N33              EVAL      BLBLNR = 'AA' + %TRIM(XAN08)
N05  C                   ELSE
N05  C                   EVAL      BLBLNR = BLAD4G
N05  C                   END
     C  N33              EVAL      BLTR   = *BLANKS
     C  N33              EVAL      BLDLOS = 0
     C  N33              EVAL      BLDTA  = 0
     C  N33              UPDATE    BILLOFR
      *
     C     HEADFK        CHAIN     BLV1                               33
     C                   DOW       *IN33 = *OFF
     C                   IF        BVMN = TUCON1
     C                   DELETE    BLV1R
     C                   ELSE
     C                   UPDATE    BLV1R
     C                   END
     C     HEADFK        READE     BLV1                                   33
     C                   ENDDO
      *
     C     WBTUR         CHAIN     TURER14                            33
     C                   SUB       1             TUAO
     C                   SUB       HENT          TUTS
     C                   SUB       HEVKT         TUTVKT
     C                   SUB       HEM3          TUTM3
     C                   SUB       HELM          TUTLM
     C                   UPDATE    TURERR
      *
     C                   EVAL      WSCHG = 'Y'
      *
     C                   endsr
      *
      *=====================================================================******
      *  SRPICKUP
      *=====================================================================******
     C     SRPICKUP      begsr
      *
     C     HEAD11K       SETLL     HEAD11
     C     WBTUR         READPE    HEAD11                                 33
     C                   Z-ADD     0             XPOSNR            3 0
S10  C* N331             DO        3             XN
S10  C*                  IF        ((POS(XN) >= '0') AND (POS(XN) <= '9'))
S10  C*                  MULT      10            XPOSNR
S10  C*                  MOVE      POS(XN)       XPOSNR
S10  C*                  END
S10  C*                  ENDDO
N12  C                   EVAL      XPOSNR   = c2n2(HEPOS1)
      *
     C     HEADFK        CHAIN     HEADF                              33
     C                   IF        *IN33 = *OFF
     C                   MOVE      WBTUR         HEPRO
     C                   IF        XTURTYPE = 'O'                               AUTO-POS VED SJØ
     C                   ADD       1             XPOSNR
     C                   MOVEL     XPOSNR        HEPOS1
     C                   END
N06   * Sjøbasert ..
N06  C                   IF        XTURTYPE = 'O'
     C                   MOVE      TUATD         TRSDFD
     C                   MOVE      TUATA         TRSDTD
N06  c                   endif
     C                   UPDATE    HEADFR
     C     HEADFK        CHAIN     DISP                               33
     C                   IF        *IN33 = *OFF
     C                   MOVE      TUAVD         DITUAV
     C                   MOVE      WBTUR         DITUR
     C                   UPDATE    DISPR
     C                   END
      * B/L-NR
     C     HEADFK        CHAIN     BILLOF                             33
     C                   IF        *in33 =  *OFF
N05  C                   EVAL      BLAD4G = BLBLNR
     C                   IF        TUBLNR <> *BLANKS
     C                   EVAL      BLBLNR = TUBLNR
     C                   EVAL      BLTR   = TUTR
     C                   END
     C                   MOVE      TUATD         BLDLOS
     C                   MOVE      TUATA         BLDTA
     C                   UPDATE    BILLOFR
      * CONTAINERNR
     C                   IF        TUCON1 <> *BLANKS
     C     HEADFK        CHAIN     BLV1                               33
     C                   EVAL      BVMN   = TUCON1
     C                   EVAL      BVVKT  = HEVKT
     C                   EVAL      BVM3   = HEM3
     C                   IF        BVVKT  = 0
     C                   EVAL      BVNT   = 0
     C                   ELSE
     C                   EVAL      BVNT   = HENT
     C                   END
     C                   EVAL      BVKDC  = TUCKD1
     C     BVKDC         CHAIN     CDCON4                             34
     C                   EVAL      BVVS   = CC4FT
     C                   IF        *IN33
     C                   EVAL      BVAVD  = BLAVD
     C                   EVAL      BVOPD  = BLOPD
     C                   EVAL      BVLI   = 1
     C                   EVAL      BVSORT = 10
     C                   WRITE     BLV1R
     C                   ELSE
     C                   UPDATE    BLV1R
     C                   END
     C                   END
     C                   END
      * DATOENE
N06   * Sjøbasert ..
N06  C                   IF        XTURTYPE = 'O'
     C     HEADFK        CHAIN     TRACKT                             33
     C                   IF        *IN33 = *OFF
     C                   EXSR      OPDLOG
     C                   MOVE      WBETD         TXETDD
     C                   MOVE      WBETA         TXETAD
     C                   MOVE      WBATD         TXATDD
     C                   MOVE      WBATA         TXATAD
     C                   UPDATE    TRACKTR
     C                   END
N06  C                   endif
      *
     C     WBTUR         CHAIN     TURER14                            33
     C                   ADD       1             TUAO
     C                   ADD       HENT          TUTS
     C                   ADD       HEVKT         TUTVKT
s02  C*                  ADD       HEM3          TUTM3
n02  c                   z-add     TUTM3         TUTM3X
n02  C                   ADD       HEM3          TUTM3X
S08  c*                  if        TUTM3X > 999.99
S08  C*                  EVAL      TUTM3  = 999.99
N08  c                   if        TUTM3X > 9999.999
N08  C                   EVAL      TUTM3  = 9999.999
n02  c                   else
n02  C                   EVAL      TUTM3  = TUTM3X
n02  c                   endif
     C                   ADD       HELM          TUTLM
     C                   UPDATE    TURERR
     C                   END
      *
     C                   EVAL      WSCHG = 'Y'
      *
     C                   endsr
      *
      *////////////////////////////////////////////////////////////
     C     OPDLOG        BEGSR
      *////////////////////////////////////////////////////////////
     C                   CALL      'SYGE15C'
     C                   PARM                    WDT               8
     C                   PARM                    WTM               6
      *
     C                   MOVE      HEAVD         TTAVD
     C                   MOVE      HEOPD         TTOPD
     C                   EVAL      TTTEXT='Order is picked up to trip '
     C                             + %TRIM(WSTUR) + ' by '
     C                             + %TRIM(BIBRID)
     C                   EVAL      TTTEXL='Ordre er plukket til turen '
     C                             + %TRIM(WSTUR) + ' av '
     C                             + %TRIM(BIBRID)
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   MOVE      'PCK'         TTACTI
     C                   MOVEL     USER          TTUSER
     C                   EVAL      TTDEPO = 'ESOVERS5'
     C                   WRITE     TRACKFR
      * ETA
     C                   IF        WBETA <> TXETAD
     C                   MOVE      TXAVD         TTAVD
     C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   MOVE      'CHD'         TTACTI
     C                   MOVE      USER          TTUSER
     C                   EVAL      TTDEPO = 'ETUR05'
     C                   MOVE      TXETAD        XAN08             8
     C                   MOVE      WBETA         XAN082            8
     C                   EVAL      TTTEXT = 'ETA changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(XAN082) + ' by '
     C                             + %TRIM(USER)
     C                   EVAL      TTTEXL = 'ETA endret fra '
     C                             + %TRIM(XAN08) + ' til '
     C                             + %TRIM(XAN082) + ' av '
     C                             + %TRIM(USER)
     C                   WRITE     TRACKFR
     C                   END
      * ETD
     C                   IF        WBETD <> TXETDD
     C                   MOVE      TXAVD         TTAVD
     C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   MOVE      'CHD'         TTACTI
     C                   MOVE      USER          TTUSER
     C                   EVAL      TTDEPO = 'ETUR05'
     C                   MOVE      TXETDD        XAN08
     C                   MOVE      WBETD         XAN082
     C                   EVAL      TTTEXT = 'ETD changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(XAN082) + ' by '
     C                             + %TRIM(USER)
     C                   EVAL      TTTEXL = 'ETD endret fra '
     C                             + %TRIM(XAN08) + ' til '
     C                             + %TRIM(XAN082) + ' av '
     C                             + %TRIM(USER)
     C                   WRITE     TRACKFR
     C                   END
      * ATA
     C                   IF        WBATA <> TXATAD
     C                   MOVE      TXAVD         TTAVD
     C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   MOVE      'CHD'         TTACTI
     C                   MOVE      USER          TTUSER
     C                   EVAL      TTDEPO = 'ETUR05'
     C                   MOVE      TXATAD        XAN08             8
     C                   MOVE      WBATA         XAN082
     C                   EVAL      TTTEXT = 'ATA changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(XAN082) + ' by '
     C                             + %TRIM(USER)
     C                   EVAL      TTTEXL = 'ATA endret fra '
     C                             + %TRIM(XAN08) + ' til '
     C                             + %TRIM(XAN082) + ' av '
     C                             + %TRIM(USER)
     C                   WRITE     TRACKFR
     C                   END
      * ETD
     C                   IF        WBATD <> TXATDD
     C                   MOVE      TXAVD         TTAVD
     C                   MOVE      TXOPD         TTOPD
     C                   MOVE      WDT           TTDATE
     C                   MOVE      WTM           TTTIME
     C                   MOVE      WDT           TTDATL
     C                   MOVE      WTM           TTTIML
     C                   MOVE      'CHD'         TTACTI
     C                   MOVE      USER          TTUSER
     C                   EVAL      TTDEPO = 'ETUR05'
     C                   MOVE      TXATDD        XAN08
     C                   MOVE      WBATD         XAN082
     C                   EVAL      TTTEXT = 'ATD changed from '
     C                             + %TRIM(XAN08) + ' to '
     C                             + %TRIM(XAN082) + ' by '
     C                             + %TRIM(USER)
     C                   EVAL      TTTEXL = 'ATD endret fra '
     C                             + %TRIM(XAN08) + ' til '
     C                             + %TRIM(XAN082) + ' av '
     C                             + %TRIM(USER)
     C                   WRITE     TRACKFR
     C                   END
      *
     C                   ENDSR
      *
      *=====================================================================******
      *  SROPDPOS
      *=====================================================================******
     C     SROPDPOS      begsr
      *
     C                   eval      ItemCount = ZhbGetVarCnt('WSPOS')
      *
     C                   eval      i = 1
     C     i             DOUGT     ItemCount
     C                   eval      XAVDA = ZhbGetVar('WSAVD':i)
     C                   EVAL      XAVDN = c2n2(XAVDA)
     C                   eval      XOPDA = ZhbGetVar('WSOPD':i)
     C                   EVAL      XOPDN = c2n2(XOPDA)
     C                   eval      XPOSA = ZhbGetVar('WSPOS':i)
     C                   EVAL      XPOSN = c2n2(XPOSA)
     C                   eval      WSBLORR = ZhbGetVar('WSBLORR':i)
     C     HEADFK2       CHAIN     HEADF                              33
     C                   IF        *IN33 = *OFF
N10  c                   if        XPOSN > 0
     C                   MOVEL     XPOSN         HEPOS1
N10  c                   else
N10  C                   MOVEL     *blanks       HEPOS1
N10  c                   endif
     C                   UPDATE    HEADFR
     C                   END
     C     HEADFK2       CHAIN     BILLOF                             33
     C                   IF        *IN33 = *OFF
     C                   MOVEL     WSBLORR       BLCH
     C                   UPDATE    BILLOFR
     C                   END
     C                   eval      i = i +1
     C                   ENDDO
      *
     C                   endsr
N10
N10   *********************************************************
N10  C     MLTPCKRMV     begsr
N10   *********************************************************
N10   *
N10   * REMOVE...
N10  C                   eval      ItemCount = ZhbGetVarCnt('RMVCHK')
N10   *
N10  C                   eval      i = 1
N10  C     i             DOWLE     ItemCount
N10  C                   move      *blanks       CHKDAvdOpd       11
N10  C                   eval      CHKDAvdOpd = ZhbGetVar('RMVCHK':i)
N10  C                   movel     CHKDAvdOpd    WBAVD
N10  C                   move      CHKDAvdOpd    WBOPD
N10  C                   EXSR      SRREMOVE
N10  C                   eval      i = i +1
N10  C                   ENDDO
N10   * PICK...
N10  C                   eval      ItemCount = ZhbGetVarCnt('PICKCHK')
N10   *
N10  C                   eval      i = 1
N10  C     i             DOWLE     ItemCount
N10  C                   move      *blanks       CHKDAvdOpd       11
N10  C                   eval      CHKDAvdOpd = ZhbGetVar('PICKCHK':i)
N10  C                   movel     CHKDAvdOpd    WBAVD
N10  C                   move      CHKDAvdOpd    WBOPD
N10  C                   EXSR      SRPICKUP
N10  C                   eval      i = i +1
N10  C                   ENDDO
N10   *
N10   *
N10  C                   endsr
      *
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     USER          CHAIN     BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
      * hent Parametre som går igjen i mange prog:
      *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
     c                   call      'ESGETPAR'
     c                   parm                    BIBRID
     c                   parm                    BIFIRM
     c                   parm                    BIKUNR
     c                   parm                    BIKNG
     c                   parm                    RowHead          10
     c                   parm                    Odd              10
     c                   parm                    Even             10
     c                   parm                    LogoImg          50
     c                   parm                    XSPRÅK            2
     c                   parm                    XINTERN           1
     c                   parm                    ParmDS1        1024
     c                   parm                    ParmDS2        1024
     c                   parm                    ParmDS3        1024
      * HENTER PARAMETER
     C                   CALL      'ESGETOS'
     C                   parm                    BIBRID
     C                   parm                    BIFIRM
     C                   parm                    BIKUNR
     C                   parm                    BIKNG
     C                   parm                    ParmOS1        1024
      *
     C                   OPEN      BRPARF
     C                   OPEN      TURER14
     C                   OPEN      DISP
     C                   OPEN      DISPL04
N09  C                   OPEN      DISPL19
N09  C                   OPEN      KODTA
     C                   OPEN      HEADF
     C                   OPEN      HEAD11
S10  C*                  OPEN      HEAD14
     C                   OPEN      HEAD30
     C                   OPEN      BILLOF
     C                   OPEN      BLV1
     C                   OPEN      TRACKT
     C                   OPEN      TRACKF
N11  C                   OPEN      TRACKL02
     C                   OPEN      CDCON4
      *
     C     HEADFK        klist
     C                   kfld                    WBAVD
     C                   kfld                    WBOPD
     C     HEADFKLT      klist
     C                   kfld                    DIAVD
     C                   kfld                    DIOPD
     C     HEADFK2       klist
     C                   kfld                    XAVDN
     C                   kfld                    XOPDN
     C     HEAD11K       klist
     C                   kfld                    WBTUR
     C                   kfld                    XPOS1             7
     C     TRACKTK       klist
     C                   kfld                    HEAVD
     C                   kfld                    HEOPD
     C     DISPL04K      KLIST
     C                   KFLD                    XDISTA1
     C                   KFLD                    XDITUR
     C                   KFLD                    XDIAVD
N09  C     DISPL19K      KLIST
N09  C                   KFLD                    XDISTA1
N09  C                   KFLD                    XDITUR
N09  C     KOAkey        KLIST
N09  C                   KFLD                    KOAUNI
N09  C                   KFLD                    HEAVD
N09  C                   movel     'A'           KOAUNI
N11  C     TT02KEY       KLIST
N11  C                   KFLD                    HEAVD
N11  C                   KFLD                    HEOPD
N11  C                   KFLD                    NULFBNR           3 0
N11  C                   KFLD                    TTACTI
     C     BrParKey      klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
     C                   MOVE      BIBRID        PABRID
     C                   MOVE      *zeros        PAKUNR
      *
     C                   MOVE      'TURPL'       PAID
     C     BrParKey      chain     BRPARF                             33
     C  N33              MOVEL     PAVRDA        XTURTYPE          1
     C   33              MOVE      'O'           XTURTYPE
     C                   MOVE      ' '           XDISTA1           1
     C                   MOVE      *ZEROS        XDITUR            8 0
      *
     C                   MOVE      'LTAVD'       PAID
     C     BrParKey      chain     BRPARF                             33
     C  N33              Z-ADD     PAVRDN        XDIAVD            4 0
      * selEct avd oppgitt (annet enn all/in/out..)
     C                   IF        WBSAVD <> 0
xx   C                             and WSSAVD <> *blanks
     C                   MOVE      WBSAVD        XDIAVD
     C                   END
      *
     C                   EVAL      XPOS1 = '9999999'
     C     WBTUR         CHAIN(N)  TURER14                            33
N06   * Sjøbasert ..
N06  C                   IF        XTURTYPE = 'O'
     C                   EVAL      WBETD    = TUETD
     C                   EVAL      WBETA    = TUETA
     C                   EVAL      WBATD    = TUATD
     C                   EVAL      WBATA    = TUATA
N06  C                   endif
      *
     C                   endsr
      *
