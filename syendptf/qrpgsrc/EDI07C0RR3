     FDKTFI     IF   E             DISK
     FDKEH01    IF   E           K DISK
     FARKIVP    O  A E           K DISK
     FARKIVL12  IF   E           K DISK
     F                                     RENAME(ARKIVR:ARKIVR12)
     F                                     PREFIX(X)
     FFIRMARC   IF   E             DISK
     FLSOUTPUT  IF   F   80        DISK
     FEDI07C0R  O  A F  512        DISK
     D                 DS
     D  XULTID                 1     14  0
     D  XULTM                  1      6  0
     D  XULDD                  7      8  0
     D  XULMM                  9     10  0
     D  XUL≈≈                 11     14  0
     D                 DS
     D  UL≈≈                   1      4  0
     D  ULMM                   5      6  0
     D  ULDD                   7      8  0
     D  ULDT                   1      8  0
     ILSOUTPUT  AA  01
     I                                  1   80  FILE
     I                                  1   26  FILE2
     I                                  1    4  F4
     I                                  1    8  F8
     I                                 10   22  F23
      * INPUT PARAMETER
     C     *ENTRY        PLIST
     C                   PARM                    LIB              10
     C                   PARM                    W0035             1
      * HÊmta firmaupplysningar
     C     1             CHAIN     DKTFI
     C                   READ      FIRMARC
      * USERID AND PASSWORD RECORD
     C                   IF        W0035=*BLANKS
     C                   MOVEL(P)  DKTF_FTUSP    DATA            512
     C                   CAT       DKTF_FTPWP:1  DATA
     C                   ELSE
     C                   MOVEL(P)  DKTF_FTUST    DATA
     C                   CAT       DKTF_FTPWT:1  DATA
     C                   ENDIF
     C                   EXCEPT    AWRK
      * sendepsv 0
     C                   MOVEL(P)  'sendepsv 0'  DATA
     C                   EXCEPT    AWRK
      * NAMEFMT
     C                   MOVEL(P)  'NAMEFMT 1'   DATA
     C                   EXCEPT    AWRK
      * BIN
     C                   MOVEL(P)  'BIN'         DATA
     C                   EXCEPT    AWRK
      * GET
     C                   READ      LSOUTPUT                               51
     C     *IN51         DOWEQ     *OFF
     C                   EVAL      *IN20=*OFF
     C     F4            IFNE      '.   '
     C     F4            ANDNE     '..  '
     C     F4            ANDNE     'temp'
     C     F4            ANDNE     'old_'
     C     F8            ANDNE     'toldskat'

     C                   MOVEL(P)  'get'         DATA
     C                   CAT       FILE:1        DATA
     C                   CAT       '/':1         DATA

     C     '.pdf'        SCAN      FILE                                   20

     C                   IF        *IN20
     C                   CAT       ARCANE:0      DATA
     C                   CAT       '/':0         DATA

     C                   ELSE

     C                   CAT       LIB:0         DATA
     C                   CAT       '/':0         DATA
     C                   CAT       'EDIRE':0     DATA
     C                   CAT       '/':0         DATA
     C                   CAT       'A':0         DATA

     C                   ENDIF

     C                   CAT       FILE:0        DATA
     C                   EXCEPT    AWRK

     C                   MOVEL(P)  'ren'         DATA
     C                   CAT       FILE:1        DATA
     C                   CAT       'old_':1      DATA
     C                   CAT       FILE:0        DATA
     C                   EXCEPT    AWRK

     C                   ENDIF
     C   20              EXSR      ARKIV
     C                   READ      LSOUTPUT                               51
     C  N51              ENDDO
      * QUIT COMMAND RECORD
     C                   MOVEL(P)  'quit'        DATA
     C                   EXCEPT    AWRK
     C                   MOVE      '1'           *INLR
      *_____________________________________________
      * Arkiver                                ARKIV
      *""""""""""""""""""""""""""""""""""""""""""""""
     C     ARKIV         BEGSR
      * Finnes allerede ?
     C     *LIKE         DEFINE    ARLINK        WARLINK
     C                   MOVEL     FILE          WARLINK
     C     WARLINK       CHAIN     ARKIVL12                           53
     C                   IF        *IN53

     C     F23           CHAIN     DKEH01                             52
     C                   IF        *IN52=*OFF
     C                   EVAL      ARSTAT='A'
     C                   EVAL      ARTYPE='DZ'
     C                   EVAL      ARFIRM=ARCFIR
     C                   MOVE      DKEH_SYAV     ARAVD
     C                   MOVE      DKEH_SYOP     AROPD
     C                   EVAL      ARUSER='ASPSY400'
     C                   TIME                    XULTID
     C                   MOVE      XULDD         ULDD
     C                   MOVE      XULMM         ULMM
     C                   MOVE      XUL≈≈         UL≈≈
     C                   MOVE      ULDT          ARDATE
     C                   MOVE      XULTM         ARTIME
     C                   z-add     DKEH_AVKN     ARKUND
     C                   MOVEL     FILE          ARLINK
     C                   WRITE     ARKIVR

     C                   BITON     '123457'      GRAAPP            1
     C                   BITOFF    '06'          GRAAPP
     C                   MOVEL(P)  'SBMJOB'      QCMDR           128
     C                   CAT       ' CMD(C':0    QCMDR
     C                   CAT       'ALL PG':0    QCMDR
     C                   CAT       'M(':0        QCMDR
     C                   CAT       'DKE031C':0   QCMDR
     C                   CAT       ') PARM':0    QCMDR
     C                   CAT       '(':0         QCMDR

     C                   MOVE      DKEH_SYAV     AVDA              4
     C                   CAT       GRAAPP:0      QCMDR
     C                   CAT       AVDA:0        QCMDR
     C                   CAT       GRAAPP:0      QCMDR

     C                   CAT       GRAAPP:1      QCMDR
     C                   CAT       FILE2:0       QCMDR
     C                   CAT       GRAAPP:0      QCMDR

     C                   CAT       '))':0        QCMDR
     C                   CAT       ' JOBD(':0    QCMDR
     C                   CAT       'SY400J':0    QCMDR
     C                   CAT       'OBD) J':0    QCMDR
     C                   CAT       'OBQ(SY':0    QCMDR
     C                   CAT       '400QER)':0   QCMDR
     C                   Z-ADD     128           QCMDLE           15 5
     C                   CALL      'QCMDEXC'                            3131
     C                   PARM                    QCMDR
     C                   PARM                    QCMDLE
     C                   ENDIF
     C                   ENDIF
     C                   ENDSR
     OEDI07C0R  EADD         AWRK
N02  O                       DATA               512
