     H Option( *SrcStmt ) DftActGrp( *No ) BndDir( 'QC2LE' )
      *__________
      * Variabler
      *""""""""""
     D FILE_i          s               *
     D FILE_o          s               *
     D String          s            128a
     D rc              s             10i 0
     D Data            s            128a   Varying
     D Codepage        s              5a   Varying
      *___________________________
      * IFS Stream file funksjoner
      *"""""""""""""""""""""""""""
     Dopen             Pr              *   ExtProc( '_C_IFS_fopen' )
     D                                 *   Value Options( *String )
     D                                 *   Value Options( *String )

     Dfputs            Pr            10i 0 ExtProc( '_C_IFS_fputs' )
     D                                 *   Value Options( *String )
     D                                 *   Value

     Dclose            Pr            10i 0 ExtProc( '_C_IFS_fclose' )
     D                                 *   Value
     Dfgets            Pr              *   ExtProc( '_C_IFS_fgets' )
     D                                 *   Value
     D                               10i 0 Value
     D                                 *   Value

     D RunCmd          PR                  EXTPGM('QCMDEXC')
     D  Cmd                         200A   CONST
     D  Len                          15P 5 CONST
      *____________________
      * DS for input string
      *""""""""""""""""""""
     D                 DS
     D  A                      1    127
     D                                     DIM(127)
     D  ADS                    1    127
      *_____________________
      * DS for output string
      *"""""""""""""""""""""
     D                 DS
     D  B                      1    512
     D                                     DIM(512)
     D  BDS                    1    512
      *//////////////
      *  Hodelogikk /
      *//////////////
     C                   EXSR      SRA
     C                   EXSR      SRB
     C                   EXSR      SRC
     C                   MOVE      '1'           *INLR
      *////////////////////////////////////////////////////////////
      *  Initiering                                           SRA /
      *////////////////////////////////////////////////////////////
     C     SRA           BEGSR
      *_____________
      * Init av felt
      *"""""""""""""
     C                   MOVE      X'7D'         WAPO              1
      *_________________
      * Input parametrer
      *"""""""""""""""""
     C     *ENTRY        PLIST
     C                   PARM                    UFILI           128
     C                   PARM                    UFILO           128
     C                   PARM                    UKRYPT          512
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Kryptere                                             SRB /
      *////////////////////////////////////////////////////////////
     C     SRB           BEGSR

     C                   MOVE      *BLANKS       WCMD1           128
     C                   EVAL      WCMD1 = 'QSH CMD(' + WAPO + 'openssl d'
     C                             + 'gst -sha256 -hex -out'

     C                   MOVE      *BLANKS       WCMD2           128
     C                   EVAL      WCMD2 = '-sign systema.key -passin pass:3410'

     C                   MOVE      *BLANKS       WCMD3           300
     C                   EVAL      WCMD3 = %trimr(WCMD1)
     C                             + ' '
     C                             + %trimr(UFILO)
     C                             + ' '
     C                             + %trimr(WCMD2)
     C                             + ' '
     C                             + %trimr(UFILI)
     C                             + WAPO +')'

     C                   CALLP     RUNCMD(WCMD3:300)

     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Les signaturfil                                      SRC /
      *////////////////////////////////////////////////////////////
     C     SRC           BEGSR
      *________________________________________
      * Åpne fil, med tegnkonvertering for jobb
      *""""""""""""""""""""""""""""""""""""""""
     C                   EVAL      FILE_i = open( %TrimR( UFILO ) : 'r' )

     C                   DOW       fgets( %Addr( String ) : %Size( String )
     C                             : FILE_i ) <> *Null
     C                   MOVEL     String        W1              127
     C                   EXSR      SRC2
     C                   ENDDO

     C                   EVAL      rc = close( FILE_i )
     C                   ENDSR
      *////////////////////////////////////////////////////////////
      *  Extraher signatur i hexaformat / Linje              SRC2 /
      *////////////////////////////////////////////////////////////
     C     SRC2          BEGSR
     C                   EVAL      ADS=*BLANKS
     C                   EVAL      BDS=*BLANKS
     C                   Z-ADD     1             Y                 4 0
     C                   Z-ADD     1             X
     C                   EVAL      ADS=W1
     C     '='           SCAN      ADS           X                 3 0    52
     C   52              ADD       2             X
     C  N52              Z-ADD     1             X
     C     X             DO        127           X
     C                   MOVE      A(X)          WCHAR             1
     C                   IF        WCHAR <> ' '
     C                   MOVE      WCHAR         B(Y)                                         I
     C                   ADD       1             Y
     C                   ENDIF
     C                   ENDDO
     C     UKRYPT        CAT       BDS:0         UKRYPT
     C
     C                   ENDSR
