      *********************************************************************
      * PROGRAM VISE UTVALGTE SAKER
      *
CRTPG+*  CRTPGM SYSPED/EISO01 MODULE(*LIBL/EISO01
CRTPGM*        *LIBL/CHECKUSR *LIBL/INCGI) ACTGRP(CGI) AUT(*USE)
********************************************************************
      * RETTINGER I DETTE PROGRAM:
PTFnr:*Sek Sig Vers  Beskrivelse...........................
""""""*"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
10XXX * 01 YBC PTF10 NYTT SØKEFELT FOR FAKTURA KUNDENR, VIS DETTE
10XXX * 02 YBC PTF10 SORT PÅ FAKTURANR
********************************************************************
      *
      *********************************************************************
      * MAIN PROGRAM FLOW
      *********************************************************************
      /copy syspeds/qrpgsrcpy,hspecs
      /copy syspeds/qrpgsrcpy,hspecsbnd
     FBRIDF     UF   E           K DISK    USROPN
     FBRPARF    IF   E           K DISK    USROPN
     FISOFL1    IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR1)
     FISOFL3    IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR3)
     FISOFL7    IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR7)
     FISOFL8    IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR8)
     FISOFL11   IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR11)
     FISOFL12   IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR12)
     FISOFL13   IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR13)
     FISOFL14   IF   E           K DISK    USROPN
     F                                     RENAME(ISOFR:ISOFR14)
N01  FISOFL15   IF   E           K DISK    USROPN
N01  F                                     RENAME(ISOFR:ISOFR15)
     FISOKDT    IF   E           K DISK    USROPN
     FISOKDA    IF   E           K DISK    USROPN
     FISOKDP    IF   E           K DISK    USROPN
     FHEADF     IF   E           K DISK    USROPN
     FKOFAST    IF   E           K DISK    USROPN
     FTRAN      IF   E           K DISK    USROPN
     FCUNDL01   IF   E           K DISK    USROPN
     FWRKCGISS  UF A E           K DISK    usropn
      *--------------------------------------------------------------------
      * Prototype defintions and standard system API error structure
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prototypeb
      /copy syspeds/qrpgsrcpy,usec
      *--------------------------------------------------------------------
      * Variables common to CGI programs
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,variables3
      *--------------------------------------------------------------------
     D OddEven         s             10
      * Variables received from the input string
     D lng             s              2
     D BckGnd          s             10
     D lstbrd          s              1
     D UsrSpcName      s             10
     D WSUSER          S             10
     D WSNA            S             30
     D WSKNA           S              8
     D XWSKNA          S              8  0
     D WSDTF           S             10
     D XWSDTF          S              8  0
     D WSSAKN          S              7
     D XWSSAKN         S              7  0
     D WSAVD           S              4
     D XWSAVD          S              4  0
     D WSOPD           S              7
     D XWSOPD          S              7  0
     D WSFN            S              7
     D XWSFN           S              7  0
     D WSFNIN          S             17
     D WSTN            S              8
     D XWSTN           S              8  0
     D WSKNT           S              8
     D XWSKNT          S              8  0
N01  D WSFKN           S              8
N01  D XWSFKN          S              8  0
N01  D XFAKTKUN        S             16
     D WSOIT           S              1
     D WSPT            S              5
     D WSAA            S              5
     D WSAP            S              5
     D WSST            S              5
     D WSUSRS          S             10
     D WSLEDET1        S             15
     D WSLEDET2        S             15
     D WSLEDET3        S             15
     D VALG01          S             50
     D VALG02          S             50
     D VALG03          S             50
     D VALG04          S             50
     D VALG05          S             50
     D VALG06          S             50
     D VALG07          S             50
     D VALG08          S             50
     D VALG09          S             50
     D VALG10          S             50
     D VALG11          S             50
     D WINT            s              6
     D TOTFORV         S             11  2
     D TOTRES          S             11  2
     D TOTSAK          S              5  0
     D WSMS01          S              1
     D WSMS02          S              1
     D WSMS03          S              1
     D WSMS04          S              1
     D WSMS05          S              1
     D WSMS06          S              1
     D WSMS07          S              1
     D WSMS08          S              1
     D WSMS09          S              1
     D WSMS10          S              1
     D WSMS11          S              1
N02  D WSMS12          S              1
     D PGM             C                   CONST('SYSPED/CHECKUSR')
      * Variables received from the input string
     D Lib             s             10
     D Fn              s             10
     D Mbr             s             10
      * tekstkonstanter
     D VALG01no        C                   CONST('Anmeldersnr.')
     D VALG02no        C                   CONST('Saksnr.')
     D VALG03no        C                   CONST('Oppdragsref.')
     D VALG04no        C                   CONST('Turnr.')
     D VALG05no        C                   CONST('Vis oppdrag på tur:')
     D VALG06no        C                   CONST('Fakturanr.')
     D VALG07no        C                   CONST('Inngående fakturaref.')
     D VALG08no        C                   CONST('Transportørsnr.')
     D VALG09no        C                   CONST('Kun posttype:')
     D VALG10no        C                   CONST('Kun arvvikets art:')
     D VALG11no        C                   CONST('Kun Ansvarlig part:')
     D                 DS
     D  DataDS                 1   1024
     D  ISSAKN                 1      7  0
     D  ISFTUN                 8     15  0
     D  ISFAVD                16     19  0
     D  ISFOPD                20     26  0
     D  ISSYSREF              16     26
     D  ISFN                  27     33  0
     D  ISFBIL                34     43
     D  ISKNA                 44     51  0
     D  ISFPFO                52     56
     D  ISFAVA                57     61
     D  ISFAV1                62    136
     D  ISKRAV               137    145  2
     D  ISFKOS               146    154  2
     D  ISFRDA               155    162  0
     D  ISST                 163    163
     D  ISFNIN               164    180
     D  ISFTRF               181    188  0
     D  ISUSRS               189    198
     D  ISFORV               199    207  2
     D  WSRES                208    216  2
     D  ISSDT                217    224  0
     D  ISINT                225    233  2
N01  D  ISFKN                234    241  0
     D                 DS
     D  WKKEY                  1    512
     D  WKSTR                  1      1
     D  WKMS01               231    231
     D  WKMS02               232    232
     D  WKMS03               233    233
     D  WKMS04               234    234
     D  WKMS05               235    235
     D  WKMS06               236    236
     D  WKMS07               237    237
     D  WKMS08               238    238
     D  WKMS09               239    239
     D  WKMS10               240    240
     D  WKMS11               241    241
N02  D  WKMS12               242    242
     D  WKEND                256    256
     D                 DS
     D WKEY1                   1    256
     D KEY1                    1    256    DIM(256)
     D                 DS
     D WKEY2                   1    256
     D KEY                     1    256    DIM(256)
     D                 DS
     D WKEY3                   1    256
     D KEY3                    1    256    DIM(256)
     D                 DS
     D WDATA                   1   1024
     D DATA                    1   1024    DIM(1024)
     D                 DS
     D UKEY                    1    128
     D USTR                    1      1
     D UKNA                    2      9
     D UDTF                   11     18
     D USAKN                  19     25
     D UAVD                   26     29
     D UOPD                   30     36
     D UFN                    37     43
     D UTN                    44     51
     D UKNT                   52     59
     D UOIT                   60     60
     D UPT                    61     65
     D UAA                    66     70
     D UAP                    71     75
     D UST                    76     80
     D UFNIN                  81     97
     D UUSRS                  98    107
N01  D UFKN                  108    115
     D UEND                  128    128
      *
      *--------------------------------------------------------------------
      * Prolog common to CGI programs
      * -Receive input from the remote browser
      *--------------------------------------------------------------------
      /copy syspeds/qrpgsrcpy,prolog3
      *=====================================================================******
      * MAIN PROCESS LINE
      *=====================================================================******
      * Get program start time for calculating execution time
     C                   time                    timedata1
      * Parse input
     C                   exsr      Parse
      *
     C                   EXSR      INIT
      *
      * Set output skeleton html member name
     C                   exsr      SetSkl
      * Read skeleton output html, etc.
     C                   callp     gethtml(fn:lib:mbr:'/CGITAG/')
      * Retrieve environment variables
     C                   exsr      RtvEnvVar
      *------------------                                                   ******
      * Write HTML sections
      *
      * 1-Section /$top
     C                   exsr      SetTop
     C                   callp     wrtsection('top')
      *------------------                                                   ******
      * Go to the last Recd already shown (1. time = from top)
     C                   exsr      GotoRecord
      *------------------                                                   ******
      * Write HTML sections
      * 2a-Section /$0found
     C     XRRN          IFEQ      9999999
     C                   callp     wrtsection('0found')
     C                   goto      endhtml
     C                   endif
      *
     C                   EXSR      HENTOPD
      *
      * 3-Section /$tablestr
     C                   exsr      SetTabStr
     C                   callp     wrtsection('tablestr')
     C                   IF        WSMS01 = 'o'
     C                   callp     wrtsection('TabUpDown11')
     C                   ELSE
     C                   callp     wrtsection('TabUpDown12')
     C                   END
     C                   callp     wrtsection('TabUpDown13')
      * 4-Sections /$tablerow
      *
     C                   IF        WSMS01 = 'o'
     C                   EVAL      WKEY2 = '99999999999999999999999999999999999'
     C     WRKKEY        SETGT     WRKCGISS
     C                   ELSE
     C     WINTEG        SETLL     WRKCGISS
     C                   END
      *
     C                   z-add     0             bseq              5 0
     C     *in50         doueq     '1'
     C     STARTVIS      TAG
     C                   IF        WSMS01 = 'o'
     C     WINTEG        READPE    WRKCGISS                               50
     C                   ELSE
     C     WINTEG        READE     WRKCGISS                               50
     C                   END
     C                   IF        *IN50 = *OFF
     C                   MOVE      WDATA         DATADS
     C                   DELETE    WRKCGISR
     C                   eval      bseq=bseq + 1
     C                   exsr      SetTabRow
     C                   callp     wrtsection('tablerow')
     C     bseq          COMP      500                                50  50
     C                   END                                                    *hival
     C                   ENDDO                                                  *hival
      *
      * 5-Section /$tableend
     C                   callp     updhtmlvar('TOTFORV':
     C                             %trim(%editc(TOTFORV:'3')))
     C                   callp     updhtmlvar('TOTRES':
     C                             %trim(%editc(TOTRES:'3')))
     C                   callp     updhtmlvar('TOTSAK':
     C                             %trim(%editc(TOTSAK:'3')))
     C                   callp     wrtsection('tableend')
      *
      * 5a-Section /$foundsome
     C     XRRN          IFLT      9999999
     C                   exsr      SetFndSome
     C                   callp     wrtsection('foundsome2')
     C                   endif
      * 6-Section /$endhtml
     C     endhtml       tag
     C                   exsr      SetEnd
     C     SLUTT         tag
     C                   callp     wrtsection('endhtml')
      * Do not delete the call to wrtsection with section name *fini.  It is needed
      * to ensure that all output html that has been buffered gets output.
     C                   callp     wrtsection('*fini')
     C                   EXSR      EXIT
     C                   return
      *
      *=====================================================================******
      * Parse input
      *=====================================================================******
     C     Parse         begsr
     C                   eval      lng     = zhbgetvar('lng')
     C                   eval      BckGnd  = zhbgetvar('bckgnd')
     C                   eval      lstbrd  = zhbgetvar('lstbrd')
     C                   EVAL      WSUSER  = zhbgetvar('USER')
     C                   EVAL      UsrSpcName  = zhbgetvar('UsrSpcName')
     C                   EVAL      WSNA    = zhbgetvar('KNAVN')
     C                   EVAL      UKEY    = zhbgetvar('KEY')
      *
     C                   IF        UKEY    = *BLANKS
      *
     C                   EVAL      WSKNA   = zhbgetvar('WSKNA')
     C                   EVAL      WSDTF   = zhbgetvar('WSDTF')
     C                   EVAL      WSSAKN  = zhbgetvar('WSSAKN')
     C                   EVAL      WSAVD   = zhbgetvar('WSAVD')
     C                   EVAL      WSOPD   = zhbgetvar('WSOPD')
     C                   EVAL      WSFN    = zhbgetvar('WSFN')
     C                   EVAL      WSFNIN  = zhbgetvar('WSFNIN')
     C                   EVAL      WSTN    = zhbgetvar('WSTN')
     C                   EVAL      WSKNT   = zhbgetvar('WSKNT')
N01  C                   EVAL      WSFKN   = zhbgetvar('WSFKN')
     C                   EVAL      WSOIT   = zhbgetvar('WSOIT')
     C                   EVAL      WSPT    = zhbgetvar('WSPT')
     C                   EVAL      WSAA    = zhbgetvar('WSAA')
     C                   EVAL      WSAP    = zhbgetvar('WSAP')
     C                   EVAL      WSST    = zhbgetvar('WSST')
     C                   EVAL      WSUSRS  = zhbgetvar('WSUSRS')
      *
     C                   ELSE
      *
     C                   EVAL      WSKNA   = UKNA
     C                   EVAL      WSDTF   = UDTF
     C                   EVAL      WSSAKN  = USAKN
     C                   EVAL      WSAVD   = UAVD
     C                   EVAL      WSOPD   = UOPD
     C                   EVAL      WSFN    = UFN
     C                   EVAL      WSFNIN  = UFNIN
     C                   EVAL      WSTN    = UTN
     C                   EVAL      WSKNT   = UKNT
N01  C                   EVAL      WSFKN   = UFKN
     C                   EVAL      WSOIT   = UOIT
     C                   EVAL      WSPT    = UPT
     C                   EVAL      WSAA    = UAA
     C                   EVAL      WSAP    = UAP
     C                   EVAL      WSST    = UST
     C                   EVAL      WSUSRS  = UUSRS
      *
     C                   END
      *
     C                   EVAL      WKKEY   = zhbgetvar('WKEY')
     C                   IF        WKKEY = *BLANKS
      *
     C                   eval      WINT     = zhbgetvar('WINT')
     C                   eval      WINTEG   = c2n2(WINT)
      *
     C                   EVAL      WSMS01  = zhbgetvar('WSMS01')
     C                   EVAL      WSMS02  = zhbgetvar('WSMS02')
     C                   EVAL      WSMS03  = zhbgetvar('WSMS03')
     C                   EVAL      WSMS04  = zhbgetvar('WSMS04')
     C                   EVAL      WSMS05  = zhbgetvar('WSMS05')
     C                   EVAL      WSMS06  = zhbgetvar('WSMS06')
     C                   EVAL      WSMS07  = zhbgetvar('WSMS07')
     C                   EVAL      WSMS08  = zhbgetvar('WSMS08')
     C                   EVAL      WSMS09  = zhbgetvar('WSMS09')
     C                   EVAL      WSMS10  = zhbgetvar('WSMS10')
     C                   EVAL      WSMS11  = zhbgetvar('WSMS11')
N02  C                   EVAL      WSMS12  = zhbgetvar('WSMS12')
      *
     C                   MOVE      '.'           WKSTR
     C                   MOVE      WSMS01        WKMS01
     C                   MOVE      WSMS02        WKMS02
     C                   MOVE      WSMS03        WKMS03
     C                   MOVE      WSMS04        WKMS04
     C                   MOVE      WSMS05        WKMS05
     C                   MOVE      WSMS06        WKMS06
     C                   MOVE      WSMS07        WKMS07
     C                   MOVE      WSMS08        WKMS08
     C                   MOVE      WSMS09        WKMS09
     C                   MOVE      WSMS10        WKMS10
     C                   MOVE      WSMS11        WKMS11
N02  C                   MOVE      WSMS12        WKMS12
     C                   MOVE      '.'           WKEND
      *
     C                   ELSE
      *
     C                   MOVE      WKMS01        WSMS01
     C                   MOVE      WKMS02        WSMS02
     C                   MOVE      WKMS03        WSMS03
     C                   MOVE      WKMS04        WSMS04
     C                   MOVE      WKMS05        WSMS05
     C                   MOVE      WKMS06        WSMS06
     C                   MOVE      WKMS07        WSMS07
     C                   MOVE      WKMS08        WSMS08
     C                   MOVE      WKMS09        WSMS09
     C                   MOVE      WKMS10        WSMS10
     C                   MOVE      WKMS11        WSMS11
N02  C                   MOVE      WKMS12        WSMS12
      *
     C                   END
      *
      *
     C                   EVAL      XWSKNA  = c2n2(WSKNA)
     C                   EVAL      XWSDTF  = c2n2(WSDTF)
     C                   EVAL      XWSSAKN = c2n2(WSSAKN)
     C                   EVAL      XWSAVD  = c2n2(WSAVD)
     C                   EVAL      XWSOPD  = c2n2(WSOPD)
     C                   EVAL      XWSFN   = c2n2(WSFN)
     C                   EVAL      XWSTN   = c2n2(WSTN )
     C                   EVAL      XWSKNT  = c2n2(WSKNT)
N01  C                   EVAL      XWSFKN  = c2n2(WSFKN)
      *
     C                   endsr
      *
      *=====================================================================******
      *  Set output variables for section /$top
      *  (search criteria)
      *=====================================================================******
     C     SetTop        begsr
      * Repeat national language for the next invocation
     C                   callp     updhtmlvar('LNG':lng:
     C                             InitHTMLVars)
OddEvC                   callp     updHTMLvar('ROWHEAD':RowHead)
OddEvC                   callp     updHTMLvar('LogoImg':LogoImg)
      * Color for text, background, links, visited links, active links
     C                   callp     updhtmlvar('TXTCOLOR':'black')
     C                   callp     updhtmlvar('BOLD':' ')
     C                   callp     updhtmlvar('BGCOLOR':BIFARG)
     C                   callp     updhtmlvar('LINK':'0000FF')
     C                   callp     updhtmlvar('VLINK':'FF0000')
     C                   callp     updhtmlvar('ALINK':'00FF00')
      * KUNDE
     C                   callp     updhtmlvar('WSNA':WSNA)
     C                   callp     updhtmlvar('USER':WSUSER)
BODY C                   callp     updhtmlvar('BODYCLASS':'class='+BIFARG)
     C                   callp     updHtmlVar('UsrSpcName':UsrSpcName)
     C                   callp     updHTMLvar('sdato':
     C                             %trim(%editw(BIDTV:'    .  .  ')))
     C                   callp     updHTMLvar('stid':
     C                             %trim(%editw(BITIDV:'  .  .  ')))
      *
     C                   callp     updHTMLvar('KEY':UKEY)
     C                   callp     updHTMLvar('WSKNA':WSKNA)
     C                   callp     updHTMLvar('WSDTF':WSDTF)
     C                   callp     updHTMLvar('WSSAKN':WSSAKN)
     C                   callp     updHTMLvar('WSAVD':WSAVD)
     C                   callp     updHTMLvar('WSOPD':WSOPD)
     C                   callp     updHTMLvar('WSFN':WSFN)
     C                   callp     updHTMLvar('WSFNIN':WSFNIN)
     C                   callp     updHTMLvar('WSTN':WSTN)
     C                   callp     updHTMLvar('WSKNT':WSKNT)
N01  C                   callp     updHTMLvar('WSFKN':WSFKN)
     C                   callp     updHTMLvar('WSOIT':WSOIT)
     C                   callp     updHTMLvar('WSPT':WSPT)
     C                   callp     updHTMLvar('WSAA':WSAA)
     C                   callp     updHTMLvar('WSAP':WSAP)
     C                   callp     updHTMLvar('WSST':WSST)
     C                   callp     updHTMLvar('WSUSRS':WSUSRS)
      *
     C     KOFASTK1      CHAIN     KOFAST                             33
     C                   IF        *IN33
     C                   EVAL      WSLEDET1 = 'posttype'
     C                   ELSE
     C                   EVAL      WSLEDET1 = KFTXT
     C                   END
     C                   callp     updHTMLvar('WSLEDET1':WSLEDET1)
     C     KOFASTK2      CHAIN     KOFAST                             33
     C                   IF        *IN33
     C                   EVAL      WSLEDET2 = 'avvikets art'
     C                   ELSE
     C                   EVAL      WSLEDET2 = KFTXT
     C                   END
     C                   callp     updHTMLvar('WSLEDET2':WSLEDET2)
     C     KOFASTK3      CHAIN     KOFAST                             33
     C                   IF        *IN33
     C                   EVAL      WSLEDET3 = 'ansvarlig part'
     C                   ELSE
     C                   EVAL      WSLEDET3 = KFTXT
     C                   END
     C                   callp     updHTMLvar('WSLEDET3':WSLEDET3)
      *
     C                   EVAL      UKEY   = *BLANKS
     C                   EVAL      USTR   = '.'
     C                   EVAL      UKNA   = WSKNA
     C                   EVAL      UDTF   = WSDTF
     C                   EVAL      USAKN  = WSSAKN
     C                   EVAL      UAVD   = WSAVD
     C                   EVAL      UOPD   = WSOPD
     C                   EVAL      UFN    = WSFN
     C                   EVAL      UFNIN  = WSFNIN
     C                   EVAL      UTN    = WSTN
     C                   EVAL      UKNT   = WSKNT
N01  C                   EVAL      UFKN   = WSFKN
     C                   EVAL      UOIT   = WSOIT
     C                   EVAL      UPT    = WSPT
     C                   EVAL      UAA    = WSAA
     C                   EVAL      UAP    = WSAP
     C                   EVAL      UST    = WSST
     C                   EVAL      UUSRS  = WSUSRS
     C                   EVAL      UEND   = '.'
     C                   callp     updHTMLvar('KEY':UKEY)
      *
     C                   endsr
      *
      *=====================================================================******
      *  Set output variables for section /$tablestr (table start)
      *=====================================================================******
     C     SetTabStr     begsr
     C     lstbrd        ifeq      'Y'
     C                   callp     updhtmlvar('LB':'0')
     C                   else
     C                   callp     updhtmlvar('LB':'1')
     C                   endif
      *
     C                   callp     updhtmlvar('WKKEY':WKKEY)
     C                   eval      WKEY3 = WKKEY
S02  C*                  MOVEA     '          '  KEY3(231)
N02  C                   MOVEA     '            'KEY3(231)
     C                   MOVE      'o'           KEY3(231)
     C                   callp     updhtmlvar('WKEY01':WKEY3)
     C                   MOVE      ' '           KEY3(231)
     C                   MOVE      'o'           KEY3(232)
     C                   callp     updhtmlvar('WKEY02':WKEY3)
     C                   MOVE      ' '           KEY3(232)
     C                   MOVE      'o'           KEY3(233)
     C                   callp     updhtmlvar('WKEY03':WKEY3)
     C                   MOVE      ' '           KEY3(233)
     C                   MOVE      'o'           KEY3(234)
     C                   callp     updhtmlvar('WKEY04':WKEY3)
     C                   MOVE      ' '           KEY3(234)
     C                   MOVE      'o'           KEY3(235)
     C                   callp     updhtmlvar('WKEY05':WKEY3)
     C                   MOVE      ' '           KEY3(235)
     C                   MOVE      'o'           KEY3(236)
     C                   callp     updhtmlvar('WKEY06':WKEY3)
     C                   MOVE      ' '           KEY3(236)
     C                   MOVE      'o'           KEY3(237)
     C                   callp     updhtmlvar('WKEY07':WKEY3)
     C                   MOVE      ' '           KEY3(237)
     C                   MOVE      'o'           KEY3(238)
     C                   callp     updhtmlvar('WKEY08':WKEY3)
     C                   MOVE      ' '           KEY3(238)
     C                   MOVE      'o'           KEY3(239)
     C                   callp     updhtmlvar('WKEY09':WKEY3)
     C                   MOVE      ' '           KEY3(239)
     C                   MOVE      'o'           KEY3(240)
     C                   callp     updhtmlvar('WKEY10':WKEY3)
N02  C                   MOVE      ' '           KEY3(240)
N02  C                   MOVE      'o'           KEY3(241)
N02  C                   callp     updhtmlvar('WKEY11':WKEY3)
N02  C                   MOVE      ' '           KEY3(241)
N02  C                   MOVE      'o'           KEY3(242)
N02  C                   callp     updhtmlvar('WKEY12':WKEY3)
      *
     C                   endsr
      *
      *=====================================================================******
      *  Set output variables for section /$tablerow (table row)
      *=====================================================================******
     C     SetTabRow     begsr
      * odde/partalls-linjer i alternativ skyggelegging/bakgrunnsfarge
     c     OddEven       IFEQ      ODD
     c                   eval      OddEven = EVEN
     c                   else
     c                   eval      OddEven = ODD
     c                   end
     C                   callp     updHTMLvar('ODDEVEN':OddEven)
     c* Sequence of this Recd (numeric, converted to char)
     C                   move      bseq          bseqchar          5
     C                   callp     updhtmlvar('SEQ':bseqchar)
     C                   callp     updhtmlvar('ISSAKN':
     C                             %trim(%editc(ISSAKN:'Z')))
     C                   callp     updhtmlvar('ISFTUN':
     C                             %trim(%editc(ISFTUN:'Z')))
     C                   callp     updhtmlvar('ISFAVD':
     C                             %trim(%editc(ISFAVD:'Z')))
     C                   callp     updhtmlvar('ISFOPD':
     C                             %trim(%editc(ISFOPD:'Z')))
S01  C*                  callp     updhtmlvar('ISFN':
S01  C*                            %trim(%editc(ISFN:'Z')))
N01  C                   EVAL      XFAKTKUN = %TRIM(%EDITC(ISFN:'Z'))
N01  C                             + '-' + %TRIM(%EDITC(ISFKN:'Z'))
N01  C                   callp     updhtmlvar('ISFN':XFAKTKUN)
     C                   callp     updhtmlvar('ISFTRF':
     C                             %trim(%editc(ISFTRF:'Z')))
     C                   callp     updhtmlvar('ISFNIN':ISFNIN)
     C                   callp     updhtmlvar('ISFBIL':ISFBIL)
     C     TRANK         CHAIN     TRAN                               33
     C                   IF        *IN33
     C     TRANK         CHAIN     CUNDL01                            33
     C  N33              callp     updhtmlvar('VMNAVN':KNAVN)
     C   33              callp     updhtmlvar('VMNAVN':'')
     C                   ELSE
     C                   callp     updhtmlvar('VMNAVN':VMNAVN)
     C                   END
     C                   callp     updhtmlvar('ISFADA':
     C                             %trim(%editw(ISFADA:'    .  .  ')))
     C                   callp     updhtmlvar('ISFAND':
     C                             %trim(%editw(ISFAND:'    .  .  ')))
     C                   callp     updhtmlvar('TTEXT':ISFPFO)
     C     ISFPFO        CHAIN     ISOKDT                             33
     C                   IF        (*IN33 OR (TFARGE = *BLANKS))
     C                   callp     updhtmlvar('PTFARGE':'')
     C                   ELSE
     C                   EVAL      XFARGE = 'BGCOLOR="#'
     C                   CAT       TFARGE:0      XFARGE           30
     C                   CAT       '"':0         XFARGE
     C                   callp     updhtmlvar('PTFARGE':XFARGE)
     C                   ENDIF
     C                   callp     updhtmlvar('ATEXT':ISFAVA)
     C     ISFAVA        CHAIN     ISOKDA                             33
     C                   IF        (*IN33 OR (AFARGE = *BLANKS))
     C                   callp     updhtmlvar('AVFARGE':'')
     C                   ELSE
     C                   EVAL      XFARGE = 'BGCOLOR="#'
     C                   CAT       AFARGE:0      XFARGE           30
     C                   CAT       '"':0         XFARGE
     C                   callp     updhtmlvar('AVFARGE':XFARGE)
     C                   ENDIF
     C                   callp     updhtmlvar('PTEXT':ISFANS)
     C     ISFANS        CHAIN     ISOKDP                             33
     C                   IF        (*IN33 OR (PFARGE = *BLANKS))
     C                   callp     updhtmlvar('ANFARGE':'')
     C                   ELSE
     C                   EVAL      XFARGE = 'BGCOLOR="#'
     C                   CAT       PFARGE:0      XFARGE           30
     C                   CAT       '"':0         XFARGE
     C                   callp     updhtmlvar('ANFARGE':XFARGE)
     C                   ENDIF
     C                   callp     updhtmlvar('ISFAV1':ISFAV1)
     C*                  callp     updhtmlvar('ISFSKL':
     C*                            %trim(%editc(ISFSKL:'Z')))
     C*                  callp     updhtmlvar('ISFSKG':
     C*                            %trim(%editc(ISFSKG:'Z')))
     C                   callp     updhtmlvar('ISFORV':
     C                             %trim(%editc(ISFORV:'L')))
     C                   EVAL      WSRES = ISFKOS + ISINT
     C                   EVAL      TOTFORV = TOTFORV + ISFORV
     C                   EVAL      TOTRES  = TOTRES  + WSRES
     C                   EVAL      TOTSAK  = TOTSAK  + 1
     C                   callp     updhtmlvar('WSRES':
     C                             %trim(%editc(WSRES:'L')))
     C                   callp     updhtmlvar('ISFRDA':
     C                             %trim(%editw(ISFRDA:'    .  .  ')))
     C                   callp     updhtmlvar('ISSDT':
     C                             %trim(%editw(ISSDT:'    .  .  ')))
     C                   callp     updhtmlvar('ISST':ISST)
     C                   callp     updhtmlvar('ISUSRS':ISUSRS)
      *
     C                   IF        ((ISFAVD <> 0) AND (ISFOPD <> 0))
     C     HEADFK        CHAIN     HEADF                              33
     C  N33              IF        ((HEUR = 'A') OR (HEUR = 'C'))
     C                   callp     updhtmlvar('XKNAVN':HENAK)
     C                   ELSE
     C                   callp     updhtmlvar('XKNAVN':HENAS)
     C                   END
     C   33              callp     updhtmlvar('XKNAVN':'')
     C                   ELSE
     C                   callp     updhtmlvar('XKNAVN':'')
     C                   END
      *
     C                   endsr
      *
      *=====================================================================******
      *  Set output variables for section /$foundsome (some Recds were found)
      *=====================================================================******
     C     SetFndSome    begsr
      * Repeat background color
     C                   callp     updhtmlvar('BCKGND':bckgnd)
      *
     C                   endsr
      *=====================================================================******
      *  Set output variables for section /$endhtml
      *=====================================================================******
     C     SetEnd        begsr
      * Server protocol
     C                   callp     updhtmlvar('PROTOCOL':S_Protocol)
      * Compute run time
     C                   time                    timedata2
     C     timedata2     subdur    timedata1     ms:*ms
     C                   eval      sec = ms / 1000000
     C                   callp     updhtmlvar('runtime':
     C                             %trim(%editw(sec:'     0 .   ')))
      *
     C                   endsr
      *=====================================================================******
     C*  Go to the last Recd aleady shown
      *=====================================================================******
     C     GotoRecord    begsr
     C                   MOVE      *ZEROS        XRRN              7 0
      *
     C                   SELECT
     C                   WHEN      XWSKNA  <> 0
     C     ISOFL14K      SETLL     ISOFL14
     C     XWSKNA        READE     ISOFL14                                50
     C                   WHEN      XWSSAKN <> 0
     C     ISOFL8K       SETLL     ISOFL8
     C                   READ      ISOFL8                                 50
     C                   WHEN      XWSAVD  <> 0
     C     ISOFL1K       SETLL     ISOFL1
     C     ISOFL1K       READE     ISOFL1                                 50
     C                   WHEN      ((XWSTN <> 0) AND (WSOIT <> 'Y'))
     C     ISOFL7K       SETLL     ISOFL7
     C     XWSTN         READE     ISOFL7                                 50
     C                   WHEN      ((XWSTN <> 0) AND (WSOIT = 'Y'))
     C     ISOFL11K      SETLL     ISOFL11
     C     XWSTN         READE     ISOFL11                                50
     C                   WHEN      XWSFN <> 0
     C     ISOFL12K      SETLL     ISOFL12
     C                   READ      ISOFL12                                50
     C                   WHEN      WSFNIN <> *BLANKS
     C     WSFNIN        SETLL     ISOFL13
     C                   READ      ISOFL13                                50
     C                   WHEN      XWSKNT  <> 0
     C     ISOFL3K       SETLL     ISOFL3
     C     XWSKNT        READE     ISOFL3                                 50
N01  C                   WHEN      XWSFKN  <> 0
N01  C     ISOFL15K      SETLL     ISOFL15
N01  C     XWSFKN        READE     ISOFL15                                50
     C                   OTHER
     C     ISOFL8K       SETLL     ISOFL8
     C                   READ      ISOFL8                                 50
     C                   ENDSL
      *
     C                   DOW       *IN50 = *OFF
     C                   MOVE      *OFF          *IN33
     C                   IF        WSPT <> '*ALL'
     C     WSPT          COMP      ISFPFO                             3333
     C                   END
     C  N33              IF        WSAA <> '*ALL'
     C     WSAA          COMP      ISFAVA                             3333
     C                   END
     C  N33              IF        WSAP <> '*ALL'
     C     WSAP          COMP      ISFANS                             3333
     C                   END
     C  N33              IF        WSST <> '*ALL'
     C     WSST          COMP      ISST                               3333
     C                   END
     C  N33              IF        WSUSRS <> '*ALL'
     C     WSUSRS        COMP      ISUSRS                             3333
     C                   END
     C                   IF        *IN33 = *OFF
     C                   LEAVE
     C                   END
     C                   SELECT
     C                   WHEN      XWSKNA  <> 0
     C     XWSKNA        READE     ISOFL14                                50
     C                   WHEN      XWSSAKN <> 0
     C                   READ      ISOFL8                                 50
     C                   WHEN      XWSAVD  <> 0
     C     ISOFL1K       READE     ISOFL1                                 50
     C                   WHEN      ((XWSTN <> 0) AND (WSOIT <> 'Y'))
     C     XWSTN         READE     ISOFL7                                 50
     C                   WHEN      ((XWSTN <> 0) AND (WSOIT = 'Y'))
     C     XWSTN         READE     ISOFL11                                50
     C                   WHEN      XWSFN <> 0
     C                   READ      ISOFL12                                50
     C                   WHEN      WSFNIN <> *BLANKS
     C                   READ      ISOFL13                                50
     C                   WHEN      XWSKNT  <> 0
     C     XWSKNT        READE     ISOFL3                                 50
N01  C                   WHEN      XWSFKN  <> 0
N01  C     XWSFKN        READE     ISOFL15                                50
     C                   OTHER
     C                   READ      ISOFL8                                 50
     C                   ENDSL
     C                   ENDDO
      *
     C   50              MOVE      999999999     XRRN
      *
     C                   endsr
      *=====================================================================******
      * HENT OPPDRAG
      *=====================================================================******
     C     HENTOPD       BEGSR
      *
     C     WINTEG        SETLL     WRKCGISS
     C     WINTEG        READE     WRKCGISS                               50
     C                   DOW       *IN50 = *OFF
     C                   DELETE    WRKCGISR
     C     WINTEG        READE     WRKCGISS                               50
     C                   ENDDO
     C                   MOVE      *ZEROS        XN                5 0
      *
     C                   SELECT
     C                   WHEN      XWSKNA  <> 0
     C     ISOFL14K      SETLL     ISOFL14
     C                   WHEN      XWSSAKN <> 0
     C     ISOFL8K       SETLL     ISOFL8
     C                   WHEN      XWSAVD  <> 0
     C     ISOFL1K       SETLL     ISOFL1
     C                   WHEN      ((XWSTN <> 0) AND (WSOIT <> 'Y'))
     C     ISOFL7K       SETLL     ISOFL7
     C                   WHEN      ((XWSTN <> 0) AND (WSOIT = 'Y'))
     C     ISOFL11K      SETLL     ISOFL11
     C                   WHEN      XWSFN <> 0
     C     XWSFN         SETLL     ISOFL12
     C                   WHEN      WSFNIN <> *BLANKS
     C     WSFNIN        SETLL     ISOFL13
     C                   WHEN      XWSKNT  <> 0
     C     ISOFL3K       SETLL     ISOFL3
N01  C                   WHEN      XWSFKN  <> 0
N01  C     ISOFL15K      SETLL     ISOFL15
     C                   OTHER
     C     ISOFL8K       SETLL     ISOFL8
     C                   ENDSL
      *
     C                   MOVE      *BLANKS       WKEY2
     C     STHENTOPD     TAG
     C                   SELECT
     C                   WHEN      XWSKNA  <> 0
     C     XWSKNA        READE     ISOFL14                                50
     C                   WHEN      XWSSAKN <> 0
     C                   READ      ISOFL8                                 50
     C                   WHEN      XWSAVD  <> 0
     C     ISOFL1K       READE     ISOFL1                                 50
     C                   WHEN      ((XWSTN <> 0) AND (WSOIT <> 'Y'))
     C     XWSTN         READE     ISOFL7                                 50
     C                   WHEN      ((XWSTN <> 0) AND (WSOIT = 'Y'))
     C     XWSTN         READE     ISOFL11                                50
     C                   WHEN      XWSFN <> 0
     C                   READ      ISOFL12                                50
     C                   WHEN      WSFNIN <> *BLANKS
     C                   READ      ISOFL13                                50
     C                   WHEN      XWSKNT  <> 0
     C     XWSKNT        READE     ISOFL3                                 50
N01  C                   WHEN      XWSFKN  <> 0
N01  C     XWSFKN        READE     ISOFL15                                50
     C                   OTHER
     C                   READ      ISOFL8                                 50
     C                   ENDSL
      *
     C                   IF        *IN50 = *OFF
      *
     C                   MOVE      *OFF          *IN33
     C                   IF        WSPT <> '*ALL'
     C     WSPT          COMP      ISFPFO                             3333
     C                   END
     C  N33              IF        WSAA <> '*ALL'
     C     WSAA          COMP      ISFAVA                             3333
     C                   END
     C  N33              IF        WSAP <> '*ALL'
     C     WSAP          COMP      ISFANS                             3333
     C                   END
     C  N33              IF        WSST <> '*ALL'
     C     WSST          COMP      ISST                               3333
     C                   END
     C  N33              IF        WSUSRS <> '*ALL'
     C     WSUSRS        COMP      ISUSRS                             3333
     C                   END
     C     *IN33         CABEQ     *ON           STHENTOPD
      *
     C                   SELECT
     C                   WHEN      WSMS01 = 'o'
     C                   MOVEL     ISSAKN        WKEY2
     C                   WHEN      WSMS02 = 'o'
     C                   MOVEL     ISFTUN        WKEY2
     C                   WHEN      WSMS03 = 'o'
     C                   MOVEL     ISSYSREF      WKEY2
     C                   WHEN      WSMS04 = 'o'
     C                   MOVEL     ISFBIL        XAN18            18
     C                   MOVE      ISFADA        XAN18
     C                   MOVEL     XAN18         WKEY2
     C                   WHEN      WSMS05 = 'o'
     C     HEADFK        CHAIN     HEADF                              33
     C   33              MOVE      *BLANKS       XAN38            38
     C  N33              IF        ((HEUR = 'A') OR (HEUR = 'C'))
     C                   MOVEL     HENAK         XAN38
     C                   ELSE
     C                   MOVEL     HENAS         XAN38
     C                   END
     C                   MOVE      ISFRDA        XAN38
     C                   MOVEL     XAN38         WKEY2
     C                   WHEN      WSMS06 = 'o'
     C                   MOVEL     ISFPFO        XAN13            13
     C                   MOVE      ISFRDA        XAN13
     C                   EVAL      WKEY2 = XAN13
     C                   WHEN      WSMS07 = 'o'
     C                   MOVEL     ISFRDA        XAN15            15
     C                   MOVE      ISSAKN        XAN15
     C                   MOVEL     XAN15         WKEY2
     C                   WHEN      WSMS08 = 'o'
     C                   MOVEL     ISST          XAN09            09
     C                   MOVE      ISSAKN        XAN09
     C                   MOVEL     XAN09         WKEY2
     C                   WHEN      WSMS09 = 'o'
     C                   MOVEL     ISUSRS        XAN17            17
     C                   MOVE      ISSAKN        XAN17
     C                   MOVEL     XAN17         WKEY2
     C                   WHEN      WSMS10 = 'o'
     C                   MOVEL     ISFN          WKEY2
     C                   WHEN      WSMS11 = 'o'
     C                   MOVEL     ISSAKN        WKEY2
N02  C                   WHEN      WSMS12 = 'o'
N02  C                   MOVEL     ISFN          WKEY2
     C                   OTHER
     C                   MOVEL     ISSAKN        WKEY2
     C                   ENDSL
      *
     C                   MOVE      DATADS        WDATA
     C                   WRITE     WRKCGISR
      *
     C                   ADD       1             XN
     C     XN            CABGT     10000         SLHENTOPD
      *
     C                   GOTO      STHENTOPD
     C                   END
      *
     C     SLHENTOPD     TAG
     C                   ENDSR
      *
      *=====================================================================******
      * Set html output skeleton member before its read into memory
      *=====================================================================******
     C     SetSkl        begsr
      *------------------
      * Set html output skeleton member
     C                   eval      lng = uppify(lng)
      * "HTMLSRC  " er dft = NORSK, ved å trykke på FLAGGET i inng.
      * kan dette endre stil "HTMLSRCXX" avh. av støttede språk
     C                   eval      Lib = '*LIBL'
     C                   eval      Fn  = 'HTMLSRC' + lng
     C                   eval      Mbr = 'EISO01'
     C** JOV             CAT       XSPRÅK:0      MBR
      *
     C                   endsr
      *=====================================================================******
      *  Retrieve environment variables
      *=====================================================================******
     C     RtvEnvVar     begsr
      * Use getenvp to get this server's protocol and name
     C                   eval      S_Protocol =getenv('SERVER_PROTOCOL':
     C                             qusec)
     C                   eval      S_Name     =getenv('SERVER_NAME':
     C                             qusec)
      *
     C                   endsr
      *=====================================================================******
      *  INITIER
      *=====================================================================******
     C     INIT          begsr
     C                   OPEN      BRIDF
     C     WSUSER        CHAIN(N)  BRIDF                              50
     C* En "standardvariant" libl: call bound (INCGI=*MODULE) med parameter.
     C     BILIBL        ifeq      *blanks
     C                   callb     'INCGI'
     C                   parm                    BISTDL
     C                   else
     C* Helt egen bibl.liste satt på user - normal CALL (BILIBL er "*pgm")
     C                   call      BILIBL
     C                   end
      *
     C                   EXSR      TSTUSER
      *
OddEv * hent Parametre som går igjen i mange prog:
OddEv *      Odd/Even/Rowhead-farger,Logobilde,Språk,Intern/Ekstern bruker,  mm
OddEvc                   call      'ESGETPAR'
OddEvc                   parm                    BIBRID
OddEvc                   parm                    BIFIRM
OddEvc                   parm                    BIKUNR
OddEvc                   parm                    BIKNG
OddEvc                   parm                    RowHead          10
OddEvc                   parm                    Odd              10
OddEvc                   parm                    Even             10
OddEvc                   parm                    LogoImg          50
OddEvc                   parm                    XSPRÅK            2
OddEvc                   parm                    XINTERN           1
OddEvc                   parm                    ParmDS1        1024
OddEvc                   parm                    ParmDS2        1024
OddEvc                   parm                    ParmDS3        1024
      *
     C                   open      BRPARF                               50
     C                   open      ISOFL1                               50
     C                   open      ISOFL3                               50
     C                   open      ISOFL7                               50
     C                   open      ISOFL8                               50
     C                   open      ISOFL14                              50
N01  C                   open      ISOFL15                              50
     C                   open      ISOFL11                              50
     C                   open      ISOFL12                              50
     C                   open      ISOFL13                              50
     C                   open      ISOKDT                               50
     C                   open      ISOKDA                               50
     C                   open      ISOKDP                               50
     C                   open      HEADF                                50
     C                   open      TRAN                                 50
     C                   open      CUNDL01                              50
     C                   open      WRKCGISS                             50
     C                   OPEN      KOFAST
      *
     C     KOFASTK1      klist
     C                   kfld                    KFTYP
     C                   kfld                    X1KFKOD           5
     C     KOFASTK2      klist
     C                   kfld                    KFTYP
     C                   kfld                    X2KFKOD           5
     C     KOFASTK3      klist
     C                   kfld                    KFTYP
     C                   kfld                    X3KFKOD           5
     C     ISOFL1K       klist
     C                   kfld                    XWSAVD
     C                   kfld                    XWSOPD
     C     ISOFL3K       klist
     C                   kfld                    XWSKNT
     C     ISOFL7K       klist
     C                   kfld                    XWSTN
     C     ISOFL8K       klist
     C                   kfld                    XWSSAKN
     C     ISOFL14K      klist
     C                   kfld                    XWSKNA
     C                   kfld                    XWSDTF
N01  C     ISOFL15K      klist
N01  C                   kfld                    XWSFKN
N01  C                   kfld                    XWSDTF
     C     ISOFL11K      klist
     C                   kfld                    XWSTN
     C     ISOFL12K      klist
     C                   kfld                    XWSFN
     C     HEADFK        klist
     C                   kfld                    ISFAVD
     C                   kfld                    ISFOPD
     C     TRANK         klist
     C                   kfld                    BIFIRM
     C                   kfld                    ISFTRF
     C     WrkKey        KLIST
     C                   KFLD                    WINTEG
     C                   KFLD                    WKey2
     C     BRPARFK       klist
     C                   kfld                    PABRID
     C                   kfld                    PAKUNR
     C                   kfld                    PAID
      *
     C                   EVAL      KFTYP   = 'AVLETEKST'
     C                   EVAL      X1KFKOD = 'ISTYP'
     C                   EVAL      X2KFKOD = 'ISAVA'
     C                   EVAL      X3KFKOD = 'ISANS'
     C                   EVAL      PABRID = WSUSER
     C                   MOVEL     'SPRÅK'       PAID
     C     BRPARFK       chain     BRPARF                             33
     C                   IF        (*IN33 OR (PAVRDA <> 'EN'))
     C                   MOVE      *BLANKS       XSPRÅK            2
     C                   ELSE
     C                   MOVE      'EN'          XSPRÅK            2
     C                   END
      *
     C                   eval      WINTEG   = random(1:999999)
     C                   move      WINTEG        WINT
      *
     C                   endsr
      *
      *////////////////////////////////////////////////////////////
     C     TSTUSER       BEGSR
      *////////////////////////////////////////////////////////////
      /copy syspeds/qrpgsrcpy,tstuser
      *
     C                   endsr
      *
      *=====================================================================******
      *  AVSLUTT
      *=====================================================================******
     C     EXIT          begsr
     C                   close     BRPARF
     C                   close     BRIDF
     C                   close     ISOFL1
     C                   close     ISOFL3
     C                   close     ISOFL7
     C                   close     ISOFL8
     C                   close     ISOFL14
N01  C                   close     ISOFL15
     C                   close     ISOFL11
     C                   close     ISOFL12
     C                   close     ISOFL13
     C                   close     ISOKDT
     C                   close     ISOKDA
     C                   close     ISOKDP
     C                   close     HEADF
     C                   close     TRAN
     C                   close     CUNDL01
     C                   close     WRKCGISS
     C                   close     KOFAST
     C                   eval      *inlr = *on
      *
     C                   endsr
      *
